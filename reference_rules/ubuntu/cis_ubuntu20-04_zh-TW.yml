# Security Configuration Assessment
# CIS Checks for Ubuntu Linux 20.04 LTS
# Copyright (C) 2023, Wazuh Inc.
#
# This program is free software; you can redistribute it
# and/or modify it under the terms of the GNU General Public
# License (version 2) as published by the FSF - Free Software
# Foundation
#
# Based on:
# Center for Internet Security Ubuntu Linux 20.04 LTS Benchmark v2.0.0 - 05-30-2023

policy:
  id: "cis_ubuntu20-04"
  file: "cis_ubuntu20-04.yml"
  name: "CIS Ubuntu Linux 20.04 LTS Benchmark v2.0.0"
  description: "This document provides prescriptive guidance for establishing a secure configuration posture for Ubuntu Linux 20.04 LTS."
  references:
    - https://www.cisecurity.org/cis-benchmarks/

requirements:
  title: "Check Ubuntu version."
  description: "Requirements for running the SCA scan against Ubuntu Linux 20.04 LTS"
  condition: all
  rules:
    - "f:/etc/os-release -> r:Ubuntu 20.04"
    - "f:/proc/sys/kernel/ostype -> Linux"

checks:
  # 1.1.1.1 Ensure mounting of cramfs filesystems is disabled. (Automated) - Not Implemented
  # 1.1.1.2 Ensure mounting of freevxfs filesystems is disabled. (Automated) - Not Implemented
  # 1.1.1.4 Ensure mounting of hfs filesystems is disabled. (Automated) - Not Implemented
  # 1.1.1.5 Ensure mounting of hfsplus filesystems is disabled. (Automated) - Not Implemented
  # 1.1.1.6 Ensure mounting of squashfs filesystems is disabled. (Automated) - Not Implemented
  # 1.1.1.7 Ensure mounting of udf filesystems is disabled. (Automated) - Not Implemented

  # 1.1.2.1 Ensure /tmp is a separate partition. (Automated)
  - id: 19000
    title: "確保 /tmp 是一個單獨的分割區。"
    description: "/tmp 目錄是一個全域可寫入的目錄，用於所有使用者和某些應用程式的暫存。"
    rationale: "將 /tmp 設為自己的檔案系統允許管理員設定其他掛載選項，例如掛載上的 noexec 選項，從而使 /tmp 對於攻擊者安裝可執行程式碼而言毫無用處。它還可以防止攻擊者建立到系統 setuid 程式的硬連結並等待其更新。一旦程式被更新，硬連結就會被破壞，攻擊者就會擁有自己的程式副本。如果程式碰巧存在安全漏洞，攻擊者可以繼續利用已知的缺陷。這可以透過將 tmpfs 安裝到 /tmp 或為 /tmp 建立單獨的分割區來完成。"
    impact: "Since the /tmp directory is intended to be world-writable, there is a risk of resource exhaustion if it is not bound to a separate partition. Running out of /tmp space is a problem regardless of what kind of filesystem lies under it, but in a configuration where /tmp is not a separate file system it will essentially have the whole disk available, as the default installation only creates a single / partition. On the other hand, a RAM-based /tmp (as with tmpfs) will almost certainly be much smaller, which can lead to applications filling up the filesystem much more easily. Another alternative is to create a dedicated partition for /tmp from a separate volume or disk. One of the downsides of a disk-based dedicated partition is that it will be slower than tmpfs which is RAM-based. /tmp utilizing tmpfs can be resized using the size={size} parameter in the relevant entry in /etc/fstab."
    remediation: "針對您的環境的 /tmp 掛載特定配置要求，請修改 /etc/fstab 或 tmp.mount 單元檔案： 使用 /etc/fstab：適當配置 /etc/fstab：例子： tmpfs /tmp tmpfs defaults,rw,nosuid,nodev,noexec,relatime 0 0 -或- 使用 tmp.mount 單元檔案：運行以下指令以創建 tmp.mount 檔案在正確的位置： # cp -v /usr/share/systemd/tmp.mount /etc/systemd/system/ 編輯 /etc/systemd/system/tmp.mount 以配置 /tmp 掛載：例子： # SPDX-License-Identifier: LGPL-2.1+ # # This file is part of systemd. # # systemd is free software; you can redistribute it and/or modify it # under the terms of the GNU Lesser General Public License as published by # the Free Software Foundation; either version 2.1 of the License, or # (at your option) any later version. [Unit] Description=Temporary Directory (/tmp) Documentation=https://systemd.io/TEMPORARY_DIRECTORIES Documentation=man:file-hierarchy(7) Documentation=https://www.freedesktop.org/wiki/Software/systemd/APIFilesystems ConditionPathIsSymbolicLink=!/tmp DefaultDependencies=no Conflicts=umount.target Before=local-fs.target umount.target After=swap.target [Mount] What=tmpfs Where=/tmp Type=tmpfs Options=mode=1777,strictatime,nosuid,nodev,noexec [Install] WantedBy=local-fs.target 運行以下指令以重新載入 systemd 守護程序並更新 tmp.mount 單元檔案： # systemctl daemon-reload 運行以下指令以啟用並啟動 tmp.mount # systemctl --now enable tmp.mount 注意：可能需要重啟以過渡到掛載在 tmpfs 的 /tmp。"
    references:
      - "https://www.freedesktop.org/wiki/Software/systemd/APIFileSystems/"
      - "https://www.freedesktop.org/software/systemd/man/systemd-fstab-generator.html"
    compliance:
      - cis: ["1.1.2.1"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1499", "T1499.001"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:findmnt -kn /tmp -> r:\s*/tmp\s'

  # 1.1.2.2 Ensure nodev option set on /tmp partition. (Automated)
  - id: 19001
    title: "確保 /tmp 分割區上設定了 nodev 選項。"
    description: "nodev 掛載選項指定檔案系統不能包含特殊裝置。"
    rationale: "由於 /tmp 檔案系統不支援設備，因此設定此選項可確保使用者無法在 /tmp 中建立區塊或字元特殊設備。"
    remediation: "編輯 /etc/fstab 檔案並在第四個欄位（掛載選項）中添加 nodev，範例：<device> /tmp <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0。運行以下指令以使用配置的選項重新掛載 /tmp：# mount -o remount /tmp。"
    compliance:
      - cis: ["1.1.2.2"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1200"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:findmnt -kn /tmp -> r:\s*/tmp\s && r:nodev'

  # 1.1.2.3 Ensure noexec option set on /tmp partition. (Automated)
  - id: 19002
    title: "確保 /tmp 分割區上設定了 noexec 選項。"
    description: "noexec 掛載選項指定檔案系統不能包含可執行二進位檔案。"
    rationale: "由於 /tmp 檔案系統僅用於臨時檔案存儲，因此設定此選項以確保使用者無法從 /tmp 運行可執行二進位檔案。"
    remediation: "編輯 /etc/fstab 檔案並將 noexec 添加到第四欄（掛載選項）中，適用於 /tmp 分區。例如：<device> /tmp <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 執行以下指令以使用配置的選項重新掛載 /tmp: # mount -o remount /tmp."
    compliance:
      - cis: ["1.1.2.3"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022", "M1038"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1204", "T1204.002"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:findmnt -kn /tmp -> r:\s*/tmp\s && r:noexec'

  # 1.1.2.4 Ensure nosuid option set on /tmp partition. (Automated)
  - id: 19003
    title: "確保 /tmp 分割區上設定了 nosuid 選項。"
    description: "nosuid 掛載選項指定檔案系統不能包含 setuid 檔案。"
    rationale: "由於 /tmp 檔案系統僅用於臨時檔案存儲，因此設定此選項可確保使用者無法在 /tmp 中建立 setuid 檔案。"
    remediation: "編輯 /etc/fstab 檔案，並在第四個欄位（掛載選項）中，為 /tmp 分區新增 nosuid。例如： <device> /tmp <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0。運行以下指令以使用配置的選項重新掛載 /tmp： # mount -o remount /tmp。"
    compliance:
      - cis: ["1.1.2.4"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022", "M1038"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1548", "T1548.001"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:findmnt -kn /tmp -> r:\s*/tmp\s && r:nosuid'

  # 1.1.3.1 Ensure separate partition exists for /var. (Automated)
  - id: 19004
    title: "確保 /var 存在單獨的分割區。"
    description: "/var 目錄由守護程式和其他系統服務用來暫時儲存動態資料。這些程序所建立的某些目錄可能是全域可寫入的。"
    rationale: "將 /var 安裝在單獨的分割區上的原因如下。防止資源耗盡 預設安裝僅建立單一 / 分割區。由於/var目錄可能包含全域可寫入的檔案和目錄，因此存在資源耗盡的風險。本質上，整個磁碟都可用於填滿並影響整個系統。此外，系統上的其他操作可能會填滿與 /var 無關的磁碟，並在磁碟已滿時導致整個系統出現意外行為。有關詳細資訊，請參閱 manauditd.conf。對掛載的細粒度控制 將 /var 配置為其自己的檔案系統允許管理員設定其他掛載選項，例如 noexec/nosuid/nodev。這些選項限制了攻擊者在系統上創建漏洞的能力。其他選項允許特定行為。有關獨立於檔案系統和特定於檔案系統的選項的確切詳細資訊，請參閱 man mount。防止利用 /var 的利用範例可能是攻擊者建立到系統 setuid 程式的硬連結並等待其更新。一旦程式被更新，硬連結就會被破壞，攻擊者就會擁有自己的程式副本。如果程式碰巧存在安全漏洞，攻擊者可以繼續利用已知的缺陷。"
    impact: "Resizing filesystems is a common activity in cloud-hosted servers. Separate filesystem partitions may prevent successful resizing, or may require the installation of additional tools solely for the purpose of resizing operations. The use of these additional tools may introduce their own security considerations."
    remediation: "對於新的安裝，在安裝過程中創建自定義分區設置並為 /var 指定一個單獨的分區。 對於之前已安裝的系統，創建一個新分區並適當地配置 /etc/fstab。"
    references:
      - "http://tldp.org/HOWTO/LVM-HOWTO/"
    compliance:
      - cis: ["1.1.3.1"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_tactics: ["TA0006"]
      - mitre_techniques: ["T1499", "T1499.001"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:findmnt -kn /var -> r:\s*/var\s'

  # 1.1.3.2 Ensure nodev option set on /var partition. (Automated)
  - id: 19005
    title: "確保在 /var 分割區上設定了 nodev 選項。"
    description: "nodev 掛載選項指定檔案系統不能包含特殊裝置。"
    rationale: "由於 /var 檔案系統不支援設備，因此設定此選項可確保使用者無法在 /var 中建立區塊或字元特殊設備。"
    remediation: "若 /var 分區存在，請編輯 /etc/fstab 檔案並將 nodev 新增至 /var 分區的第四欄（掛載選項）。範例：<device> /var <fstype> defaults,rw,nosuid,nodev,relatime 0 0 執行以下指令以配置選項重新掛載 /var：# mount -o remount /var."
    compliance:
      - cis: ["1.1.3.2"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1038"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1200"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:findmnt -kn /var -> r:\s*/var\s && r:nodev'

  # 1.1.3.3 Ensure nosuid option set on /var partition. (Automated)
  - id: 19006
    title: "確保 /var 分區上設定了 nosuid 選項。"
    description: "nosuid 掛載選項指定檔案系統不能包含 setuid 檔案。"
    rationale: "由於 /var 檔案系統僅用於日誌等變數檔案，因此設定此選項可確保使用者無法在 /var 中建立 setuid 檔案。"
    remediation: "若 /var 分區存在，編輯 /etc/fstab 檔案並且在 /var 分區的第四個字段（掛載選項）添加 nosuid。範例：<device> /var <fstype> defaults,rw,nosuid,nodev,relatime 0 0 執行以下指令使用配置的選項重新掛載 /var：# mount -o remount /var。"
    compliance:
      - cis: ["1.1.3.3"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1038"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1548", "T1548.001"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:findmnt -kn /var -> r:\s*/var\s && r:nosuid'

  # 1.1.4.1 Ensure separate partition exists for /var/tmp. (Automated)
  - id: 19007
    title: "確保 /var/tmp 存在單獨的分割區。"
    description: "/var/tmp 目錄是一個全域可寫入的目錄，用於所有使用者和某些應用程式的暫存。駐留在 /var/tmp 中的臨時檔案將在重新啟動之間保留。"
    rationale: "將 /var/tmp 安裝在單獨的分割區上的原因如下。防止資源耗盡 預設安裝僅建立單一 / 分割區。由於/var/tmp目錄可能包含全域可寫入的檔案和目錄，因此存在資源耗盡的風險。本質上，整個磁碟都可用於填滿並影響整個系統。此外，系統上的其他操作可能會填滿與 /var/tmp 無關的磁碟，並在磁碟已滿時導致守護程式潛在中斷。對掛載的細粒度控制 將 /var/tmp 配置為其自己的檔案系統允許管理員設定其他掛載選項，例如 noexec/nosuid/nodev。這些選項限制了攻擊者在系統上創建漏洞的能力。其他選項允許特定行為。有關獨立於檔案系統和特定於檔案系統的選項的確切詳細資訊，請參閱 man mount。防止利用 攻擊者利用 /var/tmp 的範例可能是建立到系統 setuid 程式的硬連結並等待其更新。一旦程式被更新，硬連結就會被破壞，攻擊者就會擁有自己的程式副本。如果程式碰巧存在安全漏洞，攻擊者可以繼續利用已知的缺陷。"
    impact: "Resizing filesystems is a common activity in cloud-hosted servers. Separate filesystem partitions may prevent successful resizing, or may require the installation of additional tools solely for the purpose of resizing operations. The use of these additional tools may introduce their own security considerations."
    remediation: "對於新安裝, 在安裝過程中創建自定義分區設置並指定一個單獨的分區給 /var/tmp。對於之前已安裝的系統，創建一個新分區並適當配置 /etc/fstab。"
    references:
      - "http://tldp.org/HOWTO/LVM-HOWTO/"
    compliance:
      - cis: ["1.1.4.1"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1499", "T1499.001"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:findmnt -kn /var/tmp -> r:\s*/var/tmp\s'

  # 1.1.4.2 Ensure nodev option set on /var/tmp partition. (Automated)
  - id: 19008
    title: "確保在 /var/tmp 分割區上設定了 nodev 選項。"
    description: "nodev 掛載選項指定檔案系統不能包含特殊裝置。"
    rationale: "由於 /var/tmp 檔案系統不支援設備，因此設定此選項可確保使用者無法在 /var/tmp 中建立區塊或字元特殊設備。"
    remediation: "如果 /var/tmp 分區存在，編輯 /etc/fstab 檔案並在第四欄位(掛載選項)中為 /var/tmp 分區添加 nodev。 例子: <device> /var/tmp <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 執行以下指令以使用配置的選項重新掛載 /var/tmp: # mount -o remount /var/tmp."
    compliance:
      - cis: ["1.1.4.2"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1200"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c: findmnt -kn /var/tmp -> r:\s*/var/tmp\s && r:nodev'

  # 1.1.4.3 Ensure noexec option set on /var/tmp partition. (Automated)
  - id: 19009
    title: "確保 /var/tmp 分割區上設定了 noexec 選項。"
    description: "noexec 掛載選項指定檔案系統不能包含可執行二進位檔案。"
    rationale: "由於 /var/tmp 檔案系統僅用於臨時檔案存儲，因此設定此選項可確保使用者無法執行 /var/tmp 中的可執行二進位檔案。"
    remediation: "如果 /var/tmp 分區存在，編輯 /etc/fstab 檔案並在第四欄位（掛載選項）中為 /var/tmp 分區新增 noexec。範例：<device> /var/tmp <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 執行以下指令以使用配置的選項重新掛載 /var/tmp：# mount -o remount /var/tmp."
    compliance:
      - cis: ["1.1.4.3"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022", "M1038"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1204", "T1204.002"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:findmnt -kn /var/tmp -> r:\s*/var/tmp\s && r:noexec'

  # 1.1.4.4 Ensure nosuid option set on /var/tmp partition. (Automated)
  - id: 19010
    title: "確保 /var/tmp 分區上設定了 nosuid 選項。"
    description: "nosuid 掛載選項指定檔案系統不能包含 setuid 檔案。"
    rationale: "由於 /var/tmp 檔案系統僅用於臨時檔案存儲，因此設定此選項可確保使用者無法在 /var/tmp 中建立 setuid 檔案。"
    remediation: "如果 /var/tmp 分區存在，編輯 /etc/fstab 檔案並在第四欄（掛載選項）中為 /var/tmp 分區添加 nosuid。範例：<device> /var/tmp <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 執行以下指令以使用配置選項重新掛載 /var/tmp：# mount -o remount /var/tmp."
    compliance:
      - cis: ["1.1.4.4"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022", "M1038"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1548", "T1548.001"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:findmnt -kn /var/tmp -> r:\s*/var/tmp\s && r:nosuid'

  # 1.1.5.1 Ensure separate partition exists for /var/log. (Automated)
  - id: 19011
    title: "確保 /var/log 存在單獨的分割區。"
    description: "/var/log 目錄用於系統服務儲存日誌資料。"
    rationale: "將 /var/log 安裝在單獨的分割區上的原因如下。防止資源耗盡 預設安裝僅建立單一 / 分割區。由於 /var/log 目錄包含的日誌檔案可能會變得非常大，因此存在資源耗盡的風險。本質上，整個磁碟都可用於填滿並影響整個系統。對掛載的細粒度控制 將 /var/log 配置為其自己的檔案系統允許管理員設定其他掛載選項，例如 noexec/nosuid/nodev。這些選項限制了攻擊者在系統上創建漏洞的能力。其他選項允許特定行為。有關獨立於檔案系統和特定於檔案系統的選項的確切詳細資訊，請參閱 man mount。日誌資料的保護 由於/var/log 包含日誌檔案，因此應注意確保資料和掛載點的安全性和完整性。"
    impact: "Resizing filesystems is a common activity in cloud-hosted servers. Separate filesystem partitions may prevent successful resizing, or may require the installation of additional tools solely for the purpose of resizing operations. The use of these additional tools may introduce their own security considerations."
    remediation: "對於新的安裝，在安裝期間創建自定義分割方案，並為 /var/log 指定一個單獨的分割區。對於之前已安裝的系統，創建一個新的分割區並適當配置 /etc/fstab。"
    references:
      - "http://tldp.org/HOWTO/LVM-HOWTO/"
    compliance:
      - cis: ["1.1.5.1"]
      - cis_csc_v8: ["8.3"]
      - cis_csc_v7: ["6.4"]
      - iso_27001-2013: ["A.12.4.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1499", "T1499.001"]
      - pci_dss_v3.2.1: ["10.7"]
      - soc_2: ["A1.1"]
    condition: all
    rules:
      - 'c:findmnt -kn /var/log -> r:\s*/var/log\s'

  # 1.1.5.2 Ensure nodev option set on /var/log partition. (Automated)
  - id: 19012
    title: "確保在 /var/log 分割區上設定了 nodev 選項。"
    description: "nodev 掛載選項指定檔案系統不能包含特殊裝置。"
    rationale: "由於 /var/log 檔案系統不支援設備，因此設定此選項可確保使用者無法在 /var/log 中建立區塊或字元特殊設備。"
    remediation: "如果 /var/log 分區存在，編輯 /etc/fstab 檔案並在第四欄（掛載選項）中為 /var/log 分區添加 nodev。範例：<device> /var/log <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 運行以下指令以使用配置的選項重新掛載 /var/log：# mount -o remount /var/log."
    compliance:
      - cis: ["1.1.5.2"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1200"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:findmnt -kn /var/log -> r:\s*/var/log\s && r:nodev'

  # 1.1.5.3 Ensure noexec option set on /var/log partition. (Automated)
  - id: 19013
    title: "確保 /var/log 分割區上設定了 noexec 選項。"
    description: "noexec 掛載選項指定檔案系統不能包含可執行二進位檔案。"
    rationale: "由於 /var/log 檔案系統僅用於日誌檔案，因此設定此選項以確保使用者無法從 /var/log 執行可執行二進位檔案。"
    remediation: "如果存在 /var/log 分區，編輯 /etc/fstab 檔案，並在 /var/log 分區的第四欄(掛載選項)添加 noexec。範例：<device> /var/log <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 運行以下指令重新掛載 /var/log 並配置選項：# mount -o remount /var/log."
    compliance:
      - cis: ["1.1.5.3"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1204", "T1204.002"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:findmnt -kn /var/log -> r:\s*/var/log\s && r:noexec'

  # 1.1.5.4 Ensure nosuid option set on /var/log partition. (Automated)
  - id: 19014
    title: "確保 /var/log 分區上設定了 nosuid 選項。"
    description: "nosuid 掛載選項指定檔案系統不能包含 setuid 檔案。"
    rationale: "由於 /var/log 檔案系統僅用於日誌檔案，因此設定此選項可確保使用者無法在 /var/log 中建立 setuid 檔案。"
    remediation: "如果 /var/log 分割區存在，請編輯 /etc/fstab 檔案，並在第四欄（掛載選項）中為 /var/log 分割區新增 nosuid。範例：<device> /var/log <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 執行以下指令以使用配置的選項重新掛載 /var/log：# mount -o remount /var/log。"
    compliance:
      - cis: ["1.1.5.4"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1548", "T1548.001"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:findmnt -kn /var/log -> r:\s*/var/log\s && r:nosuid'

  # 1.1.6.1 Ensure separate partition exists for /var/log/audit. (Automated)
  - id: 19015
    title: "確保 /var/log/audit 存在單獨的分割區。"
    description: "稽核守護程式auditd 將日誌資料儲存在/var/log/audit 目錄中。"
    rationale: "將 /var/log/audit 安裝在單獨的分割區上的原因如下。防止資源耗盡 預設安裝僅建立單一 / 分割區。由於 /var/log/audit 目錄包含的audit.log 檔案可能會變得非常大，因此存在資源耗盡的風險。本質上，整個磁碟都可用於填滿並影響整個系統。此外，系統上的其他操作可能會填滿與/var/log/audit無關的磁碟，並導致auditd在磁碟已滿時觸發其space_left_action。有關詳細資訊，請參閱 manauditd.conf。對掛載的細粒度控制 將 /var/log/audit 配置為其自己的檔案系統允許管理員設定其他掛載選項，例如 noexec/nosuid/nodev。這些選項限制了攻擊者在系統上創建漏洞的能力。其他選項允許特定行為。有關獨立於檔案系統和特定於檔案系統的選項的確切詳細資訊，請參閱 man mount。稽核資料的保護 由於 /var/log/audit 包含稽核日誌，因此應注意確保資料和掛載點的安全性和完整性。"
    impact: "Resizing filesystems is a common activity in cloud-hosted servers. Separate filesystem partitions may prevent successful resizing, or may require the installation of additional tools solely for the purpose of resizing operations. The use of these additional tools may introduce their own security considerations."
    remediation: "對於新安裝，在安裝期間創建自定義分區設置並指定一個單獨的分區給 /var/log/audit。對於先前已安裝的系統，請創建一個新分區並適當配置 /etc/fstab。"
    references:
      - "http://tldp.org/HOWTO/LVM-HOWTO/"
    compliance:
      - cis: ["1.1.6.1"]
      - cis_csc_v8: ["8.3"]
      - cis_csc_v7: ["6.4"]
      - iso_27001-2013: ["A.12.4.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1499", "T1499.001"]
      - pci_dss_v3.2.1: ["10.7"]
      - soc_2: ["A1.1"]
    condition: all
    rules:
      - 'c:findmnt -kn /var/log/audit -> r:\s*/var/log/audit\s'

  # 1.1.6.2 Ensure nodev option set on /var/log/audit partition. (Automated)
  - id: 19016
    title: "確保在 /var/log/audit 分割區上設定了 nodev 選項。"
    description: "nodev 掛載選項指定檔案系統不能包含特殊裝置。"
    rationale: "由於 /var/log/audit 檔案系統不支援設備，因此設定此選項可確保使用者無法在 /var/log/audit 中建立區塊或字元特殊設備。"
    remediation: "如果 /var/log/audit 分區存在，編輯 /etc/fstab 檔案並在第四欄（掛載選項）中為 /var/log/audit 分區添加 nodev。範例：<device> /var/log/audit <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 執行以下指令以使用配置的選項重新掛載 /var/log/audit：# mount -o remount /var/log/audit."
    compliance:
      - cis: ["1.1.6.2"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1200"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:findmnt -kn /var/log/audit -> r:\s*/var/log/audit\s && r:nodev'

  # 1.1.6.3 Ensure noexec option set on /var/log/audit partition. (Automated)
  - id: 19017
    title: "確保 /var/log/audit 分割區上設定了 noexec 選項。"
    description: "noexec 掛載選項指定檔案系統不能包含可執行二進位檔案。"
    rationale: "由於 /var/log/audit 檔案系統僅用於審核日誌，因此設定此選項以確保使用者無法從 /var/log/audit 執行可執行二進位檔案。"
    remediation: "如果 /var/log/audit 分割區存在，編輯 /etc/fstab 檔案並在第四欄（掛載選項）為 /var 區域添加 noexec。例：<device> /var/log/audit <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 運行以下指令以按照配置選項重新掛載 /var/log/audit：# mount -o remount /var/log/audit."
    compliance:
      - cis: ["1.1.6.3"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1204", "T1204.002"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:findmnt -kn /var/log/audit -> r:\s*/var/log/audit\s && r:noexec'

  # 1.1.6.4 Ensure nosuid option set on /var/log/audit partition. (Automated)
  - id: 19018
    title: "確保 /var/log/audit 分割區上設定了 nosuid 選項。"
    description: "nosuid 掛載選項指定檔案系統不能包含 setuid 檔案。"
    rationale: "由於 /var/log/audit 檔案系統僅適用於日誌等變數檔案，因此設定此選項可確保使用者無法在 /var/log/audit 中建立 setuid 檔案。"
    remediation: "如果 /var/log/audit 分區存在，編輯 /etc/fstab 檔案，並在第四個欄位 (掛載選項) 為 /var/log/audit 分區添加 nosuid。範例：<device> /var/log/audit <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 運行以下指令以使用已配置的選項重新掛載 /var/log/audit：# mount -o remount /var/log/audit."
    compliance:
      - cis: ["1.1.6.4"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1548", "T1548.001"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:findmnt -kn /var/log/audit -> r:\s*/var/log/audit\s && r:nosuid'

  # 1.1.7.1 Ensure separate partition exists for /home. (Automated)
  - id: 19019
    title: "確保 /home 存在單獨的分區。"
    description: "/home目錄用於支援本機用戶的磁碟儲存需求。"
    rationale: "將 /home 安裝在單獨的分割區上的原因如下。防止資源耗盡 預設安裝僅建立單一 / 分割區。由於/home目錄包含使用者產生的資料，因此存在資源耗盡的風險。本質上，整個磁碟都可用於填滿並影響整個系統。此外，系統上的其他操作可能會填滿與 /home 無關的磁碟並影響所有本機使用者。對掛載的細粒度控制 將 /home 配置為其自己的檔案系統允許管理員設定其他掛載選項，例如 noexec/nosuid/nodev。這些選項限制了攻擊者在系統上創建漏洞的能力。在 /home 的情況下，可以考慮使用 usrquota/grpquota 等選項來限制使用者在磁碟資源耗盡方面對彼此造成的影響。其他選項允許特定行為。有關獨立於檔案系統和特定於檔案系統的選項的確切詳細資訊，請參閱 man mount。使用者資料的保護 由於/home包含使用者資料，因此應注意確保資料和掛載點的安全性和完整性。"
    impact: "Resizing filesystems is a common activity in cloud-hosted servers. Separate filesystem partitions may prevent successful resizing, or may require the installation of additional tools solely for the purpose of resizing operations. The use of these additional tools may introduce their own security considerations."
    remediation: "對於新安裝，在安裝過程中創建自定義分區設置並為 /home 指定單獨的分區。對於以前安裝的系統，創建一個新分區並適當配置 /etc/fstab。"
    references:
      - "http://tldp.org/HOWTO/LVM-HOWTO/"
    compliance:
      - cis: ["1.1.7.1"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1038"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1499", "T1499.001"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:findmnt -kn /home -> r:\s*/home\s'

  # 1.1.7.2 Ensure nodev option set on /home partition. (Automated)
  - id: 19020
    title: "確保在 /home 分割區上設定了 nodev 選項。"
    description: "nodev 掛載選項指定檔案系統不能包含特殊裝置。"
    rationale: "由於 /home 檔案系統不支援設備，因此設定此選項可確保使用者無法在 /home 中建立區塊或字元特殊設備。"
    remediation: "如果 /home 分區存在, 請編輯 /etc/fstab 檔案並在第四個欄位（掛載選項）添加 nodev 給 /home 分區。 範例：<device> /home <fstype> defaults,rw,nosuid,nodev,relatime 0 0 執行以下指令以掛載 /home 使其符合配置的選項：# mount -o remount /home."
    compliance:
      - cis: ["1.1.7.2"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1200"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:findmnt -kn /home -> r:\s*/home\s && r:nodev'

  # 1.1.7.3 Ensure nosuid option set on /home partition. (Automated)
  - id: 19021
    title: "確保 /home 分區上設定了 nosuid 選項。"
    description: "nosuid 掛載選項指定檔案系統不能包含 setuid 檔案。"
    rationale: "由於 /home 檔案系統僅用於使用者檔案存儲，因此設定此選項可確保使用者無法在 /home 中建立 setuid 檔案。"
    remediation: "如果 /home 分區存在，編輯 /etc/fstab 檔案，並在第四欄（掛載選項）為 /home 分區添加 nosuid。例如：<device> /home <fstype> defaults,rw,nosuid,nodev,relatime 0 0 使用以下指令以配置好的選項重新掛載 /home：# mount -o remount /home."
    compliance:
      - cis: ["1.1.7.3"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1548", "T1548.001"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:findmnt -kn /home -> r:\s*/home\s && r:nosuid'

  # 1.1.8.1 Ensure nodev option set on /dev/shm partition. (Automated)
  - id: 19022
    title: "確保在 /dev/shm 分割區上設定了 nodev 選項。"
    description: "nodev 掛載選項指定檔案系統不能包含特殊裝置。"
    rationale: "由於 /dev/shm 檔案系統不支援設備，因此設定此選項可確保使用者無法嘗試在 /dev/shm 分割區中建立特殊設備。"
    remediation: "編輯 /etc/fstab 檔案並將 nodev 添加到 /dev/shm 分區的第四個字段（掛載選項）。詳情請參閱 fstab(5) 手冊頁。範例： tmpfs /dev/shm tmpfs defaults,rw,nosuid,nodev,noexec,relatime 0 0 執行以下指令以使用配置選項重新掛載 /dev/shm： # mount -o remount /dev/shm 注意 建議使用 tmpfs 作為設備/檔案系統類型，因為 /dev/shm 被應用程序用作共享記憶體空間。"
    compliance:
      - cis: ["1.1.8.1"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1038"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1200"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:findmnt -kn /dev/shm -> r:\s*/dev/shm\s && r:nodev'

  # 1.1.8.2 Ensure noexec option set on /dev/shm partition. (Automated)
  - id: 19023
    title: "確保 /dev/shm 分割區上設定了 noexec 選項。"
    description: "noexec 掛載選項指定檔案系統不能包含可執行二進位檔案。"
    rationale: "在檔案系統上設定此選項可防止使用者從共享記憶體執行程式。這可以阻止用戶在系統上引入潛在的惡意軟體。"
    remediation: "編輯 /etc/fstab 檔案並在 /dev/shm 分區的第四欄（掛載選項）中添加 noexec。範例： tmpfs /dev/shm tmpfs defaults,rw,nosuid,nodev,noexec,relatime 0 0 執行以下指令以已配置的選項重新掛載 /dev/shm： # mount -o remount /dev/shm 注意：建議使用 tmpfs 作為裝置/檔案系統類型，因為 /dev/shm 被應用程式用作共享記憶體空間。"
    compliance:
      - cis: ["1.1.8.2"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1204", "T1204.002"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:findmnt -kn /dev/shm  -> r:\s*/dev/shm\s && r:noexec'

  # 1.1.8.3 Ensure nosuid option set on /dev/shm partition. (Automated)
  - id: 19024
    title: "確保 /dev/shm 分割區上設定了 nosuid 選項。"
    description: "nosuid 掛載選項指定檔案系統不能包含 setuid 檔案。"
    rationale: "在檔案系統上設定此選項可防止使用者將特權程序引入系統並允許非 root 使用者執行它們。"
    remediation: "編輯 /etc/fstab 檔案並在 /dev/shm 分區的第四欄（挂載選項）中加入 nosuid。參見 fstab(5) 手冊頁以獲取更多資訊。範例：tmpfs /dev/shm tmpfs defaults,rw,nosuid,nodev,noexec,relatime 0 0 執行以下指令以使用配置選項重新挂載 /dev/shm： # mount -o remount /dev/shm 注意：建議使用 tmpfs 作為設備/檔案系統類型，因為 /dev/shm 被應用程序用作共享記憶體空間。"
    compliance:
      - cis: ["1.1.8.3"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1038"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1548", "T1548.001"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:findmnt -kn /dev/shm  -> r:\s*/dev/shm\s && r:nosuid'

  # 1.1.9 Disable Automounting. (Automated)
  - id: 19025
    title: "停用自動安裝。"
    description: "autofs 允許自動安裝設備，通常包括 CD/DVD 和 USB 驅動器。"
    rationale: "啟用自動掛載後，任何具有實體存取權限的人都可以連接 USB 隨身碟或光碟，並在檔案系統中使用其內容，即使他們沒有自行掛載的權限。"
    impact: "The use of portable hard drives is very common for workstation users. If your organization allows the use of portable storage or media on workstations and physical access controls to workstations are considered adequate there is little value add in turning off automounting."
    remediation: "如果沒有其他套件依賴 autofs, 用以下指令移除該套件: # apt purge autofs -或者- 如果有套件依賴 autofs 套件: 執行以下指令來封鎖 autofs: # systemctl stop autofs # systemctl mask autofs."
    compliance:
      - cis: ["1.1.9"]
      - cis_csc_v8: ["10.3"]
      - cis_csc_v7: ["8.5"]
      - cmmc_v2.0: ["MP.L2-3.8.7"]
      - hipaa: ["164.310(d)(1)"]
      - iso_27001-2013: ["A.12.2.1"]
      - mitre_techniques: ["T1068", "T1203", "T1211", "T1212"]
    condition: any
    rules:
      - "c: dpkg -s autofs -> r:package 'autofs' is not installed"
      - "c: systemctl is-enabled autofs -> r:No such file or directory|disabled"

  # 1.1.10 Disable USB Storage. (Automated) - Not Implemented

  # 1.2.1 Ensure AIDE is installed. (Automated)
  - id: 19026
    title: "確保已安裝 AIDE。"
    description: "AIDE 拍攝檔案系統狀態的快照，包括修改時間、權限和檔案雜湊值，然後可以與檔案系統的當前狀態進行比較，以偵測系統的修改。"
    rationale: "透過監視檔案系統狀態，可以偵測受損檔案，以防止或限制意外或惡意的錯誤配置或修改的二進位檔案的暴露。"
    remediation: "使用適當的套件管理器或手動安裝AIDE: # apt install aide aide-common 根據您的環境配置AIDE。請參閱AIDE檔案以了解選項。運行以下指令以初始化AIDE: # aideinit # mv /var/lib/aide/aide.db.new /var/lib/aide/aide.db."
    compliance:
      - cis: ["1.2.1"]
      - cis_csc_v8: ["3.14"]
      - cis_csc_v7: ["14.9"]
      - cmmc_v2.0: ["AC.L2-3.1.7"]
      - hipaa: ["164.312(b)", "164.312(c)(1)", "164.312(c)(2)"]
      - iso_27001-2013: ["A.12.4.3"]
      - mitre_techniques: ["T1036", "T1036.002", "T1036.003", "T1036.004", "T1036.005", "T1565", "T1565.001"]
      - nist_sp_800-53: ["AC-6(9)"]
      - pci_dss_v3.2.1: ["10.2.1", "11.5"]
      - pci_dss_v4.0: ["10.2.1", "10.2.1.1"]
      - soc_2: ["CC6.1"]
    condition: all
    rules:
      - "c:dpkg -s aide -> r:install ok installed"
      - "c:dpkg -s aide-common -> r:install ok installed"

  # 1.2.2 Ensure filesystem integrity is regularly checked. (Automated)
  - id: 19027
    title: "確保定期檢查檔案系統的完整性。"
    description: "需要定期檢查檔案系統完整性以檢測檔案系統的變更。"
    rationale: "定期檔案檢查允許系統管理員定期確定關鍵檔案是否已被未經授權的方式更改。"
    remediation: "如果將使用 cron 來排程並運行 aide 檢查: 運行以下指令: # crontab -u root -e 在 crontab 中添加以下行: 0 5 * * * /usr/bin/aide.wrapper --config /etc/aide/aide.conf --check 或者如果將使用 aidecheck.service 和 aidecheck.timer 來排程並運行 aide 檢查: 創建或編輯檔案 /etc/systemd/system/aidecheck.service 並添加以下內容: [Unit] Description=Aide Check [Service] Type=simple ExecStart=/usr/bin/aide.wrapper --config /etc/aide/aide.conf --check [Install] WantedBy=multi-user.target 創建或編輯檔案 /etc/systemd/system/aidecheck.timer 並添加以下內容: [Unit] Description=Aide check every day at 5AM [Timer] OnCalendar=*-*-* 05:00:00 Unit=aidecheck.service [Install] WantedBy=multi-user.target 運行以下指令: # chown root:root /etc/systemd/system/aidecheck.* # chmod 0644 /etc/systemd/system/aidecheck.* # systemctl daemon-reload # systemctl enable aidecheck.service # systemctl --now enable aidecheck.timer."
    references:
      - "https://github.com/konstruktoid/hardening/blob/master/config/aidecheck.service"
      - "https://github.com/konstruktoid/hardening/blob/master/config/aidecheck.timer"
    compliance:
      - cis: ["1.2.2"]
      - cis_csc_v8: ["8.5"]
      - cis_csc_v7: ["14.9"]
      - cmmc_v2.0: ["AU.L2-3.3.1"]
      - iso_27001-2013: ["A.12.4.3"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0040"]
      - mitre_techniques: ["T1036", "T1036.002", "T1036.003", "T1036.004", "T1036.005", "T1565", "T1565.001"]
      - nist_sp_800-53: ["AU-3(1)", "AU-7"]
      - pci_dss_v3.2.1: ["10.1", "10.2.2", "10.2.4", "10.2.5", "10.3"]
      - pci_dss_v4.0: ["10.2", "10.2.1", "10.2.1.2", "10.2.1.5", "9.4.5"]
      - soc_2: ["CC5.2", "CC7.2"]
    condition: all
    rules:
      - "c:systemctl is-enabled aidecheck.service -> r:enabled"
      - "c:systemctl is-enabled aidecheck.timer -> r:enabled"
      - "c:systemctl status aidecheck.timer -> r:Active: active"

  # 1.3.1 Ensure updates, patches, and additional security software are installed. (Manual) - Not Implemented
  # 1.3.2 Ensure package manager repositories are configured. (Manual) - Not Implemented
  # 1.3.3 Ensure GPG keys are configured. (Manual) Not Implemented

  # 1.4.1 Ensure bootloader password is set. (Automated)
  - id: 19028
    title: "確保設定了引導程式密碼。"
    description: "設定引導程式密碼將要求任何重新啟動系統的人都必須輸入密碼才能設定指令列引導參數。"
    rationale: "在執行引導程式時要求輸入引導密碼將防止未經授權的使用者輸入引導參數或變更引導分割區。這可以防止使用者削弱安全性（例如在啟動時關閉 AppArmor）。"
    impact: 'If password protection is enabled, only the designated superuser can edit a GRUB 2 menu item by pressing "e" or access the GRUB 2 command line by pressing "c" If GRUB 2 is set up to boot automatically to a password-protected menu entry the user has no option to back out of the password prompt to select another menu entry. Holding the SHIFT key will not display the menu in this case. The user must enter the correct username and password. If unable to do so, the configuration files will have to be edited via a LiveCD or other means to fix the problem You can add --unrestricted to the menu entries to allow the system to boot without entering a password. A password will still be required to edit menu items. More Information: https://help.ubuntu.com/community/Grub2/Passwords.'
    remediation: '使用 grub-mkpasswd-pbkdf2 建立加密密碼： # grub-mkpasswd-pbkdf2 Enter password: <password> Reenter password: <password> PBKDF2 hash of your password is <encrypted-password> 將以下內容添加到自訂的 /etc/grub.d 配置檔案中: cat <<EOF set superusers="<username>" password_pbkdf2 <username> <encrypted-password> EOF 超級使用者/使用者資訊和密碼不應包含在 /etc/grub.d/00_header 檔案中，因為該檔案可能會在更新軟體包時被覆蓋。 如果需要在不輸入密碼的情況下啟動/重新啟動，請編輯 /etc/grub.d/10_linux 並添加 --unrestricted 到 CLASS= 這行， 例如: CLASS="--class gnu-linux --class gnu --class os --unrestricted" 運行以下指令來更新 grub2 配置： # update-grub'
    compliance:
      - cis: ["1.4.1"]
      - cis_csc_v8: ["5.2"]
      - cis_csc_v7: ["4.4"]
      - cmmc_v2.0: ["IA.L2-3.5.7"]
      - iso_27001-2013: ["A.9.4.3"]
      - mitre_mitigations: ["M1046"]
      - mitre_tactics: ["TA0003"]
      - mitre_techniques: ["T1542"]
      - pci_dss_v4.0: ["2.2.2", "8.3.5", "8.3.6", "8.6.3"]
      - soc_2: ["CC6.1"]
    condition: all
    rules:
      - 'f:/boot/grub/grub.cfg -> r:^\s*\t*set superusers'
      - 'f:/boot/grub/grub.cfg -> r:^\s*\t*password'

  # 1.4.2 Ensure permissions on bootloader config are configured. (Automated)
  - id: 19029
    title: "確保配置了引導程式配置的權限。"
    description: "grub 設定檔包含有關引導設定和解鎖引導選項的密碼的資訊。"
    rationale: "設定 root 的讀寫權限只能防止非 root 使用者檢視或變更啟動參數。讀取啟動參數的非 root 使用者可能能夠在啟動時識別安全漏洞並能夠利用它們。"
    remediation: "執行以下指令來設定您的 grub 配置的權限: # chown root:root /boot/grub/grub.cfg # chmod u-x,go-rwx /boot/grub/grub.cfg."
    compliance:
      - cis: ["1.4.2"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005", "TA0007"]
      - mitre_techniques: ["T1542"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: any
    rules:
      - 'c:stat /boot/grub/grub.cfg -> r:Access:\s*\(0600/-r--------\)\s*Uid:\s*\(\s*\t*0/\s*\t*root\)\s*\t*Gid:\s*\(\s*\t*0/\s*\t*root\)'
      - 'c:stat /boot/grub/grub.cfg -> r:Access:\s*\(0400/-r--------\)\s*Uid:\s*\(\s*\t*0/\s*\t*root\)\s*\t*Gid:\s*\(\s*\t*0/\s*\t*root\)'

  # 1.4.3 Ensure authentication required for single user mode. (Automated)
  - id: 19030
    title: "確保單一使用者模式所需的身份驗證。"
    description: "單一使用者模式用於當系統在引導期間或透過引導程式手動選擇偵測到問題時進行復原。"
    rationale: "要求在單一用戶模式下進行身份驗證可防止未經授權的用戶將系統重新啟動為單用戶，以在沒有憑證的情況下獲得 root 權限。"
    remediation: "執行以下指令並按照提示為 root 用戶設置密碼: # passwd root."
    compliance:
      - cis: ["1.4.3"]
      - cis_csc_v8: ["5.2"]
      - cis_csc_v7: ["4.4"]
      - cmmc_v2.0: ["IA.L2-3.5.7"]
      - iso_27001-2013: ["A.9.4.3"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1548"]
      - pci_dss_v4.0: ["2.2.2", "8.3.5", "8.3.6", "8.6.3"]
      - soc_2: ["CC6.1"]
    condition: none
    rules:
      - 'f:/etc/shadow -> r:^root:\p:'

  # 1.5.1 Ensure prelink is not installed. (Automated)
  - id: 19031
    title: "確保未安裝預連結。"
    description: "prelink 是修改 ELF 共享庫和 ELF 動態連結二進位檔案的程序，其方式是動態連結器在啟動時執行重定位所需的時間顯著減少。"
    rationale: "預連結功能可能會幹擾 AIDE 的操作，因為它會更改二進位。如果惡意使用者能夠破壞 libc 等通用函式庫，預先連結也會增加系統的漏洞。"
    remediation: "執行以下指令將二進制恢復正常: # prelink -ua 使用適當的套件管理器或手動安裝來卸載 prelink: # apt purge prelink."
    compliance:
      - cis: ["1.5.1"]
      - cis_csc_v8: ["3.14"]
      - cis_csc_v7: ["14.9"]
      - cmmc_v2.0: ["AC.L2-3.1.7"]
      - hipaa: ["164.312(b)", "164.312(c)(1)", "164.312(c)(2)"]
      - iso_27001-2013: ["A.12.4.3"]
      - mitre_mitigations: ["M1050"]
      - mitre_tactics: ["TA0002"]
      - mitre_techniques: ["T1055", "T1055.009", "T1065", "T1065.001"]
      - nist_sp_800-53: ["AC-6(9)"]
      - pci_dss_v3.2.1: ["10.2.1", "11.5"]
      - pci_dss_v4.0: ["10.2.1", "10.2.1.1"]
      - soc_2: ["CC6.1"]
    condition: all
    rules:
      - "c:dpkg -s prelink -> r:package 'prelink' is not installed"

  # 1.5.2 Ensure address space layout randomization (ASLR) is enabled. (Automated) - Not Implemented
  # 1.5.3 Ensure ptrace_scope is restricted. (Automated) - Not Implemented

  # 1.5.4 Ensure Automatic Error Reporting is not enabled. (Automated)
  - id: 19032
    title: "確保未啟用自動錯誤報告。"
    description: "Appport 錯誤報告服務會自動產生當機報告以供偵錯。"
    rationale: "Apport 收集潛在的敏感資料，例如核心轉儲、堆疊追蹤和日誌檔案。它們可以包含密碼、信用卡號、序號和其他私人資料。"
    remediation: "編輯 /etc/default/apport 並新增或編輯 enabled 參數使其等於 0：enabled=0 運行以下指令以停止並禁用 apport 服務 # systemctl stop apport.service # systemctl --now disable apport.service -- 或 -- 運行以下指令以移除 apport 套件: # apt purge apport."
    compliance:
      - cis: ["1.5.4"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: all
    rules:
      - "c:dpkg-query -s apport -> !r:enabled"
      - "c:systemctl is-active apport.service -> !r:active"

  # 1.5.5 Ensure core dumps are restricted. (Automated) - Not Implemented

  # 1.6.1.1 Ensure AppArmor is installed. (Automated)
  - id: 19033
    title: "確保已安裝 AppArmor。"
    description: "AppArmor 提供強制存取控制。"
    rationale: "如果未安裝強制存取控制系統，則僅預設的自主存取控制系統可用。"
    remediation: "安裝AppArmor。# apt install apparmor apparmor-utils。"
    compliance:
      - cis: ["1.6.1.1"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1026"]
      - mitre_tactics: ["TA0003"]
      - mitre_techniques: ["T1068", "T1565", "T1565.001", "T1565.003"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - "c:dpkg -s apparmor -> r:install ok installed"

  # 1.6.1.2 Ensure AppArmor is enabled in the bootloader configuration. (Automated)
  - id: 19034
    title: "確保在引導程式配置中啟用 AppArmor。"
    description: "將 AppArmor 配置為在啟動時啟用，並驗證它是否未被引導程式引導參數覆蓋。注意：此建議是圍繞 grub 引導程式設計的，如果您的環境中使用 LILO 或其他引導程序，請執行等效設定。"
    rationale: "AppArmor 必須在啟動時在引導程式設定中啟用，以確保它提供的控制項不會被覆寫。"
    remediation: '編輯 /etc/default/grub 並添加 apparmor=1 和 security=apparmor 參數到 GRUB_CMDLINE_LINUX= 這行 GRUB_CMDLINE_LINUX="apparmor=1 security=apparmor" 運行以下指令來更新 grub2 配置: # update-grub.'
    compliance:
      - cis: ["1.6.1.2"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1026"]
      - mitre_tactics: ["TA0003"]
      - mitre_techniques: ["T1068", "T1565", "T1565.001", "T1565.003"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'f:/boot/grub/grub.cfg -> r:^\s*\t*linux && r:apparmor=1'
      - 'f:/boot/grub/grub.cfg -> r:^\s*\t*linux && r:security=apparmor'

  # 1.6.1.3 Ensure all AppArmor Profiles are in enforce or complain mode. (Automated)
  - id: 19035
    title: "確保所有 AppArmor 設定檔均處於強製或投訴模式。"
    description: "AppArmor 設定檔定義應用程式能夠存取哪些資源。"
    rationale: "安全配置要求因網站而異。有些網站可能會強制執行比預設策略更嚴格的策略，這是完全可以接受的。此項旨在確保系統上存在的任何策略都已啟動。"
    remediation: "執行以下指令將所有設定檔設置為強制模式: # aa-enforce /etc/apparmor.d/* 或 執行以下指令將所有設定檔設置為抱怨模式: # aa-complain /etc/apparmor.d/* 注意: 任何未受限的程序可能需要為其創建或啟用設定檔，然後重新啟動。"
    compliance:
      - cis: ["1.6.1.3"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_tactics: ["TA0005"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:apparmor_status -> n:^(\d+)\s+profiles\s+are\s+loaded compare > 0'
      - "c:apparmor_status -> r:0 processes are unconfined"

  # 1.6.1.4 Ensure all AppArmor Profiles are enforcing. (Automated)
  - id: 19036
    title: "確保所有 AppArmor 設定檔均有效。"
    description: "AppArmor 設定檔定義應用程式能夠存取哪些資源。"
    rationale: "安全配置要求因網站而異。有些網站可能會強制執行比預設策略更嚴格的策略，這是完全可以接受的。此項旨在確保系統上存在的任何策略都已啟動。"
    remediation: "執行以下指令將所有配置檔案設置為強制模式：# aa-enforce /etc/apparmor.d/* 注意：任何非受限的程序可能需要為其創建或啟用配置檔案，然後重新啟動。"
    compliance:
      - cis: ["1.6.1.4"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1068", "T1565", "T1565.001", "T1565.003"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:apparmor_status -> n:^(\d+)\s+profiles\s+are\s+loaded compare > 0'
      - 'c:apparmor_status -> n:^(\d+)\s+profiles\s+are\s+in\s+enforce\s+mode compare > 0'
      - 'c:apparmor_status -> r:^0\s*profiles\s+are\s+in\s+complain\s+mode'
      - 'c:apparmor_status -> r:^0\s*processes\s+are\s+unconfined'

  # 1.7.1 Ensure message of the day is configured properly. (Automated)
  - id: 19037
    title: "確保當天的訊息配置正確。"
    description: "/etc/motd 檔案的內容在用戶登入後顯示給用戶，並作為經過身份驗證的用戶的當天訊息。基於 Unix 的系統通常在登入系統時顯示有關作業系統版本和修補程式層級的資訊。此資訊對於為特定作業系統平台開發軟體的開發人員非常有用。如果 mingetty(8) 支援下列選項，它們會顯示作業系統資訊： \\m - 機器架構 \\r - 作業系統版本 \\s - 作業系統名稱 \\v - 作業系統版本。"
    rationale: '警告訊息會通知嘗試登入系統的使用者有關系統的法律狀態，並且必須包含擁有該系統的組織的名稱以及任何現有的監控策略。在登入橫幅中顯示作業系統和修補程式等級資訊也會產生副作用，即向試圖針對系統的特定漏洞進行攻擊的攻擊者提供詳細的系統資訊。授權使用者登入後可以透過執行「uname -a」指令輕鬆取得此資訊。'
    remediation: "編輯 /etc/motd 檔案，使其內容符合您的站點政策，移除任何 \\m 、 \\r 、 \\s 、\\v 或提及操作系統平台的內容。添加或更新消息文字以遵循本地站點政策。示例文字：# echo \"Authorized use only. All activity may be monitored and reported.\" > /etc/issue.net -- 或者 -- 如果不使用 motd，可以刪除此檔案。運行以下指令來刪除 motd 檔案：# rm /etc/motd."
    compliance:
      - cis: ["1.7.1"]
      - mitre_tactics: ["TA0007"]
      - mitre_techniques: ["T1082", "T1592", "T1592.004"]
    condition: any
    rules:
      - 'not f:/etc/motd -> r:\\v|\\r|\\m|\\s|Debian|Ubuntu'
      - "not f:/etc/motd"

  # 1.7.2 Ensure local login warning banner is configured properly. (Automated)
  - id: 19038
    title: "確保本地登入警告橫幅配置正確。"
    description: "/etc/issue 檔案的內容在使用者登入本機終端之前顯示給使用者。基於 Unix 的系統通常在登入系統時顯示有關作業系統版本和修補程式層級的資訊。此資訊對於為特定作業系統平台開發軟體的開發人員非常有用。如果 mingetty(8) 支援下列選項，它們會顯示作業系統資訊： \\m - 機器架構 \\r - 作業系統版本 \\s - 作業系統名稱 \\v - 作業系統版本 - 或作業系統名稱。"
    rationale: '警告訊息會通知嘗試登入系統的使用者有關系統的法律狀態，並且必須包含擁有該系統的組織的名稱以及任何現有的監控策略。在登入橫幅中顯示作業系統和修補程式等級資訊也會產生副作用，即向試圖針對系統的特定漏洞進行攻擊的攻擊者提供詳細的系統資訊。授權使用者登入後可以透過執行「uname -a」指令輕鬆取得此資訊。'
    remediation: "編輯 /etc/issue 檔案，使其內容符合您所在網站的政策，移除任何 \\m、\\r、\\s、\\v 或與作業系統平台有關的引用。根據本地站點政策新增或更新訊息文字。例如文字：# echo \"Authorized use only. All activity may be monitored and reported.\" > /etc/issue.net."
    compliance:
      - cis: ["1.7.2"]
      - mitre_tactics: ["TA0007"]
      - mitre_techniques: ["T1082", "T1592", "T1592.004"]
    condition: none
    rules:
      - 'f:/etc/issue -> r:\\v|\\r|\\m|\\s|Debian|Ubuntu'

  # 1.7.3 Ensure remote login warning banner is configured properly. (Automated)
  - id: 19039
    title: "確保遠端登入警告橫幅配置正確。"
    description: "/etc/issue.net 檔案的內容在使用者從配置的服務登入遠端連線之前顯示給使用者。基於 Unix 的系統通常在登入系統時顯示有關作業系統版本和修補程式層級的資訊。此資訊對於為特定作業系統平台開發軟體的開發人員非常有用。如果 mingetty(8) 支援下列選項，它們會顯示作業系統資訊： \\m - 機器架構 \\r - 作業系統版本 \\s - 作業系統名稱 \\v - 作業系統版本。"
    rationale: '警告訊息會通知嘗試登入系統的使用者有關系統的法律狀態，並且必須包含擁有該系統的組織的名稱以及任何現有的監控策略。在登入橫幅中顯示作業系統和修補程式等級資訊也會產生副作用，即向試圖針對系統的特定漏洞進行攻擊的攻擊者提供詳細的系統資訊。授權使用者登入後可以透過執行「uname -a」指令輕鬆取得此資訊。'
    remediation: "編輯 /etc/issue.net 檔案，根據您的站點政策添加適當的內容，移除 \\m, \\r, \\s, \\v 或對作業系統平台的引用。添加或更新消息文字以遵循當地站點政策。範例文字：# echo \"Authorized use only. All activity may be monitored and reported.\" > /etc/issue.net."
    compliance:
      - cis: ["1.7.3"]
      - mitre_tactics: ["TA0007"]
      - mitre_techniques: ["T1018", "T1082", "T1592", "T1592.004"]
    condition: none
    rules:
      - 'f:/etc/issue.net -> r:\\v|\\r|\\m|\\s|Debian|Ubuntu'

  # 1.7.4 Ensure permissions on /etc/motd are configured. (Automated)
  - id: 19040
    title: "確保配置了 /etc/motd 的權限。"
    description: "/etc/motd 檔案的內容在用戶登入後顯示給用戶，並作為經過身份驗證的用戶的當天訊息。"
    rationale: "如果 /etc/motd 檔案沒有正確的所有權，則未經授權的使用者可能會使用不正確或誤導性的資訊對其進行修改。"
    remediation: "執行以下指令以設定 /etc/motd 的權限 : # chown root:root $(readlink -e /etc/motd) # chmod u-x,go-wx $(readlink -e /etc/motd) -- 或 -- 執行以下指令刪除 /etc/motd 檔案: # rm /etc/motd."
    compliance:
      - cis: ["1.7.4"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1222", "T1222.002"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: any
    rules:
      - 'c:stat /etc/motd -> r:Access:\s*\(0644/-rw-r--r--\)\s*Uid:\s*\(\s*\t*0/\s*\t*root\)\s*\t*Gid:\s*\(\s*\t*0/\s*\t*root\)'
      - "not f:/etc/motd"

  # 1.7.5 Ensure permissions on /etc/issue are configured. (Automated)
  - id: 19041
    title: "確保配置了 /etc/issue 的權限。"
    description: "/etc/issue 檔案的內容在使用者登入本機終端之前顯示給使用者。"
    rationale: "如果 /etc/issue 檔案沒有正確的所有權，則未經授權的使用者可能會使用不正確或誤導性的資訊對其進行修改。"
    remediation: "執行以下指令來設定 /etc/issue 的權限: # chown root:root $(readlink -e /etc/issue) # chmod u-x,go-wx $(readlink -e /etc/issue)."
    compliance:
      - cis: ["1.7.5"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1222", "T1222.002"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:stat /etc/issue -> r:Access:\s*\(0644/-rw-r--r--\)\s*Uid:\s*\(\s*\t*0/\s*\t*root\)\s*\t*Gid:\s*\(\s*\t*0/\s*\t*root\)'

  # 1.7.6 Ensure permissions on /etc/issue.net are configured. (Automated)
  - id: 19042
    title: "確保配置了 /etc/issue.net 上的權限。"
    description: "/etc/issue.net 檔案的內容在使用者從配置的服務登入遠端連線之前顯示給使用者。"
    rationale: "如果 /etc/issue.net 檔案沒有正確的所有權，則未經授權的使用者可能會使用不正確或誤導性的資訊對其進行修改。"
    remediation: "執行以下指令來設置 /etc/issue.net 的許可權： # chown root:root $(readlink -e /etc/issue.net) # chmod u-x,go-wx $(readlink -e /etc/issue.net)."
    compliance:
      - cis: ["1.7.6"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1222", "T1222.002"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:stat /etc/issue.net -> r:Access:\s*\(0644/-rw-r--r--\)\s*Uid:\s*\(\s*\t*0/\s*\t*root\)\s*\t*Gid:\s*\(\s*\t*0/\s*\t*root\)'

  # 1.8.1 Ensure GNOME Display Manager is removed. (Automated)
  - id: 19043
    title: "確保 GNOME 顯示管理器已刪除。"
    description: "GNOME 顯示管理器 (GDM) 是一個管理圖形顯示伺服器並處理圖形使用者登入的程式。"
    rationale: "如果不需要圖形使用者介面 (GUI)，則應將其刪除以減少系統的攻擊面。"
    impact: "Removing the GNOME Display manager will remove the Graphical User Interface (GUI) from the system."
    remediation: "執行以下指令以卸載 gdm3：# apt purge gdm3."
    compliance:
      - cis: ["1.8.1"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_tactics: ["TA0002"]
      - mitre_techniques: ["T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: all
    rules:
      - "c:dpkg -s gdm3 -> r: package 'gdm3' is not installed"

  # 1.8.2 Ensure GDM login banner is configured. (Automated) - Not Implemented
  # 1.8.3 Ensure GDM disable-user-list option is enabled. (Automated) - Not Implemented
  # 1.8.4 Ensure GDM screen locks when the user is idle. (Automated) - Not Implemented
  # 1.8.5 Ensure GDM screen locks cannot be overridden. (Automated) - Not Implemented
  # 1.8.6 Ensure GDM automatic mounting of removable media is disabled. (Automated) - Not Implemented
  # 1.8.7 Ensure GDM disabling automatic mounting of removable media is not overridden. (Automated) - Not Implemented
  # 1.8.8 Ensure GDM autorun-never is enabled. (Automated) - Not Implemented
  # 1.8.9 Ensure GDM autorun-never is not overridden. (Automated) - Not Implemented

  # 1.8.10 Ensure XDCMP is not enabled. (Automated)
  - id: 19044
    title: "確保 XDCMP 未啟用。"
    description: "X 顯示管理器控制協定 (XDMCP) 旨在為遠端顯示器提供對顯示管理服務的經過驗證的存取。"
    rationale: "XDMCP 本質上是不安全的。 - XDMCP 不是加密協定。這可能允許攻擊者捕獲用戶輸入的擊鍵 - XDMCP 容易受到中間人攻擊。這可能允許攻擊者透過冒充 XDMCP 伺服器來竊取合法用戶的憑證。"
    remediation: "編輯檔案 /etc/gdm3/custom.conf 並移除這行: Enable=true."
    compliance:
      - cis: ["1.8.10"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1050"]
      - mitre_tactics: ["TA0002"]
      - mitre_techniques: ["T1040", "T1056", "T1056.001", "T1557"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: all
    rules:
      - 'not f:/etc/gdm3/custom.conf -> r:^\s*Enable\s*=\s*true'

  # 2.1.1.1 Ensure a single time synchronization daemon is in use. (Automated)
  - id: 19045
    title: "確保正在使用單一時間同步守護程序。"
    description: "系統時間應在環境中的所有系統之間同步。這通常是透過建立一個權威時間伺服器或一組伺服器並使所有系統將其時鐘與它們同步來完成的。注意： - 在可使用基於主機的時間同步的虛擬系統上，請查閱虛擬化軟體檔案並驗證是否正在使用基於主機的同步並遵循本機網站原則。在這種情況下，應跳過本節 - 系統上應僅使用一種時間同步方法。配置多種時間同步方法可能會導致意外或不可靠的結果。"
    rationale: "時間同步對於支援時間敏感的安全機制非常重要，並確保整個企業的日誌檔案具有一致的時間記錄，這有助於取證調查。"
    remediation: "在實體系統以及沒有提供寄主為基礎的時間同步的虛擬系統上，請選擇以下三個時間同步守護程序之一；chrony (1), systemd-timesyncd (2), 或 ntp (3), 並依據所選的守護程序執行修正程序。注意：啟用多於一個同步守護程序可能會導致意外或不可靠的結果： 1. chrony 執行以下指令來安裝chrony： # apt install chrony 執行以下指令來停止並封鎖systemd-timesyncd守護程序： # systemctl stop systemd-timesyncd.service # systemctl --now mask systemd-timesyncd.service 執行以下指令移除ntp程式包： # apt purge ntp 注意： - 小節：應進行chrony配置 - 小節：應跳過systemd-timesyncd配置和ntp配置 2. systemd-timesyncd 執行以下指令移除chrony程式包： # apt purge chrony 執行以下指令移除ntp程式包： # apt purge ntp 注意： - 小節：應進行systemd-timesyncd配置 - 小節：應跳過chrony配置和ntp配置 3. ntp 執行以下指令來安裝ntp： # apt install ntp 執行以下指令來停止並封鎖systemd-timesyncd守護程序： # systemctl stop systemd-timesyncd.service # systemctl --now mask systemd-timesyncd.service 執行以下指令移除chrony程式包： # apt purge chrony 注意： - 小節：應進行ntp配置 - 小節：應跳過chrony配置和systemd-timesyncd配置。"
    compliance:
      - cis: ["2.1.1.1"]
      - cis_csc_v8: ["8.4"]
      - cis_csc_v7: ["6.1"]
      - cmmc_v2.0: ["AU.L2-3.3.7"]
      - iso_27001-2013: ["A.12.4.4"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1070", "T1070.002", "T1562", "T1562.001"]
      - nist_sp_800-53: ["AU-7"]
      - pci_dss_v3.2.1: ["10.4"]
      - pci_dss_v4.0: ["10.6", "10.6.1", "10.6.2", "10.6.3"]
      - soc_2: ["CC4.1", "CC5.2"]
    condition: any
    rules:
      - "c:dpkg -s ntp -> r:install ok installed"
      - "c:dpkg -s chrony -> r:install ok installed"
      - "c:systemctl is-enabled systemd-timesyncd -> r:^enabled"

  # 2.1.2.1 Ensure chrony is configured with authorized timeserver. (Manual)
  - id: 19046
    title: "確保 chrony 配置有授權的時間伺服器。"
    description: "-> server - server 指令指定可用作時間來源的 NTP 伺服器。客戶端-伺服器關係是嚴格分層的：客戶端可以將其系統時間與伺服器的系統時間同步，但伺服器的系統時間永遠不會受到客戶端系統時間的影響。 - 該指令可以多次使用以指定多個伺服器。 o 該指令後緊接伺服器名稱或其 IP 位址。 -> pool - 該指令的語法與 server 指令的語法類似，不同之處在於它用於指定 NTP 伺服器池而不是單一 NTP 伺服器。池名稱預計會解析為多個位址，這些位址可能會隨著時間的推移而改變。 - 此指令可以多次使用來指定多個池。 - 伺服器指令中有效的所有選項也可以在此指令中使用。"
    rationale: "時間同步對於支援時間敏感的安全機制並確保日誌檔案在整個企業中具有一致的時間記錄以幫助取證調查非常重要。"
    remediation: "編輯 /etc/chrony/chrony.conf 或 /etc/chrony/sources.d/ 目錄下的以 .sources 結尾的檔案，並根據當地網站政策新增或編輯 server 或 pool 行: <[server|pool]> <[remote-server|remote-pool]> 範例: pool 指令: pool time.nist.gov iburst maxsources 4 #maxsources 選項僅適用於 pool 指令 server 指令: server time-a-g.nist.gov iburst server 132.163.97.3 iburst server time-d-b.nist.gov iburst 執行以下指令之一來將更新的時間來源載入到 chronyd 運行配置中: # systemctl restart chronyd - 如果來源在 .sources 檔案中 - # chronyc reload sources 如果系統上正在使用其他時間同步服務，請執行以下指令以移除 chrony: # apt purge chrony."
    compliance:
      - cis: ["2.1.2.1"]
      - cis_csc_v8: ["8.4"]
      - cis_csc_v7: ["6.1"]
      - cmmc_v2.0: ["AU.L2-3.3.7"]
      - iso_27001-2013: ["A.12.4.4"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0002"]
      - mitre_techniques: ["T1070", "T1070.002", "T1562", "T1562.001"]
      - nist_sp_800-53: ["AU-7"]
      - pci_dss_v3.2.1: ["10.4"]
      - pci_dss_v4.0: ["10.6", "10.6.1", "10.6.2", "10.6.3"]
      - soc_2: ["CC4.1", "CC5.2"]
    condition: all
    rules:
      - "c:ps -ef -> r:^_chrony && r:/chronyd"
      - 'f:/etc/chrony/chrony.conf -> r:^server\.+|^pool\.+'

  # 2.1.2.2 Ensure chrony is running as user _chrony. (Automated)
  - id: 19047
    title: "確保 chrony 以使用者 _chrony 身份運行。"
    description: "chrony 軟體包是使用專用使用者帳戶 _chrony 安裝的。該帳戶被授予 chronyd 服務所需的存取權限。"
    rationale: "chronyd 服務應僅以所需的權限運行。"
    remediation: "添加或編輯用戶行到 /etc/chrony/chrony.conf 或 /etc/chrony/conf.d/ 內以 .conf 結尾的檔案中：user _chrony 或者如果系統中使用了其他時間同步服務，運行以下指令從系統中移除 chrony：# apt purge chrony。"
    compliance:
      - cis: ["2.1.2.2"]
      - cis_csc_v8: ["8.4"]
      - cis_csc_v7: ["6.1"]
      - cmmc_v2.0: ["AU.L2-3.3.7"]
      - iso_27001-2013: ["A.12.4.4"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0002"]
      - mitre_techniques: ["T1070", "T1070.002", "T1562", "T1562.001"]
      - nist_sp_800-53: ["AU-7"]
      - pci_dss_v3.2.1: ["10.4"]
      - pci_dss_v4.0: ["10.6", "10.6.1", "10.6.2", "10.6.3"]
      - soc_2: ["CC4.1", "CC5.2"]
    condition: all
    rules:
      - "f:/etc/chrony/chrony.conf -> r:^user _chrony"

  # 2.1.2.3 Ensure chrony is enabled and running. (Automated)
  - id: 19048
    title: "確保 chrony 已啟用並正在運行。"
    description: "chrony 是一個用於透過網路同步系統時鐘的守護程式。"
    rationale: "需要啟用並運行 chrony 才能將系統同步到時間伺服器。時間同步對於支援時間敏感的安全機制並確保日誌檔案在整個企業中具有一致的時間記錄以幫助取證調查非常重要。"
    remediation: "如果系統上使用 chrony，執行以下指令： 執行以下指令來取消掩蔽 chrony.service： # systemctl unmask chrony.service 執行以下指令來啟用並啟動 chrony.service： # systemctl --now enable chrony.service 或者 如果系統上使用的是其他時間同步服務，執行以下指令來移除 chrony： # apt purge chrony."
    compliance:
      - cis: ["2.1.2.3"]
      - cis_csc_v8: ["8.4"]
      - cis_csc_v7: ["6.1"]
      - cmmc_v2.0: ["AU.L2-3.3.7"]
      - iso_27001-2013: ["A.12.4.4"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0002"]
      - mitre_techniques: ["T1070", "T1070.002", "T1562", "T1562.001"]
      - nist_sp_800-53: ["AU-7"]
      - pci_dss_v3.2.1: ["10.4"]
      - pci_dss_v4.0: ["10.6", "10.6.1", "10.6.2", "10.6.3"]
      - soc_2: ["CC4.1", "CC5.2"]
    condition: all
    rules:
      - "c:systemctl is-enabled chrony.service -> r:^enabled"
      - "c:systemctl is-active chrony.service -> r:^active"

  # 2.1.3.1 Ensure systemd-timesyncd configured with authorized timeserver. (Automated)
  - id: 19049
    title: "確保 systemd-timesyncd 配置有授權的時間伺服器。"
    description: "NTP= - 以空格分隔的 NTP 伺服器主機名稱或 IP 位址清單。在執行時，此清單與從 systemd-networkd.service(8) 取得的任何每個介面的 NTP 伺服器結合在一起。 systemd-timesyncd 將依序聯絡所有已配置的系統或每個介面伺服器，直到其中一個做出回應。當分配空字串時，NTP 伺服器清單將被重置，所有先前的分配將無效。此設定預設為空列表。 FallbackNTP= - 用作後備 NTP 伺服器的 NTP 伺服器主機名稱或 IP 位址的空格分隔清單。從 systemd-networkd.service(8) 取得的任何每個介面 NTP 伺服器都優先於此設置，就像透過上面的 NTP= 設定的任何伺服器一樣。因此，僅當不知道其他 NTP 伺服器資訊時，此設定才相關。當分配空字串時，NTP 伺服器清單將被重置，所有先前的分配將無效。如果未給予此選項，則使用編譯的 NTP 伺服器清單。"
    rationale: "時間同步對於支援時間敏感的安全機制並確保日誌檔案在整個企業中具有一致的時間記錄以幫助取證調查非常重要。"
    remediation: "編輯 /etc/systemd/timesyncd.conf 並將 NTP= 和/或 FallbackNTP= 行添加到 [Time] 區段：範例：[Time] NTP=time.nist.gov # 使用NIST時間伺服器的通用名稱 -和/或- FallbackNTP=time-a-g.nist.gov time-b-g.nist.gov time-c-g.nist.gov # 用空格分隔的NIST時間伺服器列表注意：添加到這些行的伺服器應遵循本地站點策略。NIST伺服器只是示例。範例腳本：以下範例腳本將 NIST 範例時間伺服器添加到 /etc/systemd/timesyncd.conf #!/usr/bin/env bash { l_ntp_ts=\"time.nist.gov\" l_ntp_fb=\"time-a-g.nist.gov time-b-g.nist.gov time-c-g.nist.gov\" l_conf_file=\"/etc/systemd/timesyncd.conf\" if ! grep -Ph '^\\h*NTP=\\H+' \"$l_conf_file\"; then ! grep -Pqs '^\\h*\\[Time\\]' \"$l_conf_file\" && echo \"[Time]\" >> \"$l_conf_file\" echo \"NTP=$l_ntp_ts\" >> \"$l_conf_file\" fi if ! grep -Ph '^\\h*FallbackNTP=\\H+' \"$l_conf_file\"; then ! grep -Pqs '^\\h*\\[Time\\]' \"$l_conf_file\" && echo \"[Time]\" >> \"$l_conf_file\" echo \"FallbackNTP=$l_ntp_fb\" >> \"$l_conf_file\" fi } 運行以下指令以重新載入 systemd-timesyncd 配置：# systemctl try-reload-or-restart systemd-timesyncd -或- 如果系統上使用了另一個時間同步服務，運行以下指令以停止並封鎖 systemd-timesyncd：# systemctl --now mask systemd-timesyncd."
    references:
      - "https://www.freedesktop.org/software/systemd/man/timesyncd.conf.html"
      - "https://tf.nist.gov/tf-cgi/servers.cgi"
    compliance:
      - cis: ["2.1.3.1"]
      - cis_csc_v8: ["8.4"]
      - cis_csc_v7: ["6.1"]
      - cmmc_v2.0: ["AU.L2-3.3.7"]
      - iso_27001-2013: ["A.12.4.4"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0002"]
      - mitre_techniques: ["T1070", "T1070.002", "T1562", "T1562.001"]
      - nist_sp_800-53: ["AU-7"]
      - pci_dss_v3.2.1: ["10.4"]
      - pci_dss_v4.0: ["10.6", "10.6.1", "10.6.2", "10.6.3"]
      - soc_2: ["CC4.1", "CC5.2"]
    condition: all
    rules:
      - "d:/etc/systemd"
      - 'd:/etc/systemd -> r:\.+.conf$'
      - 'd:/etc/systemd -> r:\.+.conf$ -> r:^\s*NTP=|^\s*FallbackNTP='

  # 2.1.3.2 Ensure systemd-timesyncd is enabled and running. (Manual)
  - id: 19050
    title: "確保 systemd-timesyncd 已啟用並正在運行。"
    description: "systemd-timesyncd 是為跨網路同步系統時鐘而新增的守護程式。"
    rationale: "需要啟用並執行 systemd-timesyncd 才能將系統同步到時間伺服器。時間同步對於支援時間敏感的安全機制並確保日誌檔案在整個企業中具有一致的時間記錄以幫助取證調查非常重要。"
    remediation: "如果系統中使用了 systemd-timesyncd，請執行以下指令: 執行以下指令來取消封鎖 systemd-timesyncd.service: # systemctl unmask systemd-timesyncd.service 執行以下指令來啟用並啟動 systemd-timesyncd.service: # systemctl --now enable systemd-timesyncd.service 或 如果系統中使用了其他的時間同步服務，請執行以下指令來停止並封鎖 systemd-timesyncd: # systemctl --now mask systemd-timesyncd.service."
    compliance:
      - cis: ["2.1.3.2"]
      - cis_csc_v8: ["8.4"]
      - cis_csc_v7: ["6.1"]
      - cmmc_v2.0: ["AU.L2-3.3.7"]
      - iso_27001-2013: ["A.12.4.4"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0002"]
      - mitre_techniques: ["T1070", "T1070.002", "T1562", "T1562.001"]
      - nist_sp_800-53: ["AU-7"]
      - pci_dss_v3.2.1: ["10.4"]
      - pci_dss_v4.0: ["10.6", "10.6.1", "10.6.2", "10.6.3"]
      - soc_2: ["CC4.1", "CC5.2"]
    condition: all
    rules:
      - "c:systemctl is-enabled systemd-timesyncd.service -> r:^enabled"
      - "c:systemctl is-active systemd-timesyncd.service -> r:^active"

  # 2.1.4.1 Ensure ntp access control is configured. (Automated)
  - id: 19051
    title: "確保配置了 ntp 存取控制。"
    description: 'ntp Access Control Commands: restrict address [mask mask] [ippeerlimit int] [flag ...] The address argument expressed in dotted-quad form is the address of a host or network. Alternatively, the address argument can be a valid host DNS name. The mask argument expressed in dotted-quad form defaults to 255.255.255.255, meaning that the address is treated as the address of an individual host. A default entry (address 0.0.0.0, mask 0.0.0.0) is always included and is always the first entry in the list. Note: the text string default, with no mask option, may be used to indicate the default entry. The ippeerlimit directive limits the number of peer requests for each IP to int, where a value of -1 means "unlimited", the current default. A value of 0 means "none". There would usually be at most 1 peering request per IP, but if the remote peering requests are behind a proxy there could well be more than 1 per IP. In the current implementation, flag always restricts access, i.e., an entry with no flags indicates that free access to the server is to be given. The flags are not orthogonal, in that more restrictive flags will often make less restrictive ones redundant. The flags can generally be classed into two categories, those which restrict time service and those which restrict informational queries and attempts to do run-time reconfiguration of the server. One or more of the following flags may be specified: - kod - If this flag is set when an access violation occurs, a kiss-o''-death (KoD) packet is sent. KoD packets are rate limited to no more than one per second. If another KoD packet occurs within one second after the last one, the packet is dropped. - limited - Deny service if the packet spacing violates the lower limits specified in the discard command. A history of clients is kept using the monitoring capability of ntpd. Thus, monitoring is always active as long as there is a restriction entry with the limited flag. - lowpriotrap - Declare traps set by matching hosts to be low priority. The number of traps a server can maintain is limited (the current limit is 3). Traps are usually assigned on a first come, first served basis, with later trap requestors being denied service. This flag modifies the assignment algorithm by allowing low priority traps to be overridden by later requests for normal priority traps. - noepeer - Deny ephemeral peer requests, even if they come from an authenticated source. Note that the ability to use a symmetric key for authentication may be restricted to one or more IPs or subnets via the third field of the ntp.keys file. This restriction is not enabled by default, to maintain backward compatibility. Expect noepeer to become the default in ntp-4.4. - nomodify - Deny ntpq and ntpdc queries which attempt to modify the state of the server (i.e., run time reconfiguration). Queries which return information are permitted. - noquery - Deny ntpq and ntpdc queries. Time service is not affected. - nopeer - Deny unauthenticated packets which would result in mobilizing a new association. This includes broadcast and symmetric active packets when a configured association does not exist. It also includes pool associations, so if you want to use servers from a pool directive and also want to use nopeer by default, you''ll want a restrict source ... line as well that does not include the nopeer directive. - noserve - Deny all packets except ntpq and ntpdc queries. - notrap - Decline to provide mode 6 control message trap service to matching hosts. The trap service is a subsystem of the ntpq control message protocol which is intended for use by remote event logging programs. - notrust - Deny service unless the packet is cryptographically authenticated. - ntpport - This is actually a match algorithm modifier, rather than a restriction flag. Its presence causes the restriction entry to be matched only if the source port in the packet is the standard NTP UDP port (123). Both ntpport and non-ntpport may be specified. The ntpport is considered more specific and is sorted later in the list.'
    rationale: "如果系統上使用 ntp，正確的配置對於確保時間同步且準確至關重要。"
    remediation: "在 /etc/ntp.conf 中添加或編輯限制行使其符合以下內容: restrict -4 default kod nomodify notrap nopeer noquery restrict -6 default kod nomodify notrap nopeer noquery 或 如果系統中正在使用其他時間同步服務，運行以下指令以從系統中移除 ntp: # apt purge ntp."
    references:
      - "http://www.ntp.org/"
    compliance:
      - cis: ["2.1.4.1"]
      - cis_csc_v8: ["8.4"]
      - cis_csc_v7: ["6.1"]
      - cmmc_v2.0: ["AU.L2-3.3.7"]
      - iso_27001-2013: ["A.12.4.4"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0002"]
      - mitre_techniques: ["T1070", "T1070.002", "T1498", "T1498.002", "T1562", "T1562.001"]
      - nist_sp_800-53: ["AU-7"]
      - pci_dss_v3.2.1: ["10.4"]
      - pci_dss_v4.0: ["10.6", "10.6.1", "10.6.2", "10.6.3"]
      - soc_2: ["CC4.1", "CC5.2"]
    condition: all
    rules:
      - 'f:/etc/ntp.conf -> r:^restrict\s*\t*-4\s*\t*default|^restrict\s*\t*default && r:\s*kod && r:\s*nomodify && r:\s*notrap && r:\s*nopeer && r:\s*noquery'
      - 'f:/etc/ntp.conf -> r:^restrict\s*\t*-6\s*\t*default && r:\s*kod && r:\s*nomodify && r:\s*notrap && r:\s*nopeer && r:\s*noquery'

  # 2.1.4.2 Ensure ntp is configured with authorized timeserver. (Manual)
  - id: 19052
    title: "確保 ntp 配置了授權的時間伺服器。"
    description: '各種模式由指令關鍵字和所需IP 位址的類型決定。位址按類型分類為 (s) 遠端伺服器或對等點（IPv4 類別 A、B 和 C）、(b) 本機介面的廣播位址、(m) 多播位址（IPv4 類別 D）或 (r) ）參考時鐘位址（127.127.x.x）。注意：下面僅列出了適用於每個指令的選項。使用未列出的選項可能不會被視為錯誤，但可能會導致一些奇怪的甚至破壞性的行為。如果偵測到 IPv6 基本套接字介面擴充 (RFC-2553)，除了 IPv4 位址系列的預設支援之外，還會產生對 IPv6 位址系列的支援。在少數情況下，包括 ntpq 或 ntpdc 產生的 reslist billboard，IPv6 位址是自動產生的。 IPv6 位址可以透過位址欄位中存在的冒號「:」來識別。 IPv6 位址幾乎可以在所有可以使用 IPv4 位址的地方使用，但參考時鐘位址除外，它總是 IPv4。注意：在需要主機名稱的上下文中，主機名稱前面的 -4 限定詞會強制將 DNS 解析為 IPv4 命名空間，而 -6 限定詞會強制將 DNS 解析為 IPv6 命名空間。有關該位址族的等效類，請參閱 IPv6 參考。 - pool - 對於 s 類型位址，此指令調動與多個遠端伺服器的持續性用戶端模式關聯。在該模式下，本機時鐘可以同步到遠端伺服器，但遠端伺服器永遠無法同步到本機時鐘。 - 伺服器 - 對於 s 和 r 類型位址，此指令調動與指定遠端伺服器或本機無線電時鐘的持續性用戶端模式關聯。在該模式下，本機時鐘可以同步到遠端伺服器，但遠端伺服器永遠無法同步到本機時鐘。此指令不應用於 b 或 m 類型位址。'
    rationale: "時間同步對於支援時間敏感的安全機制並確保日誌檔案在整個企業中具有一致的時間記錄以幫助取證調查非常重要。"
    remediation: "編輯 /etc/ntp.conf 並根據當地站點政策添加或編輯伺服器或池行：<[server|pool]> <[remote-server|remote-pool]> 範例：池模式：pool time.nist.gov iburst 伺服器模式：server time-a-g.nist.gov iburst server 132.163.97.3 iburst server time-d-b.nist.gov iburst 運行以下指令將更新的時間來源載入到正在運行的 ntp 配置中：# systemctl restart ntp 或 如果系統中使用了其他時間同步服務，運行以下指令將 ntp 從系統中移除：# apt purge ntp."
    references:
      - "http://www.ntp.org/"
      - "https://tf.nist.gov/tf-cgi/servers.cgi"
    compliance:
      - cis: ["2.1.4.2"]
      - cis_csc_v8: ["8.4"]
      - cis_csc_v7: ["6.1"]
      - cmmc_v2.0: ["AU.L2-3.3.7"]
      - iso_27001-2013: ["A.12.4.4"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0002"]
      - mitre_techniques: ["T1070", "T1070.002", "T1498", "T1498.002", "T1562", "T1562.001"]
      - nist_sp_800-53: ["AU-7"]
      - pci_dss_v3.2.1: ["10.4"]
      - pci_dss_v4.0: ["10.6", "10.6.1", "10.6.2", "10.6.3"]
      - soc_2: ["CC4.1", "CC5.2"]
    condition: all
    rules:
      - "f:/etc/ntp.conf -> r:^pool"
      - "f:/etc/ntp.conf -> r:^server"

  # 2.1.4.3 Ensure ntp is running as user ntp. (Automated)
  - id: 19053
    title: "確保 ntp 以 ntp 使用者身分運作。"
    description: "ntp 軟體包是使用專用使用者帳戶 ntp 安裝的。此帳戶被授予 ntpd 守護程序所需的存取權限 注意： - 如果使用 chrony 或 systemd-timesyncd，則應刪除 ntp 並跳過本節 - 此建議僅適用於系統上使用 ntp 的情況 - 僅一次同步方法應該在系統上使用。"
    rationale: "ntpd 守護程序應僅以所需的權限執行。"
    remediation: "新增或編輯 /usr/lib/ntp/ntp-systemd-wrapper 中的以下行: RUNASUSER=ntp 執行以下指令重啟 ntp.service: # systemctl restart ntp.service 或者 如果系統中使用了其他時間同步服務, 執行以下指令將 ntp 從系統中移除: # apt purge ntp."
    references:
      - "http://www.ntp.org/"
    compliance:
      - cis: ["2.1.4.3"]
      - cis_csc_v8: ["8.4"]
      - cis_csc_v7: ["6.1"]
      - cmmc_v2.0: ["AU.L2-3.3.7"]
      - iso_27001-2013: ["A.12.4.4"]
      - nist_sp_800-53: ["AU-7"]
      - pci_dss_v3.2.1: ["10.4"]
      - pci_dss_v4.0: ["10.6", "10.6.1", "10.6.2", "10.6.3"]
      - soc_2: ["CC4.1", "CC5.2"]
    condition: all
    rules:
      - "f:/usr/lib/ntp/ntp-systemd-wrapper -> r:^RUNASUSER=ntp"

  # 2.1.4.4 Ensure ntp is enabled and running. (Automated)
  - id: 19054
    title: "確保 ntp 已啟用並正在運行。"
    description: "ntp 是一個用於透過網路同步系統時鐘的守護程式。"
    rationale: "需要啟用並運行 ntp 才能將系統同步到時間伺服器。時間同步對於支援時間敏感的安全機制並確保日誌檔案在整個企業中具有一致的時間記錄以幫助取證調查非常重要。"
    remediation: "若系統上有使用 ntp，請執行以下指令：執行以下指令來解除 ntp.service 的遮罩：# systemctl unmask ntp.service 執行以下指令來啟用並啟動 ntp.service：# systemctl --now enable ntp.service 或者 如果系統上有使用其他的時間同步服務，請執行以下指令來移除 ntp：# apt purge ntp."
    compliance:
      - cis: ["2.1.4.4"]
      - cis_csc_v8: ["8.4"]
      - cis_csc_v7: ["6.1"]
      - cmmc_v2.0: ["AU.L2-3.3.7"]
      - iso_27001-2013: ["A.12.4.4"]
      - nist_sp_800-53: ["AU-7"]
      - pci_dss_v3.2.1: ["10.4"]
      - pci_dss_v4.0: ["10.6", "10.6.1", "10.6.2", "10.6.3"]
      - soc_2: ["CC4.1", "CC5.2"]
    condition: all
    rules:
      - "c:systemctl is-enabled ntp.service -> r:^enabled"
      - "c:systemctl is-active ntp.service -> r:^active"

  # 2.2.1 Ensure X Window System is not installed. (Automated)
  - id: 19055
    title: "確保未安裝 X Window 系統。"
    description: "X Window 系統提供了圖形使用者介面 (GUI)，使用者可以在其中擁有多個視窗來運行程式和各種附加元件。 X Windows 系統通常用於使用者登入的工作站，但不適用於使用者通常不登入的伺服器。"
    rationale: "除非您的組織特別需要透過 X Windows 進行圖形登入存取，否則請將其刪除以減少潛在的攻擊面。"
    impact: 'Many Linux systems run applications which require a Java runtime. Some Linux Java packages have a dependency on specific X Windows xorg-x11-fonts. One workaround to avoid this dependency is to use the "headless" Java packages for your specific Java runtime, if provided by your distribution.'
    remediation: "刪除 X 視窗系統套件: apt purge xserver-xorg*。"
    compliance:
      - cis: ["2.2.1"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["2.6"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.12.5.1", "A.12.6.2"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1203", "T1210", "T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - "c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' xserver-xorg -> r:unknown ok not-installed"
      - "not c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' xserver-xorg -> r:install ok installed"

  # 2.2.2 Ensure Avahi Server is not installed. (Automated)
  - id: 19056
    title: "請確保未安裝 Avahi 伺服器。"
    description: "Avahi 是一個免費的 Zeroconf 實作，包括用於多播 DNS/DNS-SD 服務發現的系統。 Avahi 允許程式發布和發現在本機網路上執行的服務和主機，無需進行特定配置。例如，使用者可以將電腦插入網路，Avahi 會自動尋找要列印的印表機、要查看的檔案和要交談的人，以及電腦上執行的網路服務。"
    rationale: "系統功能通常不需要自動發現網路服務。建議刪除此軟體包以減少潛在的攻擊面。"
    remediation: "運行以下指令來移除 avahi-daemon: # systemctl stop avahi-daemon.service # systemctl stop avahi-daemon.socket # apt purge avahi-daemon."
    compliance:
      - cis: ["2.2.2"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1203", "T1210", "T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - "c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' avahi-daemon -> r:unknown ok not-installed"
      - "not c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' avahi-daemon -> r:install ok installed"

  # 2.2.3 Ensure CUPS is not installed. (Automated)
  - id: 19057
    title: "確保未安裝 CUPS。"
    description: "通用 Unix 列印系統 (CUPS) 提供了列印到本機和網路印表機的功能。運行 CUPS 的系統還可以接受來自遠端系統的列印作業並將其列印到本機印表機。它還提供基於網路的遠端管理功能。"
    rationale: "如果系統不需要列印作業或接受其他系統的列印作業，建議刪除 CUPS 以減少潛在的攻擊面。"
    impact: "Removing CUPS will prevent printing from the system, a common task for workstation systems."
    remediation: "要刪除 CUPS，請運行以下指令之一：# apt purge cups。"
    references:
      - "http://www.cups.org."
    compliance:
      - cis: ["2.2.3"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1203", "T1210", "T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - "c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' cups -> r:unknown ok not-installed"
      - "not c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' cups -> r:install ok installed"

  # 2.2.4 Ensure DHCP Server is not installed. (Automated)
  - id: 19058
    title: "確保未安裝 DHCP 伺服器。"
    description: "動態主機設定協定 (DHCP) 是一項允許為電腦動態指派 IP 位址的服務。"
    rationale: "除非系統專門設定為充當 DHCP 伺服器，否則建議刪除此軟體包以減少潛在的攻擊面。"
    remediation: "運行以下指令來移除 isc-dhcp-server: # apt purge isc-dhcp-server."
    references:
      - "http://www.isc.org/software/dhcp."
    compliance:
      - cis: ["2.2.4"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1203", "T1210", "T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - "c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' isc-dhcp-server -> r:unknown ok not-installed"
      - "not c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' isc-dhcp-server -> r:install ok installed"

  # 2.2.5 Ensure LDAP server is not installed. (Automated)
  - id: 19059
    title: "確保未安裝 LDAP 伺服器。"
    description: "引入輕量級目錄存取協定 (LDAP) 作為 NIS/YP 的替代品。它是一種提供從中央資料庫中尋找資訊的方法的服務。"
    rationale: "如果系統不需要充當 LDAP 伺服器，建議刪除該軟體以減少潛在的攻擊面。"
    remediation: "執行以下其中一個指令來移除 slapd：# apt purge slapd."
    references:
      - "http://www.openldap.org."
    compliance:
      - cis: ["2.2.5"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1203", "T1210", "T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - "c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' slapd -> r:unknown ok not-installed"
      - "not c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' slapd -> r:install ok installed"

  # 2.2.6 Ensure NFS is not installed. (Automated)
  - id: 19060
    title: "確保未安裝 NFS。"
    description: "網路檔案系統 (NFS) 是 UNIX 環境中最早且分佈最廣泛的檔案系統之一。它為系統提供了透過網路掛載其他伺服器的檔案系統的能力。"
    rationale: "如果系統不匯出NFS共享，建議刪除nfs-kernel-server套件，以減少遠端攻擊面。"
    remediation: "執行以下指令以移除 nfs：# apt purge nfs-kernel-server。"
    compliance:
      - cis: ["2.2.6"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - "c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' nfs-kernel-server -> r:unknown ok not-installed"
      - "not c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' nfs-kernel-server -> r:install ok installed"

  # 2.2.7 Ensure DNS Server is not installed. (Automated)
  - id: 19061
    title: "確保未安裝 DNS 伺服器。"
    description: "網域名稱系統 (DNS) 是一種分層命名系統，它將名稱對應到連接到網路的電腦、服務和其他資源的 IP 位址。"
    rationale: "除非專門指定系統充當 DNS 伺服器，否則建議刪除該軟體包以減少潛在的攻擊面。"
    remediation: "運行以下指令來停用 DNS 伺服器: # apt purge bind9."
    compliance:
      - cis: ["2.2.7"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1203", "T1210", "T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - "c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' bind9 -> r:unknown ok not-installed"
      - "not c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' bind9 -> r:install ok installed"

  # 2.2.8 Ensure FTP Server is not installed. (Automated)
  - id: 19062
    title: "確保未安裝 FTP 伺服器。"
    description: "檔案傳輸協定 (FTP) 為聯網電腦提供了傳輸檔案的能力。"
    rationale: "FTP 不保護資料或身分驗證憑證的機密性。如果需要檔案傳輸，建議使用SFTP。除非需要將系統作為FTP伺服器運行（例如，允許匿名下載），否則建議刪除該軟體包以減少潛在的攻擊面。"
    remediation: "執行以下指令來移除 vsftpd: # apt purge vsftpd."
    compliance:
      - cis: ["2.2.8"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1203", "T1210", "T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - "c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' vsftpd -> r:unknown ok not-installed"
      - "not c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' vsftpd -> r:install ok installed"

  # 2.2.9 Ensure HTTP server is not installed. (Automated)
  - id: 19063
    title: "確保未安裝 HTTP 伺服器。"
    description: "HTTP 或 Web 伺服器提供託管網站內容的能力。"
    rationale: "除非需要將系統作為Web伺服器運行，否則建議刪除該軟體包以減少潛在的攻擊面。"
    remediation: "執行以下指令以移除 apache2: # apt purge apache2。"
    compliance:
      - cis: ["2.2.9"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1203", "T1210", "T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - "c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' apache2 -> r:unknown ok not-installed"
      - "not c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' apache2 -> r:install ok installed"

  # 2.2.10 Ensure IMAP and POP3 server are not installed. (Automated)
  - id: 19064
    title: "確保未安裝 IMAP 和 POP3 伺服器。"
    description: "dovecot-imapd 和 dovecot-pop3d 是基於 Linux 系統的開源 IMAP 和 POP3 伺服器。"
    rationale: "除非系統要提供 POP3 和/或 IMAP 伺服器，否則建議刪除該軟體包以減少潛在的攻擊面。"
    remediation: "運行以下指令之一以移除 dovecot-imapd 和 dovecot-pop3d: # apt purge dovecot-imapd dovecot-pop3d."
    compliance:
      - cis: ["2.2.10"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1203", "T1210", "T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: all
    rules:
      - "not c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' dovecot-imapd -> r:install ok installed"
      - "not c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' dovecot-pop3d -> r:install ok installed"

  # 2.2.11 Ensure Samba is not installed. (Automated)
  - id: 19065
    title: "確保未安裝 Samba。"
    description: "Samba 守護程序可讓系統管理員將其 Linux 系統設定為與 Windows 桌面共用檔案系統和目錄。 Samba 將透過伺服器訊息區塊 (SMB) 協定通告檔案系統和目錄。 Windows 桌面用戶將能夠將這些目錄和檔案系統作為磁碟機安裝在其系統上。"
    rationale: "如果不需要將目錄和檔案系統掛載到Windows系統，那麼應該刪除該服務以減少潛在的攻擊面。"
    remediation: "執行以下指令來移除 samba: # apt purge samba."
    compliance:
      - cis: ["2.2.11"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1005", "T1039", "T1083", "T1135", "T1203", "T1210", "T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - "c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' samba -> r:unknown ok not-installed"
      - "not c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' samba -> r:install ok installed"

  # 2.2.12 Ensure HTTP Proxy Server is not installed. (Automated)
  - id: 19066
    title: "確保未安裝 HTTP 代理伺服器。"
    description: "Squid 是許多發行版和環境中使用的標準代理伺服器。"
    rationale: "如果不需要代理伺服器，建議刪除squid代理，以減少潛在的攻擊面。"
    remediation: "運行以下指令來移除squid: # apt purge squid."
    compliance:
      - cis: ["2.2.12"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1203", "T1210", "T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - "c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' squid -> r:unknown ok not-installed"
      - "not c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' squid -> r:install ok installed"

  # 2.2.13 Ensure SNMP Server is not installed. (Automated)
  - id: 19067
    title: "確保未安裝 SNMP 伺服器。"
    description: '簡單網路管理協定 (SNMP) 是一種廣泛使用的協定，用於監控網路設備、電腦設備和 UPS 等設備的健康狀況和福祉。 Net-SNMP 是一套應用程序，用於使用 IPv4 和 IPv6 實現 SNMPv1 (RFC 1157)、SNMPv2 (RFC 1901-1908) 和 SNMPv3 (RFC 3411-3418)。隨著 UCD-snmp 軟體包 4.0 版本的發布，對 SNMPv2 classic（又稱「SNMPv2 Historical」 - RFC 1441-1452）的支援已被刪除。簡單網路管理協定（SNMP）伺服器用於偵聽來自 SNMP 管理系統的 SNMP 指令，執行指令或收集訊息，然後將結果傳回請求系統。'
    rationale: "SNMP 伺服器可以使用 SNMPv1 進行通訊，該協定以明文方式傳輸資料，並且不需要身份驗證即可執行指令。 SNMPv3 使用更安全的編碼參數取代了 SNMPv2 中使用的簡單/明文密碼共用。如果不需要SNMP服務，則應刪除snmpd套件以減少系統的攻擊面。注意：如果需要 SNMP： - 應僅針對 SNMP v3 設定伺服器。應配置用戶身份驗證和訊息加密。如果絕對需要 SNMP v2，請修改團體字串的值。 -."
    remediation: "運行以下指令來移除 snmpd: # apt purge snmpd."
    compliance:
      - cis: ["2.2.13"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1203", "T1210", "T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - "c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' snmp -> r:unknown ok not-installed"
      - "not c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' snmp -> r:install ok installed"

  # 2.2.14 Ensure NIS Server is not installed. (Automated)
  - id: 19068
    title: "確保未安裝 NIS 伺服器。"
    description: "網路資訊服務 (NIS)（以前稱為黃頁）是一種用於分發系統設定檔的用戶端伺服器目錄服務協定。 NIS 伺服器是允許分發設定檔的程式的集合。"
    rationale: "NIS 服務本質上是一個不安全的系統，容易受到 DOS 攻擊、緩衝區溢出，並且查詢 NIS 映射的身份驗證很差。 NIS 通常已被輕量級目錄存取協定 (LDAP) 等協定所取代。建議刪除該服務並使用其他更安全的服務。"
    remediation: "執行以下指令來移除 nis: # apt purge nis."
    compliance:
      - cis: ["2.2.14"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1203", "T1210", "T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - "c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' nis -> r:unknown ok not-installed"
      - "not c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' nis -> r:install ok installed"

  # 2.2.15 Ensure dnsmasq is not installed. (Automated)
  - id: 19069
    title: "確保未安裝 dnsmasq。"
    description: "dnsmasq 是一個輕量級工具，提供 DNS 快取、DNS 轉送和 DHCP（動態主機設定協定）服務。"
    rationale: "除非系統被專門指定充當 DNS 快取、DNS 轉送和/或 DHCP 伺服器，否則建議刪除該軟體包以減少潛在的攻擊面。"
    remediation: "執行以下指令來移除 dnsmasq：# apt purge dnsmasq."
    compliance:
      - cis: ["2.2.15"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1203", "T1210", "T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - "c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' dnsmaq -> r:unknown ok not-installed"
      - "not c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' dnsmaq -> r:install ok installed"

  # 2.2.16 Ensure mail transfer agent is configured for local-only mode. (Automated)
  - id: 19070
    title: "確保郵件傳輸代理程式配置為僅本機模式。"
    description: "郵件傳輸代理程式 (MTA)，例如 sendmail 和 Postfix，用於偵聽傳入郵件並將訊息傳送到適當的使用者或郵件伺服器。如果系統不打算用作郵件伺服器，建議將 MTA 設定為僅處理本機郵件。"
    rationale: "所有郵件傳輸代理程式的軟體都很複雜，而且大多數都存在長期的安全性問題。雖然確保系統可以處理本地郵件訊息很重要，但沒有必要讓 MTA 的守護程序偵聽端口，除非伺服器打算成為接收和處理來自其他系統的郵件的郵件伺服器。注意： - 此建議是圍繞 postfix 郵件伺服器設計的。 - 根據您的環境，您可能安裝了替代 MTA，例如 exim4。如果是這種情況，請參閱已安裝的 MTA 的檔案以設定建議的狀態。"
    remediation: "編輯 /etc/postfix/main.cf 並在接收郵件部分新增以下行。如果該行已經存在，請將其更改為如下所示：inet_interfaces = loopback-only 執行以下指令重啟 postfix：# systemctl restart postfix。"
    compliance:
      - cis: ["2.2.16"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1018", "T1210"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: all
    rules:
      - 'c:ss -lntu -> r:\.*:25\.*LISTEN && !r:127.0.0.1:25\.*LISTEN|::1:25\.*LISTEN'

  # 2.2.17 Ensure rsync service is either not installed or is masked. (Automated)
  - id: 19071
    title: "確保 rsync 服務未安裝或被封鎖。"
    description: "rsync 服務可用於透過網路連結在系統之間同步檔案。"
    rationale: "rsync 服務存在安全風險，因為 rsync 協定未加密。應刪除 rsync 包，或如果需要依賴項，應停止並封鎖 rsync 服務，以減少系統的攻擊範圍。"
    remediation: "運行以下指令來移除 rsync: # apt purge rsync -- 或 -- 運行以下指令來停止並封鎖 rsync: # systemctl stop rsync # systemctl mask rsync."
    compliance:
      - cis: ["2.2.17"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1105", "T1203", "T1210", "T1543", "T1543.002", "T1570"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - "c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' rsync -> r:unknown ok not-installed"
      - "c:systemctl is-active rsync -> r:^inactive"
      - "c:systemctl is-enabled rsync -> r:^masked"

  # 2.3.1 Ensure NIS Client is not installed. (Automated)
  - id: 19072
    title: "確保未安裝 NIS 用戶端。"
    description: "網路資訊服務 (NIS)，以前稱為黃頁，是一種用於分發系統設定檔的用戶端伺服器目錄服務協定。 NIS 用戶端用於將電腦綁定到 NIS 伺服器並接收分發的設定檔。"
    rationale: "NIS 服務本質上是一個不安全的系統，容易受到 DOS 攻擊、緩衝區溢出，並且查詢 NIS 映射的身份驗證很差。 NIS 通常已被輕量級目錄存取協定 (LDAP) 等協定所取代。建議刪除該服務。"
    impact: "Many insecure service clients are used as troubleshooting tools and in testing environments. Uninstalling them can inhibit capability to test and troubleshoot. If they are required it is advisable to remove the clients after use to prevent accidental or intentional misuse."
    remediation: "卸載 nis: # apt purge nis."
    compliance:
      - cis: ["2.3.1"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["2.6"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.12.5.1", "A.12.6.2"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1203", "T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - "c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' nis -> r:unknown ok not-installed"
      - "not c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' nis -> r:install ok installed"

  # 2.3.2 Ensure rsh client is not installed. (Automated)
  - id: 19073
    title: "確保未安裝 rsh 用戶端。"
    description: "rsh-client 軟體包包含 rsh 服務的客戶端指令。"
    rationale: "這些舊版客戶端存在大量安全漏洞，已被更安全的 SSH 軟體包取代。即使伺服器被刪除，最好也確保客戶端也被刪除，以防止使用者無意中嘗試使用這些指令並因此暴露其憑證。請注意，刪除 rsh-client 軟體包會刪除 rsh、rcp 和 rlogin 的客戶端。"
    impact: "Many insecure service clients are used as troubleshooting tools and in testing environments. Uninstalling them can inhibit capability to test and troubleshoot. If they are required it is advisable to remove the clients after use to prevent accidental or intentional misuse."
    remediation: "卸載 rsh: # apt purge rsh-client."
    compliance:
      - cis: ["2.3.2"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1041", "M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1040", "T1203", "T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - "c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' rsh-client -> r:unknown ok not-installed"
      - "not c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' rsh-client -> r:install ok installed"

  # 2.3.3 Ensure talk client is not installed. (Automated)
  - id: 19074
    title: "確保未安裝談話客戶端。"
    description: "此談話軟體使用戶可以透過終端會話跨系統發送和接收訊息。預設會安裝允許初始化談話會話的談話用戶端。"
    rationale: "該軟體存在安全風險，因為它使用未加密的協定進行通訊。"
    impact: "Many insecure service clients are used as troubleshooting tools and in testing environments. Uninstalling them can inhibit capability to test and troubleshoot. If they are required it is advisable to remove the clients after use to prevent accidental or intentional misuse."
    remediation: "解除安裝 talk: # apt purge talk."
    compliance:
      - cis: ["2.3.3"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1041", "M1042"]
      - mitre_tactics: ["TA0006", "TA0008"]
      - mitre_techniques: ["T1203", "T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - "c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' talk -> r:unknown ok not-installed"
      - "c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' talk -> r:no packages found matching talk"
      - "not c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' talk -> r:install ok installed"

  # 2.3.4 Ensure telnet client is not installed. (Automated)
  - id: 19075
    title: "確保未安裝 telnet 用戶端。"
    description: "telnet 軟體包包含 telnet 用戶端，它允許使用者透過 telnet 協定啟動與其他系統的連線。"
    rationale: "telnet 協定不安全且未加密。使用未加密的傳輸媒體可能會導致未經授權的使用者竊取憑證。 ssh 軟體包提供加密會話和更強的安全性，並包含在大多數 Linux 發行版中。"
    impact: "Many insecure service clients are used as troubleshooting tools and in testing environments. Uninstalling them can inhibit capability to test and troubleshoot. If they are required it is advisable to remove the clients after use to prevent accidental or intentional misuse."
    remediation: "卸載telnet：# apt purge telnet."
    compliance:
      - cis: ["2.3.4"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1041", "M1042"]
      - mitre_tactics: ["TA0006", "TA0008"]
      - mitre_techniques: ["T1040", "T1203", "T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - "c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' telnet -> r:unknown ok not-installed"
      - "not c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' telnet -> r:install ok installed"

  # 2.3.5 Ensure LDAP client is not installed. (Automated)
  - id: 19076
    title: "確保未安裝 LDAP 用戶端。"
    description: "引入輕量級目錄存取協定 (LDAP) 作為 NIS/YP 的替代品。它是一種提供從中央資料庫中尋找資訊的方法的服務。"
    rationale: "如果系統不需要充當 LDAP 用戶端，建議刪除該軟體以減少潛在的攻擊面。"
    impact: "Removing the LDAP client will prevent or inhibit using LDAP for authentication in your environment."
    remediation: "卸載 ldap-utils: # apt purge ldap-utils."
    compliance:
      - cis: ["2.3.5"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1203", "T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - "c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' ldap-utils -> r:unknown ok not-installed"
      - "not c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' ldap-utils -> r:install ok installed"

  # 2.3.6 Ensure RPC is not installed. (Automated)
  - id: 19077
    title: "確保未安裝 RPC。"
    description: '遠端過程呼叫 (RPC) 是一種跨不同系統體系結構建立低階客戶端伺服器應用程式的方法。它需要一個 RPC 相容的客戶端偵聽網路連接埠。配套的包是rpcbind」。'
    rationale: "如果不需要RPC，建議刪除該服務以減少遠端攻擊面。"
    remediation: "執行以下指令來移除 rpcbind: # apt purge rpcbind."
    compliance:
      - cis: ["2.3.6"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1203", "T1543", "T1543.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - "c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' rpcbind -> r:unknown ok not-installed"
      - "not c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' rpcbind -> r:install ok installed"

  # 2.4 Ensure nonessential services are removed or masked. (Manual) - Not Implemented

  # 3.1.1 Ensure IPv6 status is identified. (Manual)
  - id: 19078
    title: "確保識別 IPv6 狀態。"
    description: "Internet 協定版本 6 (IPv6) 是 Internet 協定 (IP) 的最新版本。它旨在提供 IP 尋址和額外的安全性，以支援連接設備的預期成長。 IPv6基於128位元尋址，可以支援340個十進位位址，即340後面跟著36個零。 IPv6 的特性 - 分層尋址和路由基礎架構 - 有狀態和無狀態配置 - 支援服務品質 (QoS) - 相鄰節點互動的理想協定。"
    rationale: "IETF RFC 4038 建議在雙堆疊假設的情況下建立應用程式。建議根據 Benchmark 建議啟用和設定 IPv6。如果您的環境中未使用雙堆疊和 IPv6，則可能會停用 IPv6 以減少系統的攻擊面，並且可以跳過與 IPv6 相關的建議。注意：建議啟用並設定 IPv6，除非這違反本機網站原則。"
    impact: "IETF RFC 4038 recommends that applications are built with an assumption of dual stack. When enabled, IPv6 will require additional configuration to reduce risk to the system."
    remediation: "根據系統需求和當地站點政策啟用或禁用IPv6。"
    compliance:
      - cis: ["3.1.1"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1557", "T1595", "T1595.001", "T1595.002"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: all
    rules:
      - "f:/sys/module/ipv6/parameters/disable -> r:^0$"

  # 3.1.2 Ensure wireless interfaces are disabled. (Automated) - Not Implemented

  # 3.1.3 Ensure bluetooth is disabled. (Automated)
  - id: 19079
    title: "確保藍牙已停用。"
    description: "藍牙是一種短距離無線技術標準，用於短距離設備之間交換資料。它採用 ISM 頻段（2.402 GHz 至 2.48 GHz）的 UHF 無線電波。它主要用作有線連接的替代品。"
    rationale: "攻擊者也許能夠找到存取或損壞您的資料的方法。此類活動的一個範例是 bluesnarfing，它指的是攻擊者使用藍牙連接從您的藍牙裝置竊取資訊。此外，病毒或其他惡意程式碼也可以利用藍牙技術來感染其他裝置。如果您被感染，您的資料可能會被損壞、洩漏、被盜或遺失。"
    impact: "Many personal electronic devices (PEDs) use Bluetooth technology. For example, you may be able to operate your computer with a wireless keyboard. Disabling Bluetooth will prevent these devices from connecting to the system."
    remediation: "執行以下指令以停止並封鎖藍牙服務 # systemctl stop bluetooth.service # systemctl mask bluetooth.service 注意：可能需要重新啟動。"
    references:
      - "https://www.cisa.gov/tips/st05-015"
    compliance:
      - cis: ["3.1.3"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: all
    rules:
      - "not c:systemctl is-enabled bluetooth.service -> r:^enabled"
      - "not c:systemctl is-active bluetooth.service -> r:^active"

  # 3.1.4 Ensure DCCP is disabled. (Automated) - Not Implemented
  # 3.1.5 Ensure SCTP is disabled. (Automated) - Not Implemented
  # 3.1.6 Ensure RDS is disabled. (Automated) Not Implemented
  # 3.1.7 Ensure TIPC is disabled. (Automated) - Not Implemented

  # 3.2.1 Ensure packet redirect sending is disabled. (Automated) - Not Implemented
  # 3.2.2 Ensure IP forwarding is disabled. (Automated) - Not Implemented

  # 3.3.1 Ensure source routed packets are not accepted. (Automated) - Not Implemented
  # 3.3.2 Ensure ICMP redirects are not accepted. (Automated) - Not Implemented
  # 3.3.3 Ensure secure ICMP redirects are not accepted. (Automated) - Not Implemented
  # 3.3.4 Ensure suspicious packets are logged. (Automated) - Not Implemented
  # 3.3.5 Ensure broadcast ICMP requests are ignored. (Automated) - Not Implemented
  # 3.3.6 Ensure bogus ICMP responses are ignored. (Automated) - Not Implemented
  # 3.3.7 Ensure Reverse Path Filtering is enabled. (Automated) - Not Implemented
  # 3.3.8 Ensure TCP SYN Cookies is enabled. (Automated) - Not Implemented
  # 3.3.9 Ensure IPv6 router advertisements are not accepted. (Automated) - Not Implemented

  # 3.4.1.1 Ensure ufw is installed. (Automated)
  - id: 19080
    title: "確保 ufw 已安裝。"
    description: "Uncomplicated Firewall (ufw) 是 iptables 的前端，特別適合主機為基礎的防火牆。 ufw 提供了一個用於管理 netfilter 的框架，以及一個用於操作防火牆的指令列介面。"
    rationale: "需要防火牆實用程式透過 iptables 或 nftables 後端設定 Linux 核心的 netfilter 框架。 Linux 核心的 netfilter 框架基於主機的防火牆可以防範來自企業網路內部的威脅，包括主機上的惡意行動程式碼和設定不當的軟體。注意：只應安裝和設定一個防火牆實用程式。 UFW 依賴 iptables 軟體包。"
    remediation: "執行以下指令來安裝 Uncomplicated Firewall (UFW) : apt install ufw."
    compliance:
      - cis: ["3.4.1.1"]
      - cis_csc_v8: ["4.4", "4.5"]
      - cis_csc_v7: ["9.4"]
      - cmmc_v2.0: ["AC.L1-3.1.20", "CM.L2-3.4.7", "SC.L1-3.13.1", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.1"]
      - mitre_mitigations: ["M1031", "M1037"]
      - mitre_tactics: ["TA0011"]
      - mitre_techniques: ["T1562", "T1562.004"]
      - nist_sp_800-53: ["SC-7(5)"]
      - pci_dss_v3.2.1: ["1.1.4", "1.3.1", "1.4"]
      - pci_dss_v4.0: ["1.2.1", "1.4.1"]
      - soc_2: ["CC6.6"]
    condition: all
    rules:
      - "c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' ufw -> r:install ok installed"

  # 3.4.1.2 Ensure iptables-persistent is not installed with ufw. (Automated)
  - id: 19081
    title: "確保 iptables-persistent 未與 ufw 一起安裝。"
    description: "iptables-persistent 是 netfilter 規則的啟動時載入程序，iptables 外掛程式。"
    rationale: "同時執行 ufw 和 iptables-persistent 套件中包含的服務可能會導致衝突。"
    remediation: "執行以下指令來移除 iptables-persistent 套件：# apt purge iptables-persistent."
    compliance:
      - cis: ["3.4.1.2"]
      - cis_csc_v8: ["4.4", "4.5"]
      - cis_csc_v7: ["9.4"]
      - cmmc_v2.0: ["AC.L1-3.1.20", "CM.L2-3.4.7", "SC.L1-3.13.1", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.1"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1562", "T1562.004"]
      - nist_sp_800-53: ["SC-7(5)"]
      - pci_dss_v3.2.1: ["1.1.4", "1.3.1", "1.4"]
      - pci_dss_v4.0: ["1.2.1", "1.4.1"]
      - soc_2: ["CC6.6"]
    condition: all
    rules:
      - "c:dpkg-query -s iptables-persistent -> r:package 'iptables-persistent' is not installed"

  # 3.4.1.3 Ensure ufw service is enabled. (Automated)
  - id: 19082
    title: "確保 ufw 服務已啟用。"
    description: "UncomplicatedFirewall (ufw) 是 iptables 的前端。 ufw 提供了一個用於管理 netfilter 的框架，以及用於操作防火牆的指令列和可用的圖形使用者介面。注意： - 當執行 ufw enable 或透過其初始化腳本啟動 ufw 時，ufw 將刷新其鏈。這是必需的，以便 ufw 可以保持一致的狀態，但它可能會刪除現有連線（例如 ssh）。 ufw 確實支援在啟用防火牆之前新增規則。 - 在執行 ufw enable 之前執行以下指令。 # ufw allowed proto tcp from any to any port 22 - 規則仍將被刷新，但啟用防火牆後 ssh 連接埠將會開啟。請注意，一旦ufw 被“啟用”，ufw 在添加或刪除規則時將不會刷新鏈（但會在修改規則或更改預設策略時刷新） - 預設情況下，ufw 在ssh 下運行時啟用防火牆時會提示。可以使用 ufw --force enable 停用此功能。"
    rationale: "必須啟用並運行 ufw 服務，ufw 才能保護系統。"
    impact: "Changing firewall settings while connected over network can result in being locked out of the system."
    remediation: "執行以下指令以解除對 ufw 服務的封鎖: # systemctl unmask ufw.service 執行以下指令以啟用並啟動 ufw 服務: # systemctl --now enable ufw.service active 執行以下指令以啟用 ufw: # ufw enable."
    references:
      - "http://manpages.ubuntu.com/manpages/precise/en/man8/ufw.8.html"
    compliance:
      - cis: ["3.4.1.3"]
      - cis_csc_v8: ["4.4", "4.5"]
      - cis_csc_v7: ["9.4"]
      - cmmc_v2.0: ["AC.L1-3.1.20", "CM.L2-3.4.7", "SC.L1-3.13.1", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.1"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1562", "T1562.004"]
      - nist_sp_800-53: ["SC-7(5)"]
      - pci_dss_v3.2.1: ["1.1.4", "1.3.1", "1.4"]
      - pci_dss_v4.0: ["1.2.1", "1.4.1"]
      - soc_2: ["CC6.6"]
    condition: all
    rules:
      - "c:systemctl is-enabled ufw.service -> r:enabled"
      - "c:systemctl is-active ufw -> r:^active"
      - "c:ufw status -> r:active"

  # 3.4.1.4 Ensure ufw loopback traffic is configured. (Automated)
  - id: 19083
    title: "確保 ufw 環回流量已配置。"
    description: "配置環回介面以接受流量。設定所有其他介面以拒絕流向環回網路的流量（對於 IPv4 為 127.0.0.0/8，對於 IPv6 為::1/128）。"
    rationale: "環回流量是在電腦上的程序之間產生的，通常對系統的運作至關重要。環回介面是唯一可以看到環回網路（IPv4 為 127.0.0.0/8，IPv6 為 ::1/128）流量的地方，所有其他介面都應忽略該網路上的流量，作為反欺騙措施。"
    remediation: "執行以下指令以實現環迴規則：# ufw allow in on lo # ufw allow out on lo # ufw deny in from 127.0.0.0/8 # ufw deny in from ::1."
    compliance:
      - cis: ["3.4.1.4"]
      - cis_csc_v8: ["4.4", "4.5"]
      - cis_csc_v7: ["9.4"]
      - cmmc_v2.0: ["AC.L1-3.1.20", "CM.L2-3.4.7", "SC.L1-3.13.1", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.1"]
      - mitre_mitigations: ["M1031", "M1037"]
      - mitre_tactics: ["TA0011"]
      - mitre_techniques: ["T1562", "T1562.004"]
      - nist_sp_800-53: ["SC-7(5)"]
      - pci_dss_v3.2.1: ["1.1.4", "1.3.1", "1.4"]
      - pci_dss_v4.0: ["1.2.1", "1.4.1"]
      - soc_2: ["CC6.6"]
    condition: all
    rules:
      - 'c:ufw status verbose -> r:Anywhere on lo\s*\t*ALLOW IN\s*\t*Anywhere'
      - 'c:ufw status verbose -> r:Anywhere\s*\t*DENY IN\s*\t*127.0.0.0/8'
      - 'c:ufw status verbose -> r:Anywhere \(v6\) on lo\s*\t*ALLOW IN\s*\t*Anywhere \(v6\)'
      - 'c:ufw status verbose -> r:Anywhere \(v6\)\s*\t*DENY IN\s*\t*::1'
      - 'c:ufw status verbose -> r:Anywhere\s*\t*ALLOW OUT\s*\t*Anywhere on lo'
      - 'c:ufw status verbose -> r:Anywhere \(v6\)\s*\t*ALLOW OUT\s*\t*Anywhere \(v6\) on lo'

  # 3.4.1.5 Ensure ufw outbound connections are configured. (Manual) - Not Implemented
  # 3.4.1.6 Ensure ufw firewall rules exist for all open ports. (Automated) - Not Implemented

  # 3.4.1.7 Ensure ufw default deny firewall policy. (Automated)
  - id: 19084
    title: "確保 ufw 預設拒絕防火牆策略。"
    description: "連線上的預設拒絕策略可確保拒絕任何未設定的網路使用。注意：在預設拒絕之前沒有明確允許的任何連接埠或協定都將被阻止。"
    rationale: "使用預設接受策略，防火牆將接受任何未配置為拒絕的資料包。將可接受的用法列入白名單比將不可接受的用法列入黑名單更容易。"
    impact: "Any port and protocol not explicitly allowed will be blocked. The following rules should be considered before applying the default deny. ufw allow git ufw allow in http ufw allow out http <- required for apt to connect to repository ufw allow in https ufw allow out https ufw allow out 53 ufw logging on."
    remediation: "執行以下指令來實現預設拒絕策略: # ufw default deny incoming # ufw default deny outgoing # ufw default deny routed."
    compliance:
      - cis: ["3.4.1.7"]
      - cis_csc_v8: ["4.4", "4.5"]
      - cis_csc_v7: ["9.4"]
      - cmmc_v2.0: ["AC.L1-3.1.20", "CM.L2-3.4.7", "SC.L1-3.13.1", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.1"]
      - mitre_mitigations: ["M1031", "M1037"]
      - mitre_tactics: ["TA0011"]
      - mitre_techniques: ["T1562", "T1562.004"]
      - nist_sp_800-53: ["SC-7(5)"]
      - pci_dss_v3.2.1: ["1.1.4", "1.3.1", "1.4"]
      - pci_dss_v4.0: ["1.2.1", "1.4.1"]
      - soc_2: ["CC6.6"]
    condition: all
    rules:
      - 'c:ufw status verbose -> r:^Default && r:deny\W+(incoming)|reject\W+(incoming)'
      - 'c:ufw status verbose -> r:^Default && r:deny\W+(outgoing)|reject\W+(outgoing)'
      - 'c:ufw status verbose -> r:^Default && r:deny\W+(routed)|reject\W+(routed)'

  # 3.4.2.1 Ensure nftables is installed. (Automated)
  - id: 19085
    title: "確保 nftables 已安裝。"
    description: "nftables 提供了一個新的核心封包分類框架，該框架基於特定於網路的虛擬機器 (VM) 和新的 nft 用戶空間指令列工具。 nftables 重複使用現有的 Netfilter 子系統，例如現有的鉤子基礎架構、連接追蹤系統、NAT、使用者空間排隊和日誌記錄子系統。注意： - nftables 在 Linux 核心 3.13 及更高版本中可用 - 僅應安裝和設定一個防火牆實用程式 - 透過網路連線時變更防火牆設定可能會導致鎖定在系統之外。"
    rationale: "nftables 是 Linux 核心的一個子系統，可以防禦來自企業網路內部的威脅，包括在惡意行動程式碼和主機上配置不當的軟體。"
    remediation: "運行以下指令來安裝nftables: # apt install nftables."
    compliance:
      - cis: ["3.4.2.1"]
      - cis_csc_v8: ["4.4", "4.5"]
      - cis_csc_v7: ["9.4"]
      - cmmc_v2.0: ["AC.L1-3.1.20", "CM.L2-3.4.7", "SC.L1-3.13.1", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.1"]
      - mitre_mitigations: ["M1031", "M1037"]
      - mitre_tactics: ["TA0011"]
      - mitre_techniques: ["T1562", "T1562.004"]
      - nist_sp_800-53: ["SC-7(5)"]
      - pci_dss_v3.2.1: ["1.1.4", "1.3.1", "1.4"]
      - pci_dss_v4.0: ["1.2.1", "1.4.1"]
      - soc_2: ["CC6.6"]
    condition: all
    rules:
      - "c:dpkg-query -s nftables -> r:install ok installed"

  # 3.4.2.2 Ensure ufw is uninstalled or disabled with nftables. (Automated)
  - id: 19086
    title: "確保 ufw 已卸載或使用 nftables 停用。"
    description: "Uncomplicated Firewall (UFW) 是一個用於管理 netfilter 防火牆的程序，其設計易於使用。"
    rationale: "同時執行 nftables 服務和 ufw 可能會導致衝突和意外結果。"
    remediation: "運行以下其中一個來移除 ufw 或禁用 ufw 並封鎖 ufw.service: 運行以下指令來移除 ufw: # apt purge ufw -或者- 運行以下指令來禁用 ufw 並封鎖 ufw.service: # ufw disable # systemctl stop ufw.service # systemctl mask ufw.service 注意: 需要在 systemctl mask ufw.service 之前運行 ufw disable 以正確禁用 UFW。"
    compliance:
      - cis: ["3.4.2.2"]
      - cis_csc_v8: ["4.4", "4.5"]
      - cis_csc_v7: ["9.4"]
      - cmmc_v2.0: ["AC.L1-3.1.20", "CM.L2-3.4.7", "SC.L1-3.13.1", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.1"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1562", "T1562.004"]
      - nist_sp_800-53: ["SC-7(5)"]
      - pci_dss_v3.2.1: ["1.1.4", "1.3.1", "1.4"]
      - pci_dss_v4.0: ["1.2.1", "1.4.1"]
      - soc_2: ["CC6.6"]
    condition: any
    rules:
      - "not c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' ufw -> r:install ok installed"
      - "c:ufw status -> r:inactive"
      - "c:systemctl is-enabled ufw.service -> r:^masked"

  # 3.4.2.3 Ensure iptables are flushed with nftables. (Manual) - Not Implemented

  # 3.4.2.4 Ensure a nftables table exists. (Automated)
  - id: 19087
    title: "確保 nftables 表存在。"
    description: "桌子上有鏈條。每個表只有一個位址族，且僅適用於該位址族的資料包。表格可以有五個系列之一。"
    rationale: "nftables 沒有任何預設表。如果沒有建置表，nftables 將不會過濾網路流量。"
    impact: "Adding rules to a running nftables can cause loss of connectivity to the system."
    remediation: "運行以下指令在nftables中創建一個表 # nft create table inet <table name> 範例: # nft create table inet filter."
    compliance:
      - cis: ["3.4.2.4"]
      - cis_csc_v8: ["4.4", "4.5"]
      - cis_csc_v7: ["9.4"]
      - cmmc_v2.0: ["AC.L1-3.1.20", "CM.L2-3.4.7", "SC.L1-3.13.1", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.1"]
      - mitre_mitigations: ["M1031", "M1037"]
      - mitre_tactics: ["TA0011"]
      - mitre_techniques: ["T1562", "T1562.004"]
      - nist_sp_800-53: ["SC-7(5)"]
      - pci_dss_v3.2.1: ["1.1.4", "1.3.1", "1.4"]
      - pci_dss_v4.0: ["1.2.1", "1.4.1"]
      - soc_2: ["CC6.6"]
    condition: all
    rules:
      - 'c:nft list tables -> r:\w+'

  # 3.4.2.5 Ensure nftables base chains exist. (Automated)
  - id: 19088
    title: "確保 nftables 基礎鏈存在。"
    description: "鍊是規則的容器。它們以兩種形式存在：基礎鍊和常規鏈。基本鍊是來自網路堆疊的資料包的入口點，常規鏈可以用作跳轉目標並用於更好的規則組織。"
    rationale: "如果不存在帶有用於輸入、轉發和刪除的鉤子的基本鏈，則流經這些鏈的資料包將不會被 nftables 觸及。"
    impact: "If configuring nftables over ssh, creating a base chain with a policy of drop will cause loss of connectivity. Ensure that a rule allowing ssh has been added to the base chain prior to setting the base chain's policy to drop."
    remediation: "執行以下指令來建立基本鏈: # nft create chain inet <table name> <base chain name> { type filter hook <(input|forward|output)> priority 0 \\; } 示例: # nft create chain inet filter input { type filter hook input priority 0 \\; } # nft create chain inet filter forward { type filter hook forward priority 0 \\; } # nft create chain inet filter output { type filter hook output priority 0 \\; }."
    compliance:
      - cis: ["3.4.2.5"]
      - cis_csc_v8: ["4.4", "4.5"]
      - cis_csc_v7: ["9.4"]
      - cmmc_v2.0: ["AC.L1-3.1.20", "CM.L2-3.4.7", "SC.L1-3.13.1", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.1"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1562", "T1562.004"]
      - nist_sp_800-53: ["SC-7(5)"]
      - pci_dss_v3.2.1: ["1.1.4", "1.3.1", "1.4"]
      - pci_dss_v4.0: ["1.2.1", "1.4.1"]
      - soc_2: ["CC6.6"]
    condition: all
    rules:
      - "c:nft list ruleset -> r:hook input"
      - "c:nft list ruleset -> r:hook forward"
      - "c:nft list ruleset -> r:hook output"

  # 3.4.2.6 Ensure nftables loopback traffic is configured. (Automated)
  - id: 19089
    title: "確保 nftables 環回流量已設定。"
    description: "配置環回介面以接受流量。設定所有其他介面以拒絕流向環回網路的流量。"
    rationale: "環回流量是在電腦上的程序之間產生的，通常對系統的運作至關重要。環回介面是環回網路流量唯一可見的地方，所有其他介面都應忽略該網路上的流量，作為反欺騙措施。"
    remediation: "執行以下指令以實現回送規則: # nft add rule inet filter input iif lo accept # nft create rule inet filter input ip saddr 127.0.0.0/8 counter drop -如果- 系統啟用了IPv6: 執行以下指令以實現IPv6回送規則: # nft add rule inet filter input ip6 saddr ::1 counter drop."
    compliance:
      - cis: ["3.4.2.6"]
      - cis_csc_v8: ["4.4", "4.5"]
      - cis_csc_v7: ["9.4"]
      - cmmc_v2.0: ["AC.L1-3.1.20", "CM.L2-3.4.7", "SC.L1-3.13.1", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.1"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1562", "T1562.004"]
      - nist_sp_800-53: ["SC-7(5)"]
      - pci_dss_v3.2.1: ["1.1.4", "1.3.1", "1.4"]
      - pci_dss_v4.0: ["1.2.1", "1.4.1"]
      - soc_2: ["CC6.6"]
    condition: all
    rules:
      - 'c:iptables -L INPUT -v -n -> r:\.*ACCEPT\.*all\.*lo\.**\.*0.0.0.0/0\.*0.0.0.0/0'
      - 'c:iptables -L INPUT -v -n -> r:\.*DROP\.*all\.**\.**\.*127.0.0.0/8\.*0.0.0.0/0'
      - 'c:iptables -L OUTPUT -v -n -> r:\.*ACCEPT\.*all\.**\.*lo\.*0.0.0.0/0\.*0.0.0.0/0'

  # 3.4.2.7 Ensure nftables outbound and established connections are configured. (Manual) - Not Implemented

  # 3.4.2.8 Ensure nftables default deny firewall policy. (Automated)
  - id: 19090
    title: "確保 nftables 預設拒絕防火牆策略。"
    description: "基本鏈策略是將應用於到達鏈末端的資料包的預設判決。"
    rationale: "有兩種策略：接受（預設）和丟棄。如果政策設定為接受，則防火牆將接受任何未配置為拒絕的資料包，並且資料包將繼續穿越網路堆疊。將可接受的用法列入白名單比將不可接受的用法列入黑名單更容易。注意：透過網路連線時變更防火牆設定可能會導致被系統鎖定。"
    impact: "If configuring nftables over ssh, creating a base chain with a policy of drop will cause loss of connectivity. Ensure that a rule allowing ssh has been added to the base chain prior to setting the base chain's policy to drop."
    remediation: "執行以下指令為 base chains 配置輸入、轉發和輸出 hooks 以實現預設的 DROP 政策: # nft chain <table family> <table name> <chain name> { policy drop \\; } 例子: # nft chain inet filter input { policy drop \\; } # nft chain inet filter forward { policy drop \\; } # nft chain inet filter output { policy drop \\; }."
    compliance:
      - cis: ["3.4.2.8"]
      - cis_csc_v8: ["4.4", "4.5"]
      - cis_csc_v7: ["9.4"]
      - cmmc_v2.0: ["AC.L1-3.1.20", "CM.L2-3.4.7", "SC.L1-3.13.1", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.1"]
      - mitre_mitigations: ["M1031", "M1037"]
      - mitre_tactics: ["TA0011"]
      - mitre_techniques: ["T1562", "T1562.004"]
      - nist_sp_800-53: ["SC-7(5)"]
      - pci_dss_v3.2.1: ["1.1.4", "1.3.1", "1.4"]
      - pci_dss_v4.0: ["1.2.1", "1.4.1"]
      - soc_2: ["CC6.6"]
    condition: all
    rules:
      - "c:nft list ruleset -> r:hook input && r:policy drop"
      - "c:nft list ruleset -> r:hook forward && r:policy drop"
      - "c:nft list ruleset -> r:hook output && r:policy drop"

  # 3.4.2.9 Ensure nftables service is enabled. (Automated)
  - id: 19091
    title: "確保 nftables 服務已啟用。"
    description: "nftables 服務允許在引導期間或在 nftables 服務上啟動時載入 nftables 規則集。"
    rationale: "nftables 服務在引導或 nftables 服務啟動期間從 /etc/nftables.conf 檔案中引用的規則檔案還原 nftables 規則。"
    remediation: "運行以下指令來啟用 nftables 服務: # systemctl enable nftables."
    compliance:
      - cis: ["3.4.2.9"]
      - cis_csc_v8: ["4.4", "4.5"]
      - cis_csc_v7: ["9.4"]
      - cmmc_v2.0: ["AC.L1-3.1.20", "CM.L2-3.4.7", "SC.L1-3.13.1", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.1"]
      - mitre_mitigations: ["M1031", "M1037"]
      - mitre_tactics: ["TA0011"]
      - mitre_techniques: ["T1562", "T1562.004"]
      - nist_sp_800-53: ["SC-7(5)"]
      - pci_dss_v3.2.1: ["1.1.4", "1.3.1", "1.4"]
      - pci_dss_v4.0: ["1.2.1", "1.4.1"]
      - soc_2: ["CC6.6"]
    condition: all
    rules:
      - "c:systemctl is-enabled nftables -> r:enabled"

  # 3.4.2.10 Ensure nftables rules are permanent. (Automated)
  - id: 19092
    title: "確保 nftables 規則是永久性的。"
    description: "nftables 是 Linux 核心的一個子系統，提供網路封包/資料封包/訊框的過濾和分類。 nftables 服務會讀取 /etc/nftables.conf 檔案以取得要包含在 nftables 規則集中的一個或多個 nftables 檔案。包含輸入、轉送和輸出基本鏈的 nftables 規則集允許過濾網路流量。"
    rationale: "對 nftables 規則集所做的變更僅會影響即時系統，您還需要設定 nftables 規則集以在啟動時套用。"
    remediation: '編輯 /etc/nftables.conf 檔案，並取消註解或新增一行 include <絕對路徑到 nftables 規則檔案> 以包含每個你想在開機時載入到 nftables 規則集的 nftables 檔案 範例: # vi /etc/nftables.conf 新增這行: include "/etc/nftables.rules".'
    compliance:
      - cis: ["3.4.2.10"]
      - cis_csc_v8: ["4.4", "4.5"]
      - cis_csc_v7: ["9.4"]
      - cmmc_v2.0: ["AC.L1-3.1.20", "CM.L2-3.4.7", "SC.L1-3.13.1", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.1"]
      - mitre_mitigations: ["M1031"]
      - mitre_tactics: ["TA0011"]
      - mitre_techniques: ["T1562", "T1562.004"]
      - nist_sp_800-53: ["SC-7(5)"]
      - pci_dss_v3.2.1: ["1.1.4", "1.3.1", "1.4"]
      - pci_dss_v4.0: ["1.2.1", "1.4.1"]
      - soc_2: ["CC6.6"]
    condition: all
    rules:
      - "f:/etc/nftables.conf -> r:include *"

  # 3.4.3.1.1 Ensure iptables packages are installed. (Automated)
  - id: 19093
    title: "確保 iptables 軟體包已安裝。"
    description: "iptables 是一個實用程序，允許系統管理員配置 Linux 核心防火牆提供的表（以不同的 Netfilter 模組實作）及其儲存的鍊和規則。不同的協定使用不同的核心模組和程式； iptables 適用於 IPv4，ip6tables 適用於 IPv6，arptables 適用於 ARP，ebtables 適用於乙太網路封包。"
    rationale: "配置基於主機的防火牆需要一種配置和維護防火牆規則的方法。"
    remediation: "運行以下指令來安裝iptables和iptables-persistent # apt install iptables iptables-persistent."
    compliance:
      - cis: ["3.4.3.1.1"]
      - cis_csc_v8: ["4.4", "4.5"]
      - cis_csc_v7: ["9.4"]
      - cmmc_v2.0: ["AC.L1-3.1.20", "CM.L2-3.4.7", "SC.L1-3.13.1", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.1"]
      - mitre_mitigations: ["M1031", "M1037"]
      - mitre_tactics: ["TA0011"]
      - mitre_techniques: ["T1562", "T1562.004"]
      - nist_sp_800-53: ["SC-7(5)"]
      - pci_dss_v3.2.1: ["1.1.4", "1.3.1", "1.4"]
      - pci_dss_v4.0: ["1.2.1", "1.4.1"]
      - soc_2: ["CC6.6"]
    condition: all
    rules:
      - "c:apt list iptables iptables-persistent -> r:installed,automatic"

  # 3.4.3.1.2 Ensure nftables is not installed with iptables. (Automated)
  - id: 19094
    title: "確保 nftables 未與 iptables 一起安裝。"
    description: "nftables 是 Linux 核心的一個子系統，提供網路封包/資料封包/訊框的過濾和分類，是 iptables 的後繼者。"
    rationale: "同時執行 iptables 和 nftables 可能會導致衝突。"
    remediation: "運行以下指令以移除nftables: # apt purge nftables."
    compliance:
      - cis: ["3.4.3.1.2"]
      - cis_csc_v8: ["4.4", "4.5"]
      - cis_csc_v7: ["9.4"]
      - cmmc_v2.0: ["AC.L1-3.1.20", "CM.L2-3.4.7", "SC.L1-3.13.1", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.1"]
      - mitre_tactics: ["TA0011"]
      - mitre_techniques: ["T1562", "T1562.004"]
      - nist_sp_800-53: ["SC-7(5)"]
      - pci_dss_v3.2.1: ["1.1.4", "1.3.1", "1.4"]
      - pci_dss_v4.0: ["1.2.1", "1.4.1"]
      - soc_2: ["CC6.6"]
    condition: all
    rules:
      - "c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' nftables -> r:unknown ok not-installed"

  # 3.4.3.1.3 Ensure ufw is uninstalled or disabled with iptables. (Automated)
  - id: 19095
    title: "確保 ufw 已卸載或透過 iptables 停用。"
    description: "Uncomplicated Firewall (UFW) 是一個用於管理 netfilter 防火牆的程序，其設計易於使用。 - 使用由少量簡單指令組成的指令列介面 - 使用 iptables 進行設定。"
    rationale: "在啟用 ufw 的情況下執行 iptables.persistent 可能會導致衝突和意外結果。"
    remediation: "執行以下其中一個指令來移除 ufw 或停止並封鎖 ufw 執行以下指令來移除 ufw: # apt purge ufw -OR- 執行以下指令來停用 ufw: # ufw disable # systemctl stop ufw # systemctl mask ufw 注意: ufw disable 需要在 systemctl mask ufw 之前執行，以正確停用 UFW。"
    compliance:
      - cis: ["3.4.3.1.3"]
      - cis_csc_v8: ["4.4", "4.5"]
      - cis_csc_v7: ["9.4"]
      - cmmc_v2.0: ["AC.L1-3.1.20", "CM.L2-3.4.7", "SC.L1-3.13.1", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.1"]
      - mitre_tactics: ["TA0011"]
      - mitre_techniques: ["T1562", "T1562.004"]
      - nist_sp_800-53: ["SC-7(5)"]
      - pci_dss_v3.2.1: ["1.1.4", "1.3.1", "1.4"]
      - pci_dss_v4.0: ["1.2.1", "1.4.1"]
      - soc_2: ["CC6.6"]
    condition: any
    rules:
      - "c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' ufw -> r:unknown ok not-installed"
      - "c:ufw status -> r:inactive"
      - "c:systemctl is-enabled ufw -> r:masked"
      - "c:ufw status -> r:inactive"

  # 3.4.3.2.1 Ensure iptables default deny firewall policy. (Automated)
  - id: 19096
    title: "確保 iptables 預設拒絕防火牆策略。"
    description: "預設拒絕所有連線原則可確保拒絕任何未設定的網路使用。注意： - 透過網路連線時變更防火牆設定可能會導致系統被鎖定 - 修復只會影響活動系統防火牆，請務必在防火牆管理中設定預設原則以在啟動時套用。"
    rationale: "使用預設接受策略，防火牆將接受任何未配置為拒絕的資料包。將可接受的用法列入白名單比將不可接受的用法列入黑名單更容易。"
    remediation: "執行以下指令來實現預設的DROP策略: # iptables -P INPUT DROP # iptables -P OUTPUT DROP # iptables -P FORWARD DROP."
    compliance:
      - cis: ["3.4.3.2.1"]
      - cis_csc_v8: ["4.4", "4.5"]
      - cis_csc_v7: ["9.4"]
      - cmmc_v2.0: ["AC.L1-3.1.20", "CM.L2-3.4.7", "SC.L1-3.13.1", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.1"]
      - mitre_mitigations: ["M1031", "M1037"]
      - mitre_tactics: ["TA0011"]
      - mitre_techniques: ["T1562", "T1562.004"]
      - nist_sp_800-53: ["SC-7(5)"]
      - pci_dss_v3.2.1: ["1.1.4", "1.3.1", "1.4"]
      - pci_dss_v4.0: ["1.2.1", "1.4.1"]
      - soc_2: ["CC6.6"]
    condition: all
    rules:
      - 'c:iptables -L -> r:Chain INPUT \(policy DROP\)|Chain INPUT \(policy REJECT\)'
      - 'c:iptables -L -> r:Chain FORWARD \(policy DROP\)|Chain FORWARD \(policy REJECT\)'
      - 'c:iptables -L -> r:Chain OUTPUT \(policy DROP\)|Chain OUTPUT \(policy REJECT\)'

  # 3.4.3.2.2 Ensure iptables loopback traffic is configured. (Automated)
  - id: 19097
    title: "確保 iptables 環回流量已設定。"
    description: "配置環回介面以接受流量。設定所有其他介面以拒絕流向環回網路 (127.0.0.0/8) 的流量。注意： - 透過網路連線時變更防火牆設定可能會導致系統被鎖定 - 修復只會影響活動系統防火牆，請務必在防火牆管理中設定預設原則以在啟動時套用。"
    rationale: "環回流量是在電腦上的程序之間產生的，通常對系統的運作至關重要。環回介面是唯一可以看到環回網路 (127.0.0.0/8) 流量的地方，所有其他介面都應忽略該網路上的流量，作為反欺騙措施。"
    remediation: "運行以下指令來實施環回規則: # iptables -A INPUT -i lo -j ACCEPT # iptables -A OUTPUT -o lo -j ACCEPT # iptables -A INPUT -s 127.0.0.0/8 -j DROP."
    compliance:
      - cis: ["3.4.3.2.2"]
      - cis_csc_v8: ["4.4", "4.5"]
      - cis_csc_v7: ["9.4"]
      - cmmc_v2.0: ["AC.L1-3.1.20", "CM.L2-3.4.7", "SC.L1-3.13.1", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.1"]
      - mitre_mitigations: ["M1031", "M1037"]
      - mitre_tactics: ["TA0011"]
      - mitre_techniques: ["T1562", "T1562.004"]
      - nist_sp_800-53: ["SC-7(5)"]
      - pci_dss_v3.2.1: ["1.1.4", "1.3.1", "1.4"]
      - pci_dss_v4.0: ["1.2.1", "1.4.1"]
      - soc_2: ["CC6.6"]
    condition: all
    rules:
      - 'c:iptables -L INPUT -v -n -> r:\.*ACCEPT\.*all\.*lo\.**\.*0.0.0.0/0\.*0.0.0.0/0'
      - 'c:iptables -L INPUT -v -n -> r:\.*DROP\.*all\.**\.**\.*127.0.0.0/8\.*0.0.0.0/0'
      - 'c:iptables -L OUTPUT -v -n -> r:\.*ACCEPT\.*all\.**\.*lo\.*0.0.0.0/0\.*0.0.0.0/0'

  # 3.4.3.2.3 Ensure iptables outbound and established connections are configured. (Manual) - Not Implemented

  # 3.4.3.2.4 Ensure iptables firewall rules exist for all open ports. (Automated) - Not Implemented

  # 3.4.3.3.1 Ensure ip6tables default deny firewall policy. (Automated)
  - id: 19098
    title: "確保 ip6tables 預設拒絕防火牆策略。"
    description: "預設拒絕所有連線原則可確保拒絕任何未設定的網路使用。注意： - 透過網路連線時變更防火牆設定可能會導致系統被鎖定 - 修復只會影響活動系統防火牆，請務必在防火牆管理中設定預設原則以在啟動時套用。"
    rationale: "使用預設接受策略，防火牆將接受任何未配置為拒絕的資料包。將可接受的用法列入白名單比將不可接受的用法列入黑名單更容易。"
    remediation: "如果您的系統啟用了IPv6：執行以下指令以實施預設的DROP策略：# ip6tables -P INPUT DROP # ip6tables -P OUTPUT DROP # ip6tables -P FORWARD DROP。"
    compliance:
      - cis: ["3.4.3.3.1"]
      - cis_csc_v8: ["4.4", "4.5"]
      - cis_csc_v7: ["9.4"]
      - cmmc_v2.0: ["AC.L1-3.1.20", "CM.L2-3.4.7", "SC.L1-3.13.1", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.1"]
      - mitre_mitigations: ["M1031", "M1037"]
      - mitre_tactics: ["TA0011"]
      - mitre_techniques: ["T1562", "T1562.004"]
      - nist_sp_800-53: ["SC-7(5)"]
      - pci_dss_v3.2.1: ["1.1.4", "1.3.1", "1.4"]
      - pci_dss_v4.0: ["1.2.1", "1.4.1"]
      - soc_2: ["CC6.6"]
    condition: all
    rules:
      - "c:ip6tables -L -> r:^Chain INPUT && r:policy DROP"
      - "c:ip6tables -L -> r:^Chain FORWARD && r:policy DROP"
      - "c:ip6tables -L -> r:^Chain OUTPUT && r:policy DROP"

  # 3.4.3.3.2 Ensure ip6tables loopback traffic is configured. (Automated)
  - id: 19099
    title: "確保配置了 ip6tables 環回流量。"
    description: "配置環回介面以接受流量。設定所有其他介面以拒絕流向環回網路 (::1) 的流量。注意： - 透過網路連線時變更防火牆設定可能會導致系統被鎖定 - 修復只會影響活動系統防火牆，請務必在防火牆管理中設定預設原則以在啟動時套用。"
    rationale: "環回流量是在電腦上的程序之間產生的，通常對系統的運作至關重要。環回介面是唯一可以看到環回網路 (::1) 流量的地方，所有其他介面都應忽略該網路上的流量，作為反欺騙措施。"
    remediation: "執行以下指令來實施回環規則: # ip6tables -A INPUT -i lo -j ACCEPT # ip6tables -A OUTPUT -o lo -j ACCEPT # ip6tables -A INPUT -s ::1 -j DROP."
    compliance:
      - cis: ["3.4.3.3.2"]
      - cis_csc_v8: ["4.4", "4.5"]
      - cis_csc_v7: ["9.4"]
      - cmmc_v2.0: ["AC.L1-3.1.20", "CM.L2-3.4.7", "SC.L1-3.13.1", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.1"]
      - mitre_mitigations: ["M1031", "M1037"]
      - mitre_tactics: ["TA0011"]
      - mitre_techniques: ["T1562", "T1562.004"]
      - nist_sp_800-53: ["SC-7(5)"]
      - pci_dss_v3.2.1: ["1.1.4", "1.3.1", "1.4"]
      - pci_dss_v4.0: ["1.2.1", "1.4.1"]
      - soc_2: ["CC6.6"]
    condition: all
    rules:
      - 'c:ip6tables -L INPUT -v -n -> r:\.*ACCEPT\.*all\.*lo\.**\.*::/0\.*::/0'
      - 'c:ip6tables -L INPUT -v -n -> r:\.*DROP\.*all\.**\.**\.*::1\.*::/0'
      - 'c:ip6tables -L OUTPUT -v -n -> r:\.*ACCEPT\.*all\.**\.*lo\.*::/0\.*::/0'

  # 3.4.3.3.3 Ensure ip6tables outbound and established connections are configured. (Manual) - Not Implemented
  # 3.4.3.3.4 Ensure ip6tables firewall rules exist for all open ports. (Automated) - Not Implemented

  # 4.1.1 Ensure cron daemon is enabled and active. (Automated)
  - id: 19100
    title: "確保 cron 守護程式已啟用並處於活動狀態。"
    description: "cron 守護程式用於在系統上執行批次作業。注意：還有其他方法（例如 systemd 計時器）可用於排程作業。如果使用其他方法，則應刪除 cron，並根據本機網站原則確保備用方法的安全。"
    rationale: "雖然系統上可能沒有需要執行的使用者作業，但系統確實有維護作業，其中可能包括必須執行的安全監控，並且使用 cron 來執行它們。"
    remediation: "運行以下指令以啟用並啟動 cron： # systemctl unmask cron # systemctl --now enable cron."
    compliance:
      - cis: ["4.1.1"]
      - mitre_mitigations: ["M1018"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1562", "T1562.001"]
    condition: all
    rules:
      - "c:systemctl is-enabled cron -> r:^enabled"
      - "c:systemctl status cron -> r:^active"

  # 4.1.2 Ensure permissions on /etc/crontab are configured. (Automated)
  - id: 19101
    title: "確保配置了 /etc/crontab 的權限。"
    description: "/etc/crontab 檔案由 cron 使用來控制自己的作業。此項目中的指令確保 root 是該檔案的使用者和群組擁有者，並且只有所有者才能存取該檔案。注意：還有其他方法（例如 systemd 計時器）可用於排程作業。如果使用其他方法，則應刪除 cron，並根據本機網站原則確保備用方法的安全。"
    rationale: "該檔案包含有關 cron 運行哪些系統作業的資訊。對這些檔案的寫入存取權限可以為非特權使用者提供提升權限的能力。對這些檔案的讀取存取權限可以使用戶能夠深入了解系統上運行的系統作業，並為他們提供一種獲得未經授權的特權存取權的方法。"
    remediation: "執行以下指令來設定 /etc/crontab 的擁有者和權限： # chown root:root /etc/crontab # chmod og-rwx /etc/crontab."
    compliance:
      - cis: ["4.1.2"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1018"]
      - mitre_tactics: ["TA0002", "TA0007"]
      - mitre_techniques: ["T1053", "T1053.003"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:stat -Lc "%a %A %u %U  %g %G" /etc/crontab -> r:600\s*\t*-rw-------\s*\t*0\s*\t*root\s*\t*0\s*\t*root'

  # 4.1.3 Ensure permissions on /etc/cron.hourly are configured. (Automated)
  - id: 19102
    title: "確保配置了 /etc/cron.hourly 的權限。"
    description: "此目錄包含需要每小時運行的系統 cron 作業。該目錄中的檔案無法透過 crontab 指令操作，而是由系統管理員使用文字編輯器進行編輯。以下指令限制對使用者和群組 root 的讀取/寫入和搜尋存取，防止普通使用者存取此目錄。注意：還有其他方法（例如 systemd 計時器）可用於排程作業。如果使用其他方法，則應刪除 cron，並根據本機網站原則確保備用方法的安全。"
    rationale: "向非特權使用者授予對此目錄的寫入存取權限可以為他們提供獲得未經授權的提升權限的方法。授予對此目錄的讀取存取權限可以讓非特權使用者了解如何獲得提升的權限或規避審核控制。"
    remediation: "執行以下指令以設置/etc/cron.hourly目錄的所有權和權限：# chown root:root /etc/cron.hourly/ # chmod og-rwx /etc/cron.hourly/."
    compliance:
      - cis: ["4.1.3"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1018"]
      - mitre_tactics: ["TA0002", "TA0007"]
      - mitre_techniques: ["T1053", "T1053.003"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:stat -Lc "%a %A %u %U  %g %G" /etc/cron.hourly/ -> r:700\s*\t*drwx------\s*\t*0\s*\t*root\s*\t*0\s*\t*root'

  # 4.1.4 Ensure permissions on /etc/cron.daily are configured. (Automated)
  - id: 19103
    title: "確保配置了 /etc/cron.daily 的權限。"
    description: "/etc/cron.daily 目錄包含需要每天執行的系統 cron 作業。該目錄中的檔案無法透過 crontab 指令操作，而是由系統管理員使用文字編輯器進行編輯。以下指令限制對使用者和群組 root 的讀取/寫入和搜尋存取，防止普通使用者存取此目錄。注意：還有其他方法（例如 systemd 計時器）可用於排程作業。如果使用其他方法，則應刪除 cron，並根據本機網站原則確保備用方法的安全。"
    rationale: "向非特權使用者授予對此目錄的寫入存取權限可以為他們提供獲得未經授權的提升權限的方法。授予對此目錄的讀取存取權限可以讓非特權使用者了解如何獲得提升的權限或規避審核控制。"
    remediation: "請執行以下指令以設定 /etc/cron.daily 目錄的擁有權和權限： # chown root:root /etc/cron.daily/ # chmod og-rwx /etc/cron.daily/."
    compliance:
      - cis: ["4.1.4"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1018"]
      - mitre_tactics: ["TA0002", "TA0007"]
      - mitre_techniques: ["T1053", "T1053.003"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:stat -Lc "%a %A %u %U  %g %G" /etc/cron.daily/ -> r:700\s*\t*drwx------\s*\t*0\s*\t*root\s*\t*0\s*\t*root'

  # 4.1.5 Ensure permissions on /etc/cron.weekly are configured. (Automated)
  - id: 19104
    title: "確保配置了 /etc/cron.weekly 的權限。"
    description: "/etc/cron.weekly 目錄包含需要每週執行的系統 cron 作業。該目錄中的檔案無法透過 crontab 指令操作，而是由系統管理員使用文字編輯器進行編輯。以下指令限制對使用者和群組 root 的讀取/寫入和搜尋存取，防止普通使用者存取此目錄。注意：還有其他方法（例如 systemd 計時器）可用於排程作業。如果使用其他方法，則應刪除 cron，並根據本機網站原則確保備用方法的安全。"
    rationale: "向非特權使用者授予對此目錄的寫入存取權限可以為他們提供獲得未經授權的提升權限的方法。授予對此目錄的讀取存取權限可以讓非特權使用者了解如何獲得提升的權限或規避審核控制。"
    remediation: "執行以下指令來設置 /etc/cron.weekly 目錄的擁有權和權限: # chown root:root /etc/cron.weekly/ # chmod og-rwx /etc/cron.weekly/."
    compliance:
      - cis: ["4.1.5"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1018"]
      - mitre_tactics: ["TA0002", "TA0007"]
      - mitre_techniques: ["T1053", "T1053.003"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:stat -Lc "%a %A %u %U  %g %G" /etc/cron.weekly/ -> r:700\s*\t*drwx------\s*\t*0\s*\t*root\s*\t*0\s*\t*root'

  # 4.1.6 Ensure permissions on /etc/cron.monthly are configured. (Automated)
  - id: 19105
    title: "確保配置了 /etc/cron.monthly 的權限。"
    description: "/etc/cron.monthly 目錄包含需要每月執行的系統 cron 作業。該目錄中的檔案無法透過 crontab 指令操作，而是由系統管理員使用文字編輯器進行編輯。以下指令限制對使用者和群組 root 的讀取/寫入和搜尋存取，防止普通使用者存取此目錄。注意：還有其他方法（例如 systemd 計時器）可用於排程作業。如果使用其他方法，則應刪除 cron，並根據本機網站原則確保備用方法的安全。"
    rationale: "向非特權使用者授予對此目錄的寫入存取權限可以為他們提供獲得未經授權的提升權限的方法。授予對此目錄的讀取存取權限可以讓非特權使用者了解如何獲得提升的權限或規避審核控制。"
    remediation: "執行以下指令設定 /etc/cron.monthly 目錄的所有權和權限: # chown root:root /etc/cron.monthly/ # chmod og-rwx /etc/cron.monthly/."
    compliance:
      - cis: ["4.1.6"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1018"]
      - mitre_tactics: ["TA0002", "TA0007"]
      - mitre_techniques: ["T1053", "T1053.003"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:stat -Lc "%a %A %u %U  %g %G" /etc/cron.monthly/ -> r:700\s*\t*drwx------\s*\t*0\s*\t*root\s*\t*0\s*\t*root'

  # 4.1.7 Ensure permissions on /etc/cron.d are configured. (Automated)
  - id: 19106
    title: "確保配置了 /etc/cron.d 的權限。"
    description: "/etc/cron.d 目錄包含系統 cron 作業，這些作業需要以與 /etc/crontab 中每小時、每天、每周和每月作業類似的方式運行，但需要更精細地控制它們的運行時間。該目錄中的檔案無法透過 crontab 指令操作，而是由系統管理員使用文字編輯器進行編輯。以下指令限制對使用者和群組 root 的讀取/寫入和搜尋存取，防止普通使用者存取此目錄。注意：還有其他方法（例如 systemd 計時器）可用於排程作業。如果使用其他方法，則應刪除 cron，並根據本機網站原則確保備用方法的安全。"
    rationale: "向非特權使用者授予對此目錄的寫入存取權限可以為他們提供獲得未經授權的提升權限的方法。授予對此目錄的讀取存取權限可以讓非特權使用者了解如何獲得提升的權限或規避審核控制。"
    remediation: "執行以下指令來設定 /etc/cron.d 目錄的所有權和權限： # chown root:root /etc/cron.d/ # chmod og-rwx /etc/cron.d/."
    compliance:
      - cis: ["4.1.7"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1018"]
      - mitre_tactics: ["TA0002", "TA0007"]
      - mitre_techniques: ["T1053", "T1053.003"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:stat -Lc "%a %A %u %U  %g %G" /etc/cron.d/ -> r:700\s*\t*drwx------\s*\t*0\s*\t*root\s*\t*0\s*\t*root'

  # 4.1.8 Ensure cron is restricted to authorized users. (Automated)
  - id: 19107
    title: "確保 cron 僅限於授權使用者。"
    description: "配置/etc/cron.allow以允許特定使用者使用此服務。如果 /etc/cron.allow 不存在，則檢查 /etc/cron.deny。任何未在此檔案中明確定義的使用者都可以使用 cron。透過刪除該檔案，只允許 /etc/cron.allow 中的使用者使用 cron。注意： - 其他方法（例如 systemd 計時器）也可用於排程作業。如果使用其他方法，則應刪除 cron，並應根據本機網站原則保護備用方法 - 即使 cron.allow 中未列出給定用戶，仍可以該使用者身分執行 cron 作業 - cron .allow 檔案僅控制對用於規劃和修改cron 作業的crontab 指令的管理存取。"
    rationale: "在許多系統上，只有系統管理員有權安排 cron 作業。使用 cron.allow 檔案來控制誰可以執行 cron 作業來強制執行此原則。管理允許清單比管理拒絕清單更容易。在拒絕清單中，您可能會在系統中新增使用者 ID，但忘記將其新增至拒絕檔案。"
    remediation: "執行以下腳本來： - 如果 /etc/cron.deny 存在則移除 - 如果 /etc/cron.allow 不存在則創建 - 將 /etc/cron.allow 的所有權更改為 root 用戶 - 將 /etc/cron.allow 的組所有權更改為 crontab 群組 #!/usr/bin/env bash { if dpkg-query -W cron > /dev/null 2>&1; then l_file=\"/etc/cron.allow\" l_mask='0137' l_maxperm=\"$( printf '%o' $(( 0777 & ~$l_mask)) )\" if [ -e /etc/cron.deny ]; then echo -e \" - Removing \\\"/etc/cron.deny\\\"\" rm -f /etc/cron.deny fi if [ ! -e /etc/cron.allow ]; then echo -e \" - creating \\\"$l_file\\\"\" touch \"$l_file\" fi while read l_mode l_fown l_fgroup; do if [ $(( $l_mode & $l_mask )) -gt 0 ]; then echo -e \" - Removing excessive permissions from \\\"$l_file\\\"\" chmod u-x,g-wx,o-rwx \"$l_file\" fi if [ \"$l_fown\" != \"root\" ]; then echo -e \" - Changing owner on \\\"$l_file\\\" from: \\\"$l_fown\\\" to: \\\"root\\\"\" chown root \"$l_file\" fi if [ \"$l_fgroup\" != \"crontab\" ]; then echo -e \" - Changing group owner on \\\"$l_file\\\" from: \\\"$l_fgroup\\\" to: \\\"crontab\\\"\" chgrp crontab \"$l_file\" fi done < <(stat -Lc '%#a %U %G' \"$l_file\") else echo -e \"- cron is not installed on the system, no remediation required\\n\" fi }."
    compliance:
      - cis: ["4.1.8"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1018"]
      - mitre_tactics: ["TA0002"]
      - mitre_techniques: ["T1053", "T1053.003"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - "f:/etc/cron.allow"
      - "not f:/etc/cron.deny"
      - 'c:stat -Lc "%a %A %u %U  %g %G" /etc/cron.allow -> r:640\s*\t*-rw-r-----\s*\t*0\s*\t*root\s*\t*0\s*\t*crontab'

  # 4.1.9 Ensure at is restricted to authorized users. (Automated)
  - id: 19108
    title: "確保 at 僅限於授權使用者。"
    description: "配置/etc/at.allow以允許特定使用者使用此服務。如果 /etc/at.allow 不存在，則檢查 /etc/at.deny。任何未在此檔案中明確定義的使用者都可以使用 at。透過刪除該檔案，僅允許 /etc/at.allow 中的使用者使用 at。注意：還有其他方法（例如 systemd 計時器）可用於排程作業。如果使用其他方法，則應刪除 at，並應根據本機網站原則保護備用方法。"
    rationale: "在許多系統上，只有系統管理員有權安排作業。使用 at.allow 檔案來控制誰可以執行作業來強制執行此原則。管理允許清單比管理拒絕清單更容易。在拒絕清單中，您可能會在系統中新增使用者 ID，但忘記將其新增至拒絕檔案。"
    remediation: "運行以下腳本以： - 如果存在則刪除 /etc/at.deny - 如果不存在則創建 /etc/at.allow - 更改 /etc/at.allow 的所有者為 root 用戶 - 更改 /etc/at.allow 的組別所有者為 root 組 #!/usr/bin/env bash { if dpkg-query -W at > /dev/null 2>&1; then l_file=\"/etc/at.allow\" l_mask='0137' l_maxperm=\"$( printf '%o' $(( 0777 & ~$l_mask)) )\" if [ -e /etc/at.deny ]; then echo -e \" - Removing \\\"/etc/at.deny\\\"\" rm -f /etc/at.deny fi if [ ! -e /etc/at.allow ]; then echo -e \" - creating \\\"$l_file\\\"\" touch \"$l_file\" fi while read l_mode l_fown l_fgroup; do if [ $(( $l_mode & $l_mask )) -gt 0 ]; then echo -e \" - Removing excessive permissions from \\\"$l_file\\\"\" chmod u-x,g-wx,o-rwx \"$l_file\" fi if [ \"$l_fown\" != \"root\" ]; then echo -e \" - Changing owner on \\\"$l_file\\\" from: \\\"$l_fown\\\" to: \\\"root\\\"\" chown root \"$l_file\" fi if [ \"$l_fgroup\" != \"root\" ]; then echo -e \" - Changing group owner on \\\"$l_file\\\" from: \\\"$l_fgroup\\\" to: \\\"root\\\"\" chgrp root \"$l_file\" fi done < <(stat -Lc '%#a %U %G' \"$l_file\") else echo -e \"- cron is not installed on the system, no remediation required\\n\" fi }."
    compliance:
      - cis: ["4.1.9"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1018"]
      - mitre_tactics: ["TA0002"]
      - mitre_techniques: ["T1053", "T1053.003"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - "f:/etc/at.allow"
      - "not f:/etc/at.deny"
      - 'c:stat -Lc "%a %A %u %U  %g %G" /etc/at.allow -> r:640\s*\t*-rw-r-----\s*\t*0\s*\t*root\s*\t*0\s*\t*root'

  # 4.2.1 Ensure permissions on /etc/ssh/sshd_config are configured. (Automated)
  - id: 19109
    title: "確保配置了 /etc/ssh/sshd_config 的權限。"
    description: "檔案 /etc/ssh/sshd_config 以及 /etc/ssh/sshd_config.d 目錄中以 .conf 結尾的檔案包含 sshd 的設定規格。"
    rationale: "需要保護 sshd 的設定規範免於非特權使用者未經授權的變更。"
    remediation: "運行以下腳本以設置 /etc/ssh/sshd_config 以及 /etc/ssh/sshd_config.d 目錄中以 .conf 結尾的檔案的所有權和權限: #!/usr/bin/env bash { chmod u-x,og-rwx /etc/ssh/sshd_config chown root:root /etc/ssh/sshd_config while IFS= read -r -d $'\\0' l_file; do if [ -e \"$l_file\" ]; then chmod u-x,og-rwx \"$l_file\" chown root:root \"$l_file\" fi done < <(find /etc/ssh/sshd_config.d -type f -print0) }."
    compliance:
      - cis: ["4.2.1"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1098", "T1098.004", "T1543", "T1543.002"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:stat -Lc "%a %A %u %U  %g %G" /etc/ssh/sshd_config -> r:600\s*\t*-rw-------\s*\t*0\s*\t*root\s*\t*0\s*\t*root'
      - 'c:sh -c "stat -L /etc/ssh/sshd_config.d/*.conf" -> r:Access:\s*\(0600/-rw-------\)\s*Uid:\s*\(\s*\t*0/\s*\t*root\)\s*\t*Gid:\s*\(\s*\t*0/\s*\t*root\)'

  # 4.2.2 Ensure permissions on SSH private host key files are configured. (Automated) - Not Implemented

  # 4.2.3 Ensure permissions on SSH public host key files are configured. (Automated)
  - id: 19110
    title: "確保配置了 SSH 公共主機金鑰檔案的權限。"
    description: "SSH 公鑰是 SSH 公鑰驗證中使用的兩個檔案之一。在這個認證方法中，公鑰是可以用於驗證使用對應的私鑰產生的數位簽章的金鑰。只有與私鑰相對應的公鑰才能成功進行身份驗證。"
    rationale: "如果公用主機金鑰檔案已被未經授權的使用者修改，則 SSH 服務可能會受到損害。"
    remediation: "運行以下腳本以設定公用 SSH 主機密鑰檔案的模式、擁有者和群組: #!/usr/bin/env bash { l_pmask=\"0133\" l_maxperm=\"$( printf '%o' $(( 0777 & ~$l_pmask )) )\" awk '{print}' <<< \"$(find -L /etc/ssh -xdev -type f -exec stat -Lc \"%n %#a %U %G\" {} +)\" | (while read -r l_file l_mode l_owner l_group; do if file \"$l_file\" | grep -Pq ':\\h+OpenSSH\\h+(\\H+\\h+)?public\\h+key\\b'; then echo -e \" - Checking private key file: \\\"$l_file\\\"\" if [ $(( $l_mode & $l_pmask )) -gt 0 ]; then echo -e \" - File: \\\"$l_file\\\" is mode \\\"$l_mode\\\" changing to mode: \\\"$l_maxperm\\\"\" chmod u-x,go-wx \"$l_file\" fi if [ \"$l_owner\" != \"root\" ]; then echo -e \" - File: \\\"$l_file\\\" is owned by: \\\"$l_owner\\\" changing owner to \\\"root\\\"\" chown root \"$l_file\" fi if [ \"$l_group\" != \"root\" ]; then echo -e \" - File: \\\"$l_file\\\" is owned by group \\\"$l_group\\\" changing to group \\\"root\\\"\" chgrp \"root\" \"$l_file\" fi fi done ) }."
    compliance:
      - cis: ["4.2.3"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["5.1"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.14.2.5", "A.8.1.3"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0003", "TA0006"]
      - mitre_techniques: ["T1557"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:sh -c "find /etc/ssh -xdev -type f -name ''ssh_host_*_key.pub'' -exec stat {} \;" -> r:Access:\s*\( && !r:-rw-r--r--'

  # 4.2.4 Ensure SSH access is limited. (Automated)
  - id: 19111
    title: "確保 SSH 存取受到限制。"
    description: "有多個選項可用於限制哪些使用者和群組可以透過 SSH 存取系統。建議至少利用以下選項之一： -AllowUsers： oAllowUsers 變數為系統管理員提供允許特定使用者透過 ssh 進入系統的選項。此清單由空格分隔的使用者名稱組成。此變數無法辨識數字使用者 ID。如果系統管理員希望透過僅允許允許的使用者從特定主機登入來進一步限制使用者存取，則可以以 user@host 的形式指定該條目。 -AllowGroups： oAllowGroups 變數為系統管理員提供了允許特定使用者群組透過 ssh 進入系統的選項。此清單由空格分隔的群組名稱組成。此變數無法辨識數字組 ID。 - DenyUsers： o DenyUsers 變數為系統管理員提供拒絕特定使用者 ssh 進入系統的選項。此清單由空格分隔的使用者名稱組成。此變數無法辨識數字使用者 ID。如果系統管理員想要透過明確拒絕使用者從特定主機的存取來進一步限制使用者存取，則可以以 user@host 的形式指定該條目。 - DenyGroups： o DenyGroups 變數為系統管理員提供了拒絕特定使用者群組透過 ssh 進入系統的選項。此清單由空格分隔的群組名稱組成。此變數無法辨識數字組 ID。"
    rationale: "限制哪些使用者可以透過 SSH 遠端存取系統將有助於確保只有授權使用者才能存取系統。"
    remediation: "編輯 /etc/ssh/sshd_config 檔案，在任何 Include 條目之前設置以下一個或多個參數，如下所示: AllowUsers <userlist> OR AllowGroups <grouplist> OR DenyUsers <userlist> OR DenyGroups <grouplist> 注意: 選項的首次出現具有優先權，Match 集合語句除外。如果啟用了 Include 位置，使用了且瞭解了在您的環境中的優先順序，則可以在 Include 位置中的檔案中創建條目。如果 Include 位置不是預設的 /etc/ssh/sshd_config.d/*.conf，則需要修改審核以考慮使用的 Include 位置。"
    compliance:
      - cis: ["4.2.4"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["4.3"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.2.3"]
      - mitre_mitigations: ["M1018"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1021", "T1021.004"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:sshd -T -> r:^\s*AllowUsers\s+\w+|^\s*AllowGroups\s+\w+|^\s*DenyUsers\s+\w+|^\s*DenyGroups\s+\w+'
      - 'f:/etc/ssh/sshd_config -> r:^\s*AllowUsers\s+\w+|^\s*AllowGroups\s+\w+|^\s*DenyUsers\s+\w+|^\s*DenyGroups\s+\w+'
      - 'not d:/etc/ssh/sshd_config.d -> r:\.*.conf$ -> r:^\s*AllowUsers\s+\w+|^\s*AllowGroups\s+\w+|^\s*DenyUsers\s+\w+|^\s*DenyGroups\s+\w+'

  # 4.2.5 Ensure SSH LogLevel is appropriate. (Automated)
  - id: 19112
    title: "確保 SSH LogLevel 合適。"
    description: "INFO級別是基本級別，僅記錄SSH用戶的登入活動。在許多情況下，例如事件回應，確定特定使用者何時在系統上處於活動狀態非常重要。註銷記錄可以消除那些斷開連接的用戶，這有助於縮小範圍。 VERBOSE 等級指定將記錄登入和登出活動以及用於登入的任何 SSH 金鑰的金鑰指紋。此資訊對於 SSH 金鑰管理非常重要，尤其是在遺留環境中。"
    rationale: "SSH 提供了多個具有不同詳細程度的日誌記錄等級。除了嚴格除錯 SSH 通訊之外，特別不建議使用 DEBUG，因為它提供的資料太多，很難識別重要的安全資訊。"
    remediation: "編輯 /etc/ssh/sshd_config 檔案，以在任何 Include 條目上方設定參數如下: LogLevel VERBOSE 或 LogLevel INFO 注意: 選項的首次出現優先，匹配設置敘述仍然有效。如果在您的環境中啟用了 Include 位置並被使用且理解其優先順序，則可以在 Include 位置的檔案中創建條目。"
    references:
      - "https://www.ssh.com/ssh/sshd_config/"
    compliance:
      - cis: ["4.2.5"]
      - cis_csc_v8: ["8.2"]
      - cis_csc_v7: ["6.2", "6.3"]
      - cmmc_v2.0: ["AU.L2-3.3.1"]
      - hipaa: ["164.312(b)"]
      - iso_27001-2013: ["A.12.4.1"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1562", "T1562.006"]
      - nist_sp_800-53: ["AU-7"]
      - pci_dss_v3.2.1: ["10.2", "10.3"]
      - pci_dss_v4.0: ["10.2.1", "10.2.1.1", "10.2.1.2", "10.2.1.3", "10.2.1.4", "10.2.1.5", "10.2.1.6", "10.2.1.7", "10.2.2", "5.3.4", "6.4.1", "6.4.2"]
    condition: all
    rules:
      - 'c:sshd -T -> r:^\s*LogLevel\s+INFO|^\s*LogLevel\s+VERBOSE'
      - 'not f:/etc/ssh/sshd_config -> !r:^\s*LogLevel\s+INFO|^\s*LogLevel\s+VERBOSE'
      - 'not d:/etc/ssh/sshd_config.d/ -> r:\.*.conf$ -> !r:^\s*LogLevel\s+INFO|^\s*LogLevel\s+VERBOSE'

  # 4.2.6 Ensure SSH PAM is enabled. (Automated)
  - id: 19113
    title: "確保 SSH PAM 已啟用。"
    description: "UsePAM 指令啟用可插入身份驗證模組 (PAM) 介面。如果設定為 yes，除了所有驗證類型的 PAM 帳戶和會話模組處理之外，還將使用 ChallengeResponseAuthentication 和 PasswordAuthentication 指令啟用 PAM 驗證。"
    rationale: "當 usePAM 設定為 yes 時，PAM 會正確執行帳戶和會話類型。如果您想根據帳戶的 IP、時間或其他因素限制對服務的存取，這一點很重要。此外，您可以確保使用者在登入時繼承某些環境變數或禁止存取伺服器。"
    remediation: "編輯 /etc/ssh/sshd_config 檔案，在任何 Include 項目之前設置參數如下：UsePAM yes 備註：選項的首次出現具有優先權。如果啟用了 Include 位置並在您的環境中使用且理解了優先順序，則可以在 Include 位置的檔案中創建該條目。"
    compliance:
      - cis: ["4.2.6"]
      - cis_csc_v8: ["5.2"]
      - cis_csc_v7: ["4.4"]
      - cmmc_v2.0: ["IA.L2-3.5.7"]
      - iso_27001-2013: ["A.9.4.3"]
      - mitre_mitigations: ["M1035"]
      - mitre_tactics: ["TA0001"]
      - mitre_techniques: ["T1021", "T1021.004"]
      - pci_dss_v4.0: ["2.2.2", "8.3.5", "8.3.6", "8.6.3"]
      - soc_2: ["CC6.1"]
    condition: all
    rules:
      - 'c:sshd -T -> r:^\s*usepam\s+yes'
      - 'not f:/etc/ssh/sshd_config -> r:^\s*usepam\s+no'
      - 'not d:/etc/ssh/sshd_config.d -> r:\.*.conf$ -> r:^\s*usepam\s+no'

  # 4.2.7 Ensure SSH root login is disabled. (Automated)
  - id: 19114
    title: "確保 SSH root 登入已停用。"
    description: "PermitRootLogin 參數指定 root 使用者是否可以使用 SSH 登入。預設為禁止密碼。"
    rationale: "禁止透過 SSH 進行 root 登入需要系統管理員使用自己的個人帳號進行驗證，然後升級到 root。這限制了不可否認的機會，並在發生安全事件時提供清晰的審計追蹤。"
    remediation: "編輯 /etc/ssh/sshd_config 檔案，以在任何 Include 項目之上設置如下參數：PermitRootLogin no 注意：選項的首次出現優先，匹配設置聲明不論。如果 Include 位置已啟用、已使用，且在您的環境中順序的優先次序已理解，可在 Include 位置中的檔案中創建此條目。"
    compliance:
      - cis: ["4.2.7"]
      - cis_csc_v8: ["5.4"]
      - cis_csc_v7: ["4.3"]
      - cmmc_v2.0: ["AC.L2-3.1.5", "AC.L2-3.1.6", "AC.L2-3.1.7", "SC.L2-3.13.3"]
      - iso_27001-2013: ["A.9.2.3"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1021"]
      - nist_sp_800-53: ["AC-6(2)", "AC-6(5)"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - soc_2: ["CC6.1", "CC6.3"]
    condition: all
    rules:
      - 'c:sshd -T -> r:^\s*PermitRootLogin\s+no'
      - 'not f:/etc/ssh/sshd_config -> r:^\s*PermitRootLogin\s+yes'
      - 'not d:/etc/ssh/sshd_config.d -> r:\.*.conf$ -> r:^\s*PermitRootLogin\s+yes'

  # 4.2.8 Ensure SSH HostbasedAuthentication is disabled. (Automated)
  - id: 19115
    title: "確保停用 SSH HostbasedAuthentication。"
    description: "HostbasedAuthentication 參數指定是否允許透過 .rhosts 或 /etc/hosts.equiv 使用者透過可信任主機進行驗證，以及成功的公鑰用戶端主機驗證。"
    rationale: "儘管如果在 /etc/pam.conf 中停用支持，.rhosts 檔案將無效，但停用在 SSH 中使用 .rhosts 檔案的功能可提供額外的保護層。"
    remediation: "編輯 /etc/ssh/sshd_config 檔案，以在任何 Include 條目之前設置參數如下： HostbasedAuthentication no 注意：首選項優先，如果有 Match 集合語句則另當別論。如果在您的環境中啟用了 Include 位置，使用並理解優先順序，則可以在 Include 位置的檔案中創建條目。"
    compliance:
      - cis: ["4.2.8"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0001"]
      - mitre_techniques: ["T1078", "T1078.001", "T1078.003"]
    condition: all
    rules:
      - 'c:sshd -T -> r:^\s*HostbasedAuthentication\s+no'
      - 'not f:/etc/ssh/sshd_config -> r:^\s*HostbasedAuthentication\s+yes'
      - 'not d:/etc/ssh/sshd_config.d -> r:\.*.conf$ -> r:^\s*HostbasedAuthentication\s+yes'

  # 4.2.9 Ensure SSH PermitEmptyPasswords is disabled. (Automated)
  - id: 19116
    title: "確保 SSH PermitEmptyPasswords 已停用。"
    description: "PermitEmptyPasswords 參數指定 SSH 伺服器是否允許使用空密碼字串登入帳戶。"
    rationale: "禁止遠端 shell 存取具有空密碼的帳戶可降低未經授權存取系統的可能性。"
    remediation: "編輯 /etc/ssh/sshd_config 檔案，將參數設置在任何 Include 條目之前，如下所示: PermitEmptyPasswords no 注意: 最先出現的選項優先，Match 設置語句不例外。如果啟用 Include 位置、使用並理解優先順序，可以在 Include 位置中的檔案中創建條目。"
    compliance:
      - cis: ["4.2.9"]
      - cis_csc_v8: ["5.2"]
      - cis_csc_v7: ["4.4"]
      - cmmc_v2.0: ["IA.L2-3.5.7"]
      - iso_27001-2013: ["A.9.4.3"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1021"]
      - pci_dss_v4.0: ["2.2.2", "8.3.5", "8.3.6", "8.6.3"]
      - soc_2: ["CC6.1"]
    condition: all
    rules:
      - 'c:sshd -T -> r:^\s*PermitEmptyPasswords\s+no'
      - 'not f:/etc/ssh/sshd_config -> r:^\s*PermitEmptyPasswords\s+yes'
      - 'not d:/etc/ssh/sshd_config.d -> r:\.*.conf$ -> r:^\s*PermitEmptyPasswords\s+yes'

  # 4.2.10 Ensure SSH PermitUserEnvironment is disabled. (Automated)
  - id: 19117
    title: "確保 SSH PermitUserEnvironment 已停用。"
    description: "PermitUserEnvironment 選項可讓使用者向 SSH 守護程式提供環境選項。"
    rationale: "允許使用者透過 SSH 守護程式設定環境變數的能力可能會允許使用者繞過安全控制（例如，設定讓 SSH 執行木馬程式的執行路徑）。"
    remediation: "編輯 /etc/ssh/sshd_config 檔案以設定參數在所有 Include 條目之上如下：PermitUserEnvironment no 注意：第一個出現的選項將優先考慮。如果啟用了 Include 位置並使用，且在您的環境中了解優先順序，則可以在 Include 位置的檔案中創建該條目。"
    compliance:
      - cis: ["4.2.10"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1021"]
    condition: all
    rules:
      - 'c:sshd -T -> r:^\s*PermitUserEnvironment\s+no'
      - 'not f:/etc/ssh/sshd_config -> r:^\s*PermitUserEnvironment\s+yes'
      - 'not d:/etc/ssh/sshd_config.d -> r:\.*.conf$ -> r:^\s*PermitUserEnvironment\s+yes'

  # 4.2.11 Ensure SSH IgnoreRhosts is enabled. (Automated)
  - id: 19118
    title: "確保 SSH IgnoreRhosts 已啟用。"
    description: "IgnoreRhosts 參數指定 .rhosts 和 .shosts 檔案不會在 RhostsRSAAuthentication 或 HostbasedAuthentication 中使用。"
    rationale: "設定此參數會強制使用者在使用 SSH 進行身份驗證時輸入密碼。"
    remediation: "編輯 /etc/ssh/sshd_config 檔案，將參數設置在任何 Include 項目之上，如下所示：IgnoreRhosts yes 注意：選項的首次出現具有優先權，Match 設置語句具有相對獨立性。如果啟用了 Include 位置，使用並理解了在您的環境中的優先順序，則可以在 Include 位置的檔案中創建條目。"
    compliance:
      - cis: ["4.2.11"]
      - cis_csc_v8: ["5.2"]
      - cis_csc_v7: ["4.4"]
      - cmmc_v2.0: ["IA.L2-3.5.7"]
      - iso_27001-2013: ["A.9.4.3"]
      - mitre_mitigations: ["M1027"]
      - mitre_tactics: ["TA0001"]
      - mitre_techniques: ["T1078", "T1078.001", "T1078.003"]
      - pci_dss_v4.0: ["2.2.2", "8.3.5", "8.3.6", "8.6.3"]
      - soc_2: ["CC6.1"]
    condition: all
    rules:
      - 'c:sshd -T -> r:^\s*IgnoreRhosts\s+yes'
      - 'not f:/etc/ssh/sshd_config -> r:^\s*IgnoreRhosts\s+no'
      - 'not d:/etc/ssh/sshd_config.d -> r:\.*.conf$ -> r:^\s*IgnoreRhosts\s+no'

  # 4.2.12 Ensure SSH X11 forwarding is disabled. (Automated)
  - id: 19119
    title: "確保 SSH X11 轉送已停用。"
    description: "X11Forwarding 參數提供透過連接隧道傳輸 X11 流量以啟用遠端圖形連接的能力。"
    rationale: "除非有直接使用 X11 應用程式的操作要求，否則停用 X11 轉送。透過 SSH 使用 X11 轉送登入的使用者的遠端 X11 伺服器可能會受到 X11 伺服器上其他使用者的危害，這是一個小風險。請注意，即使 X11 轉發已停用，使用者也始終可以安裝自己的轉發器。"
    remediation: "編輯 /etc/ssh/sshd_config 檔案以在任何 Include 條目上方設置參數如下: X11Forwarding no 注意: 第一個出現的選項具有優先權, 匹配集語句例外. 如果使用並了解了在你的環境中的 Include 位置順序, 條目可以在 Include 位置中的檔案中創建."
    compliance:
      - cis: ["4.2.12"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - iso_27001-2013: ["A.13.1.3"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1210"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: all
    rules:
      - 'c:sshd -T -> r:^\s*X11Forwarding\s+no'
      - 'not f:/etc/ssh/sshd_config -> r:^\s*X11Forwarding\s+yes'
      - 'not d:/etc/ssh/sshd_config.d -> r:\.*.conf$ -> r:^\s*X11Forwarding\s+yes'

  # 4.2.13 Ensure only strong Ciphers are used. (Automated)
  - id: 19120
    title: "確保僅使用強密碼。"
    description: '此變數限制 SSH 在通訊期間可以使用的密碼。注意： - 有些組織可能對核准的密碼有更嚴格的要求。 - 確保使用的密碼符合網站政策。 - 目前符合 FIPS 140-2 的唯一「強」密碼是： o aes256-ctr o aes192-ctr o aes128-ctr。'
    rationale: '不能依賴用於對加密模組進行身份驗證的弱密碼來提供機密性或完整性，且系統資料可能會受到損害。 - SSH 中使用的 Triple DES 密碼的生日限制約為 40 億個區塊，這使得遠端攻擊者更容易透過針對長時間加密會話（又稱「Sweet32」）的生日攻擊來獲取明文資料攻擊。 - SSH協定中的錯誤處理；當用戶端和伺服器在密碼區塊連結 (CBC) 模式下使用區塊密碼演算法時，遠端攻擊者可以更輕鬆地透過未知向量從 SSH 會話中的任意密文區塊中恢復某些純文字資料。'
    remediation: "編輯 /etc/ssh/sshd_config 檔案，新增/修改 Ciphers 行，內容需包含一個用逗號分隔的站點核准加密算法列表，並放置在任何 Include 條目之前： 示例：Ciphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr 注意：選項的首次出現具有優先權。如果啟用、使用了 Include 位置且在您的環境中理解了優先權順序，該條目可以在 Include 位置的檔案中創建。"
    references:
      - "https://nvd.nist.gov/vuln/detail/CVE-2016-2183"
      - "https://www.openssh.com/txt/cbc.adv"
      - "https://nvd.nist.gov/vuln/detail/CVE-2008-5161"
    compliance:
      - cis: ["4.2.13"]
      - cis_csc_v8: ["3.10"]
      - cis_csc_v7: ["14.4"]
      - cmmc_v2.0: ["AC.L2-3.1.13", "AC.L2-3.1.17", "IA.L2-3.5.10", "SC.L2-3.13.11", "SC.L2-3.13.15", "SC.L2-3.13.8"]
      - hipaa: ["164.312(a)(2)(iv)", "164.312(e)(1)", "164.312(e)(2)(i)", "164.312(e)(2)(ii)"]
      - iso_27001-2013: ["A.10.1.1", "A.13.1.1"]
      - mitre_mitigations: ["M1041"]
      - mitre_tactics: ["TA0006"]
      - mitre_techniques: ["T1040", "T1557"]
      - nist_sp_800-53: ["AC-17(2)", "SC-8", "SC-8(1)"]
      - pci_dss_v3.2.1: ["2.1.1", "4.1", "4.1.1", "8.2.1"]
      - pci_dss_v4.0: ["2.2.7", "4.1.1", "4.2.1", "4.2.1.2", "4.2.2", "8.3.2"]
    condition: all
    rules:
      - "not c:sshd -T -> r:ciphers && r:3des-cbc|aes128-cbc|aes192-cbc|aes256-cbc|rijndael-cbc@lysator.liu.se"

  # 4.2.14 Ensure only strong MAC algorithms are used. (Automated)
  - id: 19121
    title: "確保僅使用強 MAC 演算法。"
    description: '此變數限制 SSH 在通訊過程中可以使用的 MAC 演算法的類型。注意： - 一些組織可能對核准的 MAC 有更嚴格的要求。 - 確保所使用的 MAC 符合站點政策。 - 目前 FIPS 140-2 批准的唯一「強」MAC 是： o hmac-sha2-256 o hmac-sha2-512。'
    rationale: "MD5 和 96 位元 MAC 演算法被認為較弱，但已被證明可以提高 SSH 降級攻擊的可用性。弱演算法作為可以透過擴充計算能力來利用的弱點而繼續受到廣泛關注。破壞演算法的攻擊者可以利用 MiTM 位置來解密 SSH 隧道並捕獲憑證和資訊。"
    remediation: "編輯 /etc/ssh/sshd_config 檔案並新增/修改 MACs 行以包含站點核准的 MACs 列表，並置於任何 Include 條目之前：範例：MACs hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com,hmac-sha2-512,hmac-sha2-256,umac-128-etm@openssh.com,umac-128@openssh.com 注意：選項的首次出現具有優先權。如果已啟用、使用並理解 Include 位置的優先次序，則可以在 Include 位置的檔案中創建此條目。"
    references:
      - "http://www.mitls.org/pages/attacks/SLOTH"
    compliance:
      - cis: ["4.2.14"]
      - cis_csc_v8: ["3.10"]
      - cis_csc_v7: ["14.4", "16.5"]
      - cmmc_v2.0: ["AC.L2-3.1.13", "AC.L2-3.1.17", "IA.L2-3.5.10", "SC.L2-3.13.11", "SC.L2-3.13.15", "SC.L2-3.13.8"]
      - hipaa: ["164.312(a)(2)(iv)", "164.312(e)(1)", "164.312(e)(2)(i)", "164.312(e)(2)(ii)"]
      - iso_27001-2013: ["A.10.1.1", "A.13.1.1"]
      - mitre_mitigations: ["M1041"]
      - mitre_tactics: ["TA0006"]
      - mitre_techniques: ["T1040", "T1557"]
      - nist_sp_800-53: ["AC-17(2)", "SC-8", "SC-8(1)"]
      - pci_dss_v3.2.1: ["2.1.1", "4.1", "4.1.1", "8.2.1"]
      - pci_dss_v4.0: ["2.2.7", "4.1.1", "4.2.1", "4.2.1.2", "4.2.2", "8.3.2"]
    condition: all
    rules:
      - "not c:sshd -T -> r:MACs && r:hmac-md5|hmac-md5-96|hmac-ripemd160|hmac-sha1|hmac-sha1-96|umac-64@openssh.com|hmac-md5-etm@openssh.com|hmac-md5-96-etm@openssh.com|hmac-ripemd160-etm@openssh.com|hmac-sha1-etm@openssh.com|hmac-sha1-96-etm@openssh.com|umac-64-etm@openssh.com"

  # 4.2.15 Ensure only strong Key Exchange algorithms are used. (Automated)
  - id: 19122
    title: "確保僅使用強密鑰交換演算法。"
    description: "密鑰交換是密碼學中的任何方法，透過該方法在兩方之間交換密碼密鑰，從而允許使用密碼演算法。如果發送方和接收方希望交換加密訊息，則雙方都必須具備加密要傳送的訊息和解密接收到的訊息的能力。 2 核准的唯一密鑰交換演算法是： o ecdh-sha2-nistp256 o ecdh-sha2-nistp384 o ecdh-sha2-nistp521 o diffie -hellman-group-exchange-sha256 o diffie-hellman-group16-sha512 oiffie-hellman -group18-sha512 o diffie-hellman-group14-sha256。"
    rationale: "應刪除被認為較弱的密鑰交換方法。密鑰交換方法可能很弱，因為使用的位元太少，或者散列演算法被認為太弱。使用弱演算法可能會使連線遭受中間人攻擊。"
    remediation: "編輯 /etc/ssh/sshd_config 檔案，在所有的 Include 條目之前，添加或修改 KexAlgorithms 行以包含用逗號分隔的網站批准的密鑰交換算法清單：例如：KexAlgorithms curve25519-sha256,curve25519-sha256@libssh.org,diffie-hellman-group14-sha256,diffie-hellman-group16-sha512,diffie-hellman-group18-sha512,ecdh-sha2-nistp521,ecdh-sha2-nistp384,ecdh-sha2-nistp256,diffie-hellman-group-exchange-sha256 注意：選項的第一次出現具有優先權。如果您的環境中啟用了 Include 位置、已使用並了解優先順序，則可以在 Include 位置的檔案中創建該條目。"
    compliance:
      - cis: ["4.2.15"]
      - cis_csc_v8: ["3.10"]
      - cis_csc_v7: ["14.4"]
      - cmmc_v2.0: ["AC.L2-3.1.13", "AC.L2-3.1.17", "IA.L2-3.5.10", "SC.L2-3.13.11", "SC.L2-3.13.15", "SC.L2-3.13.8"]
      - hipaa: ["164.312(a)(2)(iv)", "164.312(e)(1)", "164.312(e)(2)(i)", "164.312(e)(2)(ii)"]
      - iso_27001-2013: ["A.10.1.1", "A.13.1.1"]
      - mitre_mitigations: ["M1041"]
      - mitre_tactics: ["TA0006"]
      - mitre_techniques: ["T1040", "T1557"]
      - nist_sp_800-53: ["AC-17(2)", "SC-8", "SC-8(1)"]
      - pci_dss_v3.2.1: ["2.1.1", "4.1", "4.1.1", "8.2.1"]
      - pci_dss_v4.0: ["2.2.7", "4.1.1", "4.2.1", "4.2.1.2", "4.2.2", "8.3.2"]
    condition: all
    rules:
      - "not c:sshd -T -> r:kexalgorithms && r:diffie-hellman-group1-sha1|diffie-hellman-group14-sha1|diffie-hellman-group-exchange-sha1"

  # 4.2.16 Ensure SSH AllowTcpForwarding is disabled. (Automated)
  - id: 19123
    title: "確保 SSH AllowTcpForwarding 已停用。"
    description: "SSH 連接埠轉送是 SSH 中的一種機制，用於將應用程式連接埠從用戶端傳送到伺服器，或將伺服器傳送到用戶端。它可用於向遺留應用程式添加加密、穿過防火牆，一些系統管理員和 IT 專業人員使用它從家用電腦打開進入內部網路的後門。"
    rationale: "啟用連接埠轉送可能會使組織面臨安全風險和後門。 SSH 連線受到強加密的保護。這使得它們的內容對於大多數部署的網路監控和流量過濾解決方案來說是不可見的。如果這種不可見性被用於惡意目的（例如資料外洩），則會帶來相當大的潛在風險。網路犯罪分子或惡意軟體可能會利用 SSH 隱藏其未經授權的通訊，或從目標網路中洩露被盜資料。"
    impact: "SSH tunnels are widely used in many corporate environments. In some environments the applications themselves may have very limited native support for security. By utilizing tunneling, compliance with SOX, HIPAA, PCI-DSS, and other standards can be achieved without having to modify the applications."
    remediation: "編輯 /etc/ssh/sshd_config 檔案以將參數設定在任何 Include 條目的上方如下: AllowTcpForwarding no 注意: 選項的首次出現優先，Match 設置語句例外。如果已啟用、使用以及理解 Include 位置及優先順序，則可以在 Include 位置的一個檔案中創建此條目。"
    references:
      - "https://www.ssh.com/ssh/tunneling/example"
    compliance:
      - cis: ["4.2.16"]
      - mitre_mitigations: ["M1042"]
      - mitre_tactics: ["TA0008"]
      - mitre_techniques: ["T1048", "T1048.002", "T1572"]
    condition: all
    rules:
      - 'c:sshd -T -> r:^\s*AllowTcpForwarding\s+no'
      - 'not f:/etc/ssh/sshd_config -> r:^\s*AllowTcpForwarding\s+yes'
      - 'not d:/etc/ssh/sshd_config.d -> r:\.*.conf$ -> r:^\s*AllowTcpForwarding\s+yes'

  # 4.2.17 Ensure SSH warning banner is configured. (Automated)
  - id: 19124
    title: "確保已配置 SSH 警告橫幅。"
    description: "Banner 參數指定一個檔案，在允許身份驗證之前，必須將其內容傳送給遠端使用者。預設情況下，不顯示橫幅。"
    rationale: "橫幅用於警告連接使用者特定網站的連線策略。在正常使用者登入之前呈現警告訊息可以幫助起訴電腦系統上的侵入者。"
    remediation: "編輯 /etc/ssh/sshd_config 檔案，將參數設置在任何 Include 條目之前，如下所示: Banner /etc/issue.net 注意: 第一個出現的選項具有優先權，Match 設定語句也是如此。如果在你的環境中啟用了 Include 位置、被使用及理解了優先順序，可以在 Include 位置的檔案中創建該條目。"
    compliance:
      - cis: ["4.2.17"]
      - mitre_mitigations: ["M1035"]
      - mitre_tactics: ["TA0001", "TA0007"]
    condition: all
    rules:
      - 'c:sshd -T -> r:^\s*banner\s*\t*/etc/issue.net'

  # 4.2.18 Ensure SSH MaxAuthTries is set to 4 or less. (Automated)
  - id: 19125
    title: "確保 SSH MaxAuthTries 設定為 4 或更少。"
    description: "MaxAuthTries 參數指定每個連線允許的最大驗證嘗試次數。當登入失敗計數達到一半時，錯誤訊息將寫入系統日誌檔案，詳細說明登入失敗。"
    rationale: "將 MaxAuthTries 參數設定為較低的數字可以最大限度地降低對 SSH 伺服器進行暴力攻擊的風險。雖然建議設定為 4，但請根據網站策略設定該數字。"
    remediation: "編輯 /etc/ssh/sshd_config 檔案以將參數設置在所有 Include 條目之上，如下所示: MaxAuthTries 4 注意: 首次出現的選項具有優先權，Match 設置語句除外。如果在您的環境中啟用了 Include 位置、使用了並理解了優先順序，可以在 Include 位置的檔案中創建條目。"
    compliance:
      - cis: ["4.2.18"]
      - cis_csc_v8: ["8.5"]
      - cis_csc_v7: ["16.13"]
      - cmmc_v2.0: ["AU.L2-3.3.1"]
      - mitre_mitigations: ["M1036"]
      - mitre_tactics: ["TA0006"]
      - mitre_techniques: ["T1110", "T1110.001", "T1110.003"]
      - nist_sp_800-53: ["AU-3(1)", "AU-7"]
      - pci_dss_v3.2.1: ["10.1", "10.2.2", "10.2.4", "10.2.5", "10.3"]
      - pci_dss_v4.0: ["10.2", "10.2.1", "10.2.1.2", "10.2.1.5", "9.4.5"]
      - soc_2: ["CC5.2", "CC7.2"]
    condition: all
    rules:
      - 'c:sshd -T -> n:^MaxAuthTries\s*\t*(\d+) compare <= 4'
      - 'not f:/etc/ssh/sshd_config -> n:^MaxAuthTries\s*\t*(\d+) compare > 4'
      - 'not d:/etc/ssh/sshd_config.d -> r:\.*.conf$ -> r:^MaxAuthTries\s*\t*([5-9]|[1-9][0-9]+)'

  # 4.2.19 Ensure SSH MaxStartups is configured. (Automated)
  - id: 19126
    title: "確保已配置 SSH MaxStartups。"
    description: "MaxStartups 參數指定 SSH 守護程式的平行未經驗證連線的最大數量。"
    rationale: "為了防止系統因大量待處理的身份驗證連線嘗試而導致拒絕服務，請使用 MaxStartups 的速率限制功能來保護 sshd 登入的可用性並防止守護程序不堪重負。"
    remediation: "編輯 /etc/ssh/sshd_config 檔案，使參數設置在任何 Include 條目之上，如下所示: MaxStartups 10:30:60 注意: 首次出現的選項具有優先權。如果啟用了 Include 位置並且在您的環境中已使用且了解先後順序，則可能在 Include 位置的檔案中創建該條目。"
    compliance:
      - cis: ["4.2.19"]
      - cis_csc_v8: ["4.1"]
      - cis_csc_v7: ["5.1"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "CM.L2-3.4.1", "CM.L2-3.4.2", "CM.L2-3.4.6", "CM.L2-3.4.7"]
      - iso_27001-2013: ["A.14.2.5", "A.8.1.3"]
      - mitre_tactics: ["TA0040"]
      - mitre_techniques: ["T1499", "T1499.002"]
      - nist_sp_800-53: ["CM-7(1)", "CM-9", "SA-10"]
      - pci_dss_v3.2.1: ["11.5", "2.2"]
      - pci_dss_v4.0: ["1.1.1", "1.2.1", "1.2.6", "1.2.7", "1.5.1", "2.1.1", "2.2.1"]
      - soc_2: ["CC7.1", "CC8.1"]
    condition: all
    rules:
      - 'c:sshd -T -> r:^\s*maxstartups\s+10:30:60'
      - 'not f:/etc/ssh/sshd_config -> r:^\s*maxstartups\s+(((1[1-9]|[1-9][0-9][0-9]+):([0-9]+):([0-9]+))|(([0-9]+):(3[1-9]|[4-9][0-9]|[1-9][0-9][0-9]+):([0-9]+))|(([0-9]+):([0-9]+):(6[1-9]|[7-9][0-9]|[1-9][0-9][0-9]+)))'
      - 'not d:/etc/ssh/sshd_config.d -> r:\.*.conf$ -> r:^\s*maxstartups\s+(((1[1-9]|[1-9][0-9][0-9]+):([0-9]+):([0-9]+))|(([0-9]+):(3[1-9]|[4-9][0-9]|[1-9][0-9][0-9]+):([0-9]+))|(([0-9]+):([0-9]+):(6[1-9]|[7-9][0-9]|[1-9][0-9][0-9]+)))'

  # 4.2.20 Ensure SSH LoginGraceTime is set to one minute or less. (Automated)
  - id: 19127
    title: "確保 SSH LoginGraceTime 設定為一分鐘或更短。"
    description: "LoginGraceTime 參數指定成功對 SSH 伺服器進行驗證所允許的時間。寬限期越長，存在的開放式未經身份驗證的連線就越多。與此會話中的其他會話控制一樣，寬限期應限制在適當的組織限制內，以確保服務可用於所需的存取。"
    rationale: "將 LoginGraceTime 參數設定為較小的數字將最大限度地降低對 SSH 伺服器進行暴力攻擊的成功風險。它還會限制平行未經身份驗證的連接的數量。"
    remediation: "編輯 /etc/ssh/sshd_config 檔案，在任何 Include 條目上方設置參數如下：LoginGraceTime 60 注意：首個出現的選項具有優先權，Match 設置語句依然有效。如果啟用了 Include 路徑、使用了並且瞭解其優先順序，可以在 Include 路徑的檔案中創建該條目。"
    compliance:
      - cis: ["4.2.20"]
      - mitre_mitigations: ["M1036"]
      - mitre_tactics: ["TA0006"]
      - mitre_techniques: ["T1110", "T1110.001", "T1110.003", "T1110.004"]
    condition: all
    rules:
      - 'c:sshd -T -> n:logingracetime\s*\t*(\d+) compare <= 60 && n:LoginGraceTime\s*\t*(\d+) compare != 0'
      - 'not f:/etc/ssh/sshd_config -> r:\s*LoginGraceTime\s+(0|6[1-9]|[7-9][0-9]|[1-9][0-9][0-9]+|[^1]m)'
      - 'not d:/etc/ssh/sshd_config.d -> r:\.*.conf$ -> r:\s*LoginGraceTime\s+(0|6[1-9]|[7-9][0-9]|[1-9][0-9][0-9]+|[^1]m)'

  # 4.2.21 Ensure SSH MaxSessions is set to 10 or less. (Automated)
  - id: 19128
    title: "確保 SSH MaxSessions 設定為 10 或更少。"
    description: "MaxSessions 參數指定給定連線允許的最大開啟會話數。"
    rationale: "為了防止系統因大量平行會話而導致拒絕服務，請使用 MaxSessions 的速率限制功能來保護 sshd 登入的可用性並防止守護程序不堪重負。"
    remediation: "編輯 /etc/ssh/sshd_config 檔案，將參數設置在任何 Include 條目之前，如下所示: MaxSessions 10 注意: 首次出現的選項優先，Match 設置的語句具有優先權。如果啟用了 Include 位址、已使用且在您的環境中理解了優先順序，則可以在 Include 位址中的檔案中創建條目。"
    compliance:
      - cis: ["4.2.21"]
      - mitre_tactics: ["TA0040"]
      - mitre_techniques: ["T1499", "T1499.002"]
    condition: all
    rules:
      - 'c:sshd -T -> n:^\s*maxsessions\s+(\d+) compare <= 10'
      - 'not f:/etc/ssh/sshd_config -> r:^\s*MaxSessions\s+(1[1-9]|[2-9][0-9]|[1-9][0-9][0-9]+)'
      - 'not d:/etc/ssh/sshd_config.d -> r:\.*.conf$ -> r:^\s*MaxSessions\s+(1[1-9]|[2-9][0-9]|[1-9][0-9][0-9]+)'

  # 4.2.22 Ensure SSH Idle Timeout Interval is configured. (Automated)
  - id: 19129
    title: "確保已配置 SSH 空閒逾時間隔。"
    description: "注意：為了澄清，以下所述的兩個設定僅適用於從協定角度來看的空閒連接，並不意味著檢查使用者是否處於活動狀態。空閒用戶並不意味著空閒連線。 SSH 沒有、也從來沒有故意刪除空閒用戶的能力。在 8.2p1 之前的 SSH 版本中，存在一個錯誤，導致這些值的行為方式被濫用以斷開空閒用戶的連線。該錯誤已在 8.2p1 中解決，因此不能再濫用它來斷開空閒用戶的連線。 ClientAliveInterval 和 ClientAliveCountMax 兩個選項控制 SSH 會話的逾時。直接取自 man 5 sshd_config： - ClientAliveInterval 設定超時間隔（以秒為單位），在此之後如果沒有從客戶端收到資料，sshd(8) 將透過加密通道發送訊息以請求客戶端回應。預設為0，表示這些訊息不會傳送到客戶端。 - ClientAliveCountMax 設定在 sshd(8) 沒有從客戶端接收任何訊息的情況下可以發送的客戶端活動訊息的數量。如果在發送客戶端活動訊息時達到此閾值，sshd 將斷開客戶端連接，終止會話。需要注意的是，客戶端活動訊息的使用與 TCPKeepAlive 有很大不同。客戶端活動訊息透過加密通道發送，因此不會被欺騙。 TCPKeepAlive 啟用的 TCP keepalive 選項是可欺騙的。當客戶端或伺服器依賴了解連線何時變得無回應時，客戶端活動機制就非常有價值。預設值為 3。將 ClientAliveCountMax 設定為零會停用連線終止。"
    rationale: "為了防止資源耗盡，應該為ClientAliveInterval和ClientAliveCountMax設定適當的值。具體來說，請查看原始程式碼，ClientAliveCountMax 必須大於零，才能利用 SSH 刪除空閒連線的功能。如果允許連線無限期地保持開啟狀態，則可能會被用作 DDOS 攻擊，或者在不可靠的網路上可能會發生簡單的資源耗盡。此處設定的範例是 45 秒逾時。請查閱您的網站策略以了解網路逾時並視情況應用。"
    remediation: "編輯 /etc/ssh/sshd_config 檔案以根據站點政策在任何 Include 條目之上設置參數。示例：ClientAliveInterval 15 ClientAliveCountMax 3 注意：選項的首次出現優先，Match 設置語句依然有效。如果在你的環境中已啟用、使用並理解了 Include 位置的優先順序，則可以在 Include 位置的檔案中創建條目。"
    references:
      - "https://man.openbsd.org/sshd_config"
    compliance:
      - cis: ["4.2.22"]
      - mitre_mitigations: ["M1026"]
      - mitre_tactics: ["TA0001"]
      - mitre_techniques: ["T1078", "T1078.001", "T1078.002", "T1078.003"]
    condition: all
    rules:
      - 'c:sshd -T -> n:ClientAliveInterval\s*\t*(\d+) compare > 0'
      - 'c:sshd -T -> n:clientalivecountmax\s*\t*(\d+) compare > 0'

  # 4.3.1 Ensure sudo is installed. (Automated)
  - id: 19130
    title: "確保已安裝 sudo。"
    description: "sudo 允許允許的使用者作為超級使用者或安全策略指定的其他使用者執行指令。呼叫使用者的真實（非有效）使用者 ID 用於決定用於查詢安全性原則的使用者名稱。"
    rationale: "sudo 支援安全性原則和輸入/輸出日誌記錄的插件架構。第三方可以開發和分發自己的策略和 I/O 日誌記錄插件，以便與 sudo 前端無縫協作。預設安全性策略是 sudoers，它是透過檔案 /etc/sudoers 和 /etc/sudoers.d 中的任何條目配置的。安全性策略確定使用者必須執行 sudo 的權限（如果有）。此政策可能要求使用者使用密碼或其他身份驗證機制來驗證自己的身份。如果需要身份驗證，如果在可設定的時間限制內未輸入使用者密碼，sudo 將退出。此限制是特定於政策的。"
    remediation: "首先確認是否需要LDAP功能。如果是，則安裝sudo-ldap，否則安裝sudo。示例：# apt install sudo。"
    compliance:
      - cis: ["4.3.1"]
      - cis_csc_v8: ["5.4"]
      - cis_csc_v7: ["4.3"]
      - cmmc_v2.0: ["AC.L2-3.1.5", "AC.L2-3.1.6", "AC.L2-3.1.7", "SC.L2-3.13.3"]
      - iso_27001-2013: ["A.9.2.3"]
      - mitre_tactics: ["TA0001"]
      - mitre_techniques: ["T1078", "T1078.003"]
      - nist_sp_800-53: ["AC-6(2)", "AC-6(5)"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - soc_2: ["CC6.1", "CC6.3"]
    condition: any
    rules:
      - "c:dpkg -s sudo -> r:install ok installed"
      - "c:dpkg -s sudo-ldap -> r:install ok installed"

  # 4.3.2 Ensure sudo commands use pty. (Automated)
  - id: 19131
    title: "確保 sudo 指令使用 pty。"
    description: "sudo 可以配置為僅從偽終端 (pseudo-pty) 運行。"
    rationale: "攻擊者可以使用 sudo 運行惡意程序，該程序會分叉一個後台程序，即使主程式執行完畢，該程序仍然保留。"
    impact: "WARNING: Editing the sudo configuration incorrectly can cause sudo to stop functioning. Always use visudo to modify sudo configuration files."
    remediation: "使用visudo編輯/etc/sudoers檔案或使用visudo -f <檔案路徑>編輯/etc/sudoers.d/中的檔案，並新增以下行：Defaults use_pty 注意： - sudo會讀取/etc/sudoers.d中的每個檔案，跳過那些名稱以~結尾或包含.字元的檔案，以避免對套件管理器或編輯器的臨時/備份檔案造成問題。 - 檔案會依詞彙順序排序進行解析。也就是說，/etc/sudoers.d/01_first會在/etc/sudoers.d/10_second之前解析。 - 請注意，由於排序是按詞彙進行而非數值，因此/etc/sudoers.d/1_whoops會在/etc/sudoers.d/10_second之後載入。 - 使用一致的前導零數量在檔案名稱中可以用來避免此類問題。"
    compliance:
      - cis: ["4.3.2"]
      - cis_csc_v8: ["5.4"]
      - cis_csc_v7: ["5.1"]
      - cmmc_v2.0: ["AC.L2-3.1.5", "AC.L2-3.1.6", "AC.L2-3.1.7", "SC.L2-3.13.3"]
      - iso_27001-2013: ["A.14.2.5", "A.8.1.3"]
      - mitre_mitigations: ["M1026", "M1038"]
      - mitre_tactics: ["TA0001", "TA0003"]
      - mitre_techniques: ["T1078", "T1078.003", "T1548", "T1548.003"]
      - nist_sp_800-53: ["AC-6(2)", "AC-6(5)"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - soc_2: ["CC6.1", "CC6.3"]
    condition: any
    rules:
      - 'f:/etc/sudoers -> r:^\s*\t*Defaults\s*\t*use_pty'
      - 'd:/etc/sudoers.d -> r:\.* -> r:^\s*\t*Defaults\s*\t*use_pty'

  # 4.3.3 Ensure sudo log file exists. (Automated)
  - id: 19132
    title: "確保 sudo 日誌檔案存在。"
    description: "sudo 可以使用自訂日誌檔案。"
    rationale: "sudo 日誌檔簡化了 sudo 指令的審核。"
    impact: "WARNING: Editing the sudo configuration incorrectly can cause sudo to stop functioning. Always use visudo to modify sudo configuration files."
    remediation: '使用 visudo 或 visudo -f <檔案路徑> 編輯 /etc/sudoers 或 /etc/sudoers.d/ 中的檔案，並添加以下行：範例：Defaults logfile="/var/log/sudo.log" 注意： - sudo 會讀取 /etc/sudoers.d 中的每一個檔案，跳過那些結尾帶有 ~ 或包含 . 字元的檔案名稱，以避免造成套件管理員或編輯器臨時/備份檔案的問題。 - 檔案會按字母順序解析。也就是說，/etc/sudoers.d/01_first 會在 /etc/sudoers.d/10_second 之前被解析。 - 請注意，因為排序是按字母而不是數字進行的，所以 /etc/sudoers.d/1_whoops 會在 /etc/sudoers.d/10_second 之後載入。 - 使用一致數量的前導零在檔案名中可以用來避免這類問題。'
    compliance:
      - cis: ["4.3.3"]
      - cis_csc_v8: ["8.5"]
      - cis_csc_v7: ["6.3"]
      - cmmc_v2.0: ["AU.L2-3.3.1"]
      - iso_27001-2013: ["A.12.4.1"]
      - mitre_mitigations: ["M1026"]
      - mitre_tactics: ["TA0004"]
      - mitre_techniques: ["T1562", "T1562.006"]
      - nist_sp_800-53: ["AU-3(1)", "AU-7"]
      - pci_dss_v3.2.1: ["10.1", "10.2.2", "10.2.4", "10.2.5", "10.3"]
      - pci_dss_v4.0: ["10.2", "10.2.1", "10.2.1.2", "10.2.1.5", "9.4.5"]
      - soc_2: ["CC5.2", "CC7.2"]
    condition: any
    rules:
      - 'f:/etc/sudoers -> r:^\s*\t*Defaults\s*\t*logfile='
      - 'd:/etc/sudoers.d -> r:\.* -> r:^\s*\t*Defaults\s*\t*logfile='

  # 4.3.4 Ensure users must provide password for privilege escalation. (Automated)
  - id: 19133
    title: "確保使用者必須提供密碼才能進行權限升級。"
    description: "必須配置作業系統，以便使用者必須提供密碼才能進行權限升級。"
    rationale: "如果沒有（重新）身份驗證，使用者可以存取資源或執行他們無權的任務。當作業系統提供升級功能的能力時，使用者（重新）身份驗證至關重要。"
    impact: "This will prevent automated processes from being able to elevate privileges."
    remediation: "根據審計程序的結果，使用visudo -f <PATH TO FILE>來編輯相關的sudoers檔案。移除檔案中所有含有NOPASSWD標籤的行。"
    compliance:
      - cis: ["4.3.4"]
      - cis_csc_v8: ["5.4"]
      - cis_csc_v7: ["4.3"]
      - cmmc_v2.0: ["AC.L2-3.1.5", "AC.L2-3.1.6", "AC.L2-3.1.7", "SC.L2-3.13.3"]
      - iso_27001-2013: ["A.9.2.3"]
      - mitre_mitigations: ["M1026"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1078", "T1548"]
      - nist_sp_800-53: ["AC-6(2)", "AC-6(5)"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - soc_2: ["CC6.1", "CC6.3"]
    condition: none
    rules:
      - "f:/etc/sudoers -> !r:^# && r:*NOPASSWD"
      - 'd:/etc/sudoers.d -> r:\.* -> !r:^# && r:*NOPASSWD'

  # 4.3.5 Ensure re-authentication for privilege escalation is not disabled globally. (Automated)
  - id: 19134
    title: "確保未全域停用權限升級的重新驗證。"
    description: "必須配置作業系統，以便使用者必須重新進行身份驗證才能提升權限。"
    rationale: "如果不重新進行身份驗證，使用者就可以存取他們沒有授權的資源或執行任務。當作業系統提供升級功能時，使用者重新進行身份驗證至關重要。"
    remediation: "將操作系統配置為要求用戶在進行權限提升時重新驗證。根據稽核程序的結果，使用visudo -f <路徑到檔案> 編輯相關的sudoers檔案。移除檔案中任何出現的!authenticate標籤。"
    compliance:
      - cis: ["4.3.5"]
      - cis_csc_v8: ["5.4"]
      - cis_csc_v7: ["4.3"]
      - cmmc_v2.0: ["AC.L2-3.1.5", "AC.L2-3.1.6", "AC.L2-3.1.7", "SC.L2-3.13.3"]
      - iso_27001-2013: ["A.9.2.3"]
      - nist_sp_800-53: ["AC-6(2)", "AC-6(5)"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - soc_2: ["CC6.1", "CC6.3"]
    condition: none
    rules:
      - 'f:/etc/sudoers -> !r:^# && r:*\!authenticate'
      - 'd:/etc/sudoers.d -> r:\.* -> !r:^# && r:*\!authenticate'

  # 4.3.6 Ensure sudo authentication timeout is configured correctly. (Automated)
  - id: 19135
    title: "確保 sudo 身份驗證逾時配置正確。"
    description: "sudo 將使用的憑證快取預設 15 分鐘。這是為了在需要執行多項管理任務時方便使用。可以修改超時以適應本機安全性原則。此預設值是特定於發行版的。有關詳細資訊，請參閱審核部分。"
    rationale: "設定超時值可以減少對其他使用者進行未經授權的特權存取的機會。"
    remediation: "如果目前配置的超時大於15分鐘，請使用visudo -f <檔案路徑>編輯審計部分列出的檔案，並根據您的站點政策將條目timestamp_timeout=修改為15分鐘或更少。該值以分鐘為單位。此特定條目可能單獨出現，也可能與env_reset出現在同一行上。請參閱以下兩個示例: Defaults env_reset, timestamp_timeout=15 Defaults timestamp_timeout=15 Defaults env_reset."
    references:
      - "https://www.sudo.ws/man/1.9.0/sudoers.man.html"
    compliance:
      - cis: ["4.3.6"]
      - cis_csc_v8: ["5.4"]
      - cis_csc_v7: ["4.3"]
      - cmmc_v2.0: ["AC.L2-3.1.5", "AC.L2-3.1.6", "AC.L2-3.1.7", "SC.L2-3.13.3"]
      - iso_27001-2013: ["A.9.2.3"]
      - nist_sp_800-53: ["AC-6(2)", "AC-6(5)"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - soc_2: ["CC6.1", "CC6.3"]
    condition: all
    rules:
      - 'c:sudo -V -> r:Authentication timestamp timeout:\s*\t*15.0 minutes'
      - 'f:/etc/sudoers -> n:timestamp_timeout=(\d+) compare <=15'
      - 'd:/etc/sudoers.d -> r:\.* -> n:timestamp_timeout=(\d+) compare <=15'

  # 4.3.7 Ensure access to the su command is restricted. (Automated)
  - id: 19136
    title: "確保對 su 指令的存取受到限制。"
    description: "su 指令允許使用者以另一個使用者的身分執行指令或 shell。該程式已被 sudo 取代，它允許對特權存取進行更精細的控制。通常，su 指令可以由任何使用者執行。透過取消註解 /etc/pam.d/su 中的 pam_wheel.so 語句，su 指令將只允許特定群組中的使用者執行 su。該組應為空，以加強使用 sudo 進行特權存取。"
    rationale: "限制 su 的使用並使用 sudo 代替它，可以使系統管理員更好地控制使用者權限的升級以執行特權指令。 sudo 實用程式還提供了更好的日誌記錄和審核機制，因為它可以記錄透過 sudo 執行的每個指令，而 su 只能記錄使用者執行了 su 程式。"
    remediation: "創建一個將被指定用於su指令的空群組。該群組應按照站點策略命名。範例：# groupadd sugroup 將以下行添加到 /etc/pam.d/su 檔案，指定空群組：auth required pam_wheel.so use_uid group=sugroup."
    compliance:
      - cis: ["4.3.7"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1026"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1548"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'f:/etc/pam.d/su -> !r:^# && r:auth\s*\t*required\s*\t*pam_wheel.so && r:use_uid && r:group=\w+'

  # 4.4.1 Ensure password creation requirements are configured. (Automated)
  - id: 19137
    title: "確保配置密碼建立要求。"
    description: "pam_pwquality.so 模組檢查密碼的強度。它執行檢查，例如確保密碼不是字典單字、具有一定長度、包含混合字元（例如字母、數字、其他）等。在 /etc/security/pwquality.conf 檔案中設定以下選項： - 密碼長度：o minlen = 14 - 密碼必須為 14 個字元或更多 - 密碼複雜性：o minclass = 4 - 所需字元類別的最小數量新密碼（數字、大寫、小寫、其他）或o dcredit = -1 - 提供至少一位數字o ucredit = -1 - 提供至少一個大寫字元o ocredit = -1 - 提供至少一個特殊字元 o lcredit = -1 - 提供至少一個小寫字元。"
    rationale: "強密碼可以保護系統免於暴力破解。"
    remediation: "以下設定是一個建議的範例政策。更改這些值以符合你們組織的密碼政策。執行以下指令來安裝 pam_pwquality 模組：# apt install libpam-pwquality 編輯檔案 /etc/security/pwquality.conf 並新增或修改以下行以符合站點的密碼長度政策：minlen = 14 編輯檔案 /etc/security/pwquality.conf 並新增或修改以下行以符合站點的密碼複雜性政策：選項 1 minclass = 4 選項 2 dcredit = -1 ucredit = -1 ocredit = -1 lcredit = -1 編輯 /etc/pam.d/common-password 檔案以包含 pam_pwquality.so 並符合站點政策：password requisite pam_pwquality.so retry=3."
    compliance:
      - cis: ["4.4.1"]
      - cis_csc_v8: ["5.2"]
      - cis_csc_v7: ["4.4"]
      - cmmc_v2.0: ["IA.L2-3.5.7"]
      - iso_27001-2013: ["A.9.4.3"]
      - mitre_mitigations: ["M1027"]
      - mitre_tactics: ["TA0006"]
      - mitre_techniques: ["T1078", "T1078.001", "T1078.002", "T1078.003", "T1078.004", "T1110", "T1110.001", "T1110.002", "T1110.003"]
      - pci_dss_v4.0: ["2.2.2", "8.3.5", "8.3.6", "8.6.3"]
      - soc_2: ["CC6.1"]
    condition: all
    rules:
      - 'f:/etc/security/pwquality.conf -> !r:^\s*# && n:minlen\s*=\s*(\d+) compare >= 14'
      - 'f:/etc/security/pwquality.conf -> !r:^\s*# && n:minclass\s*=\s*(\d+) compare >= 4'
      - 'f:/etc/security/pwquality.conf -> !r:^\s*# && r:dcredit = -1'
      - 'f:/etc/security/pwquality.conf -> !r:^\s*# && r:ucredit = -1'
      - 'f:/etc/security/pwquality.conf -> !r:^\s*# && r:lcredit = -1'
      - 'f:/etc/security/pwquality.conf -> !r:^\s*# && r:ocredit = -1'
      - 'f:/etc/pam.d/common-password -> !r:^\s*# && n:password\s*requisite\s*pam_pwquality.so\s*retry=(\d+) compare <=3'

  # 4.4.2 Ensure lockout for failed password attempts is configured. (Automated)
  - id: 19138
    title: "確保配置了針對失敗的密碼嘗試的鎖定。"
    description: "連續 n 次登入嘗試失敗後鎖定使用者。第一組變更是對 PAM 設定檔進行的。第二組變更應用於程式特定的 PAM 設定檔。第二組變更必須套用於將鎖定使用者的每個程式。檢查每個輔助程式的檔案，以了解如何配置它們以與 PAM 一起使用的說明。 - deny=n - n 表示帳戶被鎖定之前嘗試失敗的次數 - unlock_time=n - n 表示帳戶解鎖之前的秒數 -audit - 如果用戶沒有登入，會將用戶名記錄到系統日誌中成立。 - 靜音 - 不列印資訊性訊息。根據當地站點政策設定鎖定次數和解鎖時間。"
    rationale: "在連續 n 次不成功的登入嘗試後鎖定使用者 ID 可減輕針對系統的暴力密碼攻擊。"
    remediation: "編輯 /etc/pam.d/common-auth 檔案並新增以下 auth 行：auth required pam_tally2.so onerr=fail audit silent deny=5 unlock_time=900 編輯 /etc/pam.d/common-account 檔案並新增以下 account 行：account requisite pam_deny.so account required pam_tally2.so."
    compliance:
      - cis: ["4.4.2"]
      - cis_csc_v7: ["16.7"]
      - iso_27001-2013: ["A.9.2.6"]
      - mitre_mitigations: ["M1027"]
      - mitre_tactics: ["TA0006"]
      - mitre_techniques: ["T1110", "T1110.001", "T1110.003"]
    condition: all
    rules:
      - 'f:/etc/pam.d/common-auth -> !r:^# && r:auth\s*\t*required\s*\t*pam_tally2.so && r:onerr=fail && r:audit && r:silent && r:deny\s*=\s*\d+ && r:unlock_time\s*=\s*\d+'
      - 'f:/etc/pam.d/common-auth -> n:deny\s*=\s*(\d+) compare <=5'
      - 'f:/etc/pam.d/common-account -> !r:^# && r:account\s*\t*requisite\s*\t*pam_deny.so'
      - 'f:/etc/pam.d/common-account -> !r:^# && r:account\s*\t*required\s*\t*pam_tally2.so'

  # 4.4.3 Ensure password reuse is limited. (Automated)
  - id: 19139
    title: "確保密碼重複使用受到限制。"
    description: "/etc/security/opasswd 檔案儲存使用者的舊密碼，可以檢查該檔案以確保使用者沒有重複使用最近的密碼。"
    rationale: "強制使用者不要重複使用過去 5 個密碼，可以降低攻擊者猜測密碼的可能性。"
    remediation: "注意：請特別注意配置。不正確的配置可能會導致系統鎖定或意外行為。這是示例配置。您的配置可能會根據之前對檔案的更改而有所不同。編輯/etc/pam.d/common-password檔案以包含： - password required pam_pwhistory.so remember=5 - 在pam_unix.so行上使用use_authtok 示例：password required pam_pwhistory.so remember=5 password [success=1 default=ignore] pam_unix.so obscure sha512 use_authtok."
    references:
      - "https://manpages.ubuntu.com/manpages/focal/man8/pam_pwhistory.8.html"
      - "https://bugs.launchpad.net/ubuntu/+source/pam/+bug/1989731"
    compliance:
      - cis: ["4.4.3"]
      - cis_csc_v8: ["5.2"]
      - cis_csc_v7: ["4.4"]
      - cmmc_v2.0: ["IA.L2-3.5.7"]
      - iso_27001-2013: ["A.9.4.3"]
      - mitre_mitigations: ["M1028"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1078", "T1078.001", "T1078.002", "T1078.003", "T1078.004", "T1110", "T1110.004"]
      - pci_dss_v4.0: ["2.2.2", "8.3.5", "8.3.6", "8.6.3"]
      - soc_2: ["CC6.1"]
    condition: all
    rules:
      - 'f:/etc/pam.d/common-password -> !r:^# && r:password\s*\t*required\s*\t*pam_pwhistory.so && n:remember\s*\t*=\s*\t*(\d+) compare => 5'
      - 'f:/etc/pam.d/common-password -> !r:^# && r:password && r:success && r:default\s*=\s*ignore && r:pam_unix.so && r:use_authtok'

  # 4.4.4 Ensure strong password hashing algorithm is configured. (Automated)
  - id: 19140
    title: "確保配置強密碼雜湊演算法。"
    description: "雜湊函數透過使用數學運算來充當單向函數，而這些數學運算的恢復極其困難且繁瑣。當使用者登入時，發送的密碼將透過相同的單向雜湊演算法運行，並與與提供的使用者名稱相關的雜湊進行比較。如果雜湊密碼與儲存的雜湊匹配，則登入有效。"
    rationale: "SHA512 雜湊演算法提供比以前可用的演算法（例如 MD5）更強大的雜湊，從而透過增加攻擊者成功確定密碼的努力程度來為系統提供額外的保護。"
    remediation: "注意事項: - 特別注意配置。配置錯誤可能導致系統鎖定。 - 這是範例配置。您的配置可能會根據檔案的先前更改而有所不同。 - pam_unix.so 的密碼成功行中的加密方法和 /etc/login.defs 中的 ENCRYPT_METHOD 行應該匹配。編輯 /etc/pam.d/common-password 檔案並確保包含 sha512 以及 pam_unix.so 成功行：範例： password [success=1 default=ignore] pam_unix.so obscure sha512 use_authtok 編輯 /etc/login.defs 並確保 ENCRYPT_METHOD 設置為 SHA512。ENCRYPT_METHOD SHA512."
    compliance:
      - cis: ["4.4.4"]
      - cis_csc_v8: ["3.11"]
      - cis_csc_v7: ["16.4"]
      - cmmc_v2.0: ["AC.L2-3.1.19", "IA.L2-3.5.10", "MP.L2-3.8.1", "SC.L2-3.13.11", "SC.L2-3.13.16"]
      - hipaa: ["164.312(a)(2)(iv)", "164.312(e)(2)(ii)"]
      - iso_27001-2013: ["A.10.1.1"]
      - mitre_mitigations: ["M1041"]
      - mitre_tactics: ["TA0006"]
      - mitre_techniques: ["T1003", "T1003.008", "T1110", "T1110.002"]
      - nist_sp_800-53: ["SC-28", "SC-28(1)"]
      - pci_dss_v3.2.1: ["3.4", "3.4.1", "8.2.1"]
      - pci_dss_v4.0: ["3.1.1", "3.3.2", "3.3.3", "3.5.1", "3.5.1.2", "3.5.1.3", "8.3.2"]
      - soc_2: ["CC6.1"]
    condition: all
    rules:
      - "f:/etc/pam.d/common-password -> !r:^# && r:password && r:pam_unix.so && r:sha512"

  # 4.4.5 Ensure all current passwords uses the configured hashing algorithm. (Manual) - Not Implemented

  # 4.5.1.1 Ensure minimum days between password changes is configured. (Automated)
  - id: 19141
    title: "確保配置密碼變更之間的最短天數。"
    description: "/etc/login.defs 中的 PASS_MIN_DAYS 參數允許管理員阻止使用者更改其密碼，直到自使用者上次更改密碼以來經過最少天數。建議將 PASS_MIN_DAYS 參數設定為 1 天或更多天。"
    rationale: "透過限制密碼變更頻率，管理者可以防止使用者重複更改密碼以試圖規避密碼重複使用控制。"
    remediation: "將 /etc/login.defs 裡的 PASS_MIN_DAYS 參數設置為 1: PASS_MIN_DAYS 1 修改所有已經設置密碼的用戶參數以符合: # chage --mindays 1 <user>."
    compliance:
      - cis: ["4.5.1.1"]
      - cis_csc_v8: ["5.2"]
      - cis_csc_v7: ["4.4"]
      - cmmc_v2.0: ["IA.L2-3.5.7"]
      - iso_27001-2013: ["A.9.4.3"]
      - mitre_mitigations: ["M1027"]
      - mitre_tactics: ["TA0006"]
      - mitre_techniques: ["T1078", "T1078.001", "T1078.002", "T1078.003", "T1078.004", "T1110", "T1110.001", "T1110.002", "T1110.003", "T1110.004"]
      - pci_dss_v4.0: ["2.2.2", "8.3.5", "8.3.6", "8.6.3"]
      - soc_2: ["CC6.1"]
    condition: all
    rules:
      - 'f:/etc/login.defs -> n:^\s*\t*PASS_MIN_DAYS\s*\t*(\d+) compare >= 1'
      - 'not f:/etc/shadow -> !r:^\w+:\p: && n:^\w+:\S*:\d*:(\d+) compare < 1'

  # 4.5.1.2 Ensure password expiration is 365 days or less. (Automated)
  - id: 19142
    title: "確保密碼有效期限為 365 天或更短。"
    description: "/etc/login.defs 中的 PASS_MAX_DAYS 參數允許管理者在密碼達到定義的期限後強制密碼過期。"
    rationale: "攻擊者利用受損憑證或透過線上暴力攻擊成功破解憑證的機會視窗受到密碼期限的限制。因此，降低密碼的最長使用期限也會減少攻擊者的機會視窗。建議PASS_MAX_DAYS參數不超過365天，且大於PASS_MIN_DAYS的值。"
    remediation: "將PASS_MAX_DAYS參數設置為符合站點政策的值在/etc/login.defs中：PASS_MAX_DAYS 365 修改所有設置密碼的用戶參數以匹配：# chage --maxdays 365 <user>."
    references:
      - "https://www.cisecurity.org/white-papers/cis-password-policy-guide/"
    compliance:
      - cis: ["4.5.1.2"]
      - cis_csc_v8: ["5.2"]
      - cis_csc_v7: ["4.4"]
      - cmmc_v2.0: ["IA.L2-3.5.7"]
      - iso_27001-2013: ["A.9.4.3"]
      - mitre_mitigations: ["M1027"]
      - mitre_tactics: ["TA0006"]
      - mitre_techniques: ["T1078", "T1078.001", "T1078.002", "T1078.003", "T1078.004", "T1110", "T1110.001", "T1110.002", "T1110.003", "T1110.004"]
      - pci_dss_v4.0: ["2.2.2", "8.3.5", "8.3.6", "8.6.3"]
      - soc_2: ["CC6.1"]
    condition: all
    rules:
      - 'f:/etc/login.defs -> n:^\s*\t*PASS_MAX_DAYS\s*\t*(\d+) compare <= 365'
      - 'f:/etc/login.defs -> n:^\s*\t*PASS_MAX_DAYS\s*\t*(\d+) compare > 0'
      - 'not f:/etc/shadow -> !r:^\w+:\p: && n:^\w+:\S*:\d*:\d*:(\d+) compare > 365'

  # 4.5.1.3 Ensure password expiration warning days is 7 or more. (Automated)
  - id: 19143
    title: "確保密碼過期警告天數為 7 或更長。"
    description: "/etc/login.defs 中的 PASS_WARN_AGE 參數可讓管理者通知使用者其密碼將在定義的天數內過期。建議將PASS_WARN_AGE參數設定為7天或更多天。"
    rationale: "提供密碼即將過期的預先警告，讓使用者有時間考慮安全的密碼。不知情的用戶可能會選擇一個簡單的密碼或將其寫在可能被發現的地方。"
    remediation: "將 /etc/login.defs 中的 PASS_WARN_AGE 參數設置為 7：PASS_WARN_AGE 7 修改所有設有密碼的使用者參數以符合：# chage --warndays 7 <user>."
    compliance:
      - cis: ["4.5.1.3"]
      - cis_csc_v8: ["5.2"]
      - cis_csc_v7: ["4.4"]
      - cmmc_v2.0: ["IA.L2-3.5.7"]
      - iso_27001-2013: ["A.9.4.3"]
      - mitre_mitigations: ["M1027"]
      - mitre_tactics: ["TA0006"]
      - mitre_techniques: ["T1078", "T1078.001", "T1078.002", "T1078.003", "T1078.004", "T1110", "T1110.001", "T1110.002", "T1110.003", "T1110.004"]
      - pci_dss_v4.0: ["2.2.2", "8.3.5", "8.3.6", "8.6.3"]
      - soc_2: ["CC6.1"]
    condition: all
    rules:
      - 'f:/etc/login.defs -> n:^\s*\t*PASS_WARN_AGE\s*\t*(\d+) compare >= 7'
      - 'not f:/etc/shadow -> !r:^\w+:\p: && n:^\w+:\S*:\d*:\d*:\d*:(\d+) compare < 7'

  # 4.5.1.4 Ensure inactive password lock is 30 days or less. (Automated)
  - id: 19144
    title: "確保非活動密碼鎖定時間不超過 30 天。"
    description: "在給定時間段內不活動的使用者帳戶可以自動停用。建議停用密碼過期後 30 天內不活動的帳號。"
    rationale: "不活動的帳戶對系統安全性構成威脅，因為使用者登入時不會注意到失敗的登入嘗試或其他異常情況。"
    remediation: "執行以下指令將預設的密碼不活動期限設定為30天: # useradd -D -f 30 修改所有已設定密碼的用戶參數以匹配: # chage --inactive 30 <user>."
    compliance:
      - cis: ["4.5.1.4"]
      - cis_csc_v8: ["5.2"]
      - cis_csc_v7: ["4.4"]
      - cmmc_v2.0: ["IA.L2-3.5.7"]
      - iso_27001-2013: ["A.9.4.3"]
      - mitre_mitigations: ["M1027"]
      - mitre_tactics: ["TA0001"]
      - mitre_techniques: ["T1078", "T1078.002", "T1078.003"]
      - pci_dss_v4.0: ["2.2.2", "8.3.5", "8.3.6", "8.6.3"]
      - soc_2: ["CC6.1"]
    condition: all
    rules:
      - 'c:useradd -D -> n:^INACTIVE=(\d+) compare <= 30'
      - 'not c:useradd -D -> n:^INACTIVE=(\d+) compare < 0'
      - 'not f:/etc/shadow -> !r:^\w+:\p: && n:^\w+:\S*:\d*:\d*:\d*:\d+:(\d+) compare > 30'

  # 4.5.1.5 Ensure all users last password change date is in the past. (Automated) - Not Implemented

  # 4.5.1.6 Ensure the number of changed characters in a new password is configured. (Automated)
  - id: 19145
    title: "確保配置了新密碼中更改的字元數。"
    description: "pwquality difok 選項設定密碼中不能出現在舊密碼中的字元數。"
    rationale: "使用複雜密碼有助於增加破解密碼所需的時間和資源。密碼複雜性或強度是衡量密碼抵抗猜測和暴力攻擊的有效性的指標。密碼複雜度是決定破解密碼所需時間的幾個因素之一。密碼越複雜，在密碼被洩露之前需要測試的可能組合數量就越多。"
    remediation: "請編輯或添加以下行至 /etc/security/pwquality.conf 並設為 2 或更高的值: difok = 2。"
    compliance:
      - cis: ["4.5.1.6"]
      - cis_csc_v8: ["5.2"]
      - cis_csc_v7: ["4.4"]
      - cmmc_v2.0: ["IA.L2-3.5.7"]
      - iso_27001-2013: ["A.9.4.3"]
      - pci_dss_v4.0: ["2.2.2", "8.3.5", "8.3.6", "8.6.3"]
      - soc_2: ["CC6.1"]
    condition: all
    rules:
      - 'f:/etc/security/pwquality.conf -> !r:^# && n:difok\s*\t*=\s*\t*(\d+) compare => 2'

  # 4.5.1.7 Ensure preventing the use of dictionary words for passwords is configured. (Automated)
  - id: 19146
    title: "確保配置了防止使用字典單字作為密碼。"
    description: "pwquality dictcheck 選項設定是否檢查racklib 字典中的單字。"
    rationale: "如果作業系統允許使用者根據字典單字選擇密碼，則會增加成功猜測和暴力攻擊的機會，從而增加密碼洩漏的機會。"
    remediation: "在 /etc/security/pwquality.conf 中編輯或新增以下行，設定值為 1：dictcheck = 1。"
    compliance:
      - cis: ["4.5.1.7"]
      - cis_csc_v8: ["5.2"]
      - cis_csc_v7: ["4.4"]
      - cmmc_v2.0: ["IA.L2-3.5.7"]
      - iso_27001-2013: ["A.9.4.3"]
      - pci_dss_v4.0: ["2.2.2", "8.3.5", "8.3.6", "8.6.3"]
      - soc_2: ["CC6.1"]
    condition: all
    rules:
      - 'f:/etc/security/pwquality.conf -> !r:^# && n:dictcheck\s*\t*=\s*\t*(\d+) compare = 1'

  # 4.5.2 Ensure system accounts are secured. (Automated) - Not Implemented

  # 4.5.3 Ensure default group for the root account is GID 0. (Automated)
  - id: 19147
    title: "確保 root 帳號的預設群組是 GID 0。"
    description: "usermod指令可用來指定root使用者屬於哪個群組。這會影響 root 使用者所建立的檔案的權限。"
    rationale: "對 root 帳號使用 GID 0 有助於防止非特權使用者意外存取 root 擁有的檔案。"
    remediation: "請執行以下指令將 root 用戶預設群組設為 GID 0 ：# usermod -g 0 root."
    compliance:
      - cis: ["4.5.3"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1026"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1548"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'f:/etc/passwd -> !r:^# && r:root:\w+:\w+:0:'

  # 4.5.4 Ensure default user umask is 027 or more restrictive. (Automated) - Not Implemented

  # 4.5.5 Ensure default user shell timeout is configured. (Automated) - Not Implemented

  # 4.5.6 Ensure nologin is not listed in /etc/shells. (Automated)
  - id: 19148
    title: "確保 nologin 未在 /etc/shells 中列出。"
    description: "/etc/shells 是一個文字檔案，其中包含有效登入 shell 的完整路徑名。該檔案由 chsh 查閱並可供其他程式查詢。請注意，有些程式會查閱此檔案來確定使用者是否為普通使用者；例如，FTP 守護程式傳統上不允許使用未包含在此檔案中的 shell 的使用者進行存取。"
    rationale: "使用者可以使用 chsh 更改其配置的 shell。如果使用者配置的 shell 不在 /etc/shells 中，則系統會假定它們受到某種限制。對於 chsh，這意味著用戶無法更改該值。其他程式可能會查詢該清單並套用類似的限制。透過將 nologin 放入 /etc/shells 中，任何以 nologin 為其 shell 的使用者都將被視為完整的、不受限制的使用者。這不是 nologin 的預期行為。"
    remediation: "編輯 /etc/shells 並刪除任何包含 nologin 的行。"
    compliance:
      - cis: ["4.5.6"]
    condition: all
    rules:
      - "not f:/etc/shells -> !r:^# && r:nologins"

  # 4.5.7 Ensure maximum number of same consecutive characters in a password is configured. (Automated)
  - id: 19149
    title: "確保配置密碼中相同連續字元的最大數量。"
    description: "pwquality maxrepeat 選項設定新密碼中允許的相同連續字元的最大數量。"
    rationale: "使用複雜密碼有助於增加破解密碼所需的時間和資源。密碼複雜性或強度是衡量密碼抵抗猜測和暴力攻擊的有效性的指標。密碼複雜度是決定破解密碼所需時間的幾個因素之一。密碼越複雜，在密碼被洩露之前需要測試的可能組合數量就越多。"
    remediation: "編輯或新增以下行到/etc/security/pwquality.conf中設定值為3或更少且不為0：maxrepeat = 3。"
    compliance:
      - cis: ["4.5.7"]
      - cis_csc_v8: ["5.2"]
      - cis_csc_v7: ["4.4"]
      - cmmc_v2.0: ["IA.L2-3.5.7"]
      - iso_27001-2013: ["A.9.4.3"]
      - pci_dss_v4.0: ["2.2.2", "8.3.5", "8.3.6", "8.6.3"]
      - soc_2: ["CC6.1"]
    condition: all
    rules:
      - 'f:/etc/security/pwquality.conf -> !r:^# && n:maxrepeat\s*\t*=\s*\t*(\d+) compare <=3'
      - 'not f:/etc/security/pwquality.conf -> !r:^# && n:maxrepeat\s*\t*=\s*\t*(\d+) compare =0'

  # 5.1.1.1.1 Ensure systemd-journal-remote is installed. (Automated)
  - id: 19150
    title: "確保已安裝 systemd-journal-remote。"
    description: "Journald（透過 systemd-journal-remote）支援將其收集的日誌事件傳送到遠端日誌主機或從遠端主機接收訊息的能力，從而實作集中日誌管理。"
    rationale: "在遠端主機上儲存日誌資料可以保護日誌完整性免受本機攻擊。如果攻擊者獲得本機系統的 root 存取權限，他們就可以篡改或刪除本機系統上儲存的日誌資料。"
    remediation: "運行以下指令來安裝 systemd-journal-remote：# apt install systemd-journal-remote."
    compliance:
      - cis: ["5.1.1.1.1"]
      - cis_csc_v8: ["8.2"]
      - cis_csc_v7: ["6.2", "6.3"]
      - cmmc_v2.0: ["AU.L2-3.3.1"]
      - hipaa: ["164.312(b)"]
      - iso_27001-2013: ["A.12.4.1"]
      - mitre_mitigations: ["M1029"]
      - mitre_tactics: ["TA0040"]
      - mitre_techniques: ["T1070", "T1070.002", "T1562", "T1562.006"]
      - nist_sp_800-53: ["AU-7"]
      - pci_dss_v3.2.1: ["10.2", "10.3"]
      - pci_dss_v4.0: ["10.2.1", "10.2.1.1", "10.2.1.2", "10.2.1.3", "10.2.1.4", "10.2.1.5", "10.2.1.6", "10.2.1.7", "10.2.2", "5.3.4", "6.4.1", "6.4.2"]
    condition: all
    rules:
      - "c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' systemd-journal-remote -> r:install ok installed"

  # 5.1.1.1.2 Ensure systemd-journal-remote is configured. (Manual)
  - id: 19151
    title: "確保已配置 systemd-journal-remote。"
    description: "Journald（透過 systemd-journal-remote）支援將其收集的日誌事件傳送到遠端日誌主機或從遠端主機接收訊息的能力，從而實作集中日誌管理。"
    rationale: "在遠端主機上儲存日誌資料可以保護日誌完整性免受本機攻擊。如果攻擊者獲得本機系統的 root 存取權限，他們就可以篡改或刪除本機系統上儲存的日誌資料。"
    remediation: "編輯 /etc/systemd/journal-upload.conf 檔案，確保以下幾行根據您的環境進行設置：URL=192.168.50.42 ServerKeyFile=/etc/ssl/private/journal-upload.pem ServerCertificateFile=/etc/ssl/certs/journal-upload.pem TrustedCertificateFile=/etc/ssl/ca/trusted.pem 重啟服務：# systemctl restart systemd-journal-upload."
    compliance:
      - cis: ["5.1.1.1.2"]
      - cis_csc_v8: ["8.2"]
      - cis_csc_v7: ["6.2", "6.3"]
      - cmmc_v2.0: ["AU.L2-3.3.1"]
      - hipaa: ["164.312(b)"]
      - iso_27001-2013: ["A.12.4.1"]
      - mitre_mitigations: ["M1029"]
      - mitre_tactics: ["TA0040"]
      - mitre_techniques: ["T1070", "T1070.002", "T1562", "T1562.006"]
      - nist_sp_800-53: ["AU-7"]
      - pci_dss_v3.2.1: ["10.2", "10.3"]
      - pci_dss_v4.0: ["10.2.1", "10.2.1.1", "10.2.1.2", "10.2.1.3", "10.2.1.4", "10.2.1.5", "10.2.1.6", "10.2.1.7", "10.2.2", "5.3.4", "6.4.1", "6.4.2"]
    condition: all
    rules:
      - "f:/etc/systemd/journal-upload.conf -> r:URL="
      - "f:/etc/systemd/journal-upload.conf -> r:ServerKeyFile="
      - "f:/etc/systemd/journal-upload.conf -> r:ServerCertificateFile="
      - "f:/etc/systemd/journal-upload.conf -> r:TrustedCertificateFile="

  # 5.1.1.1.3 Ensure systemd-journal-remote is enabled. (Manual)
  - id: 19152
    title: "確保 systemd-journal-remote 已啟用。"
    description: "Journald（透過 systemd-journal-remote）支援將其收集的日誌事件傳送到遠端日誌主機或從遠端主機接收訊息的能力，從而實作集中日誌管理。"
    rationale: "在遠端主機上儲存日誌資料可以保護日誌完整性免受本機攻擊。如果攻擊者獲得本機系統的 root 存取權限，他們就可以篡改或刪除本機系統上儲存的日誌資料。"
    remediation: "執行以下指令以啟用 systemd-journal-remote: # systemctl --now enable systemd-journal-upload.service."
    compliance:
      - cis: ["5.1.1.1.3"]
      - cis_csc_v8: ["8.2"]
      - cis_csc_v7: ["6.2", "6.3"]
      - cmmc_v2.0: ["AU.L2-3.3.1"]
      - hipaa: ["164.312(b)"]
      - iso_27001-2013: ["A.12.4.1"]
      - mitre_mitigations: ["M1029"]
      - mitre_tactics: ["TA0040"]
      - mitre_techniques: ["T1070", "T1070.002", "T1562", "T1562.006"]
      - nist_sp_800-53: ["AU-7"]
      - pci_dss_v3.2.1: ["10.2", "10.3"]
      - pci_dss_v4.0: ["10.2.1", "10.2.1.1", "10.2.1.2", "10.2.1.3", "10.2.1.4", "10.2.1.5", "10.2.1.6", "10.2.1.7", "10.2.2", "5.3.4", "6.4.1", "6.4.2"]
    condition: all
    rules:
      - "c:systemctl is-enabled systemd-journal-upload.service -> r:^enabled"

  # 5.1.1.1.4 Ensure journald is not configured to receive logs from a remote client. (Automated)
  - id: 19153
    title: "確保未將journald配置為從遠端用戶端接收日誌。"
    description: "Journald 支援從遠端主機接收訊息的能力，從而充當日誌伺服器。客戶端不應從其他主機接收資料。注意： - 相同的套件 systemd-journal-remote 用於將日誌傳送到遠端主機和接收傳入日誌。 - 關於接收日誌，有兩種服務； systemd-journal-remote.socket 和 systemd-journal-remote.service。"
    rationale: "如果客戶端配置為也接收資料，從而將其轉變為伺服器，則客戶端系統將在其操作邊界之外運行。"
    remediation: "執行以下指令來停用systemd-journal-remote.socket: # systemctl --now disable systemd-journal-remote.socket."
    compliance:
      - cis: ["5.1.1.1.4"]
      - cis_csc_v8: ["4.8", "8.2"]
      - cis_csc_v7: ["6.2", "6.3", "9.2"]
      - cmmc_v2.0: ["AU.L2-3.3.1", "CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - hipaa: ["164.312(b)"]
      - iso_27001-2013: ["A.12.4.1", "A.13.1.3"]
      - mitre_mitigations: ["M1029"]
      - mitre_tactics: ["TA0040"]
      - mitre_techniques: ["T1070", "T1070.002", "T1562", "T1562.006"]
      - nist_sp_800-53: ["AU-7"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "10.2", "10.3", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "10.2.1", "10.2.1.1", "10.2.1.2", "10.2.1.3", "10.2.1.4", "10.2.1.5", "10.2.1.6", "10.2.1.7", "10.2.2", "2.2.4", "5.3.4", "6.4.1", "6.4.2"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: all
    rules:
      - "c:systemctl is-enabled systemd-journal-remote.socket -> r:^disabled"

  # 5.1.1.2 Ensure journald service is enabled. (Automated)
  - id: 19154
    title: "確保日誌服務已啟用。"
    description: "確保啟用 systemd-journald 服務以允許擷取日誌記錄事件。"
    rationale: "如果未啟用 systemd-journald 服務在啟動時啟動，系統將不會擷取日誌記錄事件。"
    remediation: "預設情況下，systemd-journald 服務沒有 [Install] 區段，因此無法啟用/停用。它應該被其他單元檔案引用為 Requires 或 Wants。因此，如果 systemd-journald 的狀態不是靜態的，請調查原因。"
    compliance:
      - cis: ["5.1.1.2"]
      - cis_csc_v8: ["8.2"]
      - cis_csc_v7: ["6.2", "6.3"]
      - cmmc_v2.0: ["AU.L2-3.3.1"]
      - hipaa: ["164.312(b)"]
      - iso_27001-2013: ["A.12.4.1"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1070", "T1070.002", "T1562", "T1562.001"]
      - nist_sp_800-53: ["AU-7"]
      - pci_dss_v3.2.1: ["10.2", "10.3"]
      - pci_dss_v4.0: ["10.2.1", "10.2.1.1", "10.2.1.2", "10.2.1.3", "10.2.1.4", "10.2.1.5", "10.2.1.6", "10.2.1.7", "10.2.2", "5.3.4", "6.4.1", "6.4.2"]
    condition: all
    rules:
      - "c:systemctl is-enabled systemd-journald.service -> r:^static"

  # 5.1.1.3 Ensure journald is configured to compress large log files. (Automated)
  - id: 19155
    title: "確保journald配置為壓縮大型日誌檔案。"
    description: "日誌系統具有壓縮過大檔案的功能，以避免日誌填滿系統或使日誌過大而難以管理。"
    rationale: "未壓縮的大檔案可能會意外填滿檔案系統，從而導致資源不可用。在寫入之前壓縮日誌可以防止突然的、意外的檔案系統影響。"
    remediation: "編輯 /etc/systemd/journald.conf 檔或者 /etc/systemd/journald.conf.d/ 目錄下以 .conf 結尾的檔案，新增以下這一行: Compress=yes 重新啟動服務: # systemctl restart systemd-journald."
    compliance:
      - cis: ["5.1.1.3"]
      - cis_csc_v8: ["8.2", "8.3"]
      - cis_csc_v7: ["6.2", "6.3", "6.4"]
      - cmmc_v2.0: ["AU.L2-3.3.1"]
      - hipaa: ["164.312(b)"]
      - iso_27001-2013: ["A.12.4.1"]
      - mitre_mitigations: ["M1053"]
      - mitre_tactics: ["TA0040"]
      - mitre_techniques: ["T1562", "T1562.002"]
      - nist_sp_800-53: ["AU-7"]
      - pci_dss_v3.2.1: ["10.2", "10.3", "10.7"]
      - pci_dss_v4.0: ["10.2.1", "10.2.1.1", "10.2.1.2", "10.2.1.3", "10.2.1.4", "10.2.1.5", "10.2.1.6", "10.2.1.7", "10.2.2", "5.3.4", "6.4.1", "6.4.2"]
      - soc_2: ["A1.1"]
    condition: any
    rules:
      - "f:/etc/systemd/journald.conf -> r:^Compress=yes"
      - 'd:/etc/systemd/journald.conf.d -> r:\.* -> r:^Compress=yes'

  # 5.1.1.4 Ensure journald is configured to write logfiles to persistent disk. (Automated)
  - id: 19156
    title: "確保journald配置為將日誌檔案寫入永久磁碟。"
    description: "來自日誌的資料可能儲存在易失性記憶體中或保留在伺服器本地。系統重新啟動後，記憶體中的日誌將會遺失。透過將日誌儲存到伺服器上的本機磁碟，可以防止日誌因重新啟動而遺失。"
    rationale: "將日誌資料寫入磁碟將提供取證重建事件的能力，即使在系統當機或重新啟動後，這些事件也可能影響系統的操作或安全性。"
    remediation: "編輯 /etc/systemd/journald.conf 檔案或 /etc/systemd/journald.conf.d/ 中以 .conf 結尾的檔案，並添加以下行：Storage=persistent 重新啟動服務：# systemctl restart systemd-journald."
    compliance:
      - cis: ["5.1.1.4"]
      - cis_csc_v8: ["8.2"]
      - cis_csc_v7: ["6.2", "6.3"]
      - cmmc_v2.0: ["AU.L2-3.3.1"]
      - hipaa: ["164.312(b)"]
      - iso_27001-2013: ["A.12.4.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1070", "T1070.002", "T1562", "T1562.006"]
      - nist_sp_800-53: ["AU-7"]
      - pci_dss_v3.2.1: ["10.2", "10.3"]
      - pci_dss_v4.0: ["10.2.1", "10.2.1.1", "10.2.1.2", "10.2.1.3", "10.2.1.4", "10.2.1.5", "10.2.1.6", "10.2.1.7", "10.2.2", "5.3.4", "6.4.1", "6.4.2"]
    condition: any
    rules:
      - "f:/etc/systemd/journald.conf -> r:^Storage=persistent"
      - 'd:/etc/systemd/journald.conf.d -> r:\.* -> r:^Storage=persistent'

  # 5.1.1.5 Ensure journald is not configured to send logs to rsyslog. (Manual)
  - id: 19157
    title: "確保journald未配置為將日誌傳送到rsyslog。"
    description: "來自日誌的資料應保存在服務範圍內，而不是轉發到其他服務。"
    rationale: "如果journald是捕獲日誌的方法，則系統的所有日誌都應該由journald處理，而不是轉送到其他日誌機制。"
    remediation: "編輯 /etc/systemd/journald.conf 檔案以及 /etc/systemd/journald.conf.d/ 內的檔案，確保移除 ForwardToSyslog=yes。重啟服務：# systemctl restart systemd-journald。"
    compliance:
      - cis: ["5.1.1.5"]
      - cis_csc_v8: ["8.2", "8.9"]
      - cis_csc_v7: ["6.2", "6.3", "6.5"]
      - cmmc_v2.0: ["AU.L2-3.3.1"]
      - hipaa: ["164.312(b)"]
      - iso_27001-2013: ["A.12.4.1"]
      - mitre_mitigations: ["M1029"]
      - mitre_tactics: ["TA0040"]
      - mitre_techniques: ["T1070", "T1070.002", "T1562", "T1562.006"]
      - nist_sp_800-53: ["AU-6(3)", "AU-7"]
      - pci_dss_v3.2.1: ["10.2", "10.3", "10.5.3", "10.5.4"]
      - pci_dss_v4.0: ["10.2.1", "10.2.1.1", "10.2.1.2", "10.2.1.3", "10.2.1.4", "10.2.1.5", "10.2.1.6", "10.2.1.7", "10.2.2", "10.3.3", "5.3.4", "6.4.1", "6.4.2"]
      - soc_2: ["PL1.4"]
    condition: any
    rules:
      - 'not f:/etc/systemd/journald.conf -> !r:^# && r:ForwardToSyslog\s*=\s*yes'
      - 'not d:/etc/systemd/journald.conf.d -> r:\.* -> !r:^# && r:ForwardToSyslog\s*=\s*yes'

  # 5.1.1.6 Ensure journald log rotation is configured per site policy. (Manual)
  - id: 19158
    title: "確保按站點策略配置日誌日誌輪換。"
    description: "Journald 具有定期輪換日誌檔案的功能，以避免日誌填滿系統或使日誌過大而難以管理。檔案 /etc/systemd/journald.conf 是用於指定 Journald 產生的日誌應如何輪換的設定檔。"
    rationale: "透過使日誌檔案更小且更易於管理，系統管理員可以輕鬆地將這些檔案歸檔到另一個系統，並花費更少的時間查看過大的日誌檔案。"
    remediation: "檢查 /etc/systemd/journald.conf 以確保日誌依據站點政策進行輪換。需要仔細理解這些設置，因有特定的邊界情況和參數優先級。日誌輪換的特定參數包括：SystemMaxUse= SystemKeepFree= RuntimeMaxUse= RuntimeKeepFree= MaxFileSec=."
    compliance:
      - cis: ["5.1.1.6"]
      - cis_csc_v8: ["8.2"]
      - cis_csc_v7: ["6.2", "6.3"]
      - cmmc_v2.0: ["AU.L2-3.3.1"]
      - hipaa: ["164.312(b)"]
      - iso_27001-2013: ["A.12.4.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0040"]
      - mitre_techniques: ["T1070", "T1070.002"]
      - nist_sp_800-53: ["AU-7"]
      - pci_dss_v3.2.1: ["10.2", "10.3"]
      - pci_dss_v4.0: ["10.2.1", "10.2.1.1", "10.2.1.2", "10.2.1.3", "10.2.1.4", "10.2.1.5", "10.2.1.6", "10.2.1.7", "10.2.2", "5.3.4", "6.4.1", "6.4.2"]
    condition: all
    rules:
      - "f:/etc/systemd/journald.conf -> r:SystemMaxUse="
      - "f:/etc/systemd/journald.conf -> r:SystemKeepFree="
      - "f:/etc/systemd/journald.conf -> r:RuntimeMaxUse="
      - "f:/etc/systemd/journald.conf -> r:RuntimeKeepFree="
      - "f:/etc/systemd/journald.conf -> r:MaxFileSec="

  # 5.1.1.7 Ensure journald default file permissions configured. (Manual) - Not Implemented

  # 5.1.2.1 Ensure rsyslog is installed. (Automated)
  - id: 19159
    title: "確保 rsyslog 已安裝。"
    description: "在journald不​​能滿足運行要求的環境下，建議使用rsyslog軟體。"
    rationale: "rsyslog 的安全性增強功能（例如面向連接（即TCP）的日誌傳輸、記錄到資料庫格式的選項以及在發送到中央日誌記錄伺服器的途中對日誌資料進行加密）證明了安裝和配置該軟體包的合理性。"
    remediation: "執行以下指令安裝 rsyslog: # apt install rsyslog."
    compliance:
      - cis: ["5.1.2.1"]
      - cis_csc_v8: ["8.2"]
      - cis_csc_v7: ["6.2", "6.3"]
      - cmmc_v2.0: ["AU.L2-3.3.1"]
      - hipaa: ["164.312(b)"]
      - iso_27001-2013: ["A.12.4.1"]
      - mitre_mitigations: ["M1028"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1005", "T1070", "T1070.002"]
      - nist_sp_800-53: ["AU-7"]
      - pci_dss_v3.2.1: ["10.2", "10.3"]
      - pci_dss_v4.0: ["10.2.1", "10.2.1.1", "10.2.1.2", "10.2.1.3", "10.2.1.4", "10.2.1.5", "10.2.1.6", "10.2.1.7", "10.2.2", "5.3.4", "6.4.1", "6.4.2"]
    condition: all
    rules:
      - "c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' rsyslog -> r:install ok installed"

  # 5.1.2.2 Ensure rsyslog service is enabled. (Automated)
  - id: 19160
    title: "確保 rsyslog 服務已啟用。"
    description: "安裝 rsyslog 軟體包後，請確保啟用該服務。"
    rationale: "如果 rsyslog 服務未啟用在啟動時啟動，系統將不會擷取日誌記錄事件。"
    remediation: "運行以下指令以啟用 rsyslog: # systemctl --now enable rsyslog."
    compliance:
      - cis: ["5.1.2.2"]
      - cis_csc_v8: ["8.2"]
      - cis_csc_v7: ["6.2", "6.3"]
      - cmmc_v2.0: ["AU.L2-3.3.1"]
      - hipaa: ["164.312(b)"]
      - iso_27001-2013: ["A.12.4.1"]
      - mitre_mitigations: ["M1028"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1070", "T1070.002", "T1562", "T1562.001"]
      - nist_sp_800-53: ["AU-7"]
      - pci_dss_v3.2.1: ["10.2", "10.3"]
      - pci_dss_v4.0: ["10.2.1", "10.2.1.1", "10.2.1.2", "10.2.1.3", "10.2.1.4", "10.2.1.5", "10.2.1.6", "10.2.1.7", "10.2.2", "5.3.4", "6.4.1", "6.4.2"]
    condition: all
    rules:
      - "c:systemctl is-enabled rsyslog -> r:^enabled"

  # 5.1.2.3 Ensure journald is configured to send logs to rsyslog. (Manual)
  - id: 19161
    title: "確保journald配置為將日誌傳送到rsyslog。"
    description: "來自日誌的資料可能儲存在易失性記憶體中或保留在伺服器本地。存在接受日誌日誌遠端匯出的實用程序，但是，使用 RSyslog 服務提供了一致的日誌收集和匯出方法。"
    rationale: "如果RSyslog是捕獲日誌的首選方法，則系統的所有日誌都應發送給它進行進一步處理。"
    remediation: "編輯 /etc/systemd/journald.conf 檔案並新增以下行：ForwardToSyslog=yes 重新啟動服務：# systemctl restart rsyslog."
    compliance:
      - cis: ["5.1.2.3"]
      - cis_csc_v8: ["8.2", "8.9"]
      - cis_csc_v7: ["6.2", "6.3", "6.5"]
      - cmmc_v2.0: ["AU.L2-3.3.1"]
      - hipaa: ["164.312(b)"]
      - iso_27001-2013: ["A.12.4.1"]
      - mitre_mitigations: ["M1029"]
      - mitre_tactics: ["TA0040"]
      - mitre_techniques: ["T1070", "T1070.002", "T1562", "T1562.006"]
      - nist_sp_800-53: ["AU-6(3)", "AU-7"]
      - pci_dss_v3.2.1: ["10.2", "10.3", "10.5.3", "10.5.4"]
      - pci_dss_v4.0: ["10.2.1", "10.2.1.1", "10.2.1.2", "10.2.1.3", "10.2.1.4", "10.2.1.5", "10.2.1.6", "10.2.1.7", "10.2.2", "10.3.3", "5.3.4", "6.4.1", "6.4.2"]
      - soc_2: ["PL1.4"]
    condition: all
    rules:
      - 'f:/etc/systemd/journald.conf -> r:^\s*\t*ForwardToSyslog\s*=\s*yes'

  # 5.1.2.4 Ensure rsyslog default file permissions are configured. (Automated)
  - id: 19162
    title: "確保配置了 rsyslog 預設檔權限。"
    description: "RSyslog 將建立系統上尚未存在的日誌檔案。此設定控制將哪些權限套用至這些新建立的檔案。"
    rationale: "確保日誌檔案具有正確的權限以確保敏感資料已歸檔和保護非常重要。"
    impact: "The systems global umask could override, but only making the file permissions stricter, what is configured in RSyslog with the FileCreateMode directive. RSyslog also has it's own $umask directive that can alter the intended file creation mode. In addition, consideration should be given to how FileCreateMode is used. Thus it is critical to ensure that the intended file creation mode is not overridden with less restrictive settings in /etc/rsyslog.conf, /etc/rsyslog.d/*conf files and that FileCreateMode is set before any file is created."
    remediation: "編輯 /etc/rsyslog.conf 或 /etc/rsyslog.d/ 中的專用 .conf 檔，並將 $FileCreateMode 設置為 0640 或更嚴格：$FileCreateMode 0640 重新啟動服務：# systemctl restart rsyslog."
    compliance:
      - cis: ["5.1.2.4"]
      - cis_csc_v8: ["3.3", "8.2"]
      - cis_csc_v7: ["5.1", "6.2", "6.3"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "AU.L2-3.3.1", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)", "164.312(b)"]
      - iso_27001-2013: ["A.12.4.1", "A.14.2.5", "A.8.1.3"]
      - mitre_mitigations: ["M1028"]
      - mitre_tactics: ["TA0007"]
      - mitre_techniques: ["T1070", "T1070.002", "T1083"]
      - nist_sp_800-53: ["AC-5", "AC-6", "AU-7"]
      - pci_dss_v3.2.1: ["10.2", "10.3", "7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "10.2.1", "10.2.1.1", "10.2.1.2", "10.2.1.3", "10.2.1.4", "10.2.1.5", "10.2.1.6", "10.2.1.7", "10.2.2", "5.3.4", "6.4.1", "6.4.2", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: any
    rules:
      - 'f:/etc/rsyslog.conf -> r:^\$FileCreateMode 06\d0|^\$FileCreateMode 04\d0|^\$FileCreateMode 02\d0|^\$FileCreateMode 00\d0 && r:^\$FileCreateMode 0\d40|^\$FileCreateMode 0\d00'
      - 'd:/etc/rsyslog.d/ -> r:\.*.conf -> r:^\$FileCreateMode 06\d0|^\$FileCreateMode 04\d0|^\$FileCreateMode 02\d0|^\$FileCreateMode 00\d0 && r:^\$FileCreateMode 0\d40|^\$FileCreateMode 0\d00'

  # 5.1.2.5 Ensure logging is configured. (Manual) - Not Implemented
  # 5.1.2.6 Ensure rsyslog is configured to send logs to a remote log host. (Manual) - Not Implemented

  # 5.1.2.7 Ensure rsyslog is not configured to receive logs from a remote client. (Automated)
  - id: 19163
    title: "確保 rsyslog 未配置為從遠端客戶端接收日誌。"
    description: "RSyslog 支援從遠端主機接收訊息的能力，從而充當日誌伺服器。客戶端不應從其他主機接收資料。"
    rationale: "如果客戶端配置為也接收資料，從而將其轉變為伺服器，則客戶端系統將在其操作邊界之外運行。"
    remediation: '如果在稽核部分中發現任何活動的日誌伺服器配置，修改那些檔案並移除稽核標記出的特定行。確保以下條目均不出現在 /etc/rsyslog.conf 或 /etc/rsyslog.d/*.conf 的任何檔案中。舊格式 $ModLoad imtcp $InputTCPServerRun 新格式 module(load="imtcp") input(type="imtcp" port="514") 重啟服務：# systemctl restart rsyslog.'
    compliance:
      - cis: ["5.1.2.7"]
      - cis_csc_v8: ["4.8", "8.2"]
      - cis_csc_v7: ["6.2", "6.3", "9.2"]
      - cmmc_v2.0: ["AU.L2-3.3.1", "CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - hipaa: ["164.312(b)"]
      - iso_27001-2013: ["A.12.4.1", "A.13.1.3"]
      - mitre_mitigations: ["M1028"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1070", "T1070.002", "T1562", "T1562.006"]
      - nist_sp_800-53: ["AU-7"]
      - pci_dss_v3.2.1: ["1.1.6", "1.2.1", "10.2", "10.3", "2.2.2", "2.2.5"]
      - pci_dss_v4.0: ["1.2.5", "10.2.1", "10.2.1.1", "10.2.1.2", "10.2.1.3", "10.2.1.4", "10.2.1.5", "10.2.1.6", "10.2.1.7", "10.2.2", "2.2.4", "5.3.4", "6.4.1", "6.4.2"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - 'not d:/etc/rsyslog.d -> r:\.*.conf$ -> !r:^# && r:module\(load="imtcp"\)|input\(type="imtcp" port="514"\)'
      - 'not f:/etc/rsyslog.conf -> !r:^# && r:module\(load="imtcp"\)|input\(type="imtcp" port="514"\)'

  # 5.1.3 Ensure all logfiles have appropriate access configured. (Automated) - Not Implemented

  # 5.2.1.1 Ensure auditd is installed. (Automated)
  - id: 19164
    title: "確保安裝了auditd。"
    description: "auditd 是 Linux 稽核系統的使用者空間元件。它負責將審計記錄寫入磁碟。"
    rationale: "系統事件的捕獲為系統管理員提供了資訊，使他們能夠確定是否正在發生對其系統的未經授權的存取。"
    remediation: "運行以下指令來安裝 auditd # apt install auditd。"
    compliance:
      - cis: ["5.2.1.1"]
      - cis_csc_v8: ["8.5"]
      - cis_csc_v7: ["6.2"]
      - cmmc_v2.0: ["AU.L2-3.3.1"]
      - iso_27001-2013: ["A.12.4.1"]
      - mitre_mitigations: ["M1028"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1562", "T1562.001"]
      - nist_sp_800-53: ["AU-3(1)", "AU-7"]
      - pci_dss_v3.2.1: ["10.1", "10.2.2", "10.2.4", "10.2.5", "10.3"]
      - pci_dss_v4.0: ["10.2", "10.2.1", "10.2.1.2", "10.2.1.5", "9.4.5"]
      - soc_2: ["CC5.2", "CC7.2"]
    condition: all
    rules:
      - "c:dpkg-query -W -f='${binary:Package}\\t${Status}\\t${db:Status-Status}\\n' auditd -> r: install ok installed"

  # 5.2.1.2 Ensure auditd service is enabled and active. (Automated)
  - id: 19165
    title: "確保auditd服務已啟用並處於活動狀態。"
    description: "開啟auditd守護程式來記錄系統事件。"
    rationale: "系統事件的捕獲為系統管理員提供了資訊，使他們能夠確定是否正在發生對其系統的未經授權的存取。"
    remediation: "運行以下指令來啟用並啟動auditd: # systemctl --now enable auditd."
    compliance:
      - cis: ["5.2.1.2"]
      - cis_csc_v8: ["8.2"]
      - cis_csc_v7: ["6.2", "6.3"]
      - cmmc_v2.0: ["AU.L2-3.3.1"]
      - hipaa: ["164.312(b)"]
      - iso_27001-2013: ["A.12.4.1"]
      - mitre_mitigations: ["M1028"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1562", "T1562.001"]
      - nist_sp_800-53: ["AU-7"]
      - pci_dss_v3.2.1: ["10.2", "10.3"]
      - pci_dss_v4.0: ["10.2.1", "10.2.1.1", "10.2.1.2", "10.2.1.3", "10.2.1.4", "10.2.1.5", "10.2.1.6", "10.2.1.7", "10.2.2", "5.3.4", "6.4.1", "6.4.2"]
    condition: all
    rules:
      - "c:systemctl is-enabled auditd -> r:^enabled"
      - "c:systemctl is-active auditd -> r:^active"

  # 5.2.1.3 Ensure auditing for processes that start prior to auditd is enabled. (Automated)
  - id: 19166
    title: "確保啟用對在auditd之前啟動的程序進行審核。"
    description: "配置 grub2，以便能夠審核能夠被審核的程序，即使它們在auditd 啟動之前啟動也是如此。"
    rationale: "需要在auditd之前啟動的程序上捕獲審核事件，以便潛在的惡意活動不會被偵測不到。"
    remediation: '編輯 /etc/default/grub 並在 GRUB_CMDLINE_LINUX 中添加 audit=1： 例如：GRUB_CMDLINE_LINUX="audit=1" 執行以下指令來更新 grub2 配置：# update-grub.'
    compliance:
      - cis: ["5.2.1.3"]
      - cis_csc_v8: ["8.2"]
      - cis_csc_v7: ["6.2"]
      - cmmc_v2.0: ["AU.L2-3.3.1"]
      - hipaa: ["164.312(b)"]
      - iso_27001-2013: ["A.12.4.1"]
      - mitre_mitigations: ["M1047"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1562", "T1562.001"]
      - nist_sp_800-53: ["AU-7"]
      - pci_dss_v3.2.1: ["10.2", "10.3"]
      - pci_dss_v4.0: ["10.2.1", "10.2.1.1", "10.2.1.2", "10.2.1.3", "10.2.1.4", "10.2.1.5", "10.2.1.6", "10.2.1.7", "10.2.2", "5.3.4", "6.4.1", "6.4.2"]
    condition: all
    rules:
      - 'not f:/boot/grub/grub.cfg -> r:^\s*\t*linux && !r:audit=1'

  # 5.2.1.4 Ensure audit_backlog_limit is sufficient. (Automated)
  - id: 19167
    title: "確保audit_backlog_limit足夠。"
    description: "在核心級審計子系統中，套接字緩衝佇列用於保存稽核事件。每當收到新的審核事件時，都會記錄該事件並準備將其新增至此佇列。核心啟動參數audit_backlog_limit=N，其中N代表訊息量，將確保佇列無法成長超過一定的大小。如果記錄的審核事件會使佇列成長超出此限制，則會發生故障並根據系統配置進行處理。"
    rationale: "如果記錄的審核事件會使佇列成長超出audit_backlog_limit，則會發生故障，auditd 記錄將會遺失，並且可能無法偵測到潛在的惡意活動。"
    remediation: '編輯 /etc/default/grub 並將 audit_backlog_limit=N 添加到 GRUB_CMDLINE_LINUX。建議的 N 值為 8192 或更大。範例: GRUB_CMDLINE_LINUX="audit_backlog_limit=8192" 執行以下指令來更新 grub2 配置: # update-grub.'
    compliance:
      - cis: ["5.2.1.4"]
      - cis_csc_v8: ["8.2"]
      - cis_csc_v7: ["6.2", "6.3"]
      - cmmc_v2.0: ["AU.L2-3.3.1"]
      - hipaa: ["164.312(b)"]
      - iso_27001-2013: ["A.12.4.1"]
      - mitre_mitigations: ["M1028", "M1047"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1562", "T1562.001"]
      - nist_sp_800-53: ["AU-7"]
      - pci_dss_v3.2.1: ["10.2", "10.3"]
      - pci_dss_v4.0: ["10.2.1", "10.2.1.1", "10.2.1.2", "10.2.1.3", "10.2.1.4", "10.2.1.5", "10.2.1.6", "10.2.1.7", "10.2.2", "5.3.4", "6.4.1", "6.4.2"]
    condition: all
    rules:
      - 'not f:/boot/grub/grub.cfg -> r:^\s*\t*linux && !r:audit_backlog_limit'

  # 5.2.2.1 Ensure audit log storage size is configured. (Automated)
  - id: 19168
    title: "確保配置審核日誌儲存大小。"
    description: "配置審核日誌檔案的最大大小。一旦日誌達到最大大小，它將被輪換並啟動新的日誌檔案。"
    rationale: "為日誌檔案確定適當的大小非常重要，這樣它們就不會影響系統並且審計資料也不會遺失。"
    remediation: "根據站點政策，請在 /etc/audit/auditd.conf 中設置以下參數: max_log_file = <MB>."
    compliance:
      - cis: ["5.2.2.1"]
      - cis_csc_v8: ["8.3"]
      - cis_csc_v7: ["6.4"]
      - iso_27001-2013: ["A.12.4.1"]
      - mitre_mitigations: ["M1047"]
      - mitre_tactics: ["TA0040"]
      - mitre_techniques: ["T1562", "T1562.006"]
      - pci_dss_v3.2.1: ["10.7"]
      - soc_2: ["A1.1"]
    condition: all
    rules:
      - "d:/etc/audit"
      - "f:/etc/audit/auditd.conf"
      - 'f:/etc/audit/auditd.conf -> r:^\s*\t*max_log_file\s*\t*=\s*\t*\d+'

  # 5.2.2.2 Ensure audit logs are not automatically deleted. (Automated)
  - id: 19169
    title: "確保審核日誌不會自動刪除。"
    description: "max_log_file_action 設定決定如何處理達到最大檔案大小的審核日誌檔案。 keep_logs 的值將輪換日誌，但永遠不會刪除舊日誌。"
    rationale: "在高安全性環境中，維護較長審計歷史記錄的好處超過了儲存審計歷史記錄的成本。"
    remediation: "在 /etc/audit/auditd.conf 中設定以下參數：max_log_file_action = keep_logs。"
    compliance:
      - cis: ["5.2.2.2"]
      - cis_csc_v8: ["8.3"]
      - cis_csc_v7: ["6.4"]
      - iso_27001-2013: ["A.12.4.1"]
      - mitre_mitigations: ["M1047"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1562", "T1562.006"]
      - pci_dss_v3.2.1: ["10.7"]
      - soc_2: ["A1.1"]
    condition: all
    rules:
      - "d:/etc/audit"
      - "f:/etc/audit/auditd.conf"
      - 'f:/etc/audit/auditd.conf -> r:^\s*\t*max_log_file_action\s*\t*=\s*\t*keep_logs'

  # 5.2.2.3 Ensure system is disabled when audit logs are full. (Automated)
  - id: 19170
    title: "確保審核日誌已滿時停用系統。"
    description: "可以將auditd 守護程式設定為在審核日誌已滿時停止系統。 admin_space_left_action 參數告訴系統當系統偵測到磁碟空間不足時要採取什麼動作。有效值為「忽略」、「系統日誌」、「掛起」、「單一」和「停止」。 -ignore，審計守護程序不執行任何操作-Syslog，審計守護程序將向syslog 發出警告-Suspend，審計守護程序將停止將記錄寫入磁碟-single，審計守護程序將電腦系統置於單用戶模式-halt ，稽核守護程序將關閉系統。"
    rationale: "在高安全性環境中，偵測未經授權的存取或不可否認性的風險超過了系統可用性的好處。"
    impact: "If the admin_space_left_action parameter is set to halt the audit daemon will shutdown the system when the disk partition containing the audit logs becomes full."
    remediation: "在 /etc/audit/auditd.conf 中設置以下參數: space_left_action = email action_mail_acct = root 在 /etc/audit/auditd.conf 中將 admin_space_left_action 設置為 halt 或 single。例如: admin_space_left_action = halt."
    compliance:
      - cis: ["5.2.2.3"]
      - cis_csc_v8: ["8.2", "8.3"]
      - cis_csc_v7: ["6.4"]
      - cmmc_v2.0: ["AU.L2-3.3.1"]
      - hipaa: ["164.312(b)"]
      - iso_27001-2013: ["A.12.4.1"]
      - mitre_mitigations: ["M1028"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1562", "T1562.006"]
      - nist_sp_800-53: ["AU-7"]
      - pci_dss_v3.2.1: ["10.2", "10.3", "10.7"]
      - pci_dss_v4.0: ["10.2.1", "10.2.1.1", "10.2.1.2", "10.2.1.3", "10.2.1.4", "10.2.1.5", "10.2.1.6", "10.2.1.7", "10.2.2", "5.3.4", "6.4.1", "6.4.2"]
      - soc_2: ["A1.1"]
    condition: all
    rules:
      - 'f:/etc/audit/auditd.conf -> r:^\s*space_left_action\s*=\s*email'
      - 'f:/etc/audit/auditd.conf -> r:^\s*action_mail_acct\s*=\s*root'
      - 'f:/etc/audit/auditd.conf -> r:^\s*admin_space_left_action\s*=\s*halt|^\s*admin_space_left_action\s*=\s*single'

  # 5.2.3.1 Ensure changes to system administration scope (sudoers) is collected. (Automated)
  - id: 19171
    title: "確保收集對系統管理範圍 (sudoers) 的變更。"
    description: '監視系統管理員的範圍變化。如果系統已正確配置為強制系統管理員首先以自己的身分登入，然後使用 sudo 指令執行特權指令，則可以監視範圍的變更。當檔案或相關屬性發生變更時，將寫入檔案 /etc/sudoers 或 /etc/sudoers.d 中的檔案。審計記錄將標有識別字“範圍”。'
    rationale: "/etc/sudoers 和 /etc/sudoers.d 檔案中的變更可能表示對系統管理員活動範圍進行了未經授權的更改。"
    remediation: "編輯或創建 /etc/audit/rules.d/ 目錄中的一個檔案，檔案名以 .rules 為副檔名，並添加相關規則以監控系統管理員的範圍變更。示例： # printf \" -w /etc/sudoers -p wa -k scope -w /etc/sudoers.d -p wa -k scope \" >> /etc/audit/rules.d/50-scope.rules 合併並載入規則到活動配置中：# augenrules --load 檢查是否需要重啟。# if [[ $(auditctl -s | grep \"enabled\") =~ \"2\" ]]; then printf \"Reboot required to load rules\\n\"; fi."
    compliance:
      - cis: ["5.2.3.1"]
      - cis_csc_v8: ["8.5"]
      - cis_csc_v7: ["4.8"]
      - cmmc_v2.0: ["AU.L2-3.3.1"]
      - iso_27001-2013: ["A.12.4.3"]
      - mitre_mitigations: ["M1047"]
      - mitre_tactics: ["TA0004"]
      - mitre_techniques: ["T1562", "T1562.006"]
      - nist_sp_800-53: ["AU-3(1)", "AU-7"]
      - pci_dss_v3.2.1: ["10.1", "10.2.2", "10.2.4", "10.2.5", "10.3"]
      - pci_dss_v4.0: ["10.2", "10.2.1", "10.2.1.2", "10.2.1.5", "9.4.5"]
      - soc_2: ["CC5.2", "CC7.2"]
    condition: all
    rules:
      - "d:/etc/audit/rules.d"
      - 'd:/etc/audit/rules.d -> r:\.+.rules$'
      - 'd:/etc/audit/rules.d -> r:\.+.rules$ -> r:^-w && r:/etc/sudoers && r:-p wa && r:-k scope|key=\\s*\t*scope'
      - 'd:/etc/audit/rules.d -> r:\.+.rules$ -> r:^-w && r:/etc/sudoers.d && r:-p wa && r:-k scope|key=\\s*\t*scope'
      - 'c:auditctl -l -> r:^-w && r:/etc/sudoers && r:-p wa && r:-k scope|key=\\s*\t*scope'
      - 'c:auditctl -l -> r:^-w && r:/etc/sudoers.d && r:-p wa && r:-k scope|key=\\s*\t*scope'

  # 5.2.3.2 Ensure actions as another user are always logged. (Automated)
  - id: 19172
    title: "確保始終記錄其他使用者的操作。"
    description: "sudo 會為使用者提供臨時提升的權限來執行操作，無論是作為超級使用者或其他使用者。"
    rationale: "建立具有臨時提升權限的使用者及其執行的操作的審核日誌對於報告至關重要。管理員希望將寫入稽核追蹤的事件與寫入 sudo 日誌檔案的記錄相關聯，以驗證是否執行了未經授權的指令。"
    remediation: "建立審計規則 編輯或建立放在 /etc/audit/rules.d/ 目錄裡，副檔名為 .rules 的檔案，並添加監控提升權限的相關規則。 64 位元系統 範例： # printf \" -a always,exit -F arch=b64 -C euid!=uid -F auid!=unset -S execve -k user_emulation -a always,exit -F arch=b32 -C euid!=uid -F auid!=unset -S execve -k user_emulation \" >> /etc/audit/rules.d/50-user_emulation.rules 載入審計規則 合併並載入規則到活動配置： # augenrules --load 檢查是否需要重新開機。 # if [[ $(auditctl -s | grep \"enabled\") =~ \"2\" ]]; then printf \"Reboot required to load rules\\n\"; fi 32 位元系統 按照 64 位元系統的相同程序操作，並忽略所有包含 b64 的條目。"
    compliance:
      - cis: ["5.2.3.2"]
      - cis_csc_v8: ["8.5"]
      - cis_csc_v7: ["4.9"]
      - cmmc_v2.0: ["AU.L2-3.3.1"]
      - iso_27001-2013: ["A.9.4.2"]
      - mitre_mitigations: ["M1047"]
      - mitre_tactics: ["TA0004"]
      - mitre_techniques: ["T1562", "T1562.006"]
      - nist_sp_800-53: ["AU-3(1)", "AU-7"]
      - pci_dss_v3.2.1: ["10.1", "10.2.2", "10.2.4", "10.2.5", "10.3"]
      - pci_dss_v4.0: ["10.2", "10.2.1", "10.2.1.2", "10.2.1.5", "9.4.5"]
      - soc_2: ["CC5.2", "CC7.2"]
    condition: all
    rules:
      - "d:/etc/audit/rules.d"
      - 'd:/etc/audit/rules.d -> r:\.+.rules$'
      - 'd:/etc/audit/rules.d -> r:\.+.rules$ -> r:^-a && r:exit,always|always,exit && r:-F arch=b64 && r:-C euid!=uid|-C uid!=euid  && r:-F auid!=unset|-F auid!=-1|-F auid!=4294967295 && r:-S execve && r:-k user_emulation|key=user_emulation'
      - 'd:/etc/audit/rules.d -> r:\.+.rules$ -> r:^-a && r:exit,always|always,exit && r:-F arch=b32 && r:-C euid!=uid|-C uid!=euid  && r:-F auid!=unset|-F auid!=-1|-F auid!=4294967295 && r:-S execve && r:-k user_emulation|key=user_emulation'
      - "c:auditctl -l -> r:^-a && r:exit,always|always,exit && r:-F arch=b64 && r:-C euid!=uid|-C uid!=euid && r:-F auid!=unset|-F auid!=-1|-F auid!=4294967295 && r:-S execve && r:-k user_emulation|key=user_emulation"
      - "c:auditctl -l -> r:^-a && r:exit,always|always,exit && r:-F arch=b32 && r:-C euid!=uid|-C uid!=euid && r:-F auid!=unset|-F auid!=-1|-F auid!=4294967295 && r:-S execve && r:-k user_emulation|key=user_emulation"

  # 5.2.3.3 Ensure events that modify the sudo log file are collected. (Automated) - Not Implemented

  # 5.2.3.4 Ensure events that modify date and time information are collected. (Automated)
  - id: 19173
    title: "確保收集修改日期和時間資訊的事件。"
    description: '捕獲系統日期和/或時間已修改的事件。本節中的參數設定以確定是否； - adjtimex - 調整內核時鐘 - settimeofday - 使用 timeval 和時區結構設定時間 - stime - 使用自 1970 年 1 月 1 日以來的秒數 - Clock_settime - 允許設定多個內部時脈和計時器 已執行的系統呼叫。此外，請確保在退出時將審核記錄寫入配置的審核日誌檔案，並使用唯一識別碼（例如「時間變更」）標記記錄。'
    rationale: "系統日期和/或時間的意外變更可能是系統上存在惡意活動的跡象。"
    remediation: '創建審計規則 在 /etc/audit/rules.d/ 目錄中編輯或創建一個以 .rules 為副檔名的檔案，並使用相關規則來監控修改日期和時間資訊的事件。 64 位系統 示例： # printf " -a always,exit -F arch=b64 -S adjtimex,settimeofday,clock_settime -k time-change -a always,exit -F arch=b32 -S adjtimex,settimeofday,clock_settime -k time-change -w /etc/localtime -p wa -k time-change " >> /etc/audit/rules.d/50-time-change.rules 載入審計規則 合併並載入規則進入有效配置： # augenrules --load 檢查是否需要重啟。 # if [[ $(auditctl -s | grep \"enabled\") =~ \"2\" ]]; then printf \"Reboot required to load rules\\n\"; fi 32 位系統 請按照與 64 位系統相同的步驟操作，並忽略任何帶有 b64 的條目。此外，將 stime 添加到系統調用審計中。 示例： -a always,exit -F arch=b32 -S adjtimex,settimeofday,clock_settime,stime -k time-change.'
    compliance:
      - cis: ["5.2.3.4"]
      - cis_csc_v8: ["8.5"]
      - cis_csc_v7: ["5.5"]
      - cmmc_v2.0: ["AU.L2-3.3.1"]
      - iso_27001-2013: ["A.12.1.2"]
      - mitre_mitigations: ["M1047"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1562", "T1562.006"]
      - nist_sp_800-53: ["AU-3(1)", "AU-7"]
      - pci_dss_v3.2.1: ["10.1", "10.2.2", "10.2.4", "10.2.5", "10.3"]
      - pci_dss_v4.0: ["10.2", "10.2.1", "10.2.1.2", "10.2.1.5", "9.4.5"]
      - soc_2: ["CC5.2", "CC7.2"]
    condition: all
    rules:
      - "d:/etc/audit/rules.d"
      - 'd:/etc/audit/rules.d -> r:\.+.rules$'
      - 'd:/etc/audit/rules.d -> r:\.+.rules$ -> r:^-a && r:always,exit|exit,always && r:-F arch=b64 && r:-S && r:adjtimex && r:settimeofday && r:clock_settime && r:-k time-change|key=time-change'
      - 'd:/etc/audit/rules.d -> r:\.+.rules$ -> r:^-a && r:always,exit|exit,always && r:-F arch=b32 && r:-S && r:adjtimex && r:settimeofday && r:clock_settime && r:-k time-change|key=time-change'
      - 'd:/etc/audit/rules.d -> r:\.+.rules$ -> r:^-w && r:/etc/localtime && r:-p wa && r:-k time-change|key=time-change'
      - "c:auditctl -l -> r:^-a && r:always,exit|exit,always && r:-F arch=b64 && r:-S && r:adjtimex && r:settimeofday && r:clock_settime && r:-k time-change|key=time-change"
      - "c:auditctl -l -> r:^-a && r:always,exit|exit,always && r:-F arch=b32 && r:-S && r:adjtimex && r:settimeofday && r:clock_settime && r:-k time-change|key=time-change"
      - "c:auditctl -l -> r:^-w && r:/etc/localtime && r:-p wa && r:-k time-change|key=time-change"

  # 5.2.3.5 Ensure events that modify the system's network environment are collected. (Automated)
  - id: 19174
    title: "確保收集修改系統網路環境的事件。"
    description: "記錄網路環境檔案或系統呼叫的變更。以下參數監視以下系統調用，並在系統調用退出時寫入審核事件： - sethostname - 設定系統主機名稱 - setdomainname - 設定系統網域 被監視的檔案是： - /etc/issue 和 /etc/ issues.net -登入前顯示的訊息- /etc/hosts - 包含主機名稱和關聯IP 位址的檔案- /etc/networks - 網路的符號名稱- /etc/network/ - 包含網路介面腳本和設定檔的目錄。"
    rationale: "監視 sethostname 和 setdomainname 將識別對系統主機和網域的潛在未經授權的變更。更改這些名稱可能會破壞基於這些名稱設定的安全性參數。監視 /etc/hosts 檔案的更改，這些更改可能表明未經授權的入侵者正在嘗試更改電腦與 IP 位址的關聯，並誘騙使用者和程序連接到非預期的電腦。監視 /etc/issue 和 /etc/issue.net 非常重要，因為入侵者可能會將虛假資訊放入這些檔案中並誘騙用戶向入侵者提供資訊。監視 /etc/network 非常重要，因為它可以顯示網路介面或腳本是否已修改，從而導致電腦不可用或受到損害。所有審核記錄都應具有與其關聯的相關標籤。"
    remediation: "建立審計規則 在 /etc/audit/rules.d/ 目錄中編輯或創建一個以 .rules 副檔名結尾的檔案，並包含相應的規則以監控修改系統網路環境的事件。 64 位系統 示例： # printf \" -a always,exit -F arch=b64 -S sethostname,setdomainname -k system-locale -a always,exit -F arch=b32 -S sethostname,setdomainname -k system-locale -w /etc/issue -p wa -k system-locale -w /etc/issue.net -p wa -k system-locale -w /etc/hosts -p wa -k system-locale -w /etc/networks -p wa -k system-locale -w /etc/network/ -p wa -k system-locale \" >> /etc/audit/rules.d/50-system_locale.rules 載入審計規則 合併並載入規則到活動配置中： # augenrules --load 檢查是否需要重啟。 # if [[ $(auditctl -s | grep \"enabled\") =~ \"2\" ]]; then printf \"Reboot required to load rules\\n\"; fi 32 位系統 遵循與 64 位系統相同的程序，忽略任何帶有 b64 的條目。"
    compliance:
      - cis: ["5.2.3.5"]
      - cis_csc_v8: ["8.5"]
      - cis_csc_v7: ["5.5"]
      - cmmc_v2.0: ["AU.L2-3.3.1"]
      - iso_27001-2013: ["A.12.1.2"]
      - mitre_mitigations: ["M1047"]
      - mitre_tactics: ["TA0003"]
      - mitre_techniques: ["T1562", "T1562.006"]
      - nist_sp_800-53: ["AU-3(1)", "AU-7"]
      - pci_dss_v3.2.1: ["10.1", "10.2.2", "10.2.4", "10.2.5", "10.3"]
      - pci_dss_v4.0: ["10.2", "10.2.1", "10.2.1.2", "10.2.1.5", "9.4.5"]
      - soc_2: ["CC5.2", "CC7.2"]
    condition: all
    rules:
      - "d:/etc/audit/rules.d"
      - 'd:/etc/audit/rules.d -> r:\.+.rules$'
      - 'd:/etc/audit/rules.d -> r:\.+.rules$ -> r:^-a && r:exit,always|always,exit && r:-F arch=b32 && r:-S && r:sethostname && r:setdomainname && r:-k system-locale|key=system-locale'
      - 'd:/etc/audit/rules.d -> r:\.+.rules$ -> r:^-a && r:exit,always|always,exit && r:-F arch=b64 && r:-S && r:sethostname && r:setdomainname && r:-k system-locale|key=system-locale'
      - 'd:/etc/audit/rules.d -> r:\.+.rules$ -> r:^-w && r:/etc/issue && r:-p wa && r:-k system-locale|key=system-locale'
      - 'd:/etc/audit/rules.d -> r:\.+.rules$ -> r:^-w && r:/etc/issue.net && r:-p wa && r:-k system-locale|key=system-locale'
      - 'd:/etc/audit/rules.d -> r:\.+.rules$ -> r:^-w && r:/etc/hosts && r:-p wa && r:-k system-locale|key=system-locale'
      - 'd:/etc/audit/rules.d -> r:\.+.rules$ -> r:^-w && r:/etc/network && r:-p wa && r:-k system-locale|key=system-locale'
      - 'd:/etc/audit/rules.d -> r:\.+.rules$ -> r:^-w && r:/etc/networks/ && r:-p wa && r:-k system-locale|key=system-locale'
      - "c:auditctl -l -> r:^-a && r:exit,always|always,exit && r:-F arch=b64 && r:-S && r:sethostname && r:setdomainname && r:-k system-locale|-F key=system-locale"
      - "c:auditctl -l -> r:^-a && r:exit,always|always,exit && r:-F arch=b32 && r:-S && r:sethostname && r:setdomainname && r:-k system-locale|-F key=system-locale"
      - "c:auditctl -l -> r:^-w && r:/etc/issue && r:-p wa && r:-k system-locale|key=system-locale"
      - "c:auditctl -l -> r:^-w && r:/etc/issue.net && r:-p wa && r:-k system-locale|key=system-locale"
      - "c:auditctl -l -> r:^-w && r:/etc/hosts && r:-p wa && r:-k system-locale|key=system-locale"
      - "c:auditctl -l -> r:^-w && r:/etc/network && r:-p wa && r:-k system-locale|key=system-locale"
      - "c:auditctl -l -> r:^-w && r:/etc/networks && r:-p wa && r:-k system-locale|key=system-locale"

  # 5.2.3.6 Ensure use of privileged commands are collected. (Automated) - Not Implemented
  # 5.2.3.7 Ensure unsuccessful file access attempts are collected. (Automated) - Not Implemented

  # 5.2.3.8 Ensure events that modify user/group information are collected. (Automated)
  - id: 19175
    title: "確保收集修改使用者/群組資訊的事件。"
    description: '記錄影響使用者或群組資訊修改的事件，包括密碼和舊密碼（如果使用）的修改。 - /etc/group - 系統群組 - /etc/passwd - 系統使用者 - /etc/gshadow - 每個群組的加密密碼 - /etc/shadow - 系統使用者密碼 - /etc/security/opasswd - 舊密碼的儲存相關PAM 模組正在使用本節中的參數將監視檔案以查看它們是否已開啟以進行寫入或已進行屬性變更（例如權限），並在審核日誌檔案中使用識別碼「identity」對其進行標記。'
    rationale: "這些檔案的意外變更可能表示系統已受到損害，且未經授權的使用者正試圖隱藏其活動或損害其他帳戶。"
    remediation: "編輯或創建 /etc/audit/rules.d/ 目錄中的一個檔案，以 .rules 為副檔名，並包含相關規則以監控修改用戶/組資訊的事件。例如： # printf \" -w /etc/group -p wa -k identity -w /etc/passwd -p wa -k identity -w /etc/gshadow -p wa -k identity -w /etc/shadow -p wa -k identity -w /etc/security/opasswd -p wa -k identity \" >> /etc/audit/rules.d/50-identity.rules 將規則合併並載入到活動配置中： # augenrules --load 檢查是否需要重啟。 # if [[ $(auditctl -s | grep \"enabled\") =~ \"2\" ]]; then printf \"Reboot required to load rules\\n\"; fi."
    compliance:
      - cis: ["5.2.3.8"]
      - cis_csc_v8: ["8.5"]
      - cis_csc_v7: ["4.8"]
      - cmmc_v2.0: ["AU.L2-3.3.1"]
      - iso_27001-2013: ["A.12.4.3"]
      - mitre_mitigations: ["M1047"]
      - mitre_tactics: ["TA0004"]
      - mitre_techniques: ["T1562", "T1562.006"]
      - nist_sp_800-53: ["AU-3(1)", "AU-7"]
      - pci_dss_v3.2.1: ["10.1", "10.2.2", "10.2.4", "10.2.5", "10.3"]
      - pci_dss_v4.0: ["10.2", "10.2.1", "10.2.1.2", "10.2.1.5", "9.4.5"]
      - soc_2: ["CC5.2", "CC7.2"]
    condition: all
    rules:
      - "d:/etc/audit/rules.d"
      - 'd:/etc/audit/rules.d -> r:\.+.rules$'
      - 'd:/etc/audit/rules.d -> r:\.+.rules$ -> r:^-w && r:/etc/group && r:-p wa && r:-k identity|key=identity'
      - 'd:/etc/audit/rules.d -> r:\.+.rules$ -> r:^-w && r:/etc/passwd && r:-p wa && r:-k identity|key=identity'
      - 'd:/etc/audit/rules.d -> r:\.+.rules$ -> r:^-w && r:/etc/gshadow && r:-p wa && r:-k identity|key=identity'
      - 'd:/etc/audit/rules.d -> r:\.+.rules$ -> r:^-w && r:/etc/shadow && r:-p wa && r:-k identity|key=identity'
      - 'd:/etc/audit/rules.d -> r:\.+.rules$ -> r:^-w && r:/etc/security/opasswd && r:-p wa && r:-k identity|key=identity'
      - "c:auditctl -l -> r:^-w && r:/etc/group && r:-p wa && r:-k identity|key=identity"
      - "c:auditctl -l -> r:^-w && r:/etc/passwd && r:-p wa && r:-k identity|key=identity"
      - "c:auditctl -l -> r:^-w && r:/etc/gshadow && r:-p wa && r:-k identity|key=identity"
      - "c:auditctl -l -> r:^-w && r:/etc/shadow && r:-p wa && r:-k identity|key=identity"
      - "c:auditctl -l -> r:^-w && r:/etc/security/opasswd && r:-p wa && r:-k identity|key=identity"

  # 5.2.3.9 Ensure discretionary access control permission modification events are collected. (Automated) - Not Implemented

  # 5.2.3.10 Ensure successful file system mounts are collected. (Automated)
  - id: 19176
    title: "確保收集成功的檔案系統安裝。"
    description: "監控 mount 系統呼叫的使用情況。 mount（和umount）系統呼叫控製檔案系統的安裝和卸載。以下參數將系統配置為在非特權使用者使用 mount 系統呼叫時建立審核記錄。"
    rationale: "非特權使用者將檔案系統掛載到系統的情況非常罕見。雖然追蹤安裝指令為系統管理員提供了外部媒體可能已安裝的證據（基於對安裝來源的審查並確認其是外部介質類型），但它並不能最終表明資料已匯出到媒體。希望確定資料是否已匯出的系統管理員還必須追蹤需要對外部媒體檔案系統安裝點下的檔案進行寫入存取的成功開啟、建立和截斷系統呼叫。這可以清楚地表明發生了寫入。真正證明這一點的唯一方法是追蹤對外部媒體的成功寫入。追蹤寫入系統呼叫可能會快速填滿審核日誌，因此不建議這樣做。有關追蹤資料匯出到媒體的配置選項的建議超出了本檔案的範圍。"
    remediation: "創建審計規則 在 /etc/audit/rules.d/ 目錄下編輯或創建一個以 .rules 副檔名結尾的檔案，並包含監控成功檔案系統掛載的相關規則。 64 位系統 示例: # { UID_MIN=$(awk '/^\\s*UID_MIN/{print $2}' /etc/login.defs) [ -n \"${UID_MIN}\" ] && printf \" -a always,exit -F arch=b32 -S mount -F auid>=$UID_MIN -F auid!=unset -k mounts -a always,exit -F arch=b64 -S mount -F auid>=$UID_MIN -F auid!=unset -k mounts \" >> /etc/audit/rules.d/50-mounts.rules || printf \"ERROR: Variable 'UID_MIN' is unset.\\n\" } 載入審計規則 合併並載入規則到活動配置中: # augenrules --load 檢查是否需要重新啟動。 # if [[ $(auditctl -s | grep \"enabled\") =~ \"2\" ]]; then printf \"Reboot required to load rules\\n\"; fi 32 位系統 按照與 64 位系統相同的程序操作，並忽略任何帶有 b64 的條目。"
    compliance:
      - cis: ["5.2.3.10"]
      - cis_csc_v8: ["8.5"]
      - cis_csc_v7: ["6.3"]
      - cmmc_v2.0: ["AU.L2-3.3.1"]
      - iso_27001-2013: ["A.12.4.1"]
      - mitre_mitigations: ["M1034"]
      - mitre_tactics: ["TA0010"]
      - mitre_techniques: ["T1562", "T1562.006"]
      - nist_sp_800-53: ["CM-6"]
      - pci_dss_v3.2.1: ["10.1", "10.2.2", "10.2.4", "10.2.5", "10.3"]
      - pci_dss_v4.0: ["10.2", "10.2.1", "10.2.1.2", "10.2.1.5", "9.4.5"]
      - soc_2: ["CC5.2", "CC7.2"]
    condition: all
    rules:
      - "d:/etc/audit/rules.d"
      - 'd:/etc/audit/rules.d -> r:\.+.rules$'
      - 'd:/etc/audit/rules.d -> r:\.+.rules$ -> r:^-a && r:always,exit|exit,always && r:-F arch=b32 && r:-S mount && r:-F auid>=\d+ && r:-F auid!=-1|-F auid!=4294967295|-F auid!=unset && r:-k mounts|key=mounts'
      - 'd:/etc/audit/rules.d -> r:\.+.rules$ -> r:^-a && r:always,exit|exit,always && r:-F arch=b64 && r:-S mount && r:-F auid>=\d+ && r:-F auid!=-1|-F auid!=4294967295|-F auid!=unset && r:-k mounts|key=mounts'
      - 'c:auditctl -l -> r:^-a && r:always,exit|exit,always && r:-F arch=b64 && r:-S mount && r:-F auid>=\d+ && r:-F auid!=-1|-F auid!=4294967295|-F auid!=unset && r:-k mounts|key=mounts'
      - 'c:auditctl -l -> r:^-a && r:always,exit|exit,always && r:-F arch=b32 && r:-S mount && r:-F auid>=\d+ && r:-F auid!=-1|-F auid!=4294967295|-F auid!=unset && r:-k mounts|key=mounts'

  # 5.2.3.11 Ensure session initiation information is collected. (Automated)
  - id: 19177
    title: "確保收集會話啟動資訊。"
    description: '監視會話啟動事件。本節中的參數追蹤與會話事件關聯的檔案的變更。 - /var/run/utmp - 追蹤所有目前登入的使用者。 - /var/log/wtmp - 檔案追蹤登入、登出、關閉和重新啟動事件。 - /var/log/btmp - 追蹤失敗的登入嘗試，可以透過輸入指令 /usr/bin/last -f /var/log/btmp 來讀取。所有審核記錄都將標有識別字「會話」。'
    rationale: "監視這些檔案的變更可以提醒系統管理員在異常時間發生登入，這可能表示入侵者活動（即使用者在正常不登入的時間登入）。"
    remediation: "在 /etc/audit/rules.d/ 目錄中編輯或建立一個以 .rules 結尾的檔案，包含監控會話開始資訊的相關規則。例如：# printf \" -w /var/run/utmp -p wa -k session -w /var/log/wtmp -p wa -k session -w /var/log/btmp -p wa -k session \" >> /etc/audit/rules.d/50-session.rules 合併並載入規則到活躍配置：# augenrules --load 檢查是否需要重新啟動。# if [[ $(auditctl -s | grep \"enabled\") =~ \"2\" ]]; then printf \"Reboot required to load rules\\n\"; fi."
    compliance:
      - cis: ["5.2.3.11"]
      - cis_csc_v8: ["8.5"]
      - cis_csc_v7: ["4.9", "16.13"]
      - cmmc_v2.0: ["AU.L2-3.3.1"]
      - iso_27001-2013: ["A.9.4.2"]
      - mitre_mitigations: ["M1047"]
      - mitre_tactics: ["TA0001"]
      - mitre_techniques: ["T1562", "T1562.006"]
      - nist_sp_800-53: ["AU-3", "AU-3(1)"]
      - pci_dss_v3.2.1: ["10.1", "10.2.2", "10.2.4", "10.2.5", "10.3"]
      - pci_dss_v4.0: ["10.2", "10.2.1", "10.2.1.2", "10.2.1.5", "9.4.5"]
      - soc_2: ["CC5.2", "CC7.2"]
    condition: all
    rules:
      - "d:/etc/audit/rules.d"
      - 'd:/etc/audit/rules.d -> r:\.+.rules$'
      - 'd:/etc/audit/rules.d -> r:\.+.rules$ -> r:^-w && r:/var/run/utmp && r:-p wa && r:-k session|key=session'
      - 'd:/etc/audit/rules.d -> r:\.+.rules$ -> r:^-w && r:/var/log/wtmp && r:-p wa && r:-k session|key=session'
      - 'd:/etc/audit/rules.d -> r:\.+.rules$ -> r:^-w && r:/var/log/btmp && r:-p wa && r:-k session|key=session'
      - "c:auditctl -l -> r:^-w && r:/var/run/utmp && r:-p wa && r:-k session|key=session"
      - "c:auditctl -l -> r:^-w && r:/var/log/wtmp && r:-p wa && r:-k session|key=session"
      - "c:auditctl -l -> r:^-w && r:/var/log/btmp && r:-p wa && r:-k session|key=session"

  # 5.2.3.12 Ensure login and logout events are collected. (Automated)
  - id: 19178
    title: "確保收集登入和登出事件。"
    description: "監控登入和登出事件。以下參數追蹤與登入/登出事件關聯的檔案的變更。 - /var/log/lastlog - 維護使用者上次成功登入的記錄。"
    rationale: "監視登入/登出事件可以為系統管理員提供與針對使用者登入的暴力攻擊相關的資訊。"
    remediation: "編輯或建立一個在 /etc/audit/rules.d/ 目錄中的檔案，以 .rules 為副檔名，並使用相關規則來監控登入和登出事件。範例：# printf \" -w /var/log/lastlog -p wa -k logins -w /var/run/faillock -p wa -k logins \" >> /etc/audit/rules.d/50-login.rules 合併並將規則載入到活動配置中：# augenrules --load 檢查是否需要重新啟動。# if [[ $(auditctl -s | grep \"enabled\") =~ \"2\" ]]; then printf \"Reboot required to load rules\\n\"; fi."
    compliance:
      - cis: ["5.2.3.12"]
      - cis_csc_v8: ["8.5"]
      - cis_csc_v7: ["4.9", "16.11", "16.13"]
      - cmmc_v2.0: ["AU.L2-3.3.1"]
      - iso_27001-2013: ["A.8.1.3", "A.9.4.2"]
      - mitre_mitigations: ["M1047"]
      - mitre_tactics: ["TA0001"]
      - mitre_techniques: ["T1562", "T1562.006"]
      - nist_sp_800-53: ["AU-3", "AU-3(1)"]
      - pci_dss_v3.2.1: ["10.1", "10.2.2", "10.2.4", "10.2.5", "10.3"]
      - pci_dss_v4.0: ["10.2", "10.2.1", "10.2.1.2", "10.2.1.5", "9.4.5"]
      - soc_2: ["CC5.2", "CC7.2"]
    condition: all
    rules:
      - "d:/etc/audit/rules.d"
      - 'd:/etc/audit/rules.d -> r:\.+.rules$'
      - 'd:/etc/audit/rules.d -> r:\.+.rules$ -> r:^-w && r:/var/log/lastlog && r:-p wa && r:-k logins|key=logins'
      - 'd:/etc/audit/rules.d -> r:\.+.rules$ -> r:^-w && r:/var/run/faillock && r:-p wa && r:-k logins|key=logins'
      - "c:auditctl -l -> r:^-w && r:/var/log/lastlog && r:-p wa && r:-k logins|key=logins"
      - "c:auditctl -l -> r:^-w && r:/var/run/faillock && r:-p wa && r:-k logins|key=logins"

  # 5.2.3.13 Ensure file deletion events by users are collected. (Automated)
  - id: 19179
    title: "確保收集使用者的檔案刪除事件。"
    description: '監視與刪除或重新命名檔案和檔案屬性相關的系統呼叫的使用情況。此設定語句設定監視： - unlink - 刪除檔案 - unlinkat - 刪除檔案屬性 - rename - 重新命名檔案 - renameat 重新命名檔案屬性 系統呼叫並用識別碼「delete」標記它們。'
    rationale: "監視來自非特權使用者的這些呼叫可以為系統管理員提供證據，表明正在發生與受保護檔案關聯的檔案和檔案屬性的不當刪除。雖然此審核選項將查看所有事件，但系統管理員將希望尋找正在刪除或變更的特定特權檔案。"
    remediation: "建立稽核規則在 /etc/audit/rules.d/ 目錄中編輯或創建一個以 .rules 結尾的檔案，並添加相關規則以監控用戶的檔案刪除事件。64 位系統範例：# { UID_MIN=$(awk '/^\\s*UID_MIN/{print $2}' /etc/login.defs) [ -n \"${UID_MIN}\" ] && printf \" -a always,exit -F arch=b64 -S rename,unlink,unlinkat,renameat -F auid>=${UID_MIN} -F auid!=unset -F key=delete -a always,exit -F arch=b32 -S rename,unlink,unlinkat,renameat -F auid>=${UID_MIN} -F auid!=unset -F key=delete \" >> /etc/audit/rules.d/50-delete.rules || printf \"ERROR: Variable 'UID_MIN' is unset.\\n\" } 載入稽核規則合併並載入規則到活動配置中：# augenrules --load 檢查是否需要重啟。# if [[ $(auditctl -s | grep \"enabled\") =~ \"2\" ]]; then printf \"需要重啟以載入規則\\n\"; fi 32 位系統遵循與 64 位系統相同的程序，忽略所有含 b64 的條目。"
    compliance:
      - cis: ["5.2.3.13"]
      - cis_csc_v8: ["8.5"]
      - cis_csc_v7: ["6.2"]
      - cmmc_v2.0: ["AU.L2-3.3.1"]
      - iso_27001-2013: ["A.12.4.1"]
      - mitre_mitigations: ["M1047"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1562", "T1562.006"]
      - nist_sp_800-53: ["AU-3(1)", "AU-7"]
      - pci_dss_v3.2.1: ["10.1", "10.2.2", "10.2.4", "10.2.5", "10.3"]
      - pci_dss_v4.0: ["10.2", "10.2.1", "10.2.1.2", "10.2.1.5", "9.4.5"]
      - soc_2: ["CC5.2", "CC7.2"]
    condition: all
    rules:
      - "d:/etc/audit/rules.d"
      - 'd:/etc/audit/rules.d -> r:\.+.rules$'
      - 'd:/etc/audit/rules.d -> r:\.+.rules$ -> r:^-a && r:always,exit|exit,always && r:-F arch=b64 && r:-S && r:unlink && r:unlinkat && r:rename && r:renameat && r:-F auid>=\d+ && r:-F auid!=-1|-F auid!=4294967295|-F auid!=unset && r:-k delete|key=delete'
      - 'd:/etc/audit/rules.d -> r:\.+.rules$ -> r:^-a && r:always,exit|exit,always && r:-F arch=b32 && r:-S && r:unlink && r:unlinkat && r:rename && r:renameat && r:-F auid>=\d+ && r:-F auid!=-1|-F auid!=4294967295|-F auid!=unset && r:-k delete|key=delete'
      - 'c:auditctl -l -> r:^-a && r:always,exit|exit,always && r:-F arch=b64 && r:-S && r:unlink && r:unlinkat && r:rename && r:renameat && r:-F auid>=\d+ && r:-F auid!=-1|-F auid!=4294967295|-F auid!=unset && r:-k delete|key=delete'
      - 'c:auditctl -l -> r:^-a && r:always,exit|exit,always && r:-F arch=b32 && r:-S && r:unlink && r:unlinkat && r:rename && r:renameat && r:-F auid>=\d+ && r:-F auid!=-1|-F auid!=4294967295|-F auid!=unset && r:-k delete|key=delete'

  # 5.2.3.14 Ensure events that modify the system's Mandatory Access Controls are collected. (Automated)
  - id: 19180
    title: "確保收集修改系統強制存取控制的事件。"
    description: "監控 AppArmor，強制存取控制的實現。以下參數監控對 /etc/apparmor/ 和 /etc/apparmor.d/ 目錄的任何寫入存取（目錄中檔案的潛在新增、刪除或修改）或屬性變更。注意：如果使用不同的強制存取控制方法，則應審核對應目錄的變更。"
    rationale: "對 /etc/apparmor/ 和 /etc/apparmor.d/ 目錄中的檔案進行更改可能表明未經授權的使用者正在嘗試修改存取控制並更改安全上下文，從而導致系統受到損害。"
    remediation: "編輯或創建一個位於 /etc/audit/rules.d/ 目錄中的檔案，以 .rules 為後綴，並使用相關規則來監控修改系統強制存取控制的事件。範例：# printf \" -w /etc/apparmor/ -p wa -k MAC-policy -w /etc/apparmor.d/ -p wa -k MAC-policy \" >> /etc/audit/rules.d/50-MAC-policy.rules 合併並載入規則到活動配置中：# augenrules --load 檢查是否需要重新啟動。# if [[ $(auditctl -s | grep \"enabled\") =~ \"2\" ]]; then printf \"Reboot required to load rules\\n\"; fi."
    compliance:
      - cis: ["5.2.3.14"]
      - cis_csc_v8: ["8.5"]
      - cis_csc_v7: ["5.5"]
      - cmmc_v2.0: ["AU.L2-3.3.1"]
      - iso_27001-2013: ["A.12.1.2"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0004"]
      - mitre_techniques: ["T1562", "T1562.006"]
      - nist_sp_800-53: ["AU-3(1)", "AU-7"]
      - pci_dss_v3.2.1: ["10.1", "10.2.2", "10.2.4", "10.2.5", "10.3"]
      - pci_dss_v4.0: ["10.2", "10.2.1", "10.2.1.2", "10.2.1.5", "9.4.5"]
      - soc_2: ["CC5.2", "CC7.2"]
    condition: all
    rules:
      - "d:/etc/audit/rules.d"
      - 'd:/etc/audit/rules.d -> r:\.+.rules$'
      - 'd:/etc/audit/rules.d -> r:\.+.rules$ -> r:^-w && r:/etc/apparmor && r:-p wa && r:-k MAC-policy|key=MAC-policy'
      - 'd:/etc/audit/rules.d -> r:\.+.rules$ -> r:^-w && r:/etc/apparmor.d && r:-p wa && r:-k MAC-policy|key=MAC-policy'
      - "c:auditctl -l -> r:^-w && r:/etc/apparmor && r:-p wa && r:-k MAC-policy|key=MAC-policy"
      - "c:auditctl -l -> r:^-w && r:/etc/apparmor.d && r:-p wa && r:-k MAC-policy|key=MAC-policy"

  # 5.2.3.15 Ensure successful and unsuccessful attempts to use the chcon command are recorded. (Automated)
  - id: 19181
    title: "確保記錄使用 chcon 指令的成功和不成功嘗試。"
    description: "作業系統必須為 chcon 指令的成功/不成功使用產生審核記錄。"
    rationale: "chcon 指令用於變更檔案安全上下文。如果不產生特定於組織的安全和任務需求的審計記錄，就很難建立、關聯和調查與事件相關的事件或識別對事件負責的人。審計記錄可以從資訊系統內的各個組件（例如，模組或策略過濾器）產生。"
    remediation: "建立審核規則 在 /etc/audit/rules.d/ 目錄中編輯或創建一個以 .rules 副檔名結尾的檔案，並添加相關規則以監控成功和失敗使用 chcon 指令的嘗試。 64 位系統 示例： # { UID_MIN=$(awk '/^\\s*UID_MIN/{print $2}' /etc/login.defs) [ -n \"${UID_MIN}\" ] && printf \" -a always,exit -F path=/usr/bin/chcon -F perm=x -F auid>=${UID_MIN} -F auid!=unset -k perm_chng \" >> /etc/audit/rules.d/50-perm_chng.rules || printf \"ERROR: Variable 'UID_MIN' is unset.\\n\" } 載入審核規則 合併並載入規則到有效配置中： # augenrules --load 檢查是否需要重啟。 # if [[ $(auditctl -s | grep \"enabled\") =~ \"2\" ]]; then printf \"Reboot required to load rules\\n\"; fi 32 位系統 按照與 64 位系統相同的程序進行，並忽略所有包含 b64 的條目。"
    compliance:
      - cis: ["5.2.3.15"]
      - cis_csc_v8: ["8.2"]
      - cis_csc_v7: ["6.2"]
      - cmmc_v2.0: ["AU.L2-3.3.1"]
      - hipaa: ["164.312(b)"]
      - iso_27001-2013: ["A.12.4.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1562", "T1562.006"]
      - nist_sp_800-53: ["AU-7"]
      - pci_dss_v3.2.1: ["10.2", "10.3"]
      - pci_dss_v4.0: ["10.2.1", "10.2.1.1", "10.2.1.2", "10.2.1.3", "10.2.1.4", "10.2.1.5", "10.2.1.6", "10.2.1.7", "10.2.2", "5.3.4", "6.4.1", "6.4.2"]
    condition: all
    rules:
      - "d:/etc/audit/rules.d"
      - 'd:/etc/audit/rules.d -> r:\.+.rules$'
      - 'd:/etc/audit/rules.d -> r:\.+.rules$ -> r:^-a && r:always,exit|exit,always && r:-F path=/usr/bin/chcon && r:-F perm=x && r:-F auid>=\d+ && r:-F auid!=-1|-F auid!=4294967295|-F auid!=unset && r:-k perm_chng|key=perm_chng'
      - 'c:auditctl -l -> r:^-a && r:always,exit|exit,always && r:-F path=/usr/bin/chcon && r:-F perm=x && r:-F auid>=\d+ && r:-F auid!=-1|-F auid!=4294967295|-F auid!=unset && r:-k perm_chng|key=perm_chng'

  # 5.2.3.16 Ensure successful and unsuccessful attempts to use the setfacl command are recorded. (Automated)
  - id: 19182
    title: "確保記錄使用 setfacl 指令的成功和不成功嘗試。"
    description: "作業系統必須為成功/不成功使用 setfacl 指令產生審核記錄。"
    rationale: "此實用程式設定檔案和目錄的存取控制清單（ACL）。如果不產生特定於組織的安全和任務需求的審計記錄，就很難建立、關聯和調查與事件相關的事件或識別對事件負責的人。審計記錄可以從資訊系統內的各個組件（例如，模組或策略過濾器）產生。"
    remediation: "建立審計規則 在 /etc/audit/rules.d/ 目錄中，編輯或建立一個以 .rules 為副檔名的檔案，並添加相關規則以監控成功和未成功使用 setfacl 指令的嘗試。 64 位系統 示例: # { UID_MIN=$(awk '/^\\s*UID_MIN/{print $2}' /etc/login.defs) [ -n \"${UID_MIN}\" ] && printf \" -a always,exit -F path=/usr/bin/setfacl -F perm=x -F auid>=${UID_MIN} -F auid!=unset -k perm_chng \" >> /etc/audit/rules.d/50-perm_chng.rules || printf \"ERROR: Variable 'UID_MIN' is unset.\\n\" } 載入審計規則 將規則合併並載入到活動配置中: # augenrules --load 檢查是否需要重啟。 # if [[ $(auditctl -s | grep \"enabled\") =~ \"2\" ]]; then printf \"需要重啟以載入規則\\n\"; fi 32 位系統 按照與 64 位系統相同的程序操作，忽略任何包含 b64 的條目。"
    compliance:
      - cis: ["5.2.3.16"]
      - cis_csc_v8: ["8.2"]
      - cis_csc_v7: ["6.2"]
      - cmmc_v2.0: ["AU.L2-3.3.1"]
      - hipaa: ["164.312(b)"]
      - iso_27001-2013: ["A.12.4.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1562", "T1562.006"]
      - nist_sp_800-53: ["AU-7"]
      - pci_dss_v3.2.1: ["10.2", "10.3"]
      - pci_dss_v4.0: ["10.2.1", "10.2.1.1", "10.2.1.2", "10.2.1.3", "10.2.1.4", "10.2.1.5", "10.2.1.6", "10.2.1.7", "10.2.2", "5.3.4", "6.4.1", "6.4.2"]
    condition: all
    rules:
      - "d:/etc/audit/rules.d"
      - 'd:/etc/audit/rules.d -> r:\.+.rules$'
      - 'd:/etc/audit/rules.d -> r:\.+.rules$ -> r:^-a && r:always,exit|exit,always && r:-F path=/usr/bin/setfacl && r:-F perm=x && r:-F auid>=\d+ && r:-F auid!=-1|-F auid!=4294967295|-F auid!=unset && r:-k perm_chng|-F key=perm_chng'
      - 'c:auditctl -l -> r:^-a && r:always,exit|exit,always && r:-F path=/usr/bin/setfacl && r:-F perm=x && r:-F auid>=\d+ && r:-F auid!=-1|-F auid!=4294967295|-F auid!=unset && r:-k perm_chng|-F key=perm_chng'

  # 5.2.3.17 Ensure successful and unsuccessful attempts to use the chacl command are recorded. (Automated)
  - id: 19183
    title: "確保記錄使用 chacl 指令的成功和不成功嘗試。"
    description: "作業系統必須為 chacl 指令的成功/不成功使用產生審核記錄。 chacl 是一個 IRIX 相容性指令，是為熟悉 XFS 或 IRIX 使用的使用者而維護的。"
    rationale: "chacl 更改檔案或目錄的 ACL。如果不產生特定於組織的安全和任務需求的審計記錄，就很難建立、關聯和調查與事件相關的事件或識別對事件負責的人。審計記錄可以從資訊系統內的各個組件（例如，模組或策略過濾器）產生。"
    remediation: "創建審計規則 在 /etc/audit/rules.d/ 目錄中編輯或創建一個以 .rules 結尾的檔案，並添加相關規則以監控成功和失敗使用 chacl 指令的嘗試。 64 位系統 範例： # { UID_MIN=$(awk '/^\\s*UID_MIN/{print $2}' /etc/login.defs) [ -n \"${UID_MIN}\" ] && printf \" -a always,exit -F path=/usr/bin/chacl -F perm=x -F auid>=${UID_MIN} -F auid!=unset -k perm_chng \" >> /etc/audit/rules.d/50-perm_chng.rules || printf \"ERROR: Variable 'UID_MIN' is unset.\\n\" } 載入審計規則 合併並載入規則到活動配置中： # augenrules --load 檢查是否需要重新啟動。 # if [[ $(auditctl -s | grep \"enabled\") =~ \"2\" ]]; then printf \"Reboot required to load rules\\n\"; fi 32 位系統 按照與64位系統相同的步驟進行，忽略任何包含 b64 的條目的配置。"
    compliance:
      - cis: ["5.2.3.17"]
      - cis_csc_v8: ["8.2"]
      - cis_csc_v7: ["6.2"]
      - cmmc_v2.0: ["AU.L2-3.3.1"]
      - hipaa: ["164.312(b)"]
      - iso_27001-2013: ["A.12.4.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1562", "T1562.006"]
      - nist_sp_800-53: ["AU-7"]
      - pci_dss_v3.2.1: ["10.2", "10.3"]
      - pci_dss_v4.0: ["10.2.1", "10.2.1.1", "10.2.1.2", "10.2.1.3", "10.2.1.4", "10.2.1.5", "10.2.1.6", "10.2.1.7", "10.2.2", "5.3.4", "6.4.1", "6.4.2"]
    condition: all
    rules:
      - "d:/etc/audit/rules.d"
      - 'd:/etc/audit/rules.d -> r:\.+.rules$'
      - 'd:/etc/audit/rules.d -> r:\.+.rules$ -> r:^-a && r:always,exit|exit,always && r:-F path=/usr/bin/chacl && r:-F perm=x && r:-F auid>=\d+ && r:-F auid!=-1|-F auid!=4294967295|-F auid!=unset && r:-k perm_chng|-F key=perm_chng'
      - 'c:auditctl -l -> r:^-a && r:always,exit|exit,always && r:-F path=/usr/bin/chacl && r:-F perm=x && r:-F auid>=\d+ && r:-F auid!=-1|-F auid!=4294967295|-F auid!=unset && r:-k perm_chng|-F key=perm_chng'

  # 5.2.3.18 Ensure successful and unsuccessful attempts to use the usermod command are recorded. (Automated)
  - id: 19184
    title: "確保記錄使用 usermod 指令的成功和不成功嘗試。"
    description: "作業系統必須為成功/不成功使用 usermod 指令產生審核記錄。"
    rationale: "usermod 指令會修改系統帳號檔案以反映在指令列上指定的變更。如果不產生特定於組織的安全和任務需求的審計記錄，就很難建立、關聯和調查與事件相關的事件或識別對事件負責的人。審計記錄可以從資訊系統內的各個組件（例如，模組或策略過濾器）產生。"
    remediation: "創建審計規則 在 /etc/audit/rules.d/ 目錄中編輯或創建一個以 .rules 為副檔名的檔案，包含監控成功和失敗使用 usermod 指令嘗試的相關規則。 64 位系統 範例: # { UID_MIN=$(awk '/^\\s*UID_MIN/{print $2}' /etc/login.defs) [ -n \"${UID_MIN}\" ] && printf \" -a always,exit -F path=/usr/sbin/usermod -F perm=x -F auid>=${UID_MIN} -F auid!=unset -k usermod \" >> /etc/audit/rules.d/50-usermod.rules || printf \"ERROR: Variable 'UID_MIN' is unset.\\n\" } 載入審計規則 將規則合併並載入進活動配置: # augenrules --load 檢查是否需要重新啟動。 # if [[ $(auditctl -s | grep \"enabled\") =~ \"2\" ]]; then printf \"Reboot required to load rules\\n\"; fi 32 位系統 按照64位系統的相同程序進行，忽略任何帶有b64的條目。"
    compliance:
      - cis: ["5.2.3.18"]
      - cis_csc_v8: ["8.2"]
      - cis_csc_v7: ["6.2"]
      - cmmc_v2.0: ["AU.L2-3.3.1"]
      - hipaa: ["164.312(b)"]
      - iso_27001-2013: ["A.12.4.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1562", "T1562.006"]
      - nist_sp_800-53: ["AU-7"]
      - pci_dss_v3.2.1: ["10.2", "10.3"]
      - pci_dss_v4.0: ["10.2.1", "10.2.1.1", "10.2.1.2", "10.2.1.3", "10.2.1.4", "10.2.1.5", "10.2.1.6", "10.2.1.7", "10.2.2", "5.3.4", "6.4.1", "6.4.2"]
    condition: all
    rules:
      - "d:/etc/audit/rules.d"
      - 'd:/etc/audit/rules.d -> r:\.+.rules$'
      - 'd:/etc/audit/rules.d -> r:\.+.rules$ -> r:^-a && r:always,exit|exit,always && r:-F path=/usr/sbin/usermod && r:-F perm=x && r:-F auid>=\d+ && r:-F auid!=-1|-F auid!=4294967295|-F auid!=unset && r:-k usermod|-F key=usermod'
      - 'c:auditctl -l -> r:^-a && r:always,exit|exit,always && r:-F path=/usr/sbin/usermod && r:-F perm=x && r:-F auid>=\d+ && r:-F auid!=-1|-F auid!=4294967295|-F auid!=unset && r:-k usermod|-F key=usermod'

  # 5.2.3.19 Ensure kernel module loading unloading and modification is collected. (Automated)
  - id: 19185
    title: "確保核心模組載入卸載和修改被收集。"
    description: "監控核心模組的載入和卸載。模組的所有載入/列出/依賴性檢查都是由 kmod 透過符號連結完成的。以下系統呼叫控制模組的載入和卸載： - init_module - 載入模組 - finit_module - 載入模組（當可以避免使用加密簽章模組來決定模組真實性的開銷時使用） - delete_module - 刪除模組- create_module - 建立可載入模組條目- query_module - 查詢核心以取得與模組相關的各個位元載入和卸載模組程式和系統呼叫的任何執行都會觸發帶有模組識別字的審核記錄。"
    rationale: "監視操縱核心模組的所有各種方法的使用可以為系統管理員提供證據，表明對核心模組進行了未經授權的更改，這可能會損害系統的安全性。"
    remediation: "建立審核規則 編輯或建立位於 /etc/audit/rules.d/ 目錄中的檔案，檔案名稱需以 .rules 作為副檔名，並加入相關規則來監控核心模組的修改。 64位元系統 範例: # { UID_MIN=$(awk '/^\\s*UID_MIN/{print $2}' /etc/login.defs) [ -n \"${UID_MIN}\" ] && printf \" -a always,exit -F arch=b64 -S init_module,finit_module,delete_module,create_module,query_module -F auid>=${UID_MIN} -F auid!=unset -k kernel_modules -a always,exit -F path=/usr/bin/kmod -F perm=x -F auid>=${UID_MIN} -F auid!=unset -k kernel_modules \" >> /etc/audit/rules.d/50-kernel_modules.rules || printf \"ERROR: Variable 'UID_MIN' is unset.\\n\" } 載入審核規則 合併並載入規則至活動配置: # augenrules --load 檢查是否需要重新啟動。 # if [[ $(auditctl -s | grep \"enabled\") =~ \"2\" ]]; then printf \"Reboot required to load rules\\n\"; fi."
    compliance:
      - cis: ["5.2.3.19"]
      - cis_csc_v8: ["8.5"]
      - cis_csc_v7: ["6.2"]
      - cmmc_v2.0: ["AU.L2-3.3.1"]
      - iso_27001-2013: ["A.12.4.1"]
      - mitre_mitigations: ["M1047"]
      - mitre_tactics: ["TA0004"]
      - mitre_techniques: ["T1562", "T1562.006"]
      - nist_sp_800-53: ["AU-3(1)", "AU-7"]
      - pci_dss_v3.2.1: ["10.1", "10.2.2", "10.2.4", "10.2.5", "10.3"]
      - pci_dss_v4.0: ["10.2", "10.2.1", "10.2.1.2", "10.2.1.5", "9.4.5"]
      - soc_2: ["CC5.2", "CC7.2"]
    condition: all
    rules:
      - "d:/etc/audit/rules.d"
      - 'd:/etc/audit/rules.d -> r:\.+.rules$'
      - 'd:/etc/audit/rules.d -> r:\.+.rules$ -> r:^-a && r:always,exit|exit,always && r:-F arch=b64|-F arch=b32 && r:-S && r:init_module && r:finit_module && r:delete_module && r:create_module && r:query_module && r:-F auid>=\d+ && r:-F auid!=-1|-F auid!=4294967295|-F auid!=unset && r:-k kernel_modules|-F key=kernel_modules'
      - 'd:/etc/audit/rules.d -> r:\.+.rules$ -> r:^-a && r:always,exit|exit,always && r:-F path=/usr/bin/kmod && r:-F perm=x && r:-F auid>=\d+ && r:-F auid!=-1|-F auid!=4294967295|-F auid!=unset && r:-k kernel_modules|-F key=kernel_modules'
      - 'c:auditctl -l -> r:^-a && r:always,exit|exit,always && r:-F arch=b64|-F arch=b32 && r:-S && r:init_module && r:finit_module && r:delete_module && r:create_module && r:query_module && r:-F auid>=\d+ && r:-F auid!=-1|-F auid!=4294967295|-F auid!=unset && r:-k kernel_modules|-F key=kernel_modules'
      - 'c:auditctl -l-> r:^-a && r:always,exit|exit,always && r:-F path=/usr/bin/kmod && r:-F perm=x && r:-F auid>=\d+ && r:-F auid!=-1|-F auid!=4294967295|-F auid!=unset && r:-k kernel_modules|-F key=kernel_modules'
      - "c:ls -l /usr/sbin/lsmod -> r:/bin/kmod"
      - "c:ls -l /usr/sbin/rmmod -> r:/bin/kmod"
      - "c:ls -l /usr/sbin/insmod -> r:/bin/kmod"
      - "c:ls -l /usr/sbin/modinfo -> r:/bin/kmod"
      - "c:ls -l /usr/sbin/modprobe -> r:/bin/kmod"
      - "c:ls -l /usr/sbin/depmod -> r:/bin/kmod"

  # 5.2.3.20 Ensure the audit configuration is immutable. (Automated)
  - id: 19186
    title: "確保審核配置不可變。"
    description: '設定系統審計，使審計規則不能用auditctl修改。設定標誌“-e 2”強制審核置於不可變模式。審核變更只能在系統重新啟動時進行。注意：此設定將需要重新啟動系統才能更新活動的auditd配置設定。'
    rationale: "在不可變模式下，未經授權的使用者無法對審核系統執行變更以隱藏惡意活動，然後復原審核規則。使用者很可能會注意到系統重新啟動，這可能會提醒管理員嘗試進行未經授權的審核變更。"
    remediation: "編輯或創建檔案 /etc/audit/rules.d/99-finalize.rules 並在檔案末尾添加行 -e 2: 例子: # printf -- \"-e 2 \" >> /etc/audit/rules.d/99-finalize.rules 載入審計規則 合併並載入規則到活動配置: # augenrules --load 檢查是否需要重新啟動. # if [[ $(auditctl -s | grep \"enabled\") =~ \"2\" ]]; then printf \"Reboot required to load rules\\n\"; fi."
    compliance:
      - cis: ["5.2.3.20"]
      - cis_csc_v8: ["3.3", "8.5"]
      - cis_csc_v7: ["6.2", "6.3"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "AU.L2-3.3.1", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.12.4.1"]
      - mitre_mitigations: ["M1028"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1562", "T1562.001"]
      - nist_sp_800-53: ["AC-5", "AC-6", "AU-3(1)", "AU-7"]
      - pci_dss_v3.2.1: ["10.1", "10.2.2", "10.2.4", "10.2.5", "10.3", "7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "10.2", "10.2.1", "10.2.1.2", "10.2.1.5", "7.1", "9.4.5"]
      - soc_2: ["CC5.2", "CC6.1", "CC7.2"]
    condition: all
    rules:
      - 'c:sh -c "grep -iEh ''^\s*\t*-e 2\s*$'' /etc/audit/rules.d/*.rules | tail -1" -> r:^\s*\t*-e 2\s*$'

  # 5.2.3.21 Ensure the running and on disk configuration is the same. (Manual)
  - id: 19187
    title: "確保運行配置和磁碟配置相同。"
    description: "審計系統有磁碟配置和運行配置。這些配置設定可能會有所不同。注意：由於augenrules和auditctl的限制，不能絕對保證透過augenrules --load載入規則集會導致所有規則被載入，甚至不能保證載入規則時出現問題會通知用戶。"
    rationale: "目前運行的內容和磁碟上的內容之間的配置差異可能會導致意外問題，或者可能會給合規性要求帶來錯誤的印象。"
    remediation: '如果規則在所有三個（）區域不一致，請執行以下指令以合併並載入所有規則：# augenrules --load 檢查是否需要重新啟動。if [[ $(auditctl -s | grep "enabled") =~ "2" ]]; then echo "Reboot required to load rules"; fi.'
    compliance:
      - cis: ["5.2.3.21"]
      - cis_csc_v8: ["8.5"]
      - cis_csc_v7: ["6.3"]
      - cmmc_v2.0: ["AU.L2-3.3.1"]
      - iso_27001-2013: ["A.12.4.1"]
      - nist_sp_800-53: ["AU-3(1)", "AU-7"]
      - pci_dss_v3.2.1: ["10.1", "10.2.2", "10.2.4", "10.2.5", "10.3"]
      - pci_dss_v4.0: ["10.2", "10.2.1", "10.2.1.2", "10.2.1.5", "9.4.5"]
      - soc_2: ["CC5.2", "CC7.2"]
    condition: all
    rules:
      - 'c:augenrules --check -> r:^\s*/usr/sbin/augenrules && r:No change$'

  # 5.2.4.1 Ensure audit log files are mode 0640 or less permissive. (Automated) - Not Implemented
  # 5.2.4.2 Ensure only authorized users own audit log files. (Automated) - Not Implemented

  # 5.2.4.3 Ensure only authorized groups are assigned ownership of audit log files. (Automated)
  - id: 19188
    title: "確保只有授權群組才被指派審核日誌檔案的所有權。"
    description: "審核日誌檔案包含有關系統和系統活動的資訊。"
    rationale: "存取審計記錄可能會向攻擊者洩露系統和配置資料，從而可能損害其機密性。"
    remediation: "執行以下指令以配置審計日誌檔案由 adm 組擁有： # find $(dirname $(awk -F\"=\" '/^\\s*log_file/ {print $2}' /etc/audit/auditd.conf | xargs)) -type f \\( ! -group adm -a ! -group root \\) -exec chgrp adm {} + 執行以下指令以在審計配置檔案中設置 log_group 參數為 log_group = adm： # sed -ri 's/^\\s*#?\\s*log_group\\s*=\\s*\\S+(\\s*#.*)?.*$/log_group = adm\\1/' /etc/audit/auditd.conf 執行以下指令以重新啟動審計守護程序以重新載入配置檔案： # systemctl restart auditd"
    compliance:
      - cis: ["5.2.4.3"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1047"]
      - mitre_tactics: ["TA0007"]
      - mitre_techniques: ["T1070", "T1070.002", "T1083"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'f:/etc/audit/auditd.conf -> r:^\s*\t*log_group\s*\t*=\s*\t*adm|^\s*\t*log_group\s*\t*=\s*\t*root'

  # 5.2.4.4 Ensure the audit log directory is 0750 or more restrictive. (Automated) - Not Implemented

  # 5.2.4.5 Ensure audit configuration files are 640 or more restrictive. (Automated)
  - id: 19189
    title: "確保審核設定檔的限制為 640 或更多。"
    description: "審計設定檔控制auditd以及審計哪些事件。"
    rationale: "未經授權的人員存取審核設定檔可能會阻止關鍵事件的審核。配置錯誤的審核設定檔可能會阻止關鍵事件的審核，或因審核日誌過多而影響系統效能。審計配置檔案的錯誤配置也可能使建立和調查與事件相關的事件變得更加困難。"
    remediation: "執行以下指令以從稽核配置檔案中移除比0640更寬鬆的模式: # find /etc/audit/ -type f \\( -name '*.conf' -o -name '*.rules' \\) -exec chmod u-x,g-wx,o-rwx {} +."
    compliance:
      - cis: ["5.2.4.5"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1047"]
      - mitre_tactics: ["TA0007"]
      - mitre_techniques: ["T1070", "T1070.002", "T1083"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'not c:sh -c "stat -Lc \"%n %a\" /etc/audit/*.rules" -> r:^/etc/audit && !r:640|600|400'
      - 'not c:sh -c "stat -Lc \"%n %a\" /etc/audit/*.conf" -> r:^/etc/audit && !r:640|600|400'

  # 5.2.4.6 Ensure audit configuration files are owned by root. (Automated)
  - id: 19190
    title: "確保審核設定檔歸 root 所有。"
    description: "審計設定檔控制auditd以及審計哪些事件。"
    rationale: "未經授權的人員存取審核設定檔可能會阻止關鍵事件的審核。配置錯誤的審核設定檔可能會阻止關鍵事件的審核，或因審核日誌過多而影響系統效能。審計配置檔案的錯誤配置也可能使建立和調查與事件相關的事件變得更加困難。"
    remediation: "執行以下指令將所有權更改為 root 使用者：# find /etc/audit/ -type f \\( -name '*.conf' -o -name '*.rules' \\) ! -user root -exec chown root {} +."
    compliance:
      - cis: ["5.2.4.6"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1047"]
      - mitre_tactics: ["TA0007"]
      - mitre_techniques: ["T1070", "T1070.002", "T1083"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'not c:sh -c "stat -Lc \"%n %U\" /etc/audit/*.rules" -> r:^/etc/audit && !r:root'
      - 'not c:sh -c "stat -Lc \"%n %U\" /etc/audit/*.conf" -> r:^/etc/audit && !r:root'

  # 5.2.4.7 Ensure audit configuration files belong to group root. (Automated)
  - id: 19191
    title: "確保審核設定檔屬於組根。"
    description: "審計設定檔控制auditd以及審計哪些事件。"
    rationale: "未經授權的人員存取審核設定檔可能會阻止關鍵事件的審核。配置錯誤的審核設定檔可能會阻止關鍵事件的審核，或因審核日誌過多而影響系統效能。審計配置檔案的錯誤配置也可能使建立和調查與事件相關的事件變得更加困難。"
    remediation: "執行以下指令將群組改為 root：# find /etc/audit/ -type f \\( -name '*.conf' -o -name '*.rules' \\) ! -group root -exec chgrp root {} +."
    compliance:
      - cis: ["5.2.4.7"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1047"]
      - mitre_tactics: ["TA0007"]
      - mitre_techniques: ["T1070", "T1070.002", "T1083"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'not c:sh -c "stat -Lc \"%n %G\" /etc/audit/*.rules" -> r:^/etc/audit && !r:root'
      - 'not c:sh -c "stat -Lc \"%n %G\" /etc/audit/*.conf" -> r:^/etc/audit && !r:root'

  # 5.2.4.8 Ensure audit tools are 755 or more restrictive. (Automated)
  - id: 19192
    title: "確保審核工具具有 755 或更多限制。"
    description: "審計工具包括但不限於成功查看和操作審計資訊系統活動和記錄所需的供應商提供的開源審計工具。審核工具包括自訂查詢和報表產生器。"
    rationale: "保護審計資訊包括識別和保護用於查看和操作日誌資料的工具。保護審計工具對於防止對審計資訊進行未經授權的操作是必要的。"
    remediation: "運行以下指令以從審計工具中移除更寬鬆的模式：# chmod go-w /sbin/auditctl /sbin/aureport /sbin/ausearch /sbin/autrace /sbin/auditd /sbin/augenrules."
    compliance:
      - cis: ["5.2.4.8"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1047"]
      - mitre_tactics: ["TA0007"]
      - mitre_techniques: ["T1070", "T1070.002", "T1083"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'not c:stat -c "%n %a %U %G" /sbin/auditctl /sbin/aureport /sbin/ausearch /sbin/autrace /sbin/auditd /sbin/augenrules -> r:^/sbin && !r:000|010|040|050|001|011|041|051|004|014|044|054|005|015|045|055|700|710|740|750|701|711|741|751|704|714|744|754|705|715|745|755'

  # 5.2.4.9 Ensure audit tools are owned by root. (Automated)
  - id: 19193
    title: "確保審核工具歸 root 所有。"
    description: "審計工具包括但不限於成功查看和操作審計資訊系統活動和記錄所需的供應商提供的開源審計工具。審核工具包括自訂查詢和報表產生器。"
    rationale: "保護審計資訊包括識別和保護用於查看和操作日誌資料的工具。保護審計工具對於防止對審計資訊進行未經授權的操作是必要的。"
    remediation: "執行以下指令將審計工具的所有者更改為 root 用戶：# chown root /sbin/auditctl /sbin/aureport /sbin/ausearch /sbin/autrace /sbin/auditd /sbin/augenrules."
    compliance:
      - cis: ["5.2.4.9"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1047"]
      - mitre_tactics: ["TA0007"]
      - mitre_techniques: ["T1070", "T1070.002", "T1083"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'not c:stat -c "%n %u %U %g %G" /sbin/auditctl -> r:^/sbin && !r:0 root 0 root'
      - 'not c:stat -c "%n %u %U %g %G" /sbin/aureport -> r:^/sbin && !r:0 root 0 root'
      - 'not c:stat -c "%n %u %U %g %G" /sbin/ausearch -> r:^/sbin && !r:0 root 0 root'
      - 'not c:stat -c "%n %u %U %g %G" /sbin/autrace -> r:^/sbin && !r:0 root 0 root'
      - 'not c:stat -c "%n %u %U %g %G" /sbin/auditd -> r:^/sbin && !r:0 root 0 root'
      - 'not c:stat -c "%n %u %U %g %G" /sbin/augenrules -> r:^/sbin && !r:0 root 0 root'

  # 5.2.4.10 Ensure audit tools belong to group root. (Automated)
  - id: 19194
    title: "確保審核工具屬於組根。"
    description: "審計工具包括但不限於成功查看和操作審計資訊系統活動和記錄所需的供應商提供的開源審計工具。審核工具包括自訂查詢和報表產生器。"
    rationale: "保護審計資訊包括識別和保護用於查看和操作日誌資料的工具。保護審計工具對於防止對審計資訊進行未經授權的操作是必要的。"
    remediation: "執行以下指令從稽核工具中移除更多的允許模式：# chmod go-w /sbin/auditctl /sbin/aureport /sbin/ausearch /sbin/autrace /sbin/auditd /sbin/augenrules 執行以下指令將稽核工具的所有者和群組更改為root用戶和群組：# chown root:root /sbin/auditctl /sbin/aureport /sbin/ausearch /sbin/autrace /sbin/auditd /sbin/augenrules."
    compliance:
      - cis: ["5.2.4.10"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1047"]
      - mitre_tactics: ["TA0007"]
      - mitre_techniques: ["T1070", "T1070.002", "T1083"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'not c:stat -c "%n %a %U %G" /sbin/auditctl -> r:^/sbin && !r:000|010|040|050|001|011|041|051|004|014|044|054|005|015|045|055|700|710|740|750|701|711|741|751|704|714|744|754|705|715|745|755'
      - 'not c:stat -c "%n %a %U %G" /sbin/aureport -> r:^/sbin && !r:000|010|040|050|001|011|041|051|004|014|044|054|005|015|045|055|700|710|740|750|701|711|741|751|704|714|744|754|705|715|745|755'
      - 'not c:stat -c "%n %a %U %G" /sbin/ausearch -> r:^/sbin && !r:000|010|040|050|001|011|041|051|004|014|044|054|005|015|045|055|700|710|740|750|701|711|741|751|704|714|744|754|705|715|745|755'
      - 'not c:stat -c "%n %a %U %G" /sbin/autrace -> r:^/sbin && !r:000|010|040|050|001|011|041|051|004|014|044|054|005|015|045|055|700|710|740|750|701|711|741|751|704|714|744|754|705|715|745|755'
      - 'not c:stat -c "%n %a %U %G" /sbin/auditd -> r:^/sbin && !r:000|010|040|050|001|011|041|051|004|014|044|054|005|015|045|055|700|710|740|750|701|711|741|751|704|714|744|754|705|715|745|755'
      - 'not c:stat -c "%n %a %U %G" /sbin/augenrules -> r:^/sbin && !r:000|010|040|050|001|011|041|051|004|014|044|054|005|015|045|055|700|710|740|750|701|711|741|751|704|714|744|754|705|715|745|755'

  # 5.2.4.11 Ensure cryptographic mechanisms are used to protect the integrity of audit tools. (Automated)
  - id: 19195
    title: "確保使用加密機制來保護稽核工具的完整性。"
    description: "審計工具包括但不限於成功查看和操作審計資訊系統活動和記錄所需的供應商提供的開源審計工具。審核工具包括自訂查詢和報表產生器。"
    rationale: "保護用於審計目的的工具的完整性是確保審計資訊完整性的關鍵一步。審計資訊包括成功審計資訊系統活動所需的所有資訊（例如審計記錄、審計設定和審計報告）。攻擊者可能會取代審核工具或將程式碼注入現有工具，目的是提供隱藏或刪除審核日誌中的系統活動的功能。審計工具應進行加密簽名，以便能夠識別審計工具何時被修改、操縱或替換。一個範例是一個或多個檔案的校驗和雜湊。"
    remediation: "新增或更新以下選擇行到結尾為 .conf 的檔案位於 /etc/aide/aide.conf.d/ 或者 /etc/aide/aide.conf 以保護審計工具的完整性: # Audit Tools /sbin/auditctl p+i+n+u+g+s+b+acl+xattrs+sha512 /sbin/auditd p+i+n+u+g+s+b+acl+xattrs+sha512 /sbin/ausearch p+i+n+u+g+s+b+acl+xattrs+sha512 /sbin/aureport p+i+n+u+g+s+b+acl+xattrs+sha512 /sbin/autrace p+i+n+u+g+s+b+acl+xattrs+sha512 /sbin/augenrules p+i+n+u+g+s+b+acl+xattrs+sha512."
    compliance:
      - cis: ["5.2.4.11"]
      - mitre_mitigations: ["M1047"]
      - mitre_tactics: ["TA0007"]
      - mitre_techniques: ["T1070", "T1070.002", "T1083"]
    condition: all
    rules:
      - "f:/etc/aide/aide.conf -> r:/sbin/auditctl p+i+n+u+g+s+b+acl+xattrs+sha512"
      - "f:/etc/aide/aide.conf -> r:/sbin/auditd p+i+n+u+g+s+b+acl+xattrs+sha512"
      - "f:/etc/aide/aide.conf -> r:/sbin/ausearch p+i+n+u+g+s+b+acl+xattrs+sha512"
      - "f:/etc/aide/aide.conf -> r:/sbin/aureport p+i+n+u+g+s+b+acl+xattrs+sha512"
      - "f:/etc/aide/aide.conf -> r:/sbin/autrace p+i+n+u+g+s+b+acl+xattrs+sha512"
      - "f:/etc/aide/aide.conf -> r:/sbin/augenrules p+i+n+u+g+s+b+acl+xattrs+sha512"

  # 6.1.1 Ensure permissions on /etc/passwd are configured. (Automated)
  - id: 19196
    title: "確保配置了 /etc/passwd 的權限。"
    description: "/etc/passwd 檔案包含許多系統實用程式使用的使用者帳戶訊息，因此必須可讀，這些實用程式才能運作。"
    rationale: "確保 /etc/passwd 檔案免受未經授權的寫入存取至關重要。儘管預設情況下它受到保護，但檔案權限可能會被無意或透過惡意操作更改。"
    remediation: "執行以下指令來移除多餘的權限、設定擁有者和設定群組在 /etc/passwd: # chmod u-x,go-wx /etc/passwd # chown root:root /etc/passwd."
    compliance:
      - cis: ["6.1.1"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1003", "T1003.008", "T1222", "T1222.002"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:stat -Lc "%n %a %u %U %g %G" /etc/passwd -> r:0 root 0 root && r:644|640|604|600|400|500'

  # 6.1.2 Ensure permissions on /etc/passwd- are configured. (Automated)
  - id: 19197
    title: "確保配置了 /etc/passwd- 的權限。"
    description: "/etc/passwd- 檔案包含備份使用者帳號資訊。"
    rationale: "確保 /etc/passwd- 檔案免受未經授權的存取至關重要。儘管預設情況下它受到保護，但檔案權限可能會被無意或透過惡意操作更改。"
    remediation: "執行以下指令以移除多餘的權限，設置擁有者，並設置群組於 /etc/passwd-: # chmod u-x,go-wx /etc/passwd- # chown root:root /etc/passwd-."
    compliance:
      - cis: ["6.1.2"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1003", "T1003.008", "T1222", "T1222.002"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:stat -Lc "%n %a %u %U %g %G" /etc/passwd- -> r:0 root 0 root && r:644|640|604|600|400|500'

  # 6.1.3 Ensure permissions on /etc/group are configured. (Automated)
  - id: 19198
    title: "確保配置了 /etc/group 的權限。"
    description: "/etc/group 檔案包含系統中定義的所有有效群組的清單。下面的指令允許 root 進行讀取/寫入存取，並允許其他人進行讀取存取。"
    rationale: "/etc/group 檔案需要受到保護，防止非特權使用者進行未經授權的更改，但需要可讀，因為此資訊與許多非特權程式一起使用。"
    remediation: "執行以下指令以移除多餘的權限、設定擁有者和設定群組在 /etc/group 上：# chmod u-x,go-wx /etc/group # chown root:root /etc/group."
    compliance:
      - cis: ["6.1.3"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1003", "T1003.008", "T1222", "T1222.002"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:stat -Lc "%n %a %u %U %g %G" /etc/group -> r:0 root 0 root && r:644|640|604|600|400|500'

  # 6.1.4 Ensure permissions on /etc/group- are configured. (Automated)
  - id: 19199
    title: "確保配置了 /etc/group- 的權限。"
    description: "/etc/group- 檔案包含系統中定義的所有有效群組的備份清單。"
    rationale: "確保 /etc/group- 檔案免受未經授權的存取至關重要。儘管預設情況下它受到保護，但檔案權限可能會被無意或透過惡意操作更改。"
    remediation: "執行以下指令來移除多餘的權限，設定擁有者，並設定群組在 /etc/group- 上： # chmod u-x,go-wx /etc/group- # chown root:root /etc/group-。"
    compliance:
      - cis: ["6.1.4"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1003", "T1003.008", "T1222", "T1222.002"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:stat -Lc "%n %a %u %U %g %G" /etc/group- -> r:0 root 0 root && r:644|640|604|600|400|500'

  # 6.1.5 Ensure permissions on /etc/shadow are configured. (Automated)
  - id: 19200
    title: "確保配置了 /etc/shadow 的權限。"
    description: "/etc/shadow 檔案用於儲存對這些帳戶的安全性至關重要的有關使用者帳戶的資訊，例如雜湊密碼和其他安全資訊。"
    rationale: "如果攻擊者可以獲得 /etc/shadow 檔案的讀取權限，他們就可以輕鬆地針對雜湊密碼執行密碼破解程式來破解它。儲存在 /etc/shadow 檔案中的其他安全資訊（例如到期時間）也可能有助於破壞使用者帳戶。"
    remediation: "執行以下指令之一來設定 /etc/shadow 的擁有者為 root，組為 root 或 shadow： # chown root:shadow /etc/shadow -或- # chown root:root /etc/shadow 執行以下指令來移除 /etc/shadow 的多餘權限： # chmod u-x,g-wx,o-rwx /etc/shadow."
    compliance:
      - cis: ["6.1.5"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1003", "T1003.008", "T1222", "T1222.002"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:stat -Lc "%n %a %u %U %g %G" /etc/shadow -> r:0 root \d+ shadow|0 root 0 root && r: r:644|640|604|600|400|500'

  # 6.1.6 Ensure permissions on /etc/shadow- are configured. (Automated)
  - id: 19201
    title: "確保配置了 /etc/shadow- 上的權限。"
    description: "/etc/shadow- 檔案用於儲存對使用者帳戶的安全性至關重要的備份訊息，例如雜湊密碼和其他安全資訊。"
    rationale: "確保 /etc/shadow- 檔案免受未經授權的存取至關重要。儘管預設情況下它受到保護，但檔案權限可能會被無意或透過惡意操作更改。"
    remediation: "執行以下其中一條指令來設置 /etc/shadow- 的擁有者為 root 並且群組為 root 或 shadow： # chown root:shadow /etc/shadow- -或者- # chown root:root /etc/shadow- 執行以下指令來移除 /etc/shadow- 的多餘權限: # chmod u-x,g-wx,o-rwx /etc/shadow-."
    compliance:
      - cis: ["6.1.6"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1003", "T1003.008", "T1222", "T1222.002"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:stat -Lc "%n %a %u %U %g %G" /etc/shadow- -> r:0 root \d+ shadow|0 root 0 root && r: r:644|640|604|600|400|500'

  # 6.1.7 Ensure permissions on /etc/gshadow are configured. (Automated)
  - id: 19202
    title: "確保配置了 /etc/gshadow 的權限。"
    description: "/etc/gshadow 檔案用於儲存對這些帳戶的安全性至關重要的群組訊息，例如雜湊密碼和其他安全資訊。"
    rationale: "如果攻擊者可以獲得 /etc/gshadow 檔案的讀取權限，他們就可以輕鬆地針對雜湊密碼執行密碼破解程式來破解它。儲存在 /etc/gshadow 檔案中的其他安全資訊（例如群組管理員）也可能有助於破壞群組。"
    remediation: "執行以下其中一個指令來將 /etc/gshadow 的所有權設置為 root 並將群組設置為 root 或者 shadow：# chown root:shadow /etc/gshadow -OR- # chown root:root /etc/gshadow 執行以下指令來移除 /etc/gshadow 的多餘權限：# chmod u-x,g-wx,o-rwx /etc/gshadow."
    compliance:
      - cis: ["6.1.7"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1003", "T1003.008", "T1222", "T1222.002"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:stat -Lc "%n %a %u %U %g %G" /etc/gshadow -> r:0 root \d+ shadow|0 root 0 root && r: r:644|640|604|600|400|500'

  # 6.1.8 Ensure permissions on /etc/gshadow- are configured. (Automated)
  - id: 19203
    title: "確保 /etc/gshadow- 上的權限已配置。"
    description: "/etc/gshadow- 檔案用於儲存對這些帳戶的安全性至關重要的群組的備份訊息，例如散列密碼和其他安全資訊。"
    rationale: "確保 /etc/gshadow- 檔案免受未經授權的存取至關重要。儘管預設情況下它受到保護，但檔案權限可能會被無意或透過惡意操作更改。"
    remediation: "執行以下其中一個指令將 /etc/gshadow- 的擁有者設為 root 並將群組設為 root 或 shadow：# chown root:shadow /etc/gshadow- -OR- # chown root:root /etc/gshadow- 接著執行以下指令以移除 /etc/gshadow- 額外的權限：# chmod u-x,g-wx,o-rwx /etc/gshadow-."
    compliance:
      - cis: ["6.1.8"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1003", "T1003.008", "T1222", "T1222.002"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:stat -Lc "%n %a %u %U %g %G" /etc/gshadow- -> r:0 root \d+ shadow|0 root 0 root && r: r:644|640|604|600|400|500'

  # 6.1.9 Ensure permissions on /etc/shells are configured. (Automated)
  - id: 19204
    title: "確保配置了 /etc/shells 上的權限。"
    description: "/etc/shells 是一個文字檔案，其中包含有效登入 shell 的完整路徑名。該檔案由 chsh 查閱並可供其他程式查詢。"
    rationale: "確保 /etc/shells 檔案免受未經授權的存取至關重要。儘管預設情況下它受到保護，但檔案權限可能會被無意或透過惡意操作更改。"
    remediation: "執行以下指令以移除多餘的權限、設定擁有者和群組在 /etc/shells 上：# chmod u-x,go-wx /etc/shells # chown root:root /etc/shells."
    compliance:
      - cis: ["6.1.9"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1003", "T1003.008", "T1222", "T1222.002"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:stat -Lc "%n %a %u %U %g %G" /etc/shells- -> r:0 root 0 root && r:644|640|604|600|400|500'

  # 6.1.10 Ensure permissions on /etc/opasswd are configured. (Automated)
  - id: 19205
    title: "確保配置了 /etc/opasswd 的權限。"
    description: "如果系統上正在使用 pam_unix 或 pam_pwhistory，/etc/security/opasswd 及其備份 /etc/security/opasswd.old 會儲存使用者先前的密碼。"
    rationale: "確保 /etc/security/opasswd 免受未經授權的存取至關重要。儘管預設情況下它受到保護，但檔案權限可能會被無意或透過惡意操作更改。"
    remediation: '執行以下指令以移除多餘的權限，設定擁有者和群組，如果存在的話，對 /etc/security/opasswd 及 /etc/security/opasswd.old：# [ -e "/etc/security/opasswd" ] && chmod u-x,go-rwx /etc/security/opasswd # [ -e "/etc/security/opasswd" ] && chown root:root /etc/security/opasswd # [ -e "/etc/security/opasswd.old" ] && chmod u-x,go-rwx /etc/security/opasswd.old # [ -e "/etc/security/opasswd.old" ] && chown root:root /etc/security/opasswd.old.'
    compliance:
      - cis: ["6.1.10"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1003", "T1003.008", "T1222", "T1222.002"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:stat -Lc "%n %a %u %U %g %G" /etc/security/opasswds -> r:0 root 0 root && r:644|640|604|600|400|500'

  # 6.1.11 Ensure world writable files and directories are secured. (Automated) - Not Implemented
  # 6.1.12 Ensure no unowned or ungrouped files or directories exist. (Automated) - Not Implemented
  # 6.1.13 Ensure SUID and SGID files are reviewed. (Manual) - - Not Implemented

  # 6.2.1 Ensure accounts in /etc/passwd use shadowed passwords. (Automated)
  - id: 19206
    title: "確保 /etc/passwd 中的帳戶使用隱藏密碼。"
    description: "本機帳號可以使用影子密碼。對於影子密碼，密碼保存在影子密碼檔案 /etc/shadow 中，並透過加鹽單向雜湊進行加密。具有隱藏密碼的帳戶在 /etc/passwd 的第二個欄位中有一個 x。"
    rationale: "/etc/passwd 檔案還包含許多系統程式使用的使用者 ID 和群組 ID 等資訊。因此，/etc/passwd 檔案必須保持全域可讀。儘管使用隨機生成的單向雜湊函數對密碼進行編碼，但如果攻擊者能夠存取 /etc/passwd 檔案，他們仍然可以破壞系統。這可以透過使用隱藏密碼來緩解，從而將 /etc/passwd 檔案中的密碼移至 /etc/shadow。 /etc/shadow 檔案已設定為只有 root 能夠讀取和寫入。這有助於降低攻擊者存取編碼密碼以執行字典攻擊的風險。注意： - 所有帳戶必須有密碼或鎖定，以防止帳戶被未經授權的使用者使用。 - /etc/passwd 中第二個欄位為空的使用者帳戶允許僅透過提供使用者名稱來登入該帳戶。"
    remediation: "執行以下指令來設置帳戶使用遮蔽密碼: # sed -e 's/^\\([a-zA-Z0-9_]*\\):[^:]*:/\\1:x:/' -i /etc/passwd 調查以確定該帳戶是否已登入及其用處，以判斷是否需要強制登出。"
    compliance:
      - cis: ["6.2.1"]
      - cis_csc_v8: ["3.11"]
      - cis_csc_v7: ["16.4"]
      - cmmc_v2.0: ["AC.L2-3.1.19", "IA.L2-3.5.10", "MP.L2-3.8.1", "SC.L2-3.13.11", "SC.L2-3.13.16"]
      - hipaa: ["164.312(a)(2)(iv)", "164.312(e)(2)(ii)"]
      - iso_27001-2013: ["A.10.1.1"]
      - mitre_mitigations: ["M1027"]
      - mitre_tactics: ["TA0003"]
      - mitre_techniques: ["T1003", "T1003.008"]
      - nist_sp_800-53: ["SC-28", "SC-28(1)"]
      - pci_dss_v3.2.1: ["3.4", "3.4.1", "8.2.1"]
      - pci_dss_v4.0: ["3.1.1", "3.3.2", "3.3.3", "3.5.1", "3.5.1.2", "3.5.1.3", "8.3.2"]
      - soc_2: ["CC6.1"]
    condition: all
    rules:
      - 'not f:/etc/passwd -> !r:^\w+:x:'

  # 6.2.2 Ensure /etc/shadow password fields are not empty. (Automated)
  - id: 19207
    title: "確保 /etc/shadow 密碼欄位不為空。"
    description: "密碼欄位為空的帳戶意味著任何人都可以登入該使用者而無需提供密碼。"
    rationale: "所有帳戶必須有密碼或被鎖定，以防止未經授權的使用者使用該帳戶。"
    remediation: "如果 /etc/shadow 檔案中的任何帳戶沒有密碼，請運行以下指令來鎖定帳戶，直到可以確定為什麼它沒有密碼：# passwd -l <username> 此外，檢查該帳戶是否已登入並調查它的用途，以確定是否需要強制登出。"
    compliance:
      - cis: ["6.2.2"]
      - cis_csc_v8: ["5.2"]
      - cis_csc_v7: ["4.4"]
      - cmmc_v2.0: ["IA.L2-3.5.7"]
      - iso_27001-2013: ["A.9.4.3"]
      - mitre_mitigations: ["M1027"]
      - mitre_tactics: ["TA0003"]
      - mitre_techniques: ["T1078", "T1078.001", "T1078.003"]
      - pci_dss_v4.0: ["2.2.2", "8.3.5", "8.3.6", "8.6.3"]
      - soc_2: ["CC6.1"]
    condition: all
    rules:
      - 'not f:/etc/shadow -> r:^\w+::'

  # 6.2.3 Ensure all groups in /etc/passwd exist in /etc/group. (Automated) - Not Implemented
  # 6.2.4 Ensure shadow group is empty. (Automated)
  - id: 19208
    title: "確保影子組為空。"
    description: "影子群組允許需要存取權限的系統程式讀取 /etc/shadow 檔案。不應將任何使用者指派到影子群組。"
    rationale: "分配給影子群組的任何使用者都將被授予對 /etc/shadow 檔案的讀取權限。如果攻擊者可以獲得 /etc/shadow 檔案的讀取權限，他們就可以輕鬆地針對雜湊密碼執行密碼破解程式來破解它們。儲存在 /etc/shadow 檔案中的其他安全資訊（例如到期時間）也可能有助於破壞其他使用者帳戶。"
    remediation: "運行以下指令以移除所有用戶從 shadow 群組 # sed -ri 's/(^shadow:[^:]*:[^:]*:)([^:]+$)/\\1/' /etc/group 將 primary group 為 shadow 的所有用戶修改成另一 primary group。 # usermod -g <primary group> <user>."
    compliance:
      - cis: ["6.2.4"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["AC.L1-3.1.1", "AC.L1-3.1.2", "AC.L2-3.1.3", "AC.L2-3.1.5", "MP.L2-3.8.2"]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - iso_27001-2013: ["A.9.1.1"]
      - mitre_mitigations: ["M1022"]
      - mitre_tactics: ["TA0005"]
      - mitre_techniques: ["T1003", "T1003.008"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - pci_dss_v3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_v4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'f:/etc/group -> r:shadow:\w*:\d+:$'

  # 6.2.5 Ensure no duplicate UIDs exist. (Automated) - Not Implemented
  # 6.2.6 Ensure no duplicate GIDs exist. (Automated) - Not Implemented
  # 6.2.7 Ensure no duplicate user names exist. (Automated) - Not Implemented
  # 6.2.8 Ensure no duplicate group names exist. (Automated) - Not Implemented
  # 6.2.9 Ensure root PATH Integrity. (Automated) - Not Implemented

  # 6.2.10 Ensure root is the only UID 0 account. (Automated)
  - id: 19209
    title: "確保 root 是唯一的 UID 0 帳號。"
    description: "任何 UID 為 0 的帳戶都具有系統的超級使用者權限。"
    rationale: "此存取必須僅限於預設 root 帳戶並且只能透過系統控制台進行。管理存取必須透過非特權帳戶使用經批准的機制進行，如第 5.6 項所述，確保對 su 指令的存取受到限制。"
    remediation: "移除任何除了 root 以外 UID 為 0 的使用者，或在合適的情況下給他們分配一個新的 UID。"
    compliance:
      - cis: ["6.2.10"]
      - mitre_mitigations: ["M1026"]
      - mitre_tactics: ["TA0001"]
      - mitre_techniques: ["T1548"]
    condition: all
    rules:
      - 'not f:/etc/passwd -> !r:^\s*\t*# && !r:^root: && r:^\w+:\w+:0:'

  # 6.2.11 Ensure local interactive user home directories are configured. (Automated) - Not Implemented
  # 6.2.12 Ensure local interactive user dot files access is configured. (Automated) - Not Implemented
