# Security Configuration Assessment
# CIS Checks for Ubuntu Linux 14.04 LTS
# Copyright (C) 2015, Wazuh Inc.
#
# This program is free software; you can redistribute it
# and/or modify it under the terms of the GNU General Public
# License (version 2) as published by the FSF - Free Software
# Foundation
#
# Based on:
# Center for Internet Security Ubuntu Linux 14.04 LTS Benchmark v2.1.0 - 12-28-2017

policy:
  id: "cis_ubuntu14-04"
  file: "cis_ubuntu14-04.yml"
  name: "CIS Ubuntu Linux 14.04 LTS Benchmark v2.1.0"
  description: "This document provides prescriptive guidance for establishing a secure configuration posture for Ubuntu Linux 14.04 LTS."
  references:
    - https://www.cisecurity.org/cis-benchmarks/

requirements:
  title: "Check Ubuntu version"
  description: "Requirements for running the SCA scan against Ubuntu."
  condition: all
  rules:
    - "f:/etc/os-release -> r:Ubuntu"
    - "f:/proc/sys/kernel/ostype -> Linux"

checks:
  # 1.1.1 Disable unused filesystems
  - id: 19500
    title: "確保已停用cramfs檔案系統的安裝"
    description: "cramfs 檔案系統類型是嵌入在小型系統中的壓縮唯讀 Linux 檔案系統。無需先解壓縮影像即可使用cramfs影像。"
    rationale: "刪除對不需要的檔案系統類型的支援可以減少伺服器的本機攻擊面。如果不需要此檔案系統類型，請將其停用。"
    remediation: "1) 在 /etc/modprobe.d/ 目錄中編輯或創建以 .conf 結尾的檔案，添加以下行: install cramfs /bin/true。 2) 執行以下指令以卸載 cramfs 模組: # rmmod cramfs"
    compliance:
      - cis: ["1.1.1.1"]
      - cis_csc: ["13"]
      - pci_dss: ["2.2.5"]
      - tsc: ["CC6.3"]
    condition: all
    rules:
      - "c:modprobe -n -v cramfs -> r:^install /bin/true"
      - "not c:lsmod -> r:cramfs"

  - id: 19501
    title: "確保禁用 freevxfs 檔案系統的掛載"
    description: "freevxfs 檔案系統類型是 Veritas 類型檔案系統的免費版本。這是 HP-UX 作業系統的主要檔案系統類型。"
    rationale: "刪除對不需要的檔案系統類型的支援可以減少系統的本機攻擊面。如果不需要此檔案系統類型，請將其停用。"
    remediation: "編輯或創建一個在 /etc/modprobe.d/ 目錄下以 .conf 結尾的檔案 例子：vim /etc/modprobe.d/freevxfs.conf 並添加以下行：install freevxfs /bin/true 運行以下指令來卸載 freevxfs 模組：# rmmod freevxfs"
    compliance:
      - cis: ["1.1.1.2"]
      - cis_csc: ["13"]
      - pci_dss: ["2.2.5"]
      - tsc: ["CC6.3"]
    condition: all
    rules:
      - "c:modprobe -n -v freevxfs -> r:^install /bin/true"
      - "not c:lsmod -> r:freevxfs"

  - id: 19502
    title: "確保已停用 jffs2 檔案系統的安裝"
    description: "jffs2（日誌快閃檔案系統 2）檔案系統類型是在快閃記憶體裝置中使用的日誌結構檔案系統。"
    rationale: "刪除對不需要的檔案系統類型的支援可以減少系統的本機攻擊面。如果不需要此檔案系統類型，請將其停用。"
    remediation: "在 /etc/modprobe.d/ 目錄中編輯或創建一個以 .conf 結尾的檔案 例子: vim /etc/modprobe.d/jffs2.conf 並添加以下行: install jffs2 /bin/true 執行以下指令來卸載 jffs2 模組: # rmmod jffs2"
    compliance:
      - cis: ["1.1.1.3"]
      - cis_csc: ["13"]
      - pci_dss: ["2.2.5"]
      - tsc: ["CC6.3"]
    condition: all
    rules:
      - "c:modprobe -n -v jffs2 -> r:^install /bin/true"
      - "not c:lsmod -> r:jffs2"

  - id: 19503
    title: "確保禁用 hfs 檔案系統掛載"
    description: "hfs 檔案系統類型是一種分層檔案系統，可讓您掛載 Mac OS 檔案系統。"
    rationale: "刪除對不需要的檔案系統類型的支援可以減少系統的本機攻擊面。如果不需要此檔案系統類型，請將其停用。"
    remediation: "在 /etc/modprobe.d/ 目錄中編輯或建立以 .conf 結尾的檔案 例子: vim /etc/modprobe.d/hfs.conf 並添加以下行: install hfs /bin/true 執行以下指令以卸載 hfs 模組: # rmmod hfs"
    compliance:
      - cis: ["1.1.1.4"]
      - cis_csc: ["13"]
      - pci_dss: ["2.2.5"]
      - tsc: ["CC6.3"]
    condition: all
    rules:
      - "c:modprobe -n -v hfs -> r:^install /bin/true"
      - "not c:lsmod -> r:hfs"

  - id: 19504
    title: "確保禁用 hfsplus 檔案系統的掛載"
    description: "hfsplus 檔案系統類型是一種分層檔案系統，旨在取代 hfs，可讓您掛載 Mac OS 檔案系統。"
    rationale: "刪除對不需要的檔案系統類型的支援可以減少系統的本機攻擊面。如果不需要此檔案系統類型，請將其停用。"
    remediation: "在 /etc/modprobe.d/ 目錄中編輯或創建一個以 .conf 結尾的檔案例：vim /etc/modprobe.d/hfsplus.conf，並添加以下行：install hfsplus /bin/true運行以下指令以卸載 hfsplus 模組：# rmmod hfsplus"
    compliance:
      - cis: ["1.1.1.5"]
      - cis_csc: ["5.1"]
      - pci_dss: ["2.2.5"]
      - tsc: ["CC6.3"]
    condition: all
    rules:
      - "c:modprobe -n -v hfsplus -> r:^install /bin/true"
      - "not c:lsmod -> r:hfsplus"

  - id: 19505
    title: "確保禁用 udf 檔案系統的掛載"
    description: "udf 檔案系統類型是用於實作 ISO/IEC 13346 和 ECMA-167 規範的通用磁碟格式。這是一種開放供應商檔案系統類型，用於在各種媒體上儲存資料。此檔案系統類型對於支援寫入 DVD 和更新的光碟格式是必要的。"
    rationale: "刪除對不需要的檔案系統類型的支援可以減少系統的本機攻擊面。如果不需要此檔案系統類型，請將其停用。"
    remediation: "在 /etc/modprobe.d/ 目錄中編輯或創建一個以 .conf 結尾的檔案 示例：vim /etc/modprobe.d/udf.conf 並添加以下行：install udf /bin/true 執行以下指令以卸載 udf 模組：# rmmod udf"
    compliance:
      - cis: ["1.1.1.6"]
      - cis_csc: ["13"]
      - pci_dss: ["2.2.5"]
      - tsc: ["CC6.3"]
    condition: all
    rules:
      - "c:modprobe -n -v udf -> r:^install /bin/true"
      - "not c:lsmod -> r:udf"

  # 1.1.2 Filesystem Configuration
  - id: 19506
    title: "確保 /tmp 存在單獨的分割區"
    description: "/tmp 目錄是一個全域可寫入的目錄，用於所有使用者和某些應用程式的暫存。"
    rationale: "由於 /tmp 目錄是全域可寫入的，因此如果不將其綁定到單獨的分區，則存在資源耗盡的風險。此外，使 /tmp 成為自己的檔案系統允許管理員在掛載上設定 noexec 選項，從而使 /tmp 對於攻擊者安裝可執行程式碼而言毫無用處。它還可以防止攻擊者建立到系統 setuid 程式的硬連結並等待其更新。一旦程式被更新，硬連結就會被破壞，攻擊者就會擁有自己的程式副本。如果程式碰巧存在安全漏洞，攻擊者可以繼續利用已知的缺陷。"
    remediation: "對於新的安裝，在安裝期間創建自定義分區設置並為 /tmp 指定一個單獨的分區。對於之前安裝過的系統，創建一個新分區並適當地配置 /etc/fstab。"
    compliance:
      - cis: ["1.1.2"]
      - cis_csc: ["5.1"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    references:
      - http://tldp.org/HOWTO/LVM-HOWTO/
      - https://www.freedesktop.org/wiki/Software/systemd/APIFileSystems/
    condition: all
    rules:
      - 'c:mount -> r:\s/tmp\s'

  - id: 19507
    title: "確保 /tmp 分割區上設定了 nodev 選項"
    description: "nodev 掛載選項指定檔案系統不能包含特殊裝置。"
    rationale: "由於 /tmp 檔案系統不支援設備，因此設定此選項可確保使用者無法嘗試在 /tmp 中建立區塊或字元特殊設備。"
    remediation: "編輯 /etc/fstab 檔案，並在第四欄（掛載選項）中為 /tmp 分區添加 nodev。 請參閱 fstab(5) 手冊頁以獲取更多資訊。運行以下指令重新掛載 /tmp：# mount -o remount,nodev /tmp"
    compliance:
      - cis: ["1.1.3"]
      - cis_csc: ["5.1"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:mount -> r:\s/tmp\s && r:nodev'

  - id: 19508
    title: "確保 /tmp 分割區上設定了 nosuid 選項"
    description: "nosuid 掛載選項指定檔案系統不能包含設定的使用者 ID 檔案。"
    rationale: "由於 /tmp 檔案系統僅用於臨時檔案存儲，因此設定此選項可確保使用者無法在 /tmp 中建立 set userid 檔案。"
    remediation: "編輯 /etc/fstab 檔案並在第四欄（掛載選項）中為 /tmp 分區添加 nodev。更多資訊請參閱 fstab(5) 手冊頁。執行以下指令重新掛載 /tmp: # mount -o remount,nodev /tmp"
    compliance:
      - cis: ["1.1.4"]
      - cis_csc: ["5.1"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:mount -> r:\s/tmp\s && r:nosuid'

  - id: 19509
    title: "確保 /var 存在單獨的分區"
    description: "/var 目錄由守護程式和其他系統服務用來暫時儲存動態資料。這些程序所建立的某些目錄可能是全域可寫入的。"
    rationale: "由於/var目錄可能包含全域可寫入的檔案和目錄，如果不綁定到單獨的分區，則存在資源耗盡的風險。"
    remediation: "對於新安裝，安裝期間創建自訂分區設置並指定一個單獨的分區給 /var。對於先前安裝的系統，創建一個新分區並適當配置 /etc/fstab。"
    compliance:
      - cis: ["1.1.5"]
      - cis_csc: ["5.1"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    references:
      - http://tldp.org/HOWTO/LVM-HOWTO/
    condition: all
    rules:
      - 'c:mount -> r:\s/var\s'

  - id: 19510
    title: "確保 /var/tmp 存在單獨的分區"
    description: "/var/tmp 目錄是一個全域可寫入的目錄，用於所有使用者和某些應用程式的暫存。"
    rationale: "由於 /var/tmp 目錄是全域可寫入的，因此如果不將其綁定到單獨的分區，則存在資源耗盡的風險。此外，使 /var/tmp 成為自己的檔案系統允許管理員在掛載上設定 noexec 選項，從而使 /var/tmp 對於攻擊者安裝可執行程式碼來說毫無用處。它還可以防止攻擊者建立到系統 setuid 程式的硬連結並等待其更新。"
    remediation: "對於新安裝，在安裝過程中創建自訂分割區設置並為 /var/tmp 指定一個單獨分割區。對於之前安裝的系統，創建一個新的分割區並適當地配置 /etc/fstab。"
    compliance:
      - cis: ["1.1.6"]
      - cis_csc: ["5.1"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    references:
      - http://tldp.org/HOWTO/LVM-HOWTO/
    condition: all
    rules:
      - 'c:mount -> r:\s/var/tmp\s'

  - id: 19511
    title: "確保 /var/tmp 分割區上設定了 nodev 選項"
    description: "nodev 掛載選項指定檔案系統不能包含特殊裝置。"
    rationale: "由於 /var/tmp 檔案系統不支援設備，因此設定此選項可確保使用者無法嘗試在 /var/tmp 中建立區塊或字元特殊設備。"
    remediation: "編輯 /etc/fstab 檔案並在 /var/tmp 分區的第四欄（掛載選項）中添加 nodev。查看更多資訊，請參閱 fstab(5) 手冊頁。運行以下指令重新掛載 /var/tmp : # mount -o remount,nodev /var/tmp"
    compliance:
      - cis: ["1.1.7"]
      - cis_csc: ["5.1"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:mount -> r:\s/var/tmp\s && r:nodev'

  - id: 19512
    title: "確保 /var/tmp 分區上設定了 nosuid 選項"
    description: "nosuid 掛載選項指定檔案系統不能包含 setuid 檔案。"
    rationale: "由於 /var/tmp 檔案系統僅用於臨時檔案存儲，因此設定此選項可確保使用者無法在 /var/tmp 中建立 setuid 檔案。"
    remediation: "編輯 /etc/fstab 檔案並在第四欄（掛載選項）為 /var/tmp 分區添加 nosuid。詳情請參閱 fstab(5) 手冊頁。運行以下指令來重新掛載 /var/tmp: # mount -o remount,nosuid /var/tmp"
    compliance:
      - cis: ["1.1.8"]
      - cis_csc: ["5.1"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:mount -> r:\s/var/tmp\s && r:nosuid'

  - id: 19513
    title: "確保 /var/tmp 分割區上設定了 noexec 選項"
    description: "noexec 掛載選項指定檔案系統不能包含可執行二進位檔案。"
    rationale: "由於 /var/tmp 檔案系統僅用於臨時檔案存儲，因此設定此選項可確保使用者無法執行 /var/tmp 中的可執行二進位檔案。"
    remediation: "編輯 /etc/fstab 檔案並在 /var/tmp 分區的第四欄（掛載選項）中添加 noexec。詳情請參見 fstab(5) 手冊頁。運行以下指令重新掛載 /var/tmp：# mount -o remount,noexec /var/tmp"
    compliance:
      - cis: ["1.1.9"]
      - cis_csc: ["2"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:mount -> r:\s/var/tmp\s && r:noexec'

  - id: 19514
    title: "確保 /var/log 存在單獨的分割區"
    description: "/var/log 目錄用於系統服務儲存日誌資料。"
    rationale: "確保系統日誌儲存在單獨的分割區上有兩個重要原因：防止資源耗盡（因為日誌可能會變得非常大）和保護稽核資料。"
    remediation: "對於新的安裝，在安裝過程中創建一個自定義的分區設置，並為 /var/log 指定一個單獨的分區。對於已安裝的系統，創建一個新的分區並適當配置 /etc/fstab。"
    compliance:
      - cis: ["1.1.10"]
      - cis_csc: ["6.3"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    references:
      - http://tldp.org/HOWTO/LVM-HOWTO/
    condition: all
    rules:
      - 'c:mount -> r:\s/var/log\s'

  - id: 19515
    title: "確保 /var/log/audit 存在單獨的分區"
    description: "稽核守護程式auditd 將日誌資料儲存在/var/log/audit 目錄中。"
    rationale: "確保將auditd收集的資料儲存在單獨的分割區上有兩個重要原因：防止資源耗盡（因為audit.log檔案可能會變得很大）和保護稽核資料。審核守護程序計算剩餘的可用空間並根據結果執行操作。如果其他程序（例如 syslog）與auditd 佔用相同分割區中的空間，則它可能無法如預期執行。"
    remediation: "對於新安裝的系統，在安裝過程中創建自定義分區設置，並為 /var/log/audit 指定單獨的分區。對於先前已安裝的系統，創建新分區並適當配置 /etc/fstab。"
    compliance:
      - cis: ["1.1.11"]
      - cis_csc: ["6.3"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    references:
      - http://tldp.org/HOWTO/LVM-HOWTO/
    condition: all
    rules:
      - 'c:mount -> r:\s/var/log/audit\s'

  - id: 19516
    title: "確保 /home 存在單獨的分區"
    description: "/home目錄用於支援本機用戶的磁碟儲存需求。"
    rationale: "如果系統打算支援本機用戶，請為/home目錄建立一個單獨的分割區，以防止資源耗盡並限制/home下可以儲存的檔案類型。"
    remediation: "對於新安裝，在安裝過程中創建自訂分區設置並指定一個單獨的分區給 /home。對於已經安裝的系統，創建新的分區並適當地配置 /etc/fstab。"
    compliance:
      - cis: ["1.1.12"]
      - cis_csc: ["5.1"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    references:
      - http://tldp.org/HOWTO/LVM-HOWTO/
    condition: all
    rules:
      - 'c:mount -> r:\s/home\s'

  - id: 19517
    title: "確保 /home 分割區上設定了 nodev 選項"
    description: "在檔案系統上設定時，此選項可防止定義字元和區塊特殊設備，或如果存在，則防止將其用作字元和區塊特殊設備。"
    rationale: "由於使用者分區不支援設備，因此設定此選項可確保使用者無法嘗試建立區塊或字元特殊設備。  注意：此項目中的操作涉及 /home 分區，它是許多發行版中定義的預設使用者分區。如果您建立了其他使用者分割區，建議也將修復和審核步驟套用到這些分割區。"
    remediation: "編輯 /etc/fstab 檔案，並在第四欄（掛載選項）為 /home 分區添加 nodev。更多資訊請參見 fstab(5) 手冊頁。 # mount -o remount,nodev /home"
    compliance:
      - cis: ["1.1.13"]
      - cis_csc: ["5.1"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:mount -> r:\s/home\s && r:nodev'

  - id: 19518
    title: "確保在 /run/shm 分割區上設定了 nodev 選項"
    description: "nodev 掛載選項指定檔案系統不能包含特殊裝置。"
    rationale: "由於 /run/shm 檔案系統不支援設備，因此設定此選項可確保使用者無法嘗試在 /run/shm 分割區中建立特殊設備。"
    remediation: "編輯 /etc/fstab 檔案並在 /run/shm 分區的第四欄（掛載選項）中添加 nodev。請參閱 fstab(5) 手冊頁了解更多資訊。運行以下指令重新掛載 /run/shm： # mount -o remount,nodev /run/shm"
    compliance:
      - cis: ["1.1.14"]
      - cis_csc: ["5.1"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:mount -> r:\s/run/shm\s && r:nodev'

  - id: 19519
    title: "確保 /run/shm 分割區上設定了 nosuid 選項"
    description: "nosuid 掛載選項指定檔案系統不能包含 setuid 檔案。"
    rationale: "在檔案系統上設定此選項可防止使用者將特權程序引入系統並允許非 root 使用者執行它們。"
    remediation: "編輯 /etc/fstab 檔案並在 /run/shm 分區的第四個欄位（掛載選項）中添加 nosuid。更多資訊請參閱 fstab(5) 手冊頁。運行以下指令重新掛載 /run/shm: # mount -o remount,nosuid /run/shm"
    compliance:
      - cis: ["1.1.15"]
      - cis_csc: ["5.1"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:mount -> r:\s/run/shm\s && r:nosuid'

  - id: 19520
    title: "確保 /run/shm 分割區上設定了 noexec 選項"
    description: "noexec 掛載選項指定檔案系統不能包含可執行二進位檔案。"
    rationale: "在檔案系統上設定此選項可防止使用者從共享記憶體執行程式。這可以阻止用戶在系統上引入潛在的惡意軟體。"
    remediation: "編輯 /etc/fstab 檔案並在第四個字段（掛載選項）中為 /run/shm 分區添加 noexec。查看更多資訊，請參閱 fstab(5) 手冊頁。執行以下指令重新掛載 /run/shm：# mount -o remount,noexec /run/shm"
    compliance:
      - cis: ["1.1.16"]
      - cis_csc: ["2.6", "8"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:mount -> r:\s/run/shm\s && r:noexec'

  - id: 19521
    title: "停用自動掛載"
    description: "autofs 允許自動安裝設備，通常包括 CD/DVD 和 USB 驅動器。"
    rationale: "啟用自動掛載後，任何具有實體存取權限的人都可以連接 USB 隨身碟或光碟，並在系統中使用其內容，即使他們沒有自行掛載的權限。"
    remediation: "刪除或註解掉 /etc/init/autofs.conf 中的啟動行: # start on runlevel [2345]"
    compliance:
      - cis: ["1.1.21"]
      - cis_csc: ["8.4", "8.5"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - "c:initctl show-config autofs -> r:^autofs"

  # 1.3 Filesystem Integrity Checking
  - id: 19522
    title: "確保已安裝 AIDE"
    description: "AIDE 拍攝檔案系統狀態的快照，包括修改時間、權限和檔案雜湊值，然後可以與檔案系統的當前狀態進行比較，以偵測系統的修改。"
    rationale: "透過監視檔案系統狀態，可以偵測受損檔案，以防止或限制意外或惡意的錯誤配置或修改的二進位檔案的暴露。"
    remediation: "運行以下指令來安裝 AIDE：# apt-get install aide aide-common。根據您的環境配置 AIDE。請參閱 AIDE 檔案以了解選項。初始化 AIDE：# aideinit"
    compliance:
      - cis: ["1.3.1"]
      - cis_csc: ["14.9"]
      - pci_dss: ["11.5"]
      - tsc: ["PI1.4", "PI1.5", "CC6.8", "CC7.2", "CC7.3", "CC7.4"]
    reference:
      - "AIDE stable manual: http://aide.sourceforge.net/stable/manual.html"
    condition: all
    rules:
      - "c:dpkg -s aide -> r:install ok installed"

  - id: 19523
    title: "確保定期檢查檔案系統完整性"
    description: "需要定期檢查檔案系統完整性以檢測檔案系統的變更。"
    rationale: "定期檔案檢查允許系統管理員定期確定關鍵檔案是否已被未經授權的方式更改。"
    remediation: "運行以下指令: # crontab -u root -e   將以下行添加到 crontab:   0 5 * * * /usr/bin/aide.wrapper --config /etc/aide/aide.conf --check"
    compliance:
      - cis: ["1.3.2"]
      - cis_csc: ["14.9"]
      - pci_dss: ["11.5"]
      - tsc: ["PI1.4", "PI1.5", "CC6.8", "CC7.2", "CC7.3", "CC7.4"]
    condition: all
    rules:
      - 'c:grep -Rh aide /etc/cron.d /etc/cron.daily /etc/cron.hourly /etc/cron.monthly /etc/cron.weekly /etc/crontab -> r:\.+'
      - "c:crontab -u root -l -> !r:^# && r:/usr/bin/aide && r:--check"

  # 1.4 Secure Boot Settings
  - id: 19524
    title: "確保配置了引導程式配置的權限"
    description: "grub 設定檔包含有關引導設定和解鎖引導選項的密碼的資訊。 grub 配置通常是儲存在 /boot/grub 中的 grub.cfg。"
    rationale: "設定 root 的讀寫權限只能防止非 root 使用者檢視或變更啟動參數。讀取啟動參數的非 root 使用者可能能夠在啟動時識別安全漏洞並能夠利用它們。"
    remediation: "執行以下指令來設定你的 grub 配置檔案的權限: chown root:root /boot/grub/grub.cfg, chmod og-rwx /boot/grub/grub.cfg"
    compliance:
      - cis: ["1.4.1"]
      - cis_csc: ["5.1"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:stat /boot/grub/grub.cfg -> r:Access:\s*\(0\d00/-\w\w-------\)\s*Uid:\s*\(\s*\t*0/\s*\t*root\)\s*\t*Gid:\s*\(\s*\t*0/\s*\t*root\)'

  - id: 19525
    title: "確保設定了引導程式密碼"
    description: "設定引導程式密碼將要求任何重新啟動系統的人都必須輸入密碼才能設定指令列引導參數。"
    rationale: "在執行引導程式時要求輸入引導密碼將防止未經授權的使用者輸入引導參數或變更引導分割區。這可以防止使用者削弱安全性（例如在啟動時關閉 SELinux）。"
    remediation: '使用grub-mkpasswd-pbkdf2建立加密密碼: # grub-mkpasswd-pbkdf2    將以下內容新增到/etc/grub.d/00_header或自訂的/etc/grub.d設定檔中: cat <<EOF     set superusers="<username>"      password_pbkdf2 <username> <encrypted-password>  EOF     執行以下指令更新grub2設定:  # update-grub'
    compliance:
      - cis: ["1.4.2"]
      - cis_csc: ["5.1"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'f:/boot/grub/grub.cfg -> r:^\s*\t*set superusers'
      - 'f:/boot/grub/grub.cfg -> r:^\s*\t*password'

  - id: 19526
    title: "確保單一使用者模式所需的身份驗證"
    description: "單一使用者模式用於當系統在引導期間或透過引導程式手動選擇偵測到問題時進行復原。"
    rationale: "要求在單一用戶模式下進行身份驗證可防止未經授權的用戶將系統重新啟動為單用戶，以在沒有憑證的情況下獲得 root 權限。"
    remediation: "運行以下指令並按照提示為 root 用戶設置密碼：# passwd root"
    compliance:
      - cis: ["1.4.3"]
      - cis_csc: ["5.1"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: none
    rules:
      - "f:/etc/shadow -> r:^root:*:|^root:!:"

  # 1.5 Additional Process Hardening
  - id: 19527
    title: "確保核心轉儲受到限制"
    description: "核心轉儲是可執行程式的記憶體。它通常用於確定程式中止的原因。它還可用於從核心檔案中收集機密資訊。系統提供了為核心轉儲設定軟限制的功能，但這可以由使用者覆蓋。"
    rationale: "對核心轉儲設定硬限制可以防止使用者覆蓋軟變數。如果需要核心轉儲，請考慮為使用者群組設定限制（請參閱limits.conf(5)）。此外，將 fs.suid_dumpable 變數設為 0 將阻止 setuid 程式轉儲核心。"
    remediation: "將以下行添加到 /etc/security/limits.conf 或 /etc/security/limits.d/* 檔案中: * hard core 0 在 /etc/sysctl.conf 或 /etc/sysctl.d/* 檔案中設置以下參數: fs.suid_dumpable = 0 執行以下指令設置活動內核參數: # sysctl -w fs.suid_dumpable=0"
    compliance:
      - cis: ["1.5.1"]
      - cis_csc: ["13"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:sysctl fs.suid_dumpable -> r:=\s*\t*0$'
      - 'c:grep -Rh fs\.suid_dumpable /etc/sysctl.conf /etc/sysctl.d -> !r:^# && r:=\s*\t*0$'
      - 'c:grep -Rh ^*[[:space:]]*hard[[:space:]][[:space:]]*core[[:space:]][[:space:]]* /etc/security/limits.conf /etc/security/limits.d -> r:\s*\t*0$'

  - id: 19528
    title: "確保啟用 XD/NX 支持"
    description: "x86 系列中的最新處理器支援阻止基於每個記憶體頁執行程式碼的功能。一般而言，在 AMD 處理器上，此功能稱為「不執行」(NX)，而在 Intel 處理器上，此功能稱為「執行停用」(XD)。此功能有助於防止利用緩衝區溢位漏洞，應盡可能啟動。必須採取額外的步驟來確保啟用此保護，特別是在 32 位元 x86 系統上。其他處理器（例如 Itanium 和 POWER）從一開始就包含此類支持，而這些平台的標準核心也支援該功能。"
    rationale: "啟用任何可以防止緩衝區溢位攻擊的功能都可以增強系統的安全性。"
    remediation: "在 32 位系統上安裝支援 PAE 的內核，64 位系統則不需要安裝: 若有需要請配置您的開機載入程式以載入新的內核並重新啟動系統。您可能需要在 BIOS 中啟用 NX 或 XD 支援。"
    compliance:
      - cis: ["1.5.2"]
      - cis_csc: ["8.3"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:dmesg -> r:NX \(Execute Disable\) protection: active'

  - id: 19529
    title: "確保啟用位址空間佈局隨機化 (ASLR)"
    description: "位址空間佈局隨機化 (ASLR) 是一種漏洞緩解技術，它隨機排列程序關鍵資料區域的位址空間。"
    rationale: "隨機放置虛擬記憶體區域將使編寫記憶體頁面漏洞變得困難，因為記憶體放置將持續變化。"
    remediation: "在 /etc/sysctl.conf 或 /etc/sysctl.d/* 檔案中設置以下參數: kernel.randomize_va_space = 2 執行以下指令以設置活動內核參數: # sysctl -w kernel.randomize_va_space=2"
    compliance:
      - cis: ["1.5.3"]
      - cis_csc: ["8.3"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:grep -Rh ^kernel\.randomize_va_space /etc/sysctl.conf /etc/sysctl.d -> r:\s*\t*2$'
      - 'c:sysctl kernel.randomize_va_space -> r:^kernel.randomize_va_space\s*\t*=\s*\t*2'

  - id: 19530
    title: "確保預鏈接已停用"
    description: "prelink 是修改 ELF 共享庫和 ELF 動態連結二進位檔案的程序，其方式是動態連結器在啟動時執行重定位所需的時間顯著減少。"
    rationale: "預連結功能可能會幹擾 AIDE 的操作，因為它會更改二進位。如果惡意使用者能夠破壞 libc 等通用函式庫，預先連結也會增加系統的漏洞。"
    remediation: "執行以下指令以恢復二進位檔至正常狀態並卸載 prelink：prelink -ua && yum remove prelink"
    compliance:
      - cis: ["1.5.4"]
      - cis_csc: ["14.9"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: none
    rules:
      - "c:dpkg -s prelink -> r:install ok installed"

  # 1.6 Configure SELinux
  - id: 19531
    title: "確保引導程式配置中未停用 SELinux"
    description: "將 SELINUX 配置為在引導時啟用，並驗證它沒有被 grub 引導參數覆寫。"
    rationale: "必須在引導時在 grub 配置中啟用 SELinux，以確保它提供的控制不會被覆蓋。"
    remediation: '編輯 /etc/default/grub 並從所有 CMDLINE_LINUX 參數中刪除所有 selinux=0 和 enforcing=0 的實例:  GRUB_CMDLINE_LINUX_DEFAULT="quiet" GRUB_CMDLINE_LINUX=""      執行以下指令以更新 grub2 設定: # update-grub'
    compliance:
      - cis: ["1.6.1.1"]
      - cis_csc: ["14.6"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: none
    rules:
      - 'f:/boot/grub/grub.cfg -> r:^\s*\t*linux && r:selinux=0'
      - 'f:/boot/grub/grub.cfg -> r:^\s*\t*linux && r:enforcing=0'

  - id: 19532
    title: "確保 SELinux 狀態正在執行"
    description: "將 SELinux 設定為在系統引導時啟用。"
    rationale: "SELinux 必須在啟動時啟用，以確保它提供的控制始終有效。"
    remediation: "編輯 /etc/selinux/config 檔案以設置 SELINUX 參數：SELINUX=enforcing"
    compliance:
      - cis: ["1.6.1.2"]
      - cis_csc: ["14.6"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:sestatus -> r:^SELinux status:\s*enabled$'
      - 'c:sestatus -> r:^Current mode:\s*enforcing$'
      - 'c:sestatus -> r:^Mode from config file:\s*enforcing$'
      - 'f:/etc/selinux/config -> r:^\s*SELINUX\s*=\s*enforcing'

  - id: 19533
    title: "確保已配置 SELinux 策略"
    description: "配置 SELinux 以滿足或超過預設的目標策略，該策略僅限制守護程式和系統軟體。"
    rationale: "安全配置要求因網站而異。有些網站可能會強制執行比預設策略更嚴格的策略，這是完全可以接受的。此項旨在確保至少滿足預設建議。"
    remediation: "編輯 /etc/selinux/config 檔案以設置 SELINUXTYPE 參數：SELINUXTYPE=ubuntu"
    compliance:
      - cis: ["1.6.1.3"]
      - cis_csc: ["14.6"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:sestatus -> r:^Loaded policy name:\s+ubuntu|^Loaded policy name:\s+default|^Loaded policy name:\s+mls'
      - 'f:/etc/selinux/config -> r:^Loaded policy name:\s+ubuntu|^\s*SELINUXTYPE\s*=\s*default|^\s*SELINUXTYPE\s*=\s*mls'

  - id: 19534
    title: "確保不存在不受限制的守護程式"
    description: "SELinux 策略中未定義的守護程式將繼承其父程式的安全上下文。"
    rationale: "由於守護程序是從 init 程序啟動並下降的，因此它們將繼承安全上下文標籤 initrc_t 。這可能會導致意外後果，即給予程序的權限超過其所需的權限。"
    remediation: "調查審計過程中發現的任何無約束守護程式。它們可能需要指派一個現有的安全上下文或為其構建策略。"
    compliance:
      - cis: ["1.6.1.4"]
      - cis_csc: ["14.6"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: none
    rules:
      - "c:ps -eZ -> r:initrc && !r:tr|ps|egrep|bash|awk"

  - id: 19535
    title: "確保 AppArmor 在引導程式配置中未停用"
    description: "將 AppArmor 配置為在啟動時啟用，並驗證它是否未被引導程式引導參數覆蓋。"
    rationale: "AppArmor 必須在引導時在 grub 配置中啟用，以確保它提供的控制項不會被覆寫。"
    remediation: '編輯 /etc/default/grub 並從所有 CMDLINE_LINUX 參數中移除所有 apparmor=0 的實例:    GRUB_CMDLINE_LINUX_DEFAULT="quiet"    GRUB_CMDLINE_LINUX=""執行以下指令來更新 grub2 配置: # update-grub'
    compliance:
      - cis: ["1.6.2.1"]
      - cis_csc: ["14.6"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: none
    rules:
      - 'f:/boot/grub/grub.cfg -> r:^\s*\t*linux && r:apparmor=0'

  - id: 19536
    title: "確保所有 AppArmor 設定檔均得到執行"
    description: "AppArmor 設定檔定義應用程式能夠存取哪些資源。"
    rationale: "安全配置要求因網站而異。有些網站可能會強制執行比預設策略更嚴格的策略，這是完全可以接受的。此項旨在確保系統上存在的任何策略都已啟動。"
    remediation: "執行以下指令來將所有設定檔設置為強制模式：# aa-enforce /etc/apparmor.d/* 任何未受限制的程序可能需要為其創建或啟用設定檔，然後重新啟動它們。"
    compliance:
      - cis: ["1.6.2.2"]
      - cis_csc: ["14.6"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - "c:apparmor status -> r:0 profiles are in complain mode"
      - "c:apparmor status -> r:0 processes are unconfined"
      - 'c:apparmor status -> n:(\d+) profiles are loaded compare > 0'

  - id: 19537
    title: "確保已安裝 SELinux 或 AppArmor"
    description: "SELinux 和 AppArmor 提供強制存取控制。"
    rationale: "如果未安裝強制存取控制系統，則僅預設的自主存取控制系統可用。"
    remediation: "請運行以下任一指令來安裝 SELinux 或 apparmor： # apt-get install selinux 或： # apt-get install apparmor"
    compliance:
      - cis: ["1.6.3"]
      - cis_csc: ["14.6"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: any
    rules:
      - "c:dpkg -s selinux-basics -> r:install ok installed"
      - "c:dpkg -s apparmor -> r:install ok installed"

  # 1.7 Warning Banners
  - id: 19538
    title: "確保當天的訊息配置正確"
    description: "/etc/motd 檔案的內容在用戶登入後顯示給用戶，並作為經過身份驗證的用戶的當天訊息。基於 Unix 的系統通常在登入系統時顯示有關作業系統版本和修補程式層級的資訊。此資訊對於為特定作業系統平台開發軟體的開發人員非常有用。如果 Mingetty(8) 支援下列選項，它們會顯示作業系統資訊： \\m - 機器架構 \\r - 作業系統版本 \\s - 作業系統名稱 \\v - 作業系統版本"
    rationale: '警告訊息會通知嘗試登入系統的使用者有關系的法律狀態，並且必須包含擁有該系統的組織的名稱以及任何現有的監控策略。在登入橫幅中顯示作業系統和修補程式等級資訊也會產生副作用，即向試圖針對系統的特定漏洞進行攻擊的攻擊者提供詳細的系統資訊。授權使用者登入後可以透過執行「uname -a」指令輕鬆取得此資訊。'
    remediation: "編輯 /etc/motd 檔案，根據您的站點政策填寫適當內容，移除所有的 \\m 、 \\r 、 \\s 或 \\v 。"
    compliance:
      - cis: ["1.7.1.1"]
      - cis_csc: ["5.1"]
      - pci_dss: ["7.1"]
    condition: none
    rules:
      - 'f:/etc/motd -> r:\\v|\\r|\\m|\\s'

  - id: 19539
    title: "確保本地登入警告橫幅配置正確"
    description: "/etc/issue 檔案的內容在使用者登入本機終端之前顯示給使用者。基於 Unix 的系統通常在登入系統時顯示有關作業系統版本和修補程式層級的資訊。此資訊對於為特定作業系統平台開發軟體的開發人員非常有用。如果 Mingetty(8) 支援下列選項，它們會顯示作業系統資訊： \\m - 機器架構 \\r - 作業系統版本 \\s - 作業系統名稱 \\v - 作業系統版本"
    rationale: '警告訊息會通知嘗試登入系統的使用者有關系統的法律狀態，並且必須包含擁有該系統的組織的名稱以及任何現有的監控策略。在登入橫幅中顯示作業系統和修補程式等級資訊也會產生副作用，即向試圖針對系統的特定漏洞進行攻擊的攻擊者提供詳細的系統資訊。授權使用者登入後可以透過執行「uname -a」指令輕鬆取得此資訊。'
    remediation: "根據您的站點政策編輯 /etc/issue 檔案的適當內容，刪除任何 \\m 、 \\r 、 \\s 或 \\v 的實例：# echo \"僅限授權使用。所有活動可能會被監控和報告。\" > /etc/issue"
    compliance:
      - cis: ["1.7.1.2"]
      - cis_csc: ["5.1"]
    condition: none
    rules:
      - 'f:/etc/issue -> r:\\v|\\r|\\m|\\s'

  - id: 19540
    title: "確保遠端登入警告橫幅配置正確"
    description: "/etc/issue.net 檔案的內容在使用者從配置的服務登入遠端連線之前顯示給使用者。基於 Unix 的系統通常在登入系統時顯示有關作業系統版本和修補程式層級的資訊。此資訊對於為特定作業系統平台開發軟體的開發人員非常有用。如果 Mingetty(8) 支援下列選項，它們會顯示作業系統資訊： \\m - 機器架構 \\r - 作業系統版本 \\s - 作業系統名稱 \\v - 作業系統版本"
    rationale: '警告訊息會通知嘗試登入系統的使用者有關系統的法律狀態，並且必須包含擁有該系統的組織的名稱以及任何現有的監控策略。在登入橫幅中顯示作業系統和修補程式等級資訊也會產生副作用，即向試圖針對系統的特定漏洞進行攻擊的攻擊者提供詳細的系統資訊。授權使用者登入後可以透過執行「uname -a」指令輕鬆取得此資訊。'
    remediation: "編輯 /etc/issue.net 檔案，根據您的網站政策填入適當的內容，移除任何 \\m 、 \\r 、 \\s 或 \\v 的實例： # echo \"僅授權使用。所有活動可能被監控和報告。\" > /etc/issue.net"
    compliance:
      - cis: ["1.7.1.3"]
      - cis_csc: ["5.1"]
      - pci_dss: ["7.1"]
    condition: none
    rules:
      - 'f:/etc/issue.net -> r:\\v|\\r|\\m|\\s'

  - id: 19541
    title: "確保配置了 /etc/motd 的權限"
    description: "/etc/motd 檔案的內容在用戶登入後顯示給用戶，並作為經過身份驗證的用戶的當天訊息。"
    rationale: "如果 /etc/motd 檔案沒有正確的所有權，則未經授權的使用者可能會使用不正確或誤導性的資訊對其進行修改。"
    remediation: "執行以下指令來設定 /etc/motd 的權限: # chown root:root /etc/motd # chmod 644 /etc/motd"
    compliance:
      - cis: ["1.7.1.4"]
      - cis_csc: ["5.1"]
      - pci_dss: ["10.2.5"]
      - hipaa: ["164.312.b"]
      - nist_800_53: ["AU.14", "AC.7"]
      - gpg_13: ["7.8"]
      - gdpr_IV: ["35.7", "32.2"]
      - tsc: ["CC6.1", "CC6.8", "CC7.2", "CC7.3", "CC7.4"]
    condition: all
    rules:
      - 'c:stat /etc/motd -> r:Access:\s*\(0644/-rw-r--r--\)\s*Uid:\s*\(\s*\t*0/\s*\t*root\)\s*\t*Gid:\s*\(\s*\t*0/\s*\t*root\)'

  - id: 19542
    title: "確保配置了 /etc/issue 的權限"
    description: "/etc/issue 檔案的內容在使用者登入本機終端之前顯示給使用者。"
    rationale: "如果 /etc/issue 檔案沒有正確的所有權，則未經授權的使用者可能會使用不正確或誤導性的資訊對其進行修改。"
    remediation: "執行以下指令來設定/etc/issue的權限: # chown root:root /etc/issue # chmod 644 /etc/issue"
    compliance:
      - cis: ["1.7.1.5"]
      - cis_csc: ["5.1"]
      - pci_dss: ["10.2.5"]
      - hipaa: ["164.312.b"]
      - nist_800_53: ["AU.14", "AC.7"]
      - gpg_13: ["7.8"]
      - gdpr_IV: ["35.7", "32.2"]
      - tsc: ["CC6.1", "CC6.8", "CC7.2", "CC7.3", "CC7.4"]
    condition: all
    rules:
      - 'c:stat /etc/issue -> r:Access:\s*\(0644/-rw-r--r--\)\s*Uid:\s*\(\s*\t*0/\s*\t*root\)\s*\t*Gid:\s*\(\s*\t*0/\s*\t*root\)'

  - id: 19543
    title: "確保配置了 /etc/issue.net 上的權限"
    description: "/etc/issue.net 檔案的內容在使用者從配置的服務登入遠端連線之前顯示給使用者。"
    rationale: "如果 /etc/issue.net 檔案沒有正確的所有權，則未經授權的使用者可能會使用不正確或誤導性的資訊對其進行修改。"
    remediation: "請運行以下指令來設置 /etc/issue.net 的權限: # chown root:root /etc/issue.net # chmod 644 /etc/issue.net"
    compliance:
      - cis: ["1.7.1.6"]
      - cis_csc: ["5.1"]
      - pci_dss: ["10.2.5"]
      - hipaa: ["164.312.b"]
      - nist_800_53: ["AU.14", "AC.7"]
      - gpg_13: ["7.8"]
      - gdpr_IV: ["35.7", "32.2"]
      - tsc: ["CC6.1", "CC6.8", "CC7.2", "CC7.3", "CC7.4"]
    condition: all
    rules:
      - 'c:stat /etc/issue.net -> r:Access:\s*\(0644/-rw-r--r--\)\s*Uid:\s*\(\s*\t*0/\s*\t*root\)\s*\t*Gid:\s*\(\s*\t*0/\s*\t*root\)'

  - id: 19544
    title: "確保已配置 GDM 登入橫幅"
    description: "GDM 是 GNOME 顯示管理器，它處理基於 GNOME 的系統的圖形登入。"
    rationale: "警告訊息會通知嘗試登入系統的使用者有關系統的法律狀態，並且必須包含擁有該系統的組織的名稱以及任何現有的監控策略。"
    remediation: "建立 /etc/dconf/profile/gdm 檔案並加入以下內容：    user-db:user    system-db:gdm    file-db:/usr/share/gdm/greeter-dconf-defaults    建立或編輯 /etc/dconf/db/gdm.d/01-banner-message 中的 banner-message-enable 和 banner-message-text 選項：    [org/gnome/login-screen]    banner-message-enable=true    banner-message-text='僅限授權使用。所有活動可能被監控和報告。'  執行以下指令以更新系統資料庫：# dconf update"
    compliance:
      - cis: ["1.7.2"]
      - cis_csc: ["5.1"]
      - pci_dss: ["2.2.2"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - "f:/etc/dconf/profile/gdm -> r:^user-db:user"
      - "f:/etc/dconf/profile/gdm -> r:^system-db:gdm"
      - "f:/etc/dconf/profile/gdm -> r:^file-db:/usr/share/gdm/greeter-dconf-defaults"
      - 'd:/etc/dconf/db/gdm.d/ -> r:\. -> r:^[org/gnome/login-screen]'
      - 'd:/etc/dconf/db/gdm.d/ -> r:\. -> r:^banner-message-enable=true'
      - 'd:/etc/dconf/db/gdm.d/ -> r:\. -> r:^banner-message-text=\.+'

  - id: 19545
    title: "確保安裝更新、修補程式和其他安全軟體"
    description: "由於安全缺陷或包含附加功能，會定期發布包含的軟體的修補程式。"
    rationale: "較新的更新檔可能包含最新完整更新無法提供的安全性增強功能。因此，建議使用最新的軟體修補程式以利用最新的功能。與任何軟體安裝一樣，組織需要確定給定的更新是否符合其要求，並根據所選的更新版本驗證任何其他軟體的相容性和可支援性。"
    remediation: "使用你的套件管理器根據站點政策更新系統上的所有套件。注意：站點政策可能會規定在將可用更新安裝到生產系統之前進行測試期。"
    compliance:
      - cis: ["1.8"]
      - cis_csc: ["3.4", "3.5"]
      - pci_dss: ["5.2"]
      - nist_800_53: ["AU.6", "SI.4"]
      - gpg_13: ["4.2"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
      - tsc: ["A1.2"]
    condition: none
    rules:
      - "c:apt-get -s upgrade -> r:^The following packages will be upgraded"

  # 2 Services

  - id: 19546
    title: "確保chargen服務未啟用"
    description: "chargen 是一項網路服務，對於收到的每個連線都會使用 0 到 512 個 ASCII 字元進行回應。此服務旨在用於除錯和測試目的。建議停用此服務。"
    rationale: "禁用該服務將減少系統的遠端攻擊面。"
    remediation: "將 /etc/inetd.conf 和 /etc/inetd.d/* 中以 chargen 開頭的所有行註釋掉或移除, 在 /etc/xinetd.conf 和 /etc/xinetd.d/* 中將所有 chargen 服務設置為 disable = yes"
    compliance:
      - cis: ["2.1.1"]
      - cis_csc: ["9.1"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
      - tsc: ["CC5.2"]
    condition: none
    rules:
      - "f:/etc/inetd.conf -> r:^chargen"
      - 'd:/etc/inetd.d -> r:\. -> r:^chargen'

  - id: 19547
    title: "確保白天服務未啟用"
    description: "daytime 是一種網路服務，它以伺服器的當前日期和時間回應。此服務旨在用於除錯和測試目的。建議停用此服務。"
    rationale: "禁用該服務將減少系統的遠端攻擊面。"
    remediation: "將任何以 daytime 開頭的行註解掉或移除，從 /etc/inetd.conf 和 /etc/inetd.d/* 中。 在 /etc/xinetd.conf 和 /etc/xinetd.d/* 中對所有 daytime 服務設置 disable = yes"
    compliance:
      - cis: ["2.1.2"]
      - cis_csc: ["9.1"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
      - tsc: ["CC5.2"]
    condition: none
    rules:
      - "f:/etc/inetd.conf -> r:^daytime"
      - 'd:/etc/inetd.d/ -> r:\. -> r:^daytime'

  - id: 19548
    title: "確保未啟用丟棄服務"
    description: "丟棄是一種網路服務，它只是丟棄它接收到的所有資料。此服務旨在用於除錯和測試目的。建議停用此服務。"
    rationale: "禁用該服務將減少系統的遠端攻擊面。"
    remediation: "註解掉或刪除 /etc/inetd.conf 和 /etc/inetd.d/* 中所有以 discard 開頭的行。將 /etc/xinetd.conf 和 /etc/xinetd.d/* 中所有 discard 服務的 disable 設置為 yes。"
    compliance:
      - cis: ["2.1.3"]
      - cis_csc: ["9.1"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
      - tsc: ["CC5.2"]
    condition: none
    rules:
      - "f:/etc/inetd.conf -> r:^discard"
      - 'd:/etc/inetd.d/ -> r:\. -> r:^discard'

  - id: 19549
    title: "確保未啟用 echo 服務"
    description: "echo 是一種網路服務，它用客戶端傳送給它的資料來回應客戶端。此服務旨在用於除錯和測試目的。建議停用此服務。"
    rationale: "禁用該服務將減少系統的遠端攻擊面。"
    remediation: "將 /etc/inetd.conf 和 /etc/inetd.d/* 中任何以 echo 開頭的行註解掉或移除。將 /etc/xinetd.conf 和 /etc/xinetd.d/* 中所有 echo 服務設定為 disable = yes"
    compliance:
      - cis: ["2.1.4"]
      - cis_csc: ["9.1"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
      - tsc: ["CC5.2"]
    condition: none
    rules:
      - "f:/etc/inetd.conf -> r:^echo"
      - 'd:/etc/inetd.d/ -> r:\. -> r:^echo'

  - id: 19550
    title: "確保時間服務未啟用"
    description: "time 是一種網路服務，它以 32 位元整數形式回應伺服器的當前日期和時間。此服務旨在用於除錯和測試目的。建議禁用該服務"
    rationale: "禁用該服務將減少系統的遠端攻擊面。"
    remediation: "將 /etc/inetd.conf 和 /etc/inetd.d/* 中所有以 time 開頭的行註解掉或移除。在 /etc/xinetd.conf 和 /etc/xinetd.d/* 中將所有時間服務設置為 disable = yes。"
    compliance:
      - cis: ["2.1.5"]
      - cis_csc: ["9.1"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
      - tsc: ["CC5.2"]
    condition: none
    rules:
      - "f:/etc/inetd.conf -> r:^time"
      - 'd:/etc/inetd.d/ -> r:\. -> r:^time'

  - id: 19551
    title: "確保 rsh 伺服器未啟用"
    description: "Berkeley rsh-server（rsh、rlogin、rexec）套件包含以明文形式交換憑證的遺留服務。"
    rationale: "這些遺留服務包含許多安全漏洞，並已被更安全的 SSH 軟體包取代"
    remediation: "將 /etc/inetd.conf 和 /etc/inetd.d/* 中任何以 shell、login 或 exec 開頭的行註釋掉或移除。在 /etc/xinetd.conf 和 /etc/xinetd.d/* 中，對於所有的 shell、login 或 exec 服務設置 disable = yes"
    compliance:
      - cis: ["2.1.6"]
      - cis_csc: ["9.1"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
      - tsc: ["CC5.2"]
    condition: none
    rules:
      - "f:/etc/inetd.conf -> r:^shell"
      - 'd:/etc/inetd.d/ -> r:\. -> r:^shell'
      - "f:/etc/inetd.conf -> r:^login"
      - 'd:/etc/inetd.d/ -> r:\. -> r:^login'
      - "f:/etc/inetd.conf -> r:^exec"
      - 'd:/etc/inetd.d/ -> r:\. -> r:^exec'

  - id: 19552
    title: "確保通話伺服器未啟用"
    description: "此談話軟體使用戶可以透過終端會話跨系統發送和接收訊息。預設安裝談話客戶端（允許發起談話會話）。"
    rationale: "該軟體存在安全風險，因為它使用未加密的協定進行通訊。"
    remediation: "將 /etc/inetd.conf 和 /etc/inetd.d/* 中所有以 talk 或 ntalk 開頭的行註解或移除。將 /etc/xinetd.conf 和 /etc/xinetd.d/* 中所有 talk 或 ntalk 服務設置為 disable = yes。"
    compliance:
      - cis: ["2.1.7"]
      - cis_csc: ["9.1"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
      - tsc: ["CC5.2"]
    condition: none
    rules:
      - "f:/etc/inetd.conf -> r:^talk"
      - 'd:/etc/inetd.d/ -> r:\. -> r:^talk'
      - "f:/etc/inetd.conf -> r:^ntalk"
      - 'd:/etc/inetd.d/ -> r:\. -> r:^ntalk'

  - id: 19553
    title: "確保 telnet 伺服器未啟用"
    description: "telnet-server 軟體包包含 telnet 守護程序，它透過 telnet 協定接受來自其他系統的使用者的連線。"
    rationale: "telnet 協定不安全且未加密。使用未加密的傳輸媒體可以讓有權嗅探網路流量的使用者竊取憑證。 ssh 套件提供加密會話和更強的安全性。"
    remediation: "註解或移除 /etc/inetd.conf 和 /etc/inetd.d/* 中任何以 telnet 開頭的行。在 /etc/xinetd.conf 和 /etc/xinetd.d/* 中將所有 telnet 服務設定為 disable = yes。"
    compliance:
      - cis: ["2.1.8"]
      - cis_csc: ["9.1"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
      - tsc: ["CC5.2"]
    condition: none
    rules:
      - "f:/etc/inetd.conf -> r:^telnet"
      - 'd:/etc/inetd.d/ -> r:\. -> r:^telnet'

  - id: 19554
    title: "確保 tftp 伺服器未啟用"
    description: "簡單檔案傳輸協定 (TFTP) 是一種簡單的檔案傳輸協定，通常用於從引導伺服器自動傳輸設定或引導電腦。 tftpd 和 atftp 軟體包都用於定義和支援 TFTP 伺服器。"
    rationale: "TFTP 不支援身份驗證，也不確保資料的機密性或完整性。建議刪除 TFTP，除非有特定需要 TFTP。在這種情況下，配置服務時必須格外小心。"
    remediation: "註解或移除 /etc/inetd.conf 和 /etc/inetd.d/* 中所有以 tftp 開頭的行。在 /etc/xinetd.conf 和 /etc/xinetd.d/* 中對所有 tftp 服務設置 disable = yes"
    compliance:
      - cis: ["2.1.9"]
      - cis_csc: ["9.1"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
      - tsc: ["CC5.2"]
    condition: none
    rules:
      - "f:/etc/inetd.conf -> r:^tftp"
      - 'd:/etc/inetd.d/ -> r:\. -> r:^tftp'

  - id: 19555
    title: "確保 xinetd 未啟用"
    description: "eXtending Internet Daemon (xinetd) 是一個開源超級守護程序，它取代了原始的 inetd 守護程式。 xinetddaemon 偵聽眾所周知的服務並調度適當的守護程序以正確回應服務請求。"
    rationale: "如果不需要 xinetd 服務，建議刪除該軟體包。"
    remediation: "移除或註解掉 /etc/init/xinetd.conf 中的 start 行: # start on runlevel [2345]"
    compliance:
      - cis: ["2.1.10"]
      - cis_csc: ["9.2"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - "c:initctl show-config xinetd -> r:^xinetd"

  - id: 19556
    title: "確保 openbsd-inetd 未安裝"
    description: "inetd 守護程式偵聽眾所周知的服務並調度適當的守護程序以正確回應服務請求。"
    rationale: "如果不需要 inetd 服務，建議刪除該守護程式。"
    remediation: "運行以下指令以卸載 openbsd-inetd: apt-get remove openbsd-inetd"
    compliance:
      - cis: ["2.1.11"]
      - cis_csc: ["9.2"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
      - tsc: ["CC5.2"]
    condition: none
    rules:
      - "c:dpkg -s openbsd-inetd -> r:install ok installed"

  - id: 19557
    title: "確保時間同步正在使用"
    description: "系統時間應在環境中的所有系統之間同步。這通常是透過建立一個權威時間伺服器或一組伺服器並使所有系統將其時鐘與它們同步來完成的。"
    rationale: "時間同步對於支援 Kerberos 等時間敏感的安全機制非常重要，並且還確保記錄檔在整個企業中具有一致的時間記錄，這有助於取證調查。"
    remediation: "在沒有主機時間同步功能的實體系統或虛擬系統上，請使用以下其中一個指令安裝NTP或chrony: # apt-get install ntp # apt-get install chrony 在具備主機時間同步功能的虛擬系統上，請查閱您的虛擬化軟體檔案並設置主機同步功能。"
    compliance:
      - cis: ["2.2.1.1"]
      - cis_csc: ["6.1"]
      - pci_dss: ["10.4"]
      - nist_800_53: ["AU.8"]
      - tsc: ["CC6.1", "CC6.8", "CC7.2", "CC7.3", "CC7.4"]
    condition: any
    rules:
      - "c:dpkg -s ntp -> r:install ok installed"
      - "c:dpkg -s chrony -> r:install ok installed"

  - id: 19558
    title: "確保 ntp 已配置"
    description: "ntp 是一個實作網路時間協定（NTP）的守護程式。它旨在同步各種系統之間的系統時鐘並使用高度準確的來源。有關 NTP 的更多資訊，請存取 http://www.ntp.org。 ntp 可以設定為客戶端和/或伺服器。此建議僅適用於系統上使用 ntp 的情況。"
    rationale: "如果系統上使用 ntp，正確的配置對於確保時間同步正常運作至關重要。"
    remediation: "在 /etc/ntp.conf 中新增或編輯限制行以符合以下內容：restrict -4 default kod nomodify notrap nopeer noquery restrict -6 default kod nomodify notrap nopeer noquery 新增或編輯伺服器或資源池行至 /etc/ntp.conf 中，視情況而定：server <remote-server> 透過新增或編輯 /etc/init.d/ntp 檔案來配置 ntp 以 ntp 用戶的身份運行：RUNASUSER=ntp"
    compliance:
      - cis: ["2.2.1.2"]
      - cis_csc: ["6.1"]
      - pci_dss: ["2.2.2"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    references:
      - http://www.ntp.org/
    condition: all
    rules:
      - 'f:/etc/ntp.conf -> r:^restrict\s+-4\s+default|^restrict\s+default && r:\s+kod\s+ && r:\s+nomodify\s+ && r:\s+notrap\s+ && r:\s+nopeer\s+ && r:\s+noquery'
      - 'f:/etc/ntp.conf -> r:^restrict\s+-6\s+default && r:\s+kod\s+ && r:\s+nomodify\s+ && r:\s+notrap\s+ && r:\s+nopeer\s+ && r:\s+noquery'
      - 'f:/etc/ntp.conf -> r:^server\.+|^pool\.+'
      - 'f:/etc/init.d/ntp -> r:^RUNASUSER\s*\t*=\s*\t*ntp'

  - id: 19559
    title: "確保配置了 chrony"
    description: "chrony 是一個實作網路時間協定 (NTP) 的守護程序，旨在跨各種系統同步系統時鐘並使用高度準確的來源。有關 chrony 的更多資訊，請存取 http://chrony.tuxfamily.org/。 chrony 可以設定為客戶端和/或伺服器。"
    rationale: "如果系統上使用 chrony，正確的配置對於確保時間同步正常運作至關重要。此建議僅適用於系統上使用 chrony 的情況。"
    remediation: "視需要將伺服器或池的行添加或編輯到 /etc/chrony/chrony.conf: server <remote-server>"
    compliance:
      - cis: ["2.2.1.3"]
      - cis_csc: ["6.1"]
      - pci_dss: ["2.2.2"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'f:/etc/chrony.conf -> r:^server\.+|^pool\.+'

  # 2.2.2 Ensure the X Window system is not installed (Scored)
  - id: 19560
    title: "確保未安裝 X Window 系統"
    description: "X Window 系統提供了圖形使用者介面 (GUI)，使用者可以在其中擁有多個視窗來運行程式和各種附加元件。 X Windows 系統通常用於使用者登入的工作站，但不適用於使用者通常不登入的伺服器。"
    rationale: "除非您的組織特別需要透過 X Windows 進行圖形登入存取，否則請將其刪除以減少潛在的攻擊面。"
    remediation: "執行以下指令以刪除 X Windows 系統套件: apt-get remove xserver-xorg*"
    compliance:
      - cis: ["2.2.2"]
      - cis_csc: ["2.6"]
      - pci_dss: ["2.2.2"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2", "CC6.1", "CC6.8", "CC7.1", "CC7.2", "CC8.1"]
    condition: none
    rules:
      - 'c:dpkg -l xserver-xorg-core* -> r:^\wi\s*xserver-xorg'

  - id: 19561
    title: "確保 Avahi 伺服器未啟用"
    description: "Avahi 是一個免費的 Zeroconf 實作，包括用於多播 DNS/DNS-SD 服務發現的系統。 Avahi 允許程式發布和發現在本機網路上執行的服務和主機，無需進行特定配置。例如，使用者可以將電腦插入網路，Avahi 會自動尋找要列印的印表機、要查看的檔案和要交談的人，以及電腦上執行的網路服務。"
    rationale: "系統功能通常不需要自動發現網路服務。建議停用該服務以減少潛在的連接表面。"
    remediation: "移除或註解掉 /etc/init/avahi-daemon.conf 裡的啟動行: #start on runlevel [2345]"
    compliance:
      - cis: ["2.2.3"]
      - cis_csc: ["9.2"]
      - pci_dss: ["2.2.2"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - "c:initctl show-config avahi-daemon -> r:^avahi-daemon"

  - id: 19562
    title: "確保 CUPS 未啟用"
    description: "通用 Unix 列印系統 (CUPS) 提供了列印到本機和網路印表機的功能。運行 CUPS 的系統還可以接受來自遠端系統的列印作業並將其列印到本機印表機。它還提供基於網路的遠端管理功能。"
    rationale: "如果系統不需要列印作業或接受其他系統的列印作業，建議停用CUPS以減少潛在的攻擊面。"
    remediation: "在 /etc/init/cups.conf 檔案中，移除或註解掉起始行: #start on runlevel [2345]"
    compliance:
      - cis: ["2.2.4"]
      - cis_csc: ["9.2"]
      - pci_dss: ["2.2.2"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    references:
      - https://www.cups.org
    condition: all
    rules:
      - "c:initctl show-config cups -> r:^cups"

  - id: 19563
    title: "確保 DHCP 伺服器未啟用"
    description: "動態主機設定協定 (DHCP) 是一項允許為電腦動態指派 IP 位址的服務。"
    rationale: "除非系統專門設定為充當 DHCP 伺服器，否則建議刪除此服務以減少潛在的攻擊面。"
    remediation: "刪除或註解掉 /etc/init/isc-dhcp-server.conf 和 /etc/init/isc-dhcp-server6.conf 中的啟動行: #start on runlevel [2345]"
    references:
      - https://www.isc.org/dhcp/
    compliance:
      - cis: ["2.2.5"]
      - cis_csc: ["9.2"]
      - pci_dss: ["2.2.2"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - "c:initctl show-config isc-dhcp-server -> r:^isc-dhcp-server"
      - "c:initctl show-config isc-dhcp-server6 -> r:^isc-dhcp-server6"

  - id: 19564
    title: "確保 LDAP 伺服器未啟用"
    description: "引入輕量級目錄存取協定 (LDAP) 作為 NIS/YP 的替代品。它是一種提供從中央資料庫中尋找資訊的方法的服務。"
    rationale: "如果系統不需要充當 LDAP 伺服器，建議停用該軟體以減少潛在的攻擊面。"
    remediation: "執行以下指令以停用slapd：# update-rc.d slapd disable"
    compliance:
      - cis: ["2.2.6"]
      - cis_csc: ["9.2"]
      - pci_dss: ["2.2.2"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    references:
      - https://www.openldap.org
    condition: all
    rules:
      - 'c:ls /etc/rc*.d/S*slapd -> !r:\.+|No such file or directory'

  - id: 19565
    title: "確保未啟用 NFS 和 RPC"
    description: "網路檔案系統 (NFS) 是 UNIX 環境中最早且分佈最廣泛的檔案系統之一。它為系統提供了透過網路掛載其他伺服器的檔案系統的能力。"
    rationale: "如果系統不匯出NFS共用或充當NFS客戶端，建議停用這些服務以減少遠端攻擊面。"
    remediation: "在 /etc/init/rpcbind.conf 移除或註解掉 start 行: # start on start-rpcbind 執行以下指令以禁用 nfs-kernel-server: # update-rc.d nfs-kernel-server disable"
    compliance:
      - cis: ["2.2.7"]
      - cis_csc: ["9.2"]
      - pci_dss: ["2.2.2"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:ls /etc/rc*.d/S*nfs-kernel-serverr -> !r:\.+|No such file or directory'
      - "c:initctl show-config rpcbind -> r:^rpcbind"

  - id: 19566
    title: "確保 DNS 伺服器未啟用"
    description: "網域名稱系統 (DNS) 是一種分層命名系統，它將名稱對應到連接到網路的電腦、服務和其他資源的 IP 位址。"
    rationale: "除非專門指定系統充當 DNS 伺服器，否則建議刪除該軟體包以減少潛在的攻擊面。"
    remediation: "執行以下指令以停用 bind9: # update-rc.d bind9 disable"
    compliance:
      - cis: ["2.2.8"]
      - cis_csc: ["9.2"]
      - pci_dss: ["2.2.2"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c: ls /etc/rc*.d/S*bind9 -> !r:\.+|No such file or directory'

  - id: 19567
    title: "確保 FTP 伺服器未啟用"
    description: "檔案傳輸協定 (FTP) 為聯網電腦提供了傳輸檔案的能力。"
    rationale: "FTP 不保護資料或身分驗證憑證的機密性。如果需要傳輸檔案，建議使用sftp。除非需要將系統作為FTP伺服器運行（例如，允許匿名下載），否則建議刪除該軟體包以減少潛在的攻擊面。"
    remediation: "在 /etc/init/vsftpd.conf 檔案中移除或註解掉啟動行: # start on runlevel [2345] or net-device-up IFACE!=lo"
    compliance:
      - cis: ["2.2.9"]
      - cis_csc: ["9.2"]
      - pci_dss: ["2.2.2"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - "c:initctl show-config vsftpd -> r:^vsftpd"

  - id: 19568
    title: "確保 HTTP 伺服器未啟用"
    description: "HTTP 或 Web 伺服器提供託管網站內容的能力。"
    rationale: "除非需要將系統作為Web伺服器運行，否則建議刪除該軟體包以減少潛在的攻擊面。"
    remediation: "執行以下指令來停用 apache2: # update-rc.d apache2 disable"
    compliance:
      - cis: ["2.2.10"]
      - cis_csc: ["9.2"]
      - pci_dss: ["2.2.2"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:ls /etc/rc*.d/S*apache2 -> !r:\.+|No such file or directory'

  - id: 19569
    title: "確保 IMAP 和 POP3 伺服器未啟用"
    description: "dovecot 是一個開源 IMAP 和 POP3 伺服器，適用於基於 Linux 的系統。"
    rationale: "除非系統要提供 POP3 和/或 IMAP 伺服器，否則建議刪除該服務以減少潛在的攻擊面。"
    remediation: "移除或註解掉 /etc/init/dovecot.conf 中的啟動行： # start on runlevel [2345]"
    compliance:
      - cis: ["2.2.11"]
      - cis_csc: ["9.2"]
      - pci_dss: ["2.2.2"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - "c:initctl show-config dovecot -> r:^dovecot"

  - id: 19570
    title: "確保 Samba 未啟用"
    description: "Samba 守護程序可讓系統管理員將其 Linux 系統設定為與 Windows 桌面共用檔案系統和目錄。 Samba 將透過小消息區塊 (SMB) 協定通告檔案系統和目錄。 Windows 桌面用戶將能夠將這些目錄和檔案系統作為磁碟機安裝在其系統上。"
    rationale: "如果不需要將目錄和檔案系統掛載到Windows系統上，那麼可以刪除這個服務，以減少潛在的攻擊面。"
    remediation: "將 /etc/init/smbd.conf 中的啟動行移除或註解掉：# start on (local-filesystems and net-device-up)"
    compliance:
      - cis: ["2.2.12"]
      - cis_csc: ["9.2"]
      - pci_dss: ["2.2.2"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - "c:initctl show-config smbd -> r:^smbd"

  - id: 19571
    title: "確保 HTTP 代理伺服器未啟用"
    description: "Squid 是許多發行版和環境中使用的標準代理伺服器。"
    rationale: "如果不需要代理伺服器，建議刪除squid代理，以減少潛在的攻擊面。"
    remediation: "移除或註釋掉 /etc/init/squid3.conf 中的啟動行: # start on runlevel [2345]"
    compliance:
      - cis: ["2.2.13"]
      - cis_csc: ["9.2"]
      - pci_dss: ["2.2.2"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - "c:initctl show-config squid3 -> r:^squid3"

  - id: 19572
    title: "確保 SNMP 伺服器未啟用"
    description: "簡單網路管理協定（SNMP）伺服器用於偵聽來自 SNMP 管理系統的 SNMP 指令，執行指令或收集訊息，然後將結果傳回請求系統。"
    rationale: "SNMP 伺服器可以使用 SNMP v1 進行通訊，該協定以明文方式傳輸資料，並且不需要身份驗證即可執行指令。除非絕對必要，建議不要使用 SNMP 服務。如果需要 SNMP，則應將伺服器設定為不允許 SNMP v1。"
    remediation: "執行以下指令以停用 snmpd: # update-rc.d snmpd disable"
    compliance:
      - cis: ["2.2.14"]
      - cis_csc: ["9.2"]
      - pci_dss: ["2.2.2"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:ls /etc/rc*.d/S*snmpd -> !r:\.+|No such file or directory'

  - id: 19573
    title: "確保郵件傳輸代理程式配置為僅本機模式"
    description: "郵件傳輸代理程式 (MTA)，例如 sendmail 和 Postfix，用於偵聽傳入郵件並將訊息傳送到適當的使用者或郵件伺服器。如果系統不打算用作郵件伺服器，建議將 MTA 設定為僅處理本機郵件。"
    rationale: "所有郵件傳輸代理程式的軟體都很複雜，而且大多數都存在長期的安全性問題。雖然確保系統可以處理本地郵件訊息很重要，但沒有必要讓 MTA 的守護程序偵聽端口，除非伺服器打算成為接收和處理來自其他系統的郵件的郵件伺服器。"
    remediation: "編輯 /etc/postfix/main.cf 並在\"RECEIVING MAIL\"部分添加以下行。如果該行已經存在，請將其更改為如下所示： inet_interfaces = loopback-only 。重啟 postfix： #  service postfix restart"
    compliance:
      - cis: ["2.2.15"]
      - cis_csc: ["9.2"]
      - pci_dss: ["2.2.2"]
      - nist_800_53: ["CM.1", "AC.4", "SC.7"]
      - tsc: ["CC5.2", "CC6.4", "CC6.6", "CC6.7"]
    condition: none
    rules:
      - 'c:netstat -an -> r:\.*:25\.*LISTEN && !r:127.0.0.1:25\.+LISTEN|::1:25\.*LISTEN'

  - id: 19574
    title: "確保 rsync 服務未啟用"
    description: "rsyncd 服務可用於透過網路連結在系統之間同步檔案。"
    rationale: "rsyncd 服務有安全風險，因為它使用未加密的協定進行通訊。"
    remediation: "編輯 /etc/default/rsync 檔案並將 RSYNC_ENABLE 設定為 false :RSYNC_ENABLE=false"
    compliance:
      - cis: ["2.2.16"]
      - cis_csc: ["9.2"]
      - pci_dss: ["2.2.2"]
      - nist_800_53: ["CM.1"]
    condition: all
    rules:
      - "f:/etc/default/rsync -> r:^RSYNC_ENABLE=false"

  - id: 19575
    title: "確保 NIS 伺服器未啟用"
    description: "網路資訊服務 (NIS)（以前稱為黃頁）是一種用於分發系統設定檔的用戶端伺服器目錄服務協定。 NIS 伺服器是允許分發設定檔的程式的集合。"
    rationale: "NIS 服務本質上是一個不安全的系統，容易受到 DOS 攻擊、緩衝區溢出，並且查詢 NIS 映射的身份驗證很差。 NIS 通常被輕量級目錄存取協定 (LDAP) 等協定所取代。建議停用該服務並使用其他更安全的服務"
    remediation: "刪除或註解掉 /etc/init/ypserv.conf 裡的開頭行:    #start on (started portmap ON_BOOT=     #or (started portmap ON_BOOT=y               #and ((filesystem and static-network-up) or failsafe-boot)))"
    compliance:
      - cis: ["2.2.17"]
      - cis_csc: ["9.2"]
      - pci_dss: ["2.2.2"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - "c:initctl show-config ypserv -> r:^ypserv"

  - id: 19576
    title: "確保未安裝 NIS 用戶端"
    description: "網路資訊服務 (NIS)，以前稱為黃頁，是一種用於分發系統設定檔的用戶端伺服器目錄服務協定。"
    rationale: "NIS 服務本質上是一個不安全的系統，容易受到 DOS 攻擊、緩衝區溢出，並且查詢 NIS 映射的身份驗證很差。 NIS 通常已被輕量級目錄存取協定 (LDAP) 等協定所取代。建議刪除該服務。"
    remediation: "卸載 nis 軟體包: # apt-get remove nis"
    compliance:
      - cis: ["2.3.1"]
      - cis_csc: ["2.6"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
      - tsc: ["CC5.2"]
    condition: none
    rules:
      - "c:dpkg -s nis -> r:install ok installed"

  - id: 19577
    title: "確保未安裝 rsh 用戶端"
    description: "rshpackage 包含 rsh 服務的客戶端指令。"
    rationale: "這些舊版客戶端存在大量安全漏洞，已被更安全的 SSH 軟體包取代。即使伺服器被刪除，最好也確保客戶端也被刪除，以防止使用者無意中嘗試使用這些指令並因此暴露其憑證。請注意，刪除 rsh 軟體包會刪除 rsh、rcp 和 rlogin 的用戶端。"
    remediation: "執行以下指令以卸載rsh: apt-get remove rsh-client rsh-redone-client"
    compliance:
      - cis: ["2.3.2"]
      - cis_csc: ["2.6", "4.5"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
      - tsc: ["CC5.2"]
    condition: none
    rules:
      - "c:dpkg -s rsh-client -> r:install ok installed"
      - "c:dpkg -s rsh-redone-client -> r:install ok installed"

  - id: 19578
    title: "確保未安裝談話用戶端"
    description: "此談話軟體使用戶可以透過終端會話跨系統發送和接收訊息。預設會安裝talkclient，它允許初始化通話會話。"
    rationale: "該軟體存在安全風險，因為它使用未加密的協定進行通訊。"
    remediation: "要卸載talk，請運行以下指令: apt-get remove talk"
    compliance:
      - cis: ["2.3.3"]
      - cis_csc: ["2.6"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
      - tsc: ["CC5.2"]
    condition: none
    rules:
      - "c:dpkg -s talk -> r:install ok installed"

  - id: 19579
    title: "確保未安裝 telnet 用戶端"
    description: "telnet 軟體包包含 telnet 用戶端，它允許使用者透過 telnet 協定啟動與其他系統的連線。"
    rationale: "telnet 協定不安全且未加密。使用未加密的傳輸媒體可能會導致未經授權的使用者竊取憑證。 ssh 軟體包提供加密會話和更強的安全性，並包含在大多數 Linux 發行版中。"
    remediation: "運行以下指令來卸載telnet: # apt-get remove telnet"
    compliance:
      - cis: ["2.3.4"]
      - cis_csc: ["2.6", "4.5"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
      - tsc: ["CC5.2"]
    condition: none
    rules:
      - "c:dpkg -s telnet -> r:install ok installed"

  - id: 19580
    title: "確保未安裝 LDAP 用戶端"
    description: "引入輕量級目錄存取協定 (LDAP) 作為 NIS/YP 的替代品。它是一種提供從中央資料庫中尋找資訊的方法的服務。"
    rationale: "如果系統不需要充當 LDAP 用戶端，建議刪除該軟體以減少潛在的攻擊面。"
    remediation: "執行以下指令以解除安裝 openldap-clients : # apt-get remove ldap-utils"
    compliance:
      - cis: ["2.3.5"]
      - cis_csc: ["2.6"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
      - tsc: ["CC5.2"]
    condition: none
    rules:
      - "c:dpkg -s ldap-utils -> r:install ok installed"

  ############################
  #  3 Network Configuration #
  ############################

  - id: 19581
    title: "確保 IP 轉送已停用"
    description: "net.ipv4.ip_forward 標誌用於告訴系統是否可以轉送封包。"
    rationale: "將標誌設為 0 可確保具有多個介面的系統（例如硬代理）永遠無法轉送封包，因此永遠無法充當路由器。"
    remediation: "在 /etc/sysctl.conf 或 /etc/sysctl.d/* 檔案中設定以下參數：net.ipv4.ip_forward = 0 跑以下指令設定活動中的內核參數：# sysctl -w net.ipv4.ip_forward=0 # s # sysctl -w net.ipv4.route.flush=1"
    compliance:
      - cis: ["3.1.1"]
      - cis_csc: ["5.1"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:sysctl net.ipv4.ip_forward -> r:=\s*\t*0$'
      - 'c:grep -Rh net\.ipv4\.ip_forward /etc/sysctl.conf /etc/sysctl.d -> r:^net.ipv4.ip_forward\s*=\s*0$'

  - id: 19582
    title: "確保封包重新導向發送已停用"
    description: "ICMP 重新導向用於向其他主機發送路由資訊。由於主機本身不充當路由器（在僅主機配置中），因此無需發送重新導向。"
    rationale: "攻擊者可以使用受感染的主機向其他路由器設備發送無效的 ICMP 重新導向，試圖破壞路由並讓使用者存取攻擊者設定的系統而不是有效的系統。"
    remediation: "在 /etc/sysctl.conf 中將 net.ipv4.conf.all.send_redirects 和 net.ipv4.conf.default.send_redirects 參數設為 0: net.ipv4.conf.all.send_redirects=0    net.ipv4.conf.default.send_redirects=0    修改當前內核參數以匹配: # sysctl -w net.ipv4.conf.all.send_redirects=0    # sysctl -w net.ipv4.conf.default.send_redirects=0    # sysctl -w net.ipv4.route.flush=1"
    compliance:
      - cis: ["3.1.2"]
      - cis_csc: ["5.1"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:sysctl net.ipv4.conf.all.send_redirects -> r:=\s*\t*0$'
      - 'c:sysctl net.ipv4.conf.default.send_redirects -> r:=\s*\t*0$'
      - 'c:grep -Rh net\.ipv4\.conf\.all\.send_redirects /etc/sysctl.conf /etc/sysctl.d -> r:^net.ipv4.conf.all.send_redirects\s*=\s*0$'
      - 'c:grep -Rh net\.ipv4\.conf\.default\.send_redirects /etc/sysctl.conf /etc/sysctl.d -> r:^net.ipv4.conf.default.send_redirects\s*=\s*0$'

  - id: 19583
    title: "確保來源路由資料包不被接受"
    description: "在網路中，來源路由允許發送者部分或完全指定資料包通過網路的路由。相反，非來源路由資料包沿著網路中的路由器確定的路徑行進。在某些情況下，系統可能無法從某些位置路由或存取（例如私人位址與網際網路可路由），因此需要使用來源路由封包。"
    rationale: "將 net.ipv4.conf.all.accept_source_route、net.ipv4.conf.default.accept_source_route 設定為 0 將禁止系統接受來源路由封包。假設該系統能夠將封包路由到一個介面上的 Internet 可路由位址和另一介面上的專用位址。假設私有位址不可路由至網際網路可路由位址，反之亦然。在正常路由情況下，來自 Internet 的可路由位址系統的攻擊者無法利用該系統作為到達專用位址系統的路徑。然而，如果允許來源路由資料包，則可以使用它們來存取專用位址系統，因為可以指定路由，而不是依賴不允許此路由的路由協定。"
    remediation: "將以下參數設定在 /etc/sysctl.conf 或 /etc/sysctl.d/* 檔案中: net.ipv4.conf.all.accept_source_route = 0 net.ipv4.conf.default.accept_source_route = 0 。執行以下指令設定即時核心參數: # sysctl -w net.ipv4.conf.all.accept_source_route=0 # sysctl -w net.ipv4.conf.default.accept_source_route=0  # sysctl -w net.ipv4.route.flush=1"
    compliance:
      - cis: ["3.2.1"]
      - cis_csc: ["5.1"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:sysctl net.ipv4.conf.all.accept_source_route -> r:=\s*\t*0$'
      - 'c:sysctl net.ipv4.conf.default.accept_source_route -> r:=\s*\t*0$'
      - 'c:grep -Rh net\.ipv4\.conf\.all\.accept_source_route /etc/sysctl.conf /etc/sysctl.d -> r:^net.ipv4.conf.all.accept_source_route\s*=\s*0$'
      - 'c:grep -Rh net\.ipv4\.conf\.default\.accept_source_route /etc/sysctl.conf /etc/sysctl.d -> r:^net.ipv4.conf.default.accept_source_route\s*=\s*0$'

  - id: 19584
    title: "確保不接受 ICMP 重新導向"
    description: "ICMP 重新導向訊息是傳送路由資訊並告訴主機（充當路由器）透過備用路徑發送封包的封包。這是一種允許外部路由設備更新系統路由表的方法。透過將 net.ipv4.conf.all.accept_redirects 設為 0，系統將不會接受任何 ICMP 重新導向訊息，因此不會允許外部人員更新系統的路由表。"
    rationale: "攻擊者可以使用偽造的 ICMP 重新導向訊息來惡意更改系統路由表，並使他們將資料包發送到不正確的網路，從而允許捕獲您的系統資料包。"
    remediation: "將以下參數設定在 /etc/sysctl.conf 或 /etc/sysctl.d/* 檔案中：net.ipv4.conf.all.accept_redirects = 0 net.ipv4.conf.default.accept_redirects = 0 。執行以下指令設定即時內核參數：# sysctl -w net.ipv4.conf.all.accept_redirects=0 # sysctl -w net.ipv4.conf.default.accept_redirects=0  # sysctl -w net.ipv4.route.flush=1"
    compliance:
      - cis: ["3.2.2"]
      - cis_csc: ["5.1"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:sysctl net.ipv4.conf.all.accept_redirects -> r:=\s*\t*0$'
      - 'c:sysctl net.ipv4.conf.default.accept_redirects -> r:=\s*\t*0$'
      - 'c:grep -Rh net\.ipv4\.conf\.all\.accept_redirects /etc/sysctl.conf /etc/sysctl.d -> r:^net.ipv4.conf.all.accept_redirects\s*=\s*0$'
      - 'c:grep -Rh net\.ipv4\.conf\.default\.accept_redirects /etc/sysctl.conf /etc/sysctl.d -> r:^net.ipv4.conf.default.accept_redirects\s*=\s*0$'

  - id: 19585
    title: "確保不接受安全 ICMP 重新導向"
    description: "安全性 ICMP 重新導向與 ICMP 重新導向相同，只不過它們來自預設閘道器清單中列出的閘道器。假設您的系統已知這些閘道器，並且它們可能是安全的。"
    rationale: "即使是已知的閘道器也仍然有可能受到損害。將 net.ipv4.conf.all.secure_redirects 設定為 0 可保護系統免受可能受損的已知閘道器更新路由表的影響。"
    remediation: "在 /etc/sysctl.conf 或 /etc/sysctl.d/* 檔案中設置以下參數: net.ipv4.conf.all.secure_redirects = 0 net.ipv4.conf.default.secure_redirects = 0。運行以下指令以設置活動內核參數: # sysctl -w net.ipv4.conf.all.secure_redirects=0 # sysctl -w net.ipv4.conf.default.secure_redirects=0 # sysctl -w net.ipv4.route.flush=1"
    compliance:
      - cis: ["3.2.3"]
      - cis_csc: ["5.1"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:sysctl net.ipv4.conf.all.secure_redirects -> r:=\s*\t*0$'
      - 'c:sysctl net.ipv4.conf.default.secure_redirects -> r:=\s*\t*0$'
      - 'c:grep -Rh net\.ipv4\.conf\.all\.secure_redirects /etc/sysctl.conf /etc/sysctl.d -> r:^net.ipv4.conf.all.secure_redirects\s*=\s*0$'
      - 'c:grep -Rh net\.ipv4\.conf\.default\.secure_redirects /etc/sysctl.conf /etc/sysctl.d -> r:^net.ipv4.conf.default.secure_redirects\s*=\s*0$'

  - id: 19586
    title: "確保記錄可疑資料包"
    description: "啟用後，此功能會將具有不可路由來源位址的資料包記錄到核心日誌中。"
    rationale: "啟用此功能並記錄這些資料包允許管理員調查攻擊者向其伺服器發送欺騙資料包的可能性。"
    remediation: "將以下參數設置在 /etc/sysctl.conf 或 /etc/sysctl.d/* 檔案中: net.ipv4.conf.all.log_martians = 1 net.ipv4.conf.default.log_martians = 1。運行以下指令來設置活動的內核參數: # sysctl -w net.ipv4.conf.all.log_martians=1 # sysctl -w net.ipv4.conf.default.log_martians=1 # sysctl -w net.ipv4.route.flush=1"
    compliance:
      - cis: ["3.2.4"]
      - cis_csc: ["6.2", "6.3"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:sysctl net.ipv4.conf.all.log_martians -> r:=\s*\t*1$'
      - 'c:sysctl net.ipv4.conf.default.log_martians -> r:=\s*\t*1$'
      - 'c:grep -Rh net\.ipv4\.conf\.all\.log_martians /etc/sysctl.conf /etc/sysctl.d -> r:^net.ipv4.conf.all.log_martians\s*=\s*1$'
      - 'c:grep -Rh net\.ipv4\.conf\.default\.log_martians /etc/sysctl.conf /etc/sysctl.d -> r:^net.ipv4.conf.default.log_martians\s*=\s*1$'

  - id: 19587
    title: "確保廣播 ICMP 請求被忽略"
    description: "將 net.ipv4.icmp_echo_ignore_broadcasts 設為 1 將導致系統忽略對廣播和多播位址的所有 ICMP 回顯和時間戳請求。"
    rationale: "接受具有網路廣播或多播目標的 ICMP 回顯和時間戳請求可用於欺騙您的主機開始（或參與）Smurf 攻擊。 Smurf 攻擊依賴攻擊者使用欺騙性來源位址發送大量 ICMP 廣播訊息。所有接收此訊息並回應的主機都會將回顯應答訊息傳送回欺騙位址，該位址可能無法路由。如果許多主機回應資料包，網路上的流量可能會顯著增加。"
    remediation: "請在 /etc/sysctl.conf 或 /etc/sysctl.d/* 檔案中設定以下參數：net.ipv4.icmp_echo_ignore_broadcasts = 1。執行以下指令設定活動的核心參數：# sysctl -w net.ipv4.icmp_echo_ignore_broadcasts=1 # sysctl -w net.ipv4.route.flush=1"
    compliance:
      - cis: ["3.2.5"]
      - cis_csc: ["5.1"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:sysctl net.ipv4.icmp_echo_ignore_broadcasts -> r:=\s*\t*1$'
      - 'c:grep -Rh net\.ipv4\.icmp_echo_ignore_broadcasts /etc/sysctl.conf /etc/sysctl.d -> r:^net.ipv4.icmp_echo_ignore_broadcasts\s*=\s*1$'

  - id: 19588
    title: "確保忽略偽造的 ICMP 回應"
    description: "將 icmp_ignore_bogus_error_responses 設為 1 可防止核心記錄來自廣播重新訊框的虛假回應（不符合 RFC-1122），從而防止檔案系統填滿無用的日誌訊息。"
    rationale: "一些路由器（和一些攻擊者）將發送違反 RFC-1122 的回應，並嘗試用許多無用的錯誤訊息填充日誌檔案系統。"
    remediation: "在 /etc/sysctl.conf 或 /etc/sysctl.d/* 檔案中設定以下參數: net.ipv4.icmp_ignore_bogus_error_responses = 1。 執行以下指令以設置活動的內核參數: # sysctl -w net.ipv4.icmp_ignore_bogus_error_responses=1 # sysctl -w net.ipv4.route.flush=1"
    compliance:
      - cis: ["3.2.6"]
      - cis_csc: ["5.1"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:sysctl net.ipv4.icmp_ignore_bogus_error_responses -> r:=\s*\t*1$'
      - 'c:grep -Rh net\.ipv4\.icmp_ignore_bogus_error_responses /etc/sysctl.conf /etc/sysctl.d -> r:^net.ipv4.icmp_ignore_bogus_error_responses\s*=\s*1$'

  - id: 19589
    title: "確保啟用反向路徑過濾"
    description: "將 net.ipv4.conf.all.rp_filter 和 net.ipv4.conf.default.rp_filter 設為 1 會強制 Linux 核心對收到的封包使用反向路徑過濾來確定封包是否有效。本質上，透過反向路徑過濾，如果傳回封包沒有從對應來源封包來自的相同介面發出，則封包將被丟棄（如果設定了 log_martians，則會被記錄）。"
    rationale: 設定這些標誌是阻止攻擊者向您的系統發送無法回應的偽造資料包的好方法。此功能失效的一個例子是採用非對稱路由。在系統上使用動態路由協定（bgp、ospf 等）時會發生這種情況。如果您在系統上使用非對稱路由，則在不破壞路由的情況下將無法啟用此功能。
    remediation: "請將以下參數設置在 /etc/sysctl.conf 或 /etc/sysctl.d/* 檔案中: net.ipv4.conf.all.rp_filter = 1 net.ipv4.conf.default.rp_filter = 1. 執行以下指令設置內核活動參數: # sysctl -w net.ipv4.conf.all.rp_filter=1 # sysctl -w net.ipv4.conf.default.rp_filter=1 # sysctl -w net.ipv4.route.flush=1"
    compliance:
      - cis: ["3.2.7"]
      - cis_csc: ["5.1"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:sysctl net.ipv4.conf.all.rp_filter -> r:=\s*\t*1$'
      - 'c:sysctl net.ipv4.conf.default.rp_filter -> r:=\s*\t*1$'
      - 'c:grep -Rh net\.ipv4\.conf\.all\.rp_filter /etc/sysctl.conf /etc/sysctl.d -> r:^net.ipv4.conf.all.rp_filter\s*=\s*1$'
      - 'c:grep -Rh net\.ipv4\.conf\.default\.rp_filter /etc/sysctl.conf /etc/sysctl.d -> r:^net.ipv4.conf.default.rp_filter\s*=\s*1$'

  - id: 19590
    title: "確保 TCP SYN Cookie 已啟用"
    description: "當設定 tcp_syncookies 時，核心將正常處理 TCP SYN 封包，直到半開連線佇列已滿，此時 SYN cookie 功能啟動。相反，核心只是用 SYN|ACK 回覆 SYN，但會包含一個特製的 TCP 序號，該序號對來源和目標 IP 位址以及連接埠號碼以及封包發送時間進行編碼。合法連線將發送帶有特製序號的三向握手的 ACK 資料包。這允許系統驗證它是否已收到對 SYN cookie 的有效回應並允許連接，即使佇列中沒有相應的 SYN。"
    rationale: "攻擊者使用 SYN Flood 攻擊，透過發送大量 SYN 封包而不完成三向握手來對系統執行拒絕服務攻擊。這將快速耗盡核心半開連接佇列中的插槽位，並阻止合法連線成功。 SYN cookie 允許系統持續接受有效連接，即使受到拒絕服務攻擊也是如此。"
    remediation: "在 /etc/sysctl.conf 或 /etc/sysctl.d/* 檔案中設置以下參數: net.ipv4.tcp_syncookies = 1。執行以下指令來設置活動內核參數: # sysctl -w net.ipv4.tcp_syncookies=1 # sysctl -w net.ipv4.route.flush=1"
    compliance:
      - cis: ["3.2.8"]
      - cis_csc: ["5.1"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:sysctl net.ipv4.tcp_syncookies -> r:=\s*\t*1$'
      - 'c:grep -Rh net\.ipv4\.tcp_syncookies /etc/sysctl.conf /etc/sysctl.d -> r:^net.ipv4.tcp_syncookies\s*=\s*1$'

  - id: 19591
    title: "確保 IPv6 路由器通告不被接受"
    description: "此設定禁用系統接受路由器通告的能力"
    rationale: "建議系統不要接受路由器通告，因為它們可能會被欺騙將流量路由到受感染的電腦。在系統內設定硬路由（通常是到可信任路由器的單一預設路由）可以保護系統免受不良路由的影響。"
    remediation: "將以下參數設置在 /etc/sysctl.conf 或 /etc/sysctl.d/* 檔案中: net.ipv6.conf.all.accept_ra = 0 net.ipv6.conf.default.accept_ra = 0. 執行以下指令來設置活動的內核參數: # sysctl -w net.ipv6.conf.all.accept_ra=0 # sysctl -w net.ipv6.conf.default.accept_ra=0 # sysctl -w net.ipv6.route.flush=1"
    compliance:
      - cis: ["3.3.1"]
      - cis_csc: ["5.1"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:sysctl net.ipv6.conf.all.accept_ra -> r:=\s*\t*0$'
      - 'c:sysctl net.ipv6.conf.default.accept_ra -> r:=\s*\t*0$'
      - 'c:grep -Rh net\.ipv6\.conf\.all\.accept_ra /etc/sysctl.conf /etc/sysctl.d -> r:^net.ipv6.conf.all.accept_ra\s*=\s*0$'
      - 'c:grep -Rh net\.ipv6\.conf\.default\.accept_ra /etc/sysctl.conf /etc/sysctl.d -> r:^net.ipv6.conf.default.accept_ra\s*=\s*0$'

  - id: 19592
    title: "確保不接受 IPv6 重新導向"
    description: "此設定阻止系統接受 ICMP 重新導向。 ICMP 重新導向告訴系統發送流量的備用路由。"
    rationale: "建議系統不要接受 ICMP 重新導向，因為它們可能會被欺騙將流量路由到受感染的電腦。在系統內設定硬路由（通常是到可信任路由器的單一預設路由）可以保護系統免受不良路由的影響。"
    remediation: "將以下參數設置在 /etc/sysctl.conf 或 /etc/sysctl.d/* 檔案中: net.ipv6.conf.all.accept_redirects = 0 net.ipv6.conf.default.accept_redirects = 0. 執行以下指令以設置活動的內核參數: # sysctl -w net.ipv6.conf.all.accept_redirects=0 # sysctl -w net.ipv6.conf.default.accept_redirects=0 # sysctl -w net.ipv6.route.flush=1"
    compliance:
      - cis: ["3.3.2"]
      - cis_csc: ["5.1"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:sysctl net.ipv6.conf.all.accept_redirects -> r:=\s*\t*0$'
      - 'c:sysctl net.ipv6.conf.default.accept_redirects -> r:=\s*\t*0$'
      - 'c:grep -Rh net\.ipv6\.conf\.all\.accept_redirects /etc/sysctl.conf /etc/sysctl.d -> r:^net.ipv6.conf.all.accept_redirects\s*=\s*0$'
      - 'c:grep -Rh net\.ipv6\.conf\.default\.accept_redirects /etc/sysctl.conf /etc/sysctl.d -> r:^net.ipv6.conf.default.accept_redirects\s*=\s*0$'

  - id: 19593
    title: "確保 IPv6 已停用"
    description: "儘管 IPv6 比 IPv4 具有許多優勢，但很少有組織實施 IPv6。"
    rationale: "如果不使用IPv6，建議停用，以減少系統的攻擊面。"
    remediation: '編輯 /etc/default/grub 並將 ''``ipv6.disable=1'' 添加到 GRUB_CMDLINE_LINUX: GRUB_CMDLINE_LINUX="ipv6.disable=1"     執行以下指令以更新 grub2 配置: # update-grub'
    compliance:
      - cis: ["3.3.3"]
      - cis_csc: ["3", "11"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
      - tsc: ["CC5.2"]
    condition: none
    rules:
      - 'f:/boot/grub/grub.cfg -> r:^\s*linux && !r:ipv6.disable=1'

  - id: 19594
    title: "安裝 TCP 包裝器"
    description: "TCP Wrappers 為能夠支援它的服務提供了簡單的存取清單和標準化的日誌記錄方法。過去，從 inetd 和 xinetd 調用的服務支援使用 tcp 包裝器。由於 inetd 和 xinetd 已不再使用，任何可以支援 tcp 包裝器的服務都將附加 libwrap.so 庫。"
    rationale: "TCP Wrappers 為可能沒有內建支援的服務提供了一個很好的簡單存取清單機制。"
    remediation: "安裝 tcpd : # apt-get install tcpd 要驗證服務是否支援 TCP Wrappers, 執行以下指令: # ldd <path-to-daemon> | grep libwrap.so 如果有任何輸出, 那麼該服務支援 TCP Wrappers。"
    compliance:
      - cis: ["3.4.1"]
      - cis_csc: ["9.4"]
      - pci_dss: ["1.3.5"]
    condition: all
    rules:
      - "c:dpkg -s tcpd -> r:install ok installed"

  - id: 19595
    title: "確保 /etc/hosts.allow 已配置"
    description: "/etc/hosts.allow 檔案指定允許哪些 IP 位址連接到主機。它旨在與 /etc/hosts.deny 檔案結合使用。"
    rationale: "/etc/hosts.allow 檔案支援 IP 存取控制，有助於確保只有授權的系統才能連接到系統。"
    remediation: '執行以下指令以建立 /etc/hosts.allow：# echo "ALL: <net>/<mask>, <net>/<mask>, ..." >/etc/hosts.allow。每個 <net>/<mask> 組合（例如 "192.168.1.0/255.255.255.0"）代表您的組織需要存取此系統的一個網路區塊。'
    compliance:
      - cis: ["3.4.2"]
      - cis_csc: ["9.4"]
      - pci_dss: ["1.3.5"]
    condition: all
    rules:
      - "f:/etc/hosts.allow"

  - id: 19596
    title: "確保 /etc/hosts.deny 已配置"
    description: "/etc/hosts.deny 檔案指定不允許哪些 IP 位址連接到主機。它旨在與 /etc/hosts.allow 檔案結合使用。"
    rationale: "/etc/hosts.deny 檔案用作故障保護，以便拒絕 /etc/hosts.allow 中未指定的任何主機存取伺服器。"
    remediation: '執行以下指令來創建 /etc/hosts.deny: # echo "ALL: ALL" >> /etc/hosts.deny'
    compliance:
      - cis: ["3.4.3"]
      - cis_csc: ["9.4"]
      - pci_dss: ["1.3.5"]
    condition: all
    rules:
      - "f:/etc/hosts.deny"
      - 'f:/etc/hosts.deny -> r:^ALL:\s*ALL'

  - id: 19597
    title: "驗證 /etc/hosts.allow 上的權限"
    description: "/etc/hosts.allow 檔案包含許多系統應用程式使用的網路訊息，因此必須可讀，這些應用程式才能運行。"
    rationale: "確保 /etc/hosts.allow 檔案免受未經授權的寫入存取至關重要。儘管預設情況下它受到保護，但檔案權限可能會被無意或透過惡意操作更改。"
    remediation: "執行以下指令來設定 /etc/hosts.allow 的權限： # chown root:root /etc/hosts.allow # chmod 644 /etc/hosts.allow"
    compliance:
      - cis: ["3.4.4"]
      - cis_csc: ["5.1"]
      - pci_dss: ["1.3.5"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:stat /etc/hosts.allow -> r:^Access: \(0644/-rw-r--r--\)\s*\t*Uid:\s*\t*\(\s*\t*0/\s*\t*root\)\s*\t*Gid:\s*\t*\(\s*\t*0/\s*\t*root\)$'

  - id: 19598
    title: "驗證 /etc/hosts.deny 的權限"
    description: "/etc/hosts.deny 檔案包含許多系統應用程式使用的網路訊息，因此必須可讀，這些應用程式才能運作。"
    rationale: "確保 /etc/hosts.deny 檔案免受未經授權的寫入存取至關重要。儘管預設情況下它受到保護，但檔案權限可能會被無意或透過惡意操作更改。"
    remediation: "執行以下指令來設置 /etc/hosts.deny 的權限: # chown root:root /etc/hosts.deny  # chmod 644 /etc/hosts.deny"
    compliance:
      - cis: ["3.4.5"]
      - cis_csc: ["5.1"]
      - pci_dss: ["1.3.5"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:stat /etc/hosts.deny -> r:^Access: \(0644/-rw-r--r--\)\s*\t*Uid:\s*\t*\(\s*\t*0/\s*\t*root\)\s*\t*Gid:\s*\t*\(\s*\t*0/\s*\t*root\)$'

  - id: 19599
    title: "確保 DCCP 已停用"
    description: "資料封包擁塞控制協定 (DCCP) 是支援串流媒體和電話的傳輸層協定。 DCCP 提供了一種無需在應用層執行擁塞控制的方法，但不提供按順序傳送。"
    rationale: "如果不需要該協定，建議不要安裝驅動程式，以減少潛在的攻擊面。"
    remediation: "編輯或創建檔案 /etc/modprobe.d/CIS.conf，並添加以下行: install dccp /bin/true"
    compliance:
      - cis: ["3.5.1"]
      - cis_csc: ["9.2"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
      - tsc: ["CC5.2"]
    condition: none
    rules:
      - "not c:modprobe -n -v dccp -> r:install /bin/true"
      - "c:lsmod -> r:dccp"

  - id: 19600
    title: "確保 SCTP 已停用"
    description: "流控制傳輸協定 (SCTP) 是一種傳輸層協定，用於支援面向訊息的通訊，在一個連接中具有多個訊息流。它的功能與 TCP 和 UDP 類似，融合了兩者的功能。它像UDP一樣是面向訊息的，並且像TCP一樣透過擁塞控制確保訊息的可靠的順序傳輸。"
    rationale: "如果協定沒有被使用，建議不要載入核心模組，停用該服務以減少潛在的攻擊面。"
    remediation: "編輯或者創建檔案 /etc/modprobe.d/CIS.conf 並增加以下這一行: install sctp /bin/true"
    compliance:
      - cis: ["3.5.2"]
      - cis_csc: ["9.2"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
      - tsc: ["CC5.2"]
    condition: none
    rules:
      - "not c:modprobe -n -v sctp -> r:install /bin/true"
      - "c:lsmod -> r:sctp"

  - id: 19601
    title: "確保 RDS 已停用"
    description: "可靠資料報套接字 (RDS) 協定是一種傳輸層協定，旨在在叢集節點之間提供低延遲、高頻寬通訊。它是由 Oracle 公司開發的。"
    rationale: "如果協定沒有被使用，建議不要載入核心模組，停用該服務以減少潛在的攻擊面。"
    remediation: "編輯或建立檔案 /etc/modprobe.d/CIS.conf 並添加以下行: install rds /bin/true"
    compliance:
      - cis: ["3.5.3"]
      - cis_csc: ["9.2"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
      - tsc: ["CC5.2"]
    condition: none
    rules:
      - "not c:modprobe -n -v rds -> r:install /bin/true"
      - "c:lsmod -> r:rds"

  - id: 19602
    title: "確保 TIPC 已停用"
    description: "透明程序間通訊 (TIPC) 協定旨在提供叢集節點之間的通訊。"
    rationale: "如果協定沒有被使用，建議不要載入核心模組，停用該服務以減少潛在的攻擊面。"
    remediation: "編輯或創建檔案 /etc/modprobe.d/CIS.conf 並添加以下行: install tipc /bin/true"
    compliance:
      - cis: ["3.5.4"]
      - cis_csc: ["9.2"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
      - tsc: ["CC5.2"]
    condition: none
    rules:
      - "not c:modprobe -n -v tipc -> r:install /bin/true"
      - "c:lsmod -> r:tipc"

  # 3.5 Firewall configuration

  - id: 19603
    title: "確保預設拒絕防火牆策略"
    description: "預設拒絕所有連線原則可確保拒絕任何未設定的網路使用。"
    rationale: "使用預設接受策略，防火牆將接受任何未配置為拒絕的資料包。將可接受的用法列入白名單比將不可接受的用法列入黑名單更容易。"
    remediation: "執行以下指令以設置預設 DROP 政策: # iptables -P INPUT DROP # iptables -P OUTPUT DROP # iptables -P FORWARD DROP。注意: 在網路連線時變更防火牆設置可能會導致系統被鎖定。修復措施將僅影響活動系統防火牆，請確保在防火牆管理中配置預設政策以在啟動時應用。"
    compliance:
      - cis: ["3.6.2"]
      - cis_csc: ["9.4"]
      - pci_dss: ["1.2.1"]
      - tsc: ["CC8.1"]
    condition: all
    rules:
      - "c:iptables -L -> r:^Chain INPUT && r:policy DROP"
      - "c:iptables -L -> r:^Chain FORWARD && r:policy DROP"
      - "c:iptables -L -> r:^Chain OUTPUT && r:policy DROP"

  - id: 19604
    title: "確保環回流量已配置"
    description: "配置環回介面以接受流量。設定所有其他介面以拒絕流向環回網路 (127.0.0.0/8) 的流量。"
    rationale: "環回流量是在電腦上的程序之間產生的，通常對系統的運作至關重要。環回介面是唯一可以看到環回網路 (127.0.0.0/8) 流量的地方，所有其他介面都應忽略該網路上的流量，作為反欺騙措施。"
    remediation: "執行以下指令來實現回環規則: # iptables -A INPUT -i lo -j ACCEPT # iptables -A OUTPUT -o lo -j ACCEPT # iptables -A INPUT -s 127.0.0.0/8 -j DROP"
    compliance:
      - cis: ["3.6.3"]
      - cis_csc: ["9.4"]
      - pci_dss: ["1.2.1"]
      - tsc: ["CC8.1"]
    condition: all
    rules:
      - 'c:iptables -L INPUT -v -n -> r:\.*ACCEPT\.*all\.*lo\.**\.*0.0.0.0/0\.*0.0.0.0/0'
      - 'c:iptables -L INPUT -v -n -> r:\.*DROP\.*all\.**\.**\.*127.0.0.0/8\.*0.0.0.0/0'
      - 'c:iptables -L OUTPUT -v -n -> r:\.*ACCEPT\.*all\.**\.*lo\.*0.0.0.0/0\.*0.0.0.0/0'

  #########################################
  # 4 Logging and Auditing
  #########################################

  - id: 19605
    title: "確保配置審核日誌儲存大小"
    description: "配置審核日誌檔案的最大大小。一旦日誌達到最大大小，它將被輪換並啟動新的日誌檔案。"
    rationale: "為日誌檔案確定適當的大小非常重要，這樣它們就不會影響系統並且審計資料也不會遺失。"
    remediation: "請依據站點政策在 /etc/audit/auditd.conf 中設置下列參數：max_log_file = <MB> 注意：max_log_file 參數的測量單位是兆位元組。"
    compliance:
      - cis: ["4.1.1.1"]
      - cis_csc: ["6.4"]
    condition: all
    rules:
      - "f:/etc/audit/auditd.conf"
      - 'f:/etc/audit/auditd.conf -> r:^\s*\t*max_log_file\s*\t*=\s*\t*\d+'

  - id: 19606
    title: "確保審核日誌已滿時停用系統"
    description: "可以將auditd 守護程式設定為在審核日誌已滿時停止系統。"
    rationale: "在高安全性環境中，偵測未經授權的存取或不可否認性的風險超過了系統可用性的好處。"
    remediation: "將以下參數設置在 /etc/audit/auditd.conf 中： space_left_action = email action_mail_acct = root admin_space_left_action = halt"
    compliance:
      - cis: ["4.1.1.2"]
      - cis_csc: ["6.4"]
    condition: all
    rules:
      - "f:/etc/audit/auditd.conf"
      - 'f:/etc/audit/auditd.conf -> r:^\s*\t*action_mail_acct\s*\t*=\s*\t*root'
      - 'f:/etc/audit/auditd.conf -> r:^\s*\t*space_left_action\s*\t*=\s*\t*email'
      - 'f:/etc/audit/auditd.conf -> r:^\s*\t*admin_space_left_action\s*\t*=\s*\t*halt'

  - id: 19607
    title: "確保審核日誌不會自動刪除"
    description: "max_log_file_action 設定決定如何處理達到最大檔案大小的審核日誌檔案。 keep_logs 的值將輪換日誌，但永遠不會刪除舊日誌。"
    rationale: "在高安全性環境中，維護較長審計歷史記錄的好處超過了儲存審計歷史記錄的成本。"
    remediation: "在 /etc/audit/auditd.conf 中設置以下參數：max_log_file_action = keep_logs"
    compliance:
      - cis: ["4.1.1.3"]
      - cis_csc: ["6.4"]
    condition: all
    rules:
      - "f:/etc/audit/auditd.conf"
      - 'f:/etc/audit/auditd.conf -> r:^\s*\t*max_log_file_action\s*\t*=\s*\t*keep_logs'

  - id: 19608
    title: "確保auditd服務已啟用"
    description: "開啟auditd守護程式來記錄系統事件。"
    rationale: "系統事件的捕獲為系統管理員提供了資訊，使他們能夠確定是否正在發生對其系統的未經授權的存取。"
    remediation: "執行以下指令以啟用 auditd: # update-rc.d auditd enable"
    compliance:
      - cis: ["4.1.2"]
      - cis_csc: ["6.2", "6.3"]
      - pci_dss: ["10.1", "10.7"]
      - tsc: [CC6.1", "CC6.2", "CC6.3", "CC7.2", "CC7.3", "CC7.4"]
    condition: all
    rules:
      - "c:ls /etc/rc*.d/S*auditd -> r:/etc/rc2.d/S37auditd  && r:/etc/rc3.d/S37auditd && r:/etc/rc4.d/S37auditd && r:/etc/rc5.d/S37auditd"

  - id: 19609
    title: "確保啟用對在auditd之前啟動的程序進行審核"
    description: "配置 grub 或 lilo，以便能夠審核能夠被審核的程序，即使它們在auditd 啟動之前啟動也是如此。"
    rationale: "需要在auditd之前啟動的程序上捕獲審核事件，以便潛在的惡意活動不會被偵測不到。"
    remediation: '1) 編輯 /etc/default/grub 並將 audit=1 添加至 GRUB_CMDLINE_LINUX: GRUB_CMDLINE_LINUX="audit=1" 2) 執行以下指令來更新 grub2 配置: # update-grub 注意: 這個建議是圍繞 grub 引導程序設計的，如果您的環境中使用的是 LILO 或其他引導程序，請執行等效設置。'
    compliance:
      - cis: ["4.1.3"]
      - cis_csc: ["6.2", "6.3"]
      - pci_dss: ["10.2.6", "10.7"]
      - gpg_13: ["7.9"]
      - gdpr_IV: ["35.7.d", "32.2"]
      - tsc: ["CC6.1", "CC6.8", "CC7.2", "CC7.3", "CC7.4"]
    condition: none
    rules:
      - 'f:/boot/grub/grub.cfg -> r:^\s*\t*linux && !r:audit=1'

  - id: 19610
    title: "確保收集修改日期和時間資訊的事件"
    description: '捕獲系統日期和/或時間已修改的事件。本節中的參數設定確定是否為adjtimex（調整內核時鐘）、settimeofday（設定時間，使用timeval 和時區結構）、stime（使用自1970 年1 月1 日以來的秒數）或clock_settime（允許設定多個內部時鐘）。'
    rationale: "系統日期和/或時間的意外變更可能是系統上存在惡意活動的跡象。"
    remediation: "對於32位元系統，將以下行添加到/etc/audit/audit.rules檔案中：-a always,exit -F arch=b32 -S adjtimex -S settimeofday -S stime -k time-change | -a always,exit -F arch=b32 -S clock_settime -k time-change | -w /etc/localtime -p wa -k time-change。對於64位元系統，將以下行添加到/etc/audit/audit.rules檔案中：-a always,exit -F arch=b64 -S adjtimex -S settimeofday -k time-change | -a always,exit -F arch=b32 -S adjtimex -S settimeofday -S stime -k time-change | -a always,exit -F arch=b64 -S clock_settime -k time-change -a always,exit -F arch=b32 -S clock_settime -k time-change | -w /etc/localtime -p wa -k time-change"
    compliance:
      - cis: ["4.1.4"]
      - cis_csc: ["5.5"]
      - pci_dss: ["10.4.2", "10.2.7"]
      - nist_800_53: ["AU.14", "AU.6"]
      - gpg_13: ["7.9"]
      - gdpr_IV: ["32.2", "35.7.d"]
      - hipaa: ["164.312.b"]
      - tsc: ["CC6.1", "CC6.3", "CC6.8", "CC7.2", "CC7.3", "CC7.4"]
    condition: all
    rules:
      - "f:/etc/audit/audit.rules"
      - "f:/etc/audit/audit.rules -> r:^-a && r:always,exit|exit,always && r:-F arch=b32 && r:-S adjtimex && r:-S settimeofday && r:-S stime && r:-k time-change"
      - "f:/etc/audit/audit.rules -> r:^-a && r:always,exit|exit,always && r:-F arch=b32 && r:-S clock_settime && r:-k time-change"
      - "f:/etc/audit/audit.rules -> r:^-w && r:/etc/localtime && r:-p wa && r:-k time-change"

  - id: 19611
    title: "確保收集修改使用者/群組資訊的事件"
    description: '記錄影響 group 、 passwd （使用者 ID）、shadow 和 gshadow （密碼）或 /etc/security/opasswd （舊密碼，基於 PAM 設定中的記住參數）檔案的事件。本節中的參數將監視檔案以查看它們是否已開啟以進行寫入或已進行屬性變更（例如權限），並在審核日誌檔案中使用識別碼「identity」對其進行標記。'
    rationale: "這些檔案的意外變更可能表示系統已受到損害，且未經授權的使用者正試圖隱藏其活動或損害其他帳戶。"
    remediation: "將以下行添加到 /etc/audit/audit.rules 檔案中: -w /etc/group -p wa -k identity | -w /etc/passwd -p wa -k identity | -w /etc/gshadow -p wa -k identity | -w /etc/shadow -p wa -k identity | -w /etc/security/opasswd -p wa -k identity 注意: 重新載入 auditd 配置以設置活動設置可能需要重新啟動系統。"
    compliance:
      - cis: ["4.1.5"]
      - cis_csc: ["4.8"]
      - pci_dss: ["10.2.5"]
      - hipaa: ["164.312.b"]
      - nist_800_53: ["AU.14", "AC.7"]
      - gpg_13: ["7.8"]
      - gdpr_IV: ["35.7", "32.2"]
      - tsc: ["CC7.2", "CC6.1", "CC6.8", "CC7.3", "CC7.4"]
    condition: all
    rules:
      - "f:/etc/audit/audit.rules -> r:^-w && r:/etc/group && r:-p wa && r:-k identity"
      - "f:/etc/audit/audit.rules -> r:^-w && r:/etc/passwd && r:-p wa && r:-k identity"
      - "f:/etc/audit/audit.rules -> r:^-w && r:/etc/gshadow && r:-p wa && r:-k identity"
      - "f:/etc/audit/audit.rules -> r:^-w && r:/etc/shadow && r:-p wa && r:-k identity"
      - "f:/etc/audit/audit.rules -> r:^-w && r:/etc/security/opasswd && r:-p wa && r:-k identity"

  - id: 19612
    title: "確保收集修改系統網路環境的事件"
    description: "記錄網路環境檔案或系統呼叫的變更。以下參數監視 sethostname（設定系統主機名稱）或 setdomainname（設定系統網域名稱）系統調用，並在系統調用退出時寫入審核事件。其他參數監視 /etc/issue 和 /etc/issue.net 檔案（登入前顯示的訊息）、/etc/hosts（包含主機名稱和關聯 IP 位址的檔案）和 /etc/sysconfig/network（包含網路的目錄）介面腳本和配置）檔案。"
    rationale: '監視 sethostname 和 setdomainname 將識別對系統主機和網域的潛在未經授權的變更。更改這些名稱可能會破壞基於這些名稱設定的安全性參數。監視 /etc/hosts 檔案中的檔案更改，這些更改可能表明未經授權的入侵者正在嘗試更改電腦與 IP 位址的關聯，並誘騙使用者和程序連接到非預期的電腦。監視 /etc/issue 和 /etc/issue.net 非常重要，因為入侵者可能會將虛假資訊放入這些檔案中並誘騙用戶向入侵者提供資訊。監視 /etc/sysconfig/network 非常重要，因為它可以顯示網路介面或腳本是否已修改，從而導致電腦不可用或受到損害。所有審核記錄都將標有識別碼「系統區域設定」。'
    remediation: "對於 64 位系統，將以下行添加到 /etc/audit/audit.rules 檔案： -a always,exit -F arch=b64 -S sethostname -S setdomainname -k system-locale | -a always,exit -F arch=b32 -S sethostname -S setdomainname -k system-locale | -w /etc/issue -p wa -k system-locale | -w /etc/issue.net -p wa -k system-locale | -w /etc/hosts -p wa -k system-locale | -w /etc/sysconfig/network -p wa -k system-locale 注意：/etc/sysconfig/network 是 Red Hat 和 SUSE 基於這些發行版的常見檔案。你應該擴充或替換這個涵蓋範圍，以適應你的系統上的任何網路配置檔案，例如 Debian 基於這些發行版的 /etc/network。重新載入 auditd 配置以設置活動設置可能需要系統重啟。"
    compliance:
      - cis: ["4.1.6"]
      - cis_csc: ["5.5"]
      - pci_dss: ["10.2.7"]
      - nist_800_53: ["AU.14", "AU.6"]
      - gpg_13: ["7.9"]
      - gdpr_IV: ["32.2", "35.7.d"]
      - hipaa: ["164.312.b"]
      - tsc: ["CC7.2", "CC6.1", "CC6.8", "CC7.3", "CC7.4"]
    condition: all
    rules:
      - "f:/etc/audit/audit.rules -> r:^-a && r:exit,always|always,exit && r:-F arch=b32 && r:-S sethostname && r:-S setdomainname && r:-k system-locale"
      - "f:/etc/audit/audit.rules -> r:^-w && r:/etc/issue && r:-p wa && r:-k system-locale"
      - "f:/etc/audit/audit.rules -> r:^-w && r:/etc/issue.net && r:-p wa && r:-k system-locale"
      - "f:/etc/audit/audit.rules -> r:^-w && r:/etc/hosts && r:-p wa && r:-k system-locale"
      - "f:/etc/audit/audit.rules -> r:^-w && r:/etc/sysconfig/network && r:-p wa && r:-k system-locale"

  - id: 19613
    title: "確保收集修改系統強制存取控制的事件"
    description: "監控 SELinux/AppArmor 強制存取控制。以下參數監控對 /etc/selinux 或 /etc/apparmor 和 /etc/apparmor.d 目錄的任何寫入存取（目錄中檔案的潛在附加、刪除或修改）或屬性變更。"
    rationale: "對這些目錄中的檔案進行更改可能表示未經授權的使用者正在嘗試修改存取控制並更改安全上下文，從而導致系統受到損害。"
    remediation: "對於使用 SELinux 的系統，添加以下行到 /etc/audit/audit.rules 檔案中: -w /etc/selinux/ -p wa -k MAC-policy  | -w /usr/share/selinux/ -p wa -k MAC-policy 對於使用 AppArmor 的系統，添加以下行到 /etc/audit/audit.rules 檔案中: -w /etc/apparmor/ -p wa -k MAC-policy | -w /etc/apparmor.d/ -p wa -k MAC-policy"
    compliance:
      - cis: ["4.1.7"]
      - cis_csc: ["5.5"]
      - pci_dss: ["10.2.5"]
      - hipaa: ["164.312.b"]
      - nist_800_53: ["AU.14", "AC.7"]
      - gpg_13: ["7.8"]
      - gdpr_IV: ["35.7", "32.2"]
      - tsc: ["CC7.2", "CC6.1", "CC6.8", "CC7.3", "CC7.4"]
    condition: all
    rules:
      - "f:/etc/audit/audit.rules -> r:^-w && r:/etc/selinux/|/etc/apparmor/ && r:-p wa && r:-k MAC-policy"
      - "f:/etc/audit/audit.rules -> r:^-w && r:/usr/share/selinux/|/etc/apparmor.d/ && r:-p wa && r:-k MAC-policy"

  - id: 19614
    title: "確保收集登入和登出事件"
    description: "監控登入和登出事件。以下參數追蹤與登入/登出事件關聯的檔案的變更。檔案 /var/log/faillog 追蹤登入失敗事件。檔案 /var/log/lastlog 維護使用者上次成功登入的記錄。"
    rationale: "監視登入/登出事件可以為系統管理員提供與針對使用者登入的暴力攻擊相關的資訊。"
    remediation: "將以下行新增到 /etc/audit/audit.rules 檔案中: -w /var/log/faillog -p wa -k logins | -w /var/log/lastlog -p wa -k logins | -w /var/log/tallylog -p wa -k logins。注意事項: 重新載入 auditd 配置以設定活動設置可能需要重新啟動系統。"
    compliance:
      - cis: ["4.1.8"]
      - cis_csc: ["4.9", "16.11", "16.13"]
      - pci_dss: ["10.2.1", "10.2.4", "10.3"]
      - nist_800_53: ["AC.7", "AU.14"]
      - gpg_13: ["7.8"]
      - gdpr_IV: ["32.2", "35.7.d"]
      - hipaa: ["164.312.b"]
      - tsc: ["CC7.2", "CC6.1", "CC6.8", "CC7.3", "CC7.4"]
    condition: all
    rules:
      - "f:/etc/audit/audit.rules -> r:^-w && r:/var/log/faillog && r:-p wa && r:-k logins"
      - "f:/etc/audit/audit.rules -> r:^-w && r:/var/log/lastlog && r:-p wa && r:-k logins"
      - "f:/etc/audit/audit.rules -> r:^-w && r:/var/log/tallylog && r:-p wa && r:-k logins"

  - id: 19615
    title: "確保收集會話啟動資訊"
    description: '監視會話啟動事件。本節中的參數追蹤與會話事件關聯的檔案的變更。 /var/run/utmp 檔案追蹤所有目前登入的使用者。所有審核記錄都將標有識別字「會話」。 /var/log/wtmp 檔案追蹤登入、登出、關閉和重新啟動事件。檔案 /var/log/btmp 追蹤失敗的登入嘗試，可以透過輸入指令 /usr/bin/last -f /var/log/btmp 來讀取。所有審核記錄都將標有識別碼「登入」。'
    rationale: "監視這些檔案的變更可以提醒系統管理員在異常時間發生登入，這可能表示入侵者活動（即使用者在正常不登入的時間登入）。"
    remediation: "將以下程式碼行新增到 /etc/audit/audit.rules 檔案中: -w /var/run/utmp -p wa -k session | -w /var/log/wtmp -p wa -k logins | -w /var/log/btmp -p wa -k logins。注意: 最後一個指令可以用來讀取 /var/log/wtmp (last without parameters) 和 /var/run/utmp (last -f /var/run/utmp)。重新載入 auditd 配置以設置活動設置可能需要系統重新啟動。"
    compliance:
      - cis: ["4.1.9"]
      - cis_csc: ["4.9", "16.11", "16.13"]
      - pci_dss: ["10.3"]
      - nist_800_53: ["AC.7", "AU.14"]
      - hipaa: ["164.312.b"]
    condition: all
    rules:
      - "f:/etc/audit/audit.rules -> r:^-w && r:/var/run/utmp && r:-p wa && r:-k session"
      - "f:/etc/audit/audit.rules -> r:^-w && r:/var/log/wtmp && r:-p wa && r:-k logins"
      - "f:/etc/audit/audit.rules -> r:^-w && r:/var/log/btmp && r:-p wa && r:-k logins"

  - id: 19616
    title: "確保收集酌情存取控制權限修改事件"
    description: '監視檔案權限、屬性、所有權和群組的變更。本節中的參數追蹤影響檔案權限和屬性的系統呼叫的變更。 chmod 、 fchmod 和 fchmodat 系統呼叫會影響與檔案關聯的權限。 chown 、 fchown 、 fchownat 和 lchown 系統呼叫會影響檔案的擁有者和群組屬性。 setxattr 、 lsetxattr 、 fsetxattr （設定擴充檔屬性）和removexattr 、 lremovexattr 、 fremovexattr （刪除擴充檔屬性）控制擴充檔屬性。在所有情況下，只會為非系統使用者 ID (auid >= 1000) 寫入審核記錄，並將忽略守護程序事件 (auid = 4294967295)。所有審核記錄都將標有識別字“perm_mod”。'
    rationale: "監視檔案屬性的變更可以提醒系統管理員注意可能表示入侵者活動或違反策略的活動。"
    remediation: "對於64位系統，將以下行添加到/etc/audit/audit.rules檔案： -a always,exit -F arch=b64 -S chmod -S fchmod -S fchmodat -F auid>=1000 -F auid!=4294967295 -k perm_mod | -a always,exit -F arch=b32 -S chmod -S fchmod -S fchmodat -F auid>=1000 -F auid!=4294967295 -k perm_mod | -a always,exit -F arch=b64 -S chown -S fchown -S fchownat -S lchown -F auid>=1000 -F auid!=4294967295 -k perm_mod | -a always,exit -F arch=b32 -S chown -S fchown -S fchownat -S lchown -F auid>=1000 -F auid!=4294967295 -k perm_mod | -a always,exit -F arch=b64 -S setxattr -S lsetxattr -S fsetxattr -S removexattr -S lremovexattr -S fremovexattr -F auid>=1000 -F auid!=4294967295 -k perm_mod | -a always,exit -F arch=b32 -S setxattr -S lsetxattr -S fsetxattr -S removexattr -S lremovexattr -S fremovexattr -F auid>=1000 -F auid!=4294967295 -k perm_mod. 注意: 重新載入auditd配置以設置有效設置可能需要系統重啟。"
    compliance:
      - cis: ["4.1.10"]
      - cis_csc: ["5.5"]
      - pci_dss: ["10.4.2", "10.2.7"]
      - nist_800_53: ["AU.14", "AU.6"]
      - gpg_13: ["7.9"]
      - gdpr_IV: ["32.2", "35.7.d"]
      - hipaa: ["164.312.b"]
      - tsc: ["CC7.2", "CC6.1", "CC6.8", "CC7.3", "CC7.4"]
    condition: all
    rules:
      - "f:/etc/audit/audit.rules -> r:^-a && r:always,exit|exit,always && r:-F arch=b32 && r:-S chmod && r:-S fchmod && r:-S fchmodat && r:-F auid>=1000 && r:-F auid!=4294967295 && r:-k perm_mod"
      - "f:/etc/audit/audit.rules -> r:^-a && r:always,exit|exit,always && r:-F arch=b32 && r:-S chown && r:-S fchown && r:-S fchownat && r:-S lchown && r:-F auid>=1000 && r:-F auid!=4294967295 && r:-k perm_mod"
      - "f:/etc/audit/audit.rules -> r:^-a && r:always,exit|exit,always && r:-F arch=b32 && r:-S setxattr && r:-S lsetxattr && r:-S fsetxattr && r:-S removexattr && r:-S lremovexattr && r:-S fremovexattr && r:-F auid>=1000 && r:-F auid!=4294967295 && r:-k perm_mod"

  - id: 19617
    title: "確保收集不成功的未經授權的檔案存取嘗試"
    description: '監視存取檔案的失敗嘗試。以下參數與控制檔案的建立 ( creat )、開啟 ( open 、 openat ) 和截斷 ( truncate 、 ftruncate ) 的系統呼叫相關聯。只有當使用者是非特權使用者 (auid > = 1000)、不是守護程序事件 (auid=4294967295) 且系統呼叫傳回 EACCES（檔案權限被拒絕）或 EPERM 時，才會寫入審核日誌記錄（與特定系統呼叫相關的其他一些永久性錯誤）。所有審核記錄都將標有識別碼「存取」。'
    rationale: "嘗試開啟、建立或截斷檔案失敗可能表示個人或程序正在嘗試獲得對系統的未經授權的存取。"
    remediation: "對於 64 位系統，將以下行添加到 /etc/audit/audit.rules 檔案中：-a always,exit -F arch=b64 -S creat -S open -S openat -S truncate -S ftruncate -F exit=-EACCES -F auid>=1000 -F auid!=4294967295 -k access | -a always,exit -F arch=b32 -S creat -S open -S openat -S truncate -S ftruncate -F exit=-EACCES -F auid>=1000 -F auid!=4294967295 -k access | -a always,exit -F arch=b64 -S creat -S open -S openat -S truncate -S ftruncate -F exit=-EPERM -F auid>=1000 -F auid!=4294967295 -k access | -a always,exit -F arch=b32 -S creat -S open -S openat -S truncate -S ftruncate -F exit=-EPERM -F auid>=1000 -F auid!=4294967295 -k access。注意：重新載入 auditd 配置以設置活動設置可能需要重新啟動系統。"
    compliance:
      - cis: ["4.1.11"]
      - cis_csc: ["14.9"]
      - pci_dss: ["10.2.4"]
      - nist_800_53: ["AC.7"]
      - gpg_13: ["7.8"]
      - gdpr_IV: ["32.2", "35.7.d"]
      - hipaa: ["164.312.b"]
      - tsc: ["CC7.2", "CC6.1", "CC6.8", "CC7.3", "CC7.4"]
    condition: all
    rules:
      - "f:/etc/audit/audit.rules -> r:^-a && r:always,exit|exit,always && r:-F arch=b32 && r:-S creat && r:-S open && r:-S openat && r:-S truncate && r:-F exit=-EACCES && r:-F auid>=1000 && r:-F auid!=4294967295 && r:-k access"
      - "f:/etc/audit/audit.rules -> r:^-a && r:always,exit|exit,always && r:-F arch=b32 && r:-S creat && r:-S open && r:-S openat && r:-S truncate && r:-F exit=-EPERM && r:-F auid>=1000 && r:-F auid!=4294967295 && r:-k access"

  - id: 19618
    title: "確保收集成功的檔案系統安裝"
    description: "監控 mount 系統呼叫的使用情況。 mount （和 umount ）系統呼叫控製檔案系統的安裝和卸載。以下參數將系統配置為在非特權使用者使用 mount 系統呼叫時建立審核記錄。"
    rationale: "非特權使用者將檔案系統掛載到系統的情況非常罕見。雖然追蹤安裝指令為系統管理員提供了外部媒體可能已安裝的證據（基於對安裝來源的審查並確認其是外部介質類型），但它並不能最終表明資料已匯出到媒體。希望確定資料是否已匯出的系統管理員還必須追蹤成功的 open 、 creat 和 truncate 系統調用，這些系統調用需要對外部媒體檔案系統安裝點下的檔案進行寫入存取。這可以清楚地表明發生了寫入。真正證明這一點的唯一方法是追蹤對外部媒體的成功寫入。追蹤寫入系統呼叫可能會快速填滿審核日誌，因此不建議這樣做。有關追蹤資料匯出到媒體的配置選項的建議超出了本檔案的範圍。"
    remediation: "對於 64 位元系統, 將以下行新增至 /etc/audit/audit.rules 檔案中: -a always,exit -F arch=b64 -S mount -F auid>=1000 -F auid!=4294967295 -k mounts | -a always,exit -F arch=b32 -S mount -F auid>=1000 -F auid!=4294967295 -k mounts. 注意: 這將追蹤成功和失敗的掛載指令。檔案系統掛載不必來自外部媒體, 此操作仍不會驗證寫入 (例如 CD ROMS)。重新載入 auditd 配置以設置活動設置可能需要重新啟動系統。"
    compliance:
      - cis: ["4.1.13"]
      - cis_csc: ["13"]
      - pci_dss: ["10.2.7"]
      - nist_800_53: ["AU.14", "AU.6"]
      - gpg_13: ["7.9"]
      - gdpr_IV: ["32.2", "35.7.d"]
      - hipaa: ["164.312.b"]
      - tsc: ["CC7.2", "CC6.1", "CC6.8", "CC7.3", "CC7.4"]
    condition: all
    rules:
      - "f:/etc/audit/audit.rules -> r:^-a && r:always,exit|exit,always && r:-F arch=b32 && r:-S mount && r:-F auid>=1000 && r:-F auid!=4294967295 && r:-k mounts"

  - id: 19619
    title: "確保收集用戶的檔案刪除事件"
    description: '監視與刪除或重新命名檔案和檔案屬性相關的系統呼叫的使用情況。此設定敘述對 unlink（刪除檔案）、unlinkat（刪除檔案屬性）、rename（重新命名檔案）和 renameat（重新命名檔案屬性）系統呼叫的監視，並用識別碼「delete」標記它們。'
    rationale: "監視來自非特權使用者的這些呼叫可以為系統管理員提供證據，表明正在發生與受保護檔案關聯的檔案和檔案屬性的不當刪除。雖然此審核選項將查看所有事件，但系統管理員將希望尋找正在刪除或變更的特定特權檔案。"
    remediation: "對於64位元系統，將以下行添加到/etc/audit/audit.rules檔案中: -a always,exit -F arch=b64 -S unlink -S unlinkat -S rename -S renameat -F auid>=1000 -F auid!=4294967295 -k delete | -a always,exit -F arch=b32 -S unlink -S unlinkat -S rename -S renameat -F auid>=1000 -F auid!=4294967295 -k delete。注意: 至少應配置審計系統來收集所有用戶和root的檔案刪除事件。為了設置有效設定，重新載入auditd配置可能需要系統重啟。"
    compliance:
      - cis: ["4.1.14"]
      - cis_csc: ["6,2", "13"]
      - pci_dss: ["10.5.5"]
      - nist_800_53: ["AU.14"]
      - hipaa: ["164.312.b"]
      - tsc: ["CC6.1", "CC7.2", "CC7.3", "CC7.4"]
    condition: all
    rules:
      - "f:/etc/audit/audit.rules -> r:^-a && r:always,exit|exit,always && r:-F arch=b32 && r:-S unlink && r:-S unlinkat && r:-S rename && r:-S renameat && r:-F auid>=1000 && r:-F auid!=4294967295 && r:-k delete"

  - id: 19620
    title: "確保收集對系統管理範圍 (sudoers) 的更改"
    description: '監視系統管理範圍的變更。如果系統已正確配置為強制系統管理員首先以自己的身分登入，然後使用 sudo 指令執行特權指令，則可以監視範圍的變更。當檔案或其屬性發生變更時，將寫入檔案 /etc/sudoers。審計記錄將標有識別字“範圍”。'
    rationale: "/etc/sudoers 檔案中的變更可能表示對系統管理員活動範圍進行了未經授權的更改。"
    remediation: "將以下行添加到 /etc/audit/audit.rules 檔案中: -w /etc/sudoers -p wa -k scope | -w /etc/sudoers.d/ -p wa -k scope。注意: 重新載入 auditd 配置以設置活動設置可能需要重新啟動系統。"
    compliance:
      - cis: ["4.1.15"]
      - cis_csc: ["4.8"]
      - pci_dss: ["10.2.5"]
      - hipaa: ["164.312.b"]
      - nist_800_53: ["AU.14", "AC.7"]
      - gpg_13: ["7.8"]
      - gdpr_IV: ["35.7", "32.2"]
      - tsc: ["CC7.2", "CC6.1", "CC6.8", "CC7.3", "CC7.4"]
    condition: all
    rules:
      - "f:/etc/audit/audit.rules -> r:^-w && r:/etc/sudoers && r:-p wa && r:-k scope"
      - "f:/etc/audit/audit.rules -> r:^-w && r:/etc/sudoers.d/ && r:-p wa && r:-k scope"

  - id: 19621
    title: "確保收集系統管理員操作 (sudolog)"
    description: "監視 sudo 日誌檔。如果系統已正確配置為停用 su 指令並強制所有管理員必須先登入然後使用 sudo 執行特權指令，則所有管理員指令都將記錄到 /var/log/sudo.log 。每當執行指令時，都會觸發審核事件，因為 /var/log/sudo.log 檔案將開啟進行寫入，並且執行的管理指令將寫入日誌。"
    rationale: "/var/log/sudo.log 中的變更表示管理員已執行指令或日誌檔案本身已被竄改。管理者希望將寫入稽核追蹤的事件與寫入 /var/log/sudo.log 的記錄相關聯，以驗證是否執行了未經授權的指令。"
    remediation: "將以下行新增到 /etc/audit/audit.rules 檔案中: -w /var/log/sudo.log -p wa -k actions。 注意: 系統必須配置為禁用 su（參見項目 5.6 確保 su 指令存取受到限制），以強制所有指令執行透過 sudo。這在控制台上將無效，因為管理員可以以 root 登入。重新載入 auditd 配置以設置活動設置可能需要系統重啟。"
    compliance:
      - cis: ["4.1.16"]
      - cis_csc: ["4.9"]
      - pci_dss: ["10.2.2"]
      - nist_800_53: ["AU.14", "AC.6", "AC.7"]
      - gpg_13: ["7.8"]
      - gdpr_IV: ["32.2", "35.7.d"]
      - hipaa: ["164.312.b"]
      - tsc: ["CC7.2", "CC6.1", "CC6.8", "CC7.3", "CC7.4"]
    condition: all
    rules:
      - "f:/etc/audit/audit.rules -> r:^-w && r:/var/log/sudo.log && r:-p wa && r:-k actions"

  - id: 19622
    title: "確保收集內核模組載入和卸載"
    description: '監控核心模組的載入和卸載。程式 insmod（安裝核心模組）、rmmod（刪除核心模組）和 modprobe（用於載入和卸載模組的更複雜的程序，以及一些其他功能）控制模組的載入和卸載。 init_module（載入模組）和delete_module（刪除模組）系統呼叫控制模組的載入和卸載。任何載入、卸載模組程式和系統呼叫的執行都會觸發一條標識為「modules」的稽核記錄。'
    rationale: "監視 insmod、rmmod 和 modprobe 的使用可以為系統管理員提供未經授權的使用者載入或卸載核心模組的證據，這可能會危及系統的安全。對 init_module 和 delete_module 系統呼叫的監視將反映未經授權的使用者試圖使用不同的程式來載入和卸載模組。"
    remediation: "對於 64 位系統，將以下行添加到 /etc/audit/audit.rules 檔案中： -w /sbin/insmod -p x -k modules | -w /sbin/rmmod -p x -k modules | -w /sbin/modprobe -p x -k modules | -a always,exit -F arch=b64 -S init_module -S delete_module -k modules。 注意：重新載入 auditd 配置以設置活動設置可能需要重新啟動系統。"
    compliance:
      - cis: ["4.1.17"]
      - cis_csc: ["5.1"]
      - pci_dss: ["10.2.7"]
      - nist_800_53: ["AU.14", "AU.6"]
      - gpg_13: ["7.9"]
      - gdpr_IV: ["32.2", "35.7.d"]
      - hipaa: ["164.312.b"]
      - tsc: ["CC7.2", "CC6.1", "CC6.8", "CC7.3", "CC7.4"]
    condition: all
    rules:
      - "f:/etc/audit/audit.rules -> r:^-w && r:/sbin/insmod && r:-p x && r:-k modules"
      - "f:/etc/audit/audit.rules -> r:^-w && r:/sbin/rmmod && r:-p x && r:-k modules"
      - "f:/etc/audit/audit.rules -> r:^-w && r:/sbin/modprobe && r:-p x && r:-k modules"
      - "f:/etc/audit/audit.rules -> r:^-a && r:always,exit|exit,always && r:-F arch=b32|-F arch=b64 && r:-S init_module && r:-S delete_module && r:-k modules"

  - id: 19623
    title: "確保審核配置不可變"
    description: '設定系統審計，使審計規則不能用auditctl修改。設定標誌“-e 2”強制審核置於不可變模式。審核變更只能在系統重新啟動時進行。'
    rationale: "在不可變模式下，未經授權的使用者無法對審核系統執行變更以隱藏惡意活動，然後復原審核規則。使用者很可能會注意到系統重新啟動，這可能會提醒管理員嘗試進行未經授權的審核變更。"
    remediation: "將以下行新增至 /etc/audit/audit.rules 檔案的末尾: -e 2。注意: 此設定將確保重新載入 auditd 配置以設定活動設定需要系統重新啟動。"
    compliance:
      - cis: ["4.1.18"]
      - cis_csc: ["6.2", "6.3"]
      - pci_dss: ["10.5"]
      - nist_800_53: ["AU.9"]
      - hipaa: ["164.312.b"]
      - tsc: ["CC7.2"]
    condition: all
    rules:
      - "c:tail -1 /etc/audit/audit.rules -> -e 2"

  - id: 19624
    title: "確保 rsyslog 服務已啟用"
    description: "安裝 rsyslog 軟體包後，需要將其啟動。"
    rationale: "如果 rsyslog 服務未啟用，系統將不會執行 syslog 服務。"
    remediation: "在 /etc/init/rsyslog.conf 中設置正確的啟動條件：start on filesystem"
    compliance:
      - cis: ["4.2.1.1"]
      - cis_csc: ["6.2", "6.3"]
      - pci_dss: ["10.1"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2", "CC6.1", "CC6.2", "CC6.3", "CC7.2", "CC7.3", "CC7.4"]
      - hipaa: ["164.312.b"]
    condition: all
    rules:
      - "c:initctl show-config rsyslog -> r:^rsyslog"
      - "c:initctl show-config rsyslog -> r:start on filesystem"

  # 4.2.1.3 Ensure rsyslog default file permissions configured (Scored)
  - id: 19625
    title: "確保配置了 rsyslog 預設檔權限"
    description: "rsyslog 將建立系統上尚不存在的日誌檔案。此設定控制將哪些權限套用至這些新建立的檔案。"
    rationale: "確保日誌檔案具有正確的權限以確保敏感資料已歸檔和保護非常重要。"
    remediation: "編輯 /etc/rsyslog.conf 和 /etc/rsyslog.d/*.conf 檔案並將 $FileCreateMode 設定為 0640 或更嚴格：   $FileCreateMode 0640"
    compliance:
      - cis: ["4.2.1.3"]
      - cis_csc: ["5.1"]
      - pci_dss: ["10.5.1", "10.5.2"]
      - nist_800_53: ["CM.1", "AU.9"]
      - tsc: ["CC5.2", "CC6.1", "CC7.2", "CC.7.3", "CC7.4"]
    condition: any
    rules:
      - 'f:/etc/rsyslog.conf -> r:^\$FileCreateMode 06\d0|^\$FileCreateMode 04\d0|^\$FileCreateMode 02\d0|^\$FileCreateMode 00\d0 && r:^\$FileCreateMode 0\d40|^\$FileCreateMode 0\d00'
      - 'd:/etc/rsyslog.d/ -> r:\. -> r:^\$FileCreateMode 06\d0|^\$FileCreateMode 04\d0|^\$FileCreateMode 02\d0|^\$FileCreateMode 00\d0 && r:^\$FileCreateMode 0\d40|^\$FileCreateMode 0\d00'

  - id: 19626
    title: "確保 rsyslog 配置為將日誌傳送到遠端日誌主機"
    description: "rsyslog 實用程式支援將其收集的日誌傳送至執行 syslogd(8) 的遠端日誌主機或從遠端主機接收訊息的功能，從而減少管理開銷。"
    rationale: "在遠端主機上儲存日誌資料可以保護日誌完整性免受本機攻擊。如果攻擊者獲得本機系統的 root 存取權限，他們就可以篡改或刪除本機系統上儲存的日誌資料。"
    remediation: "編輯 /etc/rsyslog.conf 和 /etc/rsyslog.d/*.conf 檔案，並添加以下行（其中 loghost.example.com 是您的中央日志主機的名稱）：*.* @@loghost.example.com。運行以下指令以重新載入 rsyslogd 配置：# pkill -HUP rsyslogd"
    compliance:
      - cis: ["4.2.1.4"]
      - cis_csc: ["6.6", "6.8"]
      - pci_dss: ["10.5.3"]
      - nist_800_53: ["CM.1", "AU.4"]
      - tsc: ["CC5.2"]
    references:
      - rsyslog.conf(5) man page
    condition: all
    rules:
      - 'c:grep -Rh ^*.*[^I][^I]*@ /etc/rsyslog.conf /etc/rsyslog.d/ -> r:^*.* @@\.+'

  - id: 19627
    title: "確保遠端 rsyslog 訊息僅在指定的日誌主機上接受"
    description: "預設情況下，rsyslog 不偵聽來自遠端系統的日誌訊息。 ModLoad 告訴 rsyslog 載入 imtcp.so 模組，以便它可以透過 TCP 監聽網路。 InputTCPServerRun 選項指示 rsyslogd 偵聽指定的 TCP 連接埠。"
    rationale: "本節中的指示可確保遠端日誌主機已配置為僅接受來自指定網域內的主機的 rsyslog 資料，且未設計為日誌主機的系統不接受任何遠端 rsyslog 訊息。這可以防止日誌資料被欺騙，並確保系統管理員在中央位置檢查相當完整的系統日誌資料。"
    remediation: "對於指定為日誌主機的主機，編輯 /etc/rsyslog.conf 檔案並取消註解或添加以下行:$ModLoad imtcp & $InputTCPServerRun 514。對於未指定為日誌主機的主機，編輯 /etc/rsyslog.conf 檔案並註解或刪除以下行: # $ModLoad imtcp # $InputTCPServerRun 514。運行以下指令重新載入 rsyslogd 配置: # pkill -HUP rsyslogd"
    compliance:
      - cis: ["4.2.1.5"]
      - cis_csc: ["9.2"]
      - pci_dss: ["10.5.1"]
    references:
      - rsyslog.conf(8) man page
    condition: all
    rules:
      - 'c:grep -Rh ^\$ModLoad[[:space:]]*imtcp /etc/rsyslog.conf /etc/rsyslog.d/ -> r:^\$ModLoad\s*\t*imtcp'
      - 'c:grep -Rh ^\$InputTCPServerRun /etc/rsyslog.conf /etc/rsyslog.d/ -> r:^\$InputTCPServerRun\s*\t*514'

  # 4.2.2.1 Ensure syslog-ng service is enabled (Scored)
  - id: 19628
    title: "確保 syslog-ng 服務已啟用"
    description: "安裝 syslog-ng 軟體包後，需要將其啟動。"
    rationale: "如果 syslog-ng 服務未啟用，系統可能會預設使用 syslogd 服務或缺少日誌記錄。"
    remediation: "執行以下指令來啟用 rsyslog :   # update-rc.d syslog-ng enable"
    compliance:
      - cis: ["4.2.2.1"]
      - cis_csc: ["6.2", "6.3"]
      - pci_dss: ["10.1"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2", "CC6.1", "CC6.2", "CC6.3", "CC7.2", "CC7.3", "CC7.4"]
      - hipaa: ["164.312.b"]
    condition: all
    rules:
      - "c:ls /etc/rc*.d/S*syslog-ng > r:/etc/rc2.d/S10syslog-ng  && r:/etc/rc3.d/S10syslog-ng && r:/etc/rc4.d/S10syslog-ng && r:/etc/rc5.d/S10syslog-ng"

  # 4.2.2.3 Ensure syslog-ng default file permissions configured (Scored)
  - id: 19629
    title: "確保配置了 syslog-ng 預設檔權限"
    description: "syslog-ng 將建立系統上尚不存在的日誌檔案。此設定控制將哪些權限套用至這些新建立的檔案。"
    rationale: "確保日誌檔案具有正確的權限以確保敏感的 syslog-ng 資料得到歸檔和保護非常重要。"
    remediation: "編輯 /etc/syslog-ng/syslog-ng.conf 並將 perm 選項設置為 0640 或更嚴格：     options { chain_hostnames(off); flush_lines(0); perm(0640); stats_freq(3600); threaded(yes); };"
    compliance:
      - cis: ["4.2.2.3"]
      - cis_csc: ["5.1"]
      - pci_dss: ["10.5.1", "10.5.2"]
      - nist_800_53: ["CM.1", "AU.9"]
      - tsc: ["CC5.2", "CC6.1", "CC7.2", "CC.7.3", "CC7.4"]
    condition: all
    rules:
      - 'f:/etc/syslog-ng/syslog-ng.conf -> r:^options && r:perm\(06\d0\)|perm\(04\d0\)|perm\(02\d0\)|perm\(00\d0\) && r:perm\(0\d40\)|perm\(0\d00\)'

  # 4.2.2.4 Ensure syslog-ng is configured to send logs to a remote log host (Not Scored)
  - id: 19630
    title: "確保 syslog-ng 配置為將日誌傳送到遠端日誌主機"
    description: "syslog-ng 公用程式支援將其收集的日誌傳送到遠端日誌主機或從遠端主機接收訊息的功能，從而減少管理開銷。"
    rationale: "在遠端主機上儲存日誌資料可以保護日誌完整性免受本機攻擊。如果攻擊者獲得本機系統的 root 存取權限，他們就可以篡改或刪除本機系統上儲存的日誌資料。"
    remediation: '編輯 /etc/syslog-ng/syslog-ng.conf 檔案並添加以下行 (其中 logfile.example.com 是您的中心日誌主機的名稱)。 destination logserver { tcp("logfile.example.com" port(514)); }; log { source(src); destination(logserver); }; 執行以下指令重新載入 rsyslogd 配置: # pkill -HUP syslog-ng'
    compliance:
      - cis: ["4.2.2.4"]
      - cis_csc: ["6.6", "6.8"]
      - pci_dss: ["10.5.3"]
      - nist_800_53: ["CM.1", "AU.4"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - "f:/etc/syslog-ng/syslog-ng.conf -> r:destination logserver"
      - 'f:/etc/syslog-ng/syslog-ng.conf -> r:log\.+source\.+destination'

  # 4.2.3 Ensure rsyslog or syslog-ng is installed (Scored)
  - id: 19631
    title: "確保安裝了 rsyslog 或 syslog-ng"
    description: "建議使用 rsyslog 和 syslog-ng 軟體來替代原始 syslogd 守護程序，它們對 syslogd 進行了改進，例如面向連接（即 TCP）的日誌傳輸、記錄到資料庫格式的選項以及日誌資料傳輸途中的加密到中央日誌伺服器。"
    rationale: "rsyslog 和 syslog-ng 的安全性增強功能（例如連線導向（即 TCP）的日誌傳輸、記錄到資料庫格式的選項以及到中央日誌伺服器的日誌資料加密）證明了安裝和配置該軟體包的合理性。"
    remediation: "使用以下其中一條指令來安裝 rsyslog 或 syslog-ng： # apt-get install rsyslog # apt-get install syslog-ng"
    compliance:
      - cis: ["4.2.3"]
      - cis_csc: ["6.2", "6.3"]
      - pci_dss: ["10.1"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2", "CC6.1", "CC6.2", "CC6.3", "CC7.2", "CC7.3", "CC7.4"]
      - hipaa: ["164.312.b"]
    condition: any
    rules:
      - "c:dpkg -s rsyslog -> r:install ok installed"
      - "c:dpkg -s syslog-ng -> r:install ok installed"

  #########################################
  # 5 Access, Authentication and Authorization
  #########################################

  - id: 19632
    title: "確保 cron 守護程式已啟用"
    description: "cron 守護程式用於在系統上執行批次作業。"
    rationale: "雖然系統上可能沒有需要執行的使用者作業，但系統確實有維護作業，其中可能包括必須執行的安全監控，並且使用 cron 來執行它們。"
    remediation: "請編輯 /etc/init/cron.conf 中的起始行，以符合以下內容： start on runlevel [2345]"
    compliance:
      - cis: ["5.1.1"]
      - cis_csc: ["5.1"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - "c:initctl show-config cron -> r:^cron"
      - "c:initctl show-config cron -> r:start on runlevel [2345]"

  # 5.1.2 Ensure permissions on /etc/crontab are configured (Scored)
  - id: 19633
    title: "確保配置了 /etc/crontab 的權限"
    description: "/etc/crontab 檔案由 cron 使用來控制自己的作業。此項目中的指令確保 root 是該檔案的使用者和群組擁有者，並且只有所有者才能存取該檔案。"
    rationale: "該檔案包含有關 cron 運行哪些系統作業的資訊。對這些檔案的寫入存取權限可以為非特權使用者提供提升權限的能力。對這些檔案的讀取存取權限可以使用戶能夠深入了解系統上運行的系統作業，並為他們提供一種獲得未經授權的特權存取權的方法。"
    remediation: "運行以下指令來設置 /etc/crontab 的所有權及許可權：chown root:root /etc/crontab 和 chmod og-rwx /etc/crontab"
    compliance:
      - cis: ["5.1.2"]
      - cis_csc: ["5.1"]
      - pci_dss: ["2.2.4"]
      - hipaa: ["164.312.b"]
      - nist_800_53: ["AU.14", "AC.7"]
      - tsc: ["CC7.2", "CC6.1"]
      - gpg_13: ["7.8"]
      - gdpr_IV: ["35.7", "32.2"]
    condition: all
    rules:
      - 'c:stat /etc/crontab -> r:^Access: \(0\d00/\w\w\w-------\)  Uid: \(    0/    root\)   Gid: \(    0/    root\)$'

  # 5.1.3 Ensure permissions on /etc/cron.hourly are configured (Scored)
  - id: 19634
    title: "確保配置了 /etc/cron.hourly 的權限"
    description: "此目錄包含需要每小時運行的系統 cron 作業。該目錄中的檔案無法透過 crontab 指令操作，而是由系統管理員使用文字編輯器進行編輯。以下指令限制對使用者和群組 root 的讀取/寫入和搜尋存取，防止普通使用者存取此目錄。"
    rationale: "向非特權使用者授予對此目錄的寫入存取權限可以為他們提供獲得未經授權的提升權限的方法。授予對此目錄的讀取存取權限可以讓非特權使用者了解如何獲得提升的權限或規避審核控制。"
    remediation: "執行以下指令來設置 /etc/cron.hourly 的所有權和權限 : chown root:root /etc/cron.hourly 和 chmod og-rwx /etc/cron.hourly"
    compliance:
      - cis: ["5.1.3"]
      - cis_csc: ["5.1"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]

    condition: all
    rules:
      - 'c:stat /etc/cron.hourly -> r:^Access: \(0\d00/\w\w\w\w------\)  Uid: \(    0/    root\)   Gid: \(    0/    root\)$'

  # 5.1.4 Ensure permissions on /etc/cron.daily are configured (Scored)
  - id: 19635
    title: "確保配置了 /etc/cron.daily 的權限"
    description: "/etc/cron.daily 目錄包含需要每天執行的系統 cron 作業。該目錄中的檔案無法透過 crontab 指令操作，而是由系統管理員使用文字編輯器進行編輯。以下指令限制對使用者和群組 root 的讀取/寫入和搜尋存取，防止普通使用者存取此目錄。"
    rationale: "向非特權使用者授予對此目錄的寫入存取權限可以為他們提供獲得未經授權的提升權限的方法。授予對此目錄的讀取存取權限可以讓非特權使用者了解如何獲得提升的權限或規避審核控制。"
    remediation: "執行以下指令來設置 /etc/cron.daily 的擁有權和權限 : chown root:root /etc/cron.daily 和 chmod og-rwx /etc/cron.daily"
    compliance:
      - cis: ["5.1.4"]
      - cis_csc: ["5.1"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:stat /etc/cron.daily -> r:^Access: \(0\d00/\w\w\w\w------\)  Uid: \(    0/    root\)   Gid: \(    0/    root\)$'

  # 5.1.5 Ensure permissions on /etc/cron.weekly are configured (Scored)
  - id: 19636
    title: "確保配置了 /etc/cron.weekly 的權限"
    description: "/etc/cron.weekly 目錄包含需要每週執行的系統 cron 作業。該目錄中的檔案無法透過 crontab 指令操作，而是由系統管理員使用文字編輯器進行編輯。以下指令限制對使用者和群組 root 的讀取/寫入和搜尋存取，防止普通使用者存取此目錄。"
    rationale: "向非特權使用者授予對此目錄的寫入存取權限可以為他們提供獲得未經授權的提升權限的方法。授予對此目錄的讀取存取權限可以讓非特權使用者了解如何獲得提升的權限或規避審核控制。"
    remediation: "執行以下指令來設定 /etc/cron.weekly 的擁有者和權限：chown root:root /etc/cron.weekly 和 chmod og-rwx /etc/cron.weekly"
    compliance:
      - cis: ["5.1.5"]
      - cis_csc: ["5.1"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:stat /etc/cron.weekly -> r:^Access: \(0\d00/\w\w\w\w------\)  Uid: \(    0/    root\)   Gid: \(    0/    root\)$'

  # 5.1.6 Ensure permissions on /etc/cron.monthly are configured (Scored)
  - id: 19637
    title: "確保配置了 /etc/cron.monthly 的權限"
    description: "/etc/cron.monthly 目錄包含需要每月執行的系統 cron 作業。該目錄中的檔案無法透過 crontab 指令操作，而是由系統管理員使用文字編輯器進行編輯。以下指令限制對使用者和群組 root 的讀取/寫入和搜尋存取，防止普通使用者存取此目錄。"
    rationale: "向非特權使用者授予對此目錄的寫入存取權限可以為他們提供獲得未經授權的提升權限的方法。授予對此目錄的讀取存取權限可以讓非特權使用者了解如何獲得提升的權限或規避審核控制。"
    remediation: "執行以下指令來設定 /etc/cron.monthly 的所有權和權限：chown root:root /etc/cron.monthly 和 chmod og-rwx /etc/cron.monthly"
    compliance:
      - cis: ["5.1.6"]
      - cis_csc: ["5.1"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:stat /etc/cron.monthly -> r:^Access: \(0\d00/\w\w\w\w------\)  Uid: \(    0/    root\)   Gid: \(    0/    root\)$'

  # 5.1.7 Ensure permissions on /etc/cron.d are configured (Scored)
  - id: 19638
    title: "確保配置了 /etc/cron.d 的權限"
    description: "配置/etc/cron.allow和/etc/at.allow以允許特定使用者使用這些服務。如果 /etc/cron.allow 或 /etc/at.allow 不存在，則檢查 /etc/at.deny 和 /etc/cron.deny。任何未在這些檔案中明確定義的使用者都可以使用 at 和 cron。透過刪除這些檔案，僅允許 /etc/cron.allow 和 /etc/at.allow 中的使用者使用 at 和 cron。請注意，即使 cron.allow 中未列出給定用戶，仍可以以該用戶身分執行 cron 作業。 cron.allow 檔案僅控制對用於規劃和修改 cron 作業的 crontab 指令的管理存取。"
    rationale: "在許多系統上，只有系統管理員有權安排 cron 作業。使用 cron.allow 檔案來控制誰可以執行 cron 作業來強制執行此原則。管理允許清單比管理拒絕清單更容易。在拒絕清單中，您可能會在系統中新增使用者 ID，但忘記將其新增至拒絕檔案。"
    remediation: "執行以下指令以刪除 /etc/cron.deny 和 /etc/at.deny，並創建 /etc/cron.allow 和 /etc/at.allow 並設置權限和擁有者: rm /etc/cron.deny;rm /etc/at.deny;touch /etc/cron.allow; touch /etc/at.allow; chmod og-rwx /etc/cron.allow; chmod og-rwx /etc/at.allow; chown root:root /etc/cron.allow 和 chown root:root /etc/at.allow"
    compliance:
      - cis: ["5.1.7"]
      - cis_csc: ["5.1"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:stat /etc/cron.d -> r:^Access: \(0\d00/\w\w\w\w------\)  Uid: \(    0/    root\)   Gid: \(    0/    root\)$'

  - id: 19639
    title: "確保 at/cron 僅限授權使用者使用"
    description: "配置/etc/cron.allow和/etc/at.allow以允許特定使用者使用這些服務。如果 /etc/cron.allow 或 /etc/at.allow 不存在，則檢查 /etc/at.deny 和 /etc/cron.deny。任何未在這些檔案中明確定義的使用者都可以使用 at 和 cron。透過刪除這些檔案，僅允許 /etc/cron.allow 和 /etc/at.allow 中的使用者使用 at 和 cron。請注意，即使 cron.allow 中未列出給定用戶，cron 作業仍可以以該用戶身分執行。 cron.allow 檔案僅控制對用於規劃和修改 cron 作業的 crontab 指令的管理存取。"
    rationale: "在許多系統上，只有系統管理員有權安排 cronjobs。使用 cron.allow 檔案來控制誰可以執行 cron 作業來強制執行此原則。管理允許清單比管理拒絕清單更容易。在拒絕清單中，您可能會在系統中新增使用者 ID，但忘記將其新增至拒絕檔案。"
    remediation: "運行以下指令來刪除 /etc/cron.deny 和 /etc/at.deny 並創建設置 /etc/cron.allow 和 /etc/at.allow 的權限和所有權: # rm /etc/cron.deny # rm /etc/at.deny # touch /etc/cron.allow # touch /etc/at.allow # chmod og-rwx /etc/cron.allow # chmod og-rwx /etc/at.allow # chown root:root /etc/cron.allow # chown root:root /etc/at.allow"
    compliance:
      - cis: ["5.1.8"]
      - cis_csc: ["16"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - "f:/etc/cron.allow"
      - "f:/etc/at.allow"
      - "not f:/etc/cron.deny"
      - "not f:/etc/at.deny"
      - 'c:stat /etc/cron.allow -> r:^Access: \(0\d00/\w\w\w\w------\)  Uid: \(    0/    root\)   Gid: \(    0/    root\)$'
      - 'c:stat /etc/at.allow -> r:^Access: \(0\d00/\w\w\w\w------\)  Uid: \(    0/    root\)   Gid: \(    0/    root\)$'

  # 5.2 SSH Server Configuration

  - id: 19640
    title: "確保配置了 /etc/ssh/sshd_config 的權限"
    description: "/etc/ssh/sshd_config 檔案包含 sshd 的設定規格。下面的指令將檔案的擁有者和群組設定為 root。"
    rationale: "需要保護 /etc/ssh/sshd_config 檔案免受非特權使用者未經授權的變更。"
    remediation: "執行以下指令來設置 /etc/ssh/sshd_config 的所有權和權限: # chown root:root /etc/ssh/sshd_config # chmod og-rwx /etc/ssh/sshd_config"
    compliance:
      - cis: ["5.2.1"]
      - cis_csc: ["5.1"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:stat /etc/ssh/sshd_config -> r:^Access: \(0\d00/\w\w\w\w------\)  Uid: \(    0/    root\)   Gid: \(    0/    root\)$'

  - id: 19641
    title: "確保 SSH 協定設定為 2"
    description: "SSH 支援兩種不同且不相容的協定：SSH1 和SSH2。 SSH1 是最初的協定，存在安全性問題。 SSH2 更先進、更安全。"
    rationale: "SSH v1 有不安全問題，但不會影響 SSH v2。注意：此指令在較新版本的 SSH 中不再存在。對於可能執行舊版 SSH 的系統，仍包含此檢查。從 openSSH 版本 7.4 開始，包含此參數不會導致問題。"
    remediation: "編輯 /etc/ssh/sshd_config 檔案以將參數設定如下: Protocol 2"
    compliance:
      - cis: ["5.2.2"]
      - cis_csc: ["14.4"]
      - pci_dss: ["4.1"]
      - hipaa: ["164.312.a.2.IV", "164.312.e.1", "164.312.e.2.I", "164.312.e.2.II"]
      - nist_800_53: ["SC.8"]
      - tsc: ["CC6.7"]
    condition: all
    rules:
      - 'f:/etc/ssh/sshd_config -> !r:^# && r:Protocol\s*\t*2'

  - id: 19642
    title: "確保 SSH LogLevel 設定為 INFO"
    description: "INFO 參數指定將記錄登入和登出活動。"
    rationale: "SSH 提供了多個具有不同詳細程度的日誌記錄等級。除了嚴格除錯 SSH 通訊之外，特別不建議使用 DEBUG，因為它提供的資料太多，很難識別重要的安全資訊。 INFO級別是基本級別，僅記錄SSH用戶的登入活動。在許多情況下，例如事件回應，確定特定使用者何時在系統上處於活動狀態非常重要。註銷記錄可以消除那些斷開連接的用戶，這有助於縮小範圍。"
    remediation: "編輯 /etc/ssh/sshd_config 檔案，將參數設定如下：LogLevel INFO"
    references:
      - https://www.ssh.com/ssh/sshd_config/
    compliance:
      - cis: ["5.2.3"]
      - cis_csc: ["6.2", "6.3"]
      - pci_dss: ["4.1"]
      - hipaa: ["164.312.a.2.IV", "164.312.e.1", "164.312.e.2.I", "164.312.e.2.II"]
      - nist_800_53: ["SC.8"]
      - tsc: ["CC6.7"]
    condition: all
    rules:
      - 'f:/etc/ssh/sshd_config -> r:^\s*LogLevel\s+INFO'

  - id: 19643
    title: "確保 SSH X11 轉送已停用"
    description: "X11Forwarding 參數提供透過連接隧道傳輸 X11 流量以啟用遠端圖形連接的能力。"
    rationale: "除非有直接使用 X11 應用程式的操作要求，否則停用 X11 轉送。透過 SSH 使用 X11 轉送登入的使用者的遠端 X11 伺服器可能會受到 X11 伺服器上其他使用者的危害，這是一個小風險。請注意，即使 X11 轉發已停用，使用者也始終可以安裝自己的轉發器。"
    remediation: "編輯 /etc/ssh/sshd_config 檔案將參數設定如下: X11Forwarding no"
    compliance:
      - cis: ["5.2.4"]
      - cis_csc: ["9.2"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
    condition: all
    rules:
      - 'f:/etc/ssh/sshd_config -> r:^\s*X11Forwarding\s+no'

  - id: 19644
    title: "確保 SSH MaxAuthTries 設定為 4 或更少"
    description: "MaxAuthTries 參數指定每個連線允許的最大驗證嘗試次數。當登入失敗計數達到一半時，錯誤訊息將寫入系統日誌檔案，詳細說明登入失敗。"
    rationale: "將 MaxAuthTries 參數設定為較低的數字可以最大限度地降低對 SSH 伺服器進行暴力攻擊的風險。雖然建議設定為 4，但請根據網站策略設定該數字。"
    remediation: "編輯 /etc/ssh/sshd_config 檔案以將參數設定如下：MaxAuthTries 4"
    compliance:
      - cis: ["5.2.5"]
      - cis_csc: ["16.13"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'f:/etc/ssh/sshd_config -> n:^\s*MaxAuthTries\s*\t*(\d+) compare <= 4'

  - id: 19645
    title: "確保 SSH IgnoreRhosts 已啟用"
    description: "IgnoreRhosts 參數指定 .rhosts 和 .shosts 檔案不會在 RhostsRSAAuthentication 或 HostbasedAuthentication 中使用。"
    rationale: "設定此參數會強制使用者在使用 ssh 進行身份驗證時輸入密碼。"
    remediation: "編輯 /etc/ssh/sshd_config 檔案並將參數設置如下: IgnoreRhosts yes"
    compliance:
      - cis: ["5.2.6"]
      - cis_csc: ["9.2"]
      - pci_dss: ["4.1"]
      - hipaa: ["164.312.a.2.IV", "164.312.e.1", "164.312.e.2.I", "164.312.e.2.II"]
      - nist_800_53: ["SC.8"]
      - tsc: ["CC6.7"]
    condition: all
    rules:
      - 'f:/etc/ssh/sshd_config -> r:^\s*IgnoreRhosts\s+yes'

  - id: 19646
    title: "確保停用 SSH HostbasedAuthentication"
    description: "HostbasedAuthentication 參數指定是否允許透過 .rhosts 或 /etc/hosts.equiv 使用者透過可信任主機進行驗證，以及成功的公鑰用戶端主機驗證。此選項僅適用於 SSH 協定版本 2。"
    rationale: "儘管如果在 /etc/pam.conf 中停用支持，.rhosts 檔案將無效，但停用在 SSH 中使用 .rhosts 檔案的功能可提供額外的保護層。"
    remediation: "編輯 /etc/ssh/sshd_config 檔案設定以下參數：HostbasedAuthentication no"
    compliance:
      - cis: ["5.2.7"]
      - cis_csc: ["16.3"]
      - pci_dss: ["4.1"]
      - hipaa: ["164.312.a.2.IV", "164.312.e.1", "164.312.e.2.I", "164.312.e.2.II"]
      - nist_800_53: ["SC.8"]
      - tsc: ["CC6.7"]
    condition: all
    rules:
      - 'f:/etc/ssh/sshd_config -> r:^\s*HostbasedAuthentication\s+no'

  - id: 19647
    title: "確保 SSH root 登入已停用"
    description: "PermitRootLogin 參數指定 root 使用者是否可以使用 ssh(1) 登入。預設為否。"
    rationale: "禁止透過 SSH 進行 root 登入需要伺服器管理員使用自己的個人帳戶進行身份驗證，然後透過 sudo 或 su 升級到 root。這反過來又限制了不可否認的機會，並在發生安全事件時提供清晰的審計追蹤。"
    remediation: "編輯 /etc/ssh/sshd_config 檔案以設定參數如下: PermitRootLogin no"
    compliance:
      - cis: ["5.2.8"]
      - cis_csc: ["4.3"]
      - pci_dss: ["4.1"]
      - hipaa: ["164.312.a.2.IV", "164.312.e.1", "164.312.e.2.I", "164.312.e.2.II"]
      - nist_800_53: ["SC.8"]
      - tsc: ["CC6.7"]
    condition: all
    rules:
      - 'f:/etc/ssh/sshd_config -> r:^\s*PermitRootLogin\s+no'

  - id: 19648
    title: "確保 SSH PermitEmptyPasswords 已停用"
    description: "PermitEmptyPasswords 參數指定伺服器是否允許使用空密碼字串登入帳戶。"
    rationale: "禁止遠端 shell 存取具有空密碼的帳戶可降低未經授權存取系統的可能性"
    remediation: "編輯 /etc/ssh/sshd_config 檔案來按如下設置參數: PermitEmptyPasswords no"
    compliance:
      - cis: ["5.2.9"]
      - cis_csc: ["16.3"]
      - pci_dss: ["4.1"]
      - hipaa: ["164.312.a.2.IV", "164.312.e.1", "164.312.e.2.I", "164.312.e.2.II"]
      - nist_800_53: ["SC.8"]
      - tsc: ["CC6.7"]
    condition: all
    rules:
      - 'f:/etc/ssh/sshd_config -> r:^\s*PermitEmptyPasswords\s+no'

  - id: 19649
    title: "確保 SSH PermitUserEnvironment 已停用"
    description: "PermitUserEnvironment 選項可讓使用者向 ssh 守護程式提供環境選項。"
    rationale: "允許使用者透過 SSH 守護程序設定環境變數的能力可能會允許使用者繞過安全控制（例如，設定讓 ssh 執行木馬程式的執行路徑）"
    remediation: "編輯 /etc/ssh/sshd_config 檔案以將參數設置如下: PermitUserEnvironment no"
    compliance:
      - cis: ["5.2.10"]
      - cis_csc: ["5.1"]
      - pci_dss: ["4.1"]
      - hipaa: ["164.312.a.2.IV", "164.312.e.1", "164.312.e.2.I", "164.312.e.2.II"]
      - nist_800_53: ["SC.8"]
      - tsc: ["CC6.7", "CC6.1", "CC7.2"]
    condition: all
    rules:
      - 'f:/etc/ssh/sshd_config -> r:^\s*PermitUserEnvironment\s+no'

  - id: 19650
    title: "確保僅使用經批准的 MAC 演算法"
    description: "此變數限制 SSH 在通訊過程中可以使用的 MAC 演算法的類型。"
    rationale: "MD5 和 96 位元 MAC 演算法被認為較弱，但已被證明可以提高 SSH 降級攻擊的可用性。弱演算法作為可以透過擴充計算能力來利用的弱點而繼續受到廣泛關注。破壞演算法的攻擊者可以利用 MiTM 位置來解密 SSH 隧道並捕獲憑證和訊息"
    remediation: "編輯 /etc/ssh/sshd_config 檔案，新增/修改 MACs 行以包含網站核准的 MACs 逗號分隔列表 例如: MACs hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com,hmac-sha2-512,hmac-sha2-256"
    compliance:
      - cis: ["5.2.11"]
      - cis_csc: ["14.4", "16.5"]
      - pci_dss: ["4.1"]
      - hipaa: ["164.312.a.2.IV", "164.312.e.1", "164.312.e.2.I", "164.312.e.2.II"]
      - nist_800_53: ["SC.8"]
      - tsc: ["CC6.7", "CC6.1", "CC7.2"]
    reference:
      - "http://www.mitls.org/pages/attacks/SLOTH"
    condition: none
    rules:
      - "c:sshd -T -> r:MACs && r:hmac-md5|hmac-md5-96|hmac-ripemd160|hmac-sha1|hmac-sha1-96|umac-64@openssh.com|umac-128@openssh.com|hmac-md5-etm@openssh.com|hmac-md5-96-etm@openssh.com|hmac-ripemd160-etm@openssh.com|hmac-sha1-etm@openssh.com|hmac-sha1-96-etm@openssh.com|umac-64-etm@openssh.com|umac-128-etm@openssh.com"

  - id: 19651
    title: "確保已配置 SSH 空閒超時間隔"
    description: "ClientAliveInterval 和 ClientAliveCountMax 兩個選項控制 ssh 會話的逾時。設定 ClientAliveInterval 變數後，在指定時間長度內沒有活動的 ssh 會話將會終止。設定 ClientAliveCountMax 變數後，sshd 會在每個 ClientAliveInterval 間隔發送客戶端活動訊息。當連續發送了一定數量的客戶端活動訊息而客戶端沒有回應時，ssh 會話將終止。例如，如果 ClientAliveInterval 設定為 15 秒，ClientAliveCountMax 設定為 3，則用戶端 ssh 會話將在 45 秒空閒時間後終止。"
    rationale: "沒有與連線關聯的逾時值可能會允許未經授權的使用者存取另一個使用者的 ssh 會話（例如，使用者離開電腦並且不鎖定螢幕）。設定超時值至少可以降低發生這種情況的風險。雖然建議設定為 300 秒（5 分鐘），但請根據網站策略設定此逾時值。 ClientAliveCountMax 的建議設定為 0。"
    remediation: "編輯 /etc/ssh/sshd_config 檔案以根據站點政策設定參數：ClientAliveInterval 300    ClientAliveCountMax 0"
    compliance:
      - cis: ["5.2.12"]
      - cis_csc: ["16.11"]
      - pci_dss: ["12.3.8"]
    condition: all
    rules:
      - 'f:/etc/ssh/sshd_config -> n:ClientAliveInterval\s*\t*(\d+) compare <= 300 && n:ClientAliveInterval\s*\t*(\d+) compare != 0'
      - 'f:/etc/ssh/sshd_config -> n:ClientAliveCountMax\s*\t*(\d+) compare <= 3'

  - id: 19652
    title: "確保 SSH LoginGraceTime 設定為一分鐘或更短"
    description: "LoginGraceTime 參數指定成功對 SSH 伺服器進行驗證所允許的時間。寬限期越長，存在的開放式未經身份驗證的連線就越多。與此會話中的其他會話控制一樣，寬限期應限制在適當的組織限制內，以確保服務可用於所需的存取。"
    rationale: "將 LoginGraceTime 參數設定為較小的數字將最大限度地降低對 SSH 伺服器進行暴力攻擊的成功風險。它還會限制平行未經身份驗證的連接的數量。"
    remediation: "編輯 /etc/ssh/sshd_config 檔案，將參數設定如下：LoginGraceTime 60"
    compliance:
      - cis: ["5.2.13"]
      - cis_csc: ["5.1"]
      - pci_dss: ["8.1"]
    condition: all
    rules:
      - 'f:/etc/ssh/sshd_config -> n:LoginGraceTime\s*\t*(\d+) compare <= 60 && n:LoginGraceTime\s*\t*(\d+) compare != 0'

  - id: 19653
    title: "確保 SSH 存取受到限制"
    description: "有多個選項可用於限制哪些使用者和群組可以透過 SSH 存取系統。建議至少利用以下選項之一：AllowUsers、AllowGroups、DenyUsers、DenyGroups。"
    rationale: "限制哪些使用者可以透過 SSH 遠端存取系統將有助於確保只有授權使用者才能存取系統。"
    remediation: "編輯 /etc/ssh/sshd_config 檔案以設定以下一個或多個參數: AllowUsers <userlist>    AllowGroups <grouplist>    DenyUsers <userlist>    DenyGroups <grouplist>"
    compliance:
      - cis: ["5.2.14"]
      - cis_csc: ["5.1"]
      - pci_dss: ["8.1"]
    condition: all
    rules:
      - 'f:/etc/ssh/sshd_config -> r:AllowUsers\s+\w+|AllowGroups\s+\w+|DenyUsers\s+\w+|DenyGroups\s+\w+'

  - id: 19654
    title: "確保已配置 SSH 警告橫幅"
    description: "Banner 參數指定一個檔案，在允許身份驗證之前，必須將其內容傳送給遠端使用者。預設情況下，不顯示橫幅。"
    rationale: "橫幅用於警告連接使用者特定網站的連線策略。在正常使用者登入之前呈現警告訊息可以幫助起訴電腦系統上的侵入者。"
    remediation: "編輯 /etc/ssh/sshd_config 檔案，將參數設置如下：Banner /etc/issue.net"
    compliance:
      - cis: ["5.2.15"]
      - cis_csc: ["5.1"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'f:/etc/ssh/sshd_config -> r:Banner\s*\t*/etc/issue.net'

  # 5.3 Configure PAM

  - id: 19655
    title: "確保配置密碼建立要求"
    description: "pam_pwquality.so 模組檢查密碼的強度。它執行檢查，例如確保密碼不是字典單字、具有一定長度、包含混合字元（例如字母、數字、其他）等。以下是 pam_pwquality.so 選項的定義： - retry=3（在發回失敗之前允許嘗試 3 次）。在 /etc/security/pwquality.conf 檔案中設定以下選項： - minlen = 14 dcredit = -1 ucredit = -1 ocredit = -1 lcredit = -1 （上面顯示的設定是一種可能的策略。更改這些值以符合您自己組織的密碼策略。"
    rationale: "強密碼可以保護系統免於暴力破解。"
    remediation: "1) 執行以下指令來安裝 pam_pwquality 模組: apt-get install libpam-pwquality 2) 編輯 /etc/pam.d/common-password 檔案以包含 pam_pwquality.so 的適當選項並符合站點政策: password requisite pam_pwquality.so retry=3 3) 編輯 /etc/security/pwquality.conf 以新增或更新以下設定以符合站點政策: minlen = 14 dcredit = -1 ucredit = -1 ocredit = -1 lcredit = -1。注意: 其他模組選項可以設置，建議要求只包括 try_first_pass 和 minlen 設置為 14 或以上。/etc/security/pwquality.conf 中的設定必須在 = 符號周圍使用空格。"
    compliance:
      - cis: ["5.3.1"]
      - cis_csc: ["4.4"]
      - pci_dss: ["8.2.3"]
    condition: all
    rules:
      - "c:dpkg -s libpam-pwquality -> r:install ok installed"
      - 'f:/etc/pam.d/common-password -> !r:^# && r:password\s*\t*requisite\s*\t*pam_pwquality.so\s*\t*retry=\d'
      - 'f:/etc/security/pwquality.conf -> !r:^# && n:minlen\s*\t*=\s*\t*(\d+) compare >= 14'

  - id: 19656
    title: "確保配置了密碼嘗試失敗的鎖定"
    description: "連續 n 次登入嘗試失敗後鎖定使用者。第一組變更是對 PAM 設定檔進行的。第二組變更應用於程式特定的 PAM 設定檔。第二組變更必須套用於將鎖定使用者的每個程式。檢查每個輔助程式的檔案，以了解如何配置它們以與 PAM 一起使用的說明。將鎖定號碼設定為您網站上有效的策略。"
    rationale: "在連續 n 次不成功的登入嘗試後鎖定使用者 ID 可減輕針對系統的暴力密碼攻擊。"
    remediation: "編輯 /etc/pam.d/common-auth 檔案並添加以下身份驗證行: auth required pam_tally2.so onerr=fail audit silent deny=5 unlock_time=900."
    compliance:
      - cis: ["5.3.2"]
      - cis_csc: ["16.7"]
      - pci_dss: ["8.2.5"]
    condition: all
    rules:
      - 'f:/etc/pam.d/common-auth -> !r:^# && r:auth\s*\t*required\s*\t*pam_tally2.so && r:onerr=fail && r:audit && r:silent && r:deny\s*=\s*\d+ && r:unlock_time\s*=\s*\d+'

  - id: 19657
    title: "確保密碼重複使用受到限制"
    description: "/etc/security/opasswd 檔案儲存使用者的舊密碼，可以檢查該檔案以確保使用者沒有重複使用最近的密碼。"
    rationale: "強制使用者不要重複使用過去 5 個密碼，可以降低攻擊者猜測密碼的可能性。請注意，這些變更僅適用於本機系統上配置的帳戶。"
    remediation: "編輯 /etc/pam.d/common-password 檔案以包括「remember」選項並遵守網站政策，如下所示: password required pam_pwhistory.so remember=5。 注意: 可能會設置其他模組選項，建議僅涵蓋此處列出的選項。"
    compliance:
      - cis: ["5.3.3"]
      - cis_csc: ["16"]
      - pci_dss: ["8.2.5"]
    condition: none
    rules:
      - 'f:/etc/pam.d/common-password -> !r:^# && r:password\s*\t*required\s*\t*pam_pwhistory.so && n:remember\s*\t*=\s*\t*(\d+) compare < 5'
      - 'f:/etc/pam.d/common-password -> !r:^# && r:password\s*\t*required\s*\t*pam_pwhistory.so && !r:remember'

  # 5.3.4 Ensure password hashing algorithm is SHA-512 (Scored)
  - id: 19658
    title: "確保密碼雜湊演算法為 SHA-512"
    description: "以下指令將密碼加密從 md5 更改為 sha512（一種更強的雜湊演算法）。所有現有帳戶都需要執行密碼更改，以將儲存的雜湊值升級到新演算法。"
    rationale: "SHA-512 演算法提供比 MD5 更強的雜湊，從而透過增加攻擊者成功確定密碼的難度來為系統提供額外的保護。請注意，這些變更僅適用於本機系統上配置的帳戶。"
    remediation: "編輯 /etc/pam.d/common-password 檔案以包含 pam_unix.so 的 sha512 選項，如下所示: password [success=1 default=ignore] pam_unix.so sha512"
    compliance:
      - cis: ["5.3.4"]
      - cis_csc: ["16.4"]
      - pci_dss: ["3.6.1"]
    condition: none
    rules:
      - 'f:/etc/pam.d/common-password -> r:^password\.+pam_unix.so && !r:sha512'

  # 5.4 User Accounts and Environment

  - id: 19659
    title: "確保密碼有效期限為 365 天或更短"
    description: "/etc/login.defs 中的 PASS_MAX_DAYS 參數允許管理者在密碼達到定義的期限後強制密碼過期。建議將PASS_MAX_DAYS參數設定為小於或等於365天。"
    rationale: "攻擊者利用受損憑證或透過線上暴力攻擊成功破解憑證的機會視窗受到密碼期限的限制。因此，降低密碼的最長使用期限也會減少攻擊者的機會視窗。"
    remediation: "在 /etc/login.defs 中設置 PASS_MAX_DAYS 參數以符合網站政策: PASS_MAX_DAYS 90。修改所有已設定密碼的使用者參數以匹配: # chage --maxdays 90 <user>。註: 您也可以直接在 /etc/shadow 中檢查此設定。對於所有已設定密碼的使用者，第五欄應為 365 或更少。值為 -1 將禁用密碼過期。另外，密碼過期時間必須大於兩次密碼變更之間的最小天數，否則使用者將無法更改其密碼。"
    compliance:
      - cis: ["5.4.1.1"]
      - cis_csc: ["4.4", "16"]
      - pci_dss: ["8.2.4"]
    condition: all
    rules:
      - 'f:/etc/login.defs -> n:^\s*\t*PASS_MAX_DAYS\s*\t*(\d+) compare <= 365'
      - 'not f:/etc/login.defs -> n:^\s*\t*PASS_MAX_DAYS\s*\t*(\d+) compare < 0'

  - id: 19660
    title: "確保密碼變更之間的最短天數為 7 或更長"
    description: "/etc/login.defs 中的 PASS_MIN_DAYS 參數允許管理員阻止使用者更改其密碼，直到自使用者上次更改密碼以來經過最少天數。建議將 PASS_MIN_DAYS 參數設定為 7 天或更多天。"
    rationale: "透過限制密碼變更頻率，管理者可以防止使用者重複更改密碼以試圖規避密碼重複使用控制。"
    remediation: "將 PASS_MIN_DAYS 參數設為 7 在 /etc/login.defs: PASS_MIN_DAYS 7。 修改所有設定密碼的用戶參數以匹配: # chage --mindays 7 <user>。 注意: 您也可以直接在 /etc/shadow 中檢查此設置。 第四字段應該是 7 或更多，對於所有設置密碼的用戶。"
    compliance:
      - cis: ["5.4.1.2"]
      - cis_csc: ["4.4", "16"]
      - pci_dss: ["3.6.1"]
    condition: all
    rules:
      - 'f:/etc/login.defs -> n:^\s*\t*PASS_MIN_DAYS\s*\t*(\d+) compare >= 7'

  - id: 19661
    title: "確保密碼過期警告天數為 7 或更長"
    description: "/etc/login.defs 中的 PASS_WARN_AGE 參數可讓管理者通知使用者其密碼將在定義的天數內過期。建議將PASS_WARN_AGE參數設定為7天或更多天。"
    rationale: "提供密碼即將過期的預先警告，讓使用者有時間考慮安全的密碼。不知情的用戶可能會選擇一個簡單的密碼或將其寫在可能被發現的地方。"
    remediation: "將 PASS_WARN_AGE 參數設置為 7 在 /etc/login.defs: PASS_WARN_AGE 7. 修改所有設置了密碼的用戶參數以匹配: # chage --warndays 7 <user>. 注意事項: 您也可以直接在 /etc/shadow 中檢查此設置。對於所有設置了密碼的用戶，第6個字段應該為7或更多。"
    compliance:
      - cis: ["5.4.1.3"]
      - cis_csc: ["4.4", "16"]
      - pci_dss: ["3.6.1"]
    condition: all
    rules:
      - 'f:/etc/login.defs -> n:^\s*\t*PASS_WARN_AGE\s*\t*(\d+) compare >= 7'

  - id: 19662
    title: "確保非活動密碼鎖定時間不超過 30 天"
    description: "在給定時間段內不活動的使用者帳戶可以自動停用。建議停用密碼過期後 30 天內不活動的帳號。"
    rationale: "不活動的帳戶對系統安全性構成威脅，因為使用者登入時不會注意到失敗的登入嘗試或其他異常情況。"
    remediation: "執行以下指令來將預設的密碼不活動期設置為30天：# useradd -D -f 30。修改所有設置密碼的用戶參數以匹配：# chage --inactive 30 <user>。注意：你也可以直接在/etc/shadow檢查這個設置。對於所有設置密碼的用戶，第7欄應該是30或更少。值為-1將會禁用此設置。"
    compliance:
      - cis: ["5.4.1.4"]
      - cis_csc: ["4.4", "16"]
      - pci_dss: ["3.6.1"]
    condition: all
    rules:
      - 'c:useradd -D -> n:^INACTIVE=(\d+) compare <= 30'
      - 'not c:useradd -D -> n:^INACTIVE=(\d+) compare < 0'

  - id: 19663
    title: "確保 root 帳戶的預設群組是 GID 0"
    description: "usermod指令可用來指定root使用者屬於哪個群組。這會影響 root 使用者所建立的檔案的權限。"
    rationale: "對 root 帳號使用 GID 0 有助於防止非特權使用者意外存取 root 擁有的檔案。"
    remediation: "執行以下指令將 root 使用者的預設群組設置為 GID 0: # usermod -g 0 root"
    compliance:
      - cis: ["5.4.3"]
      - cis_csc: ["5.1"]
      - pci_dss: ["3.6.1"]
    condition: all
    rules:
      - 'f:/etc/passwd -> !r:^# && r:root:\w+:\w+:0:'

  - id: 19664
    title: "確保預設使用者 umask 為 027 或更具限制性"
    description: "預設umask決定了使用者建立的檔案的權限。建立檔案的使用者可以自行決定透過 chmod 指令使其檔案和目錄可供其他人讀取。希望預設允許其他人讀取其檔案和目錄的使用者可以透過將 umask 指令插入其主目錄中的標準 shell 設定檔（ .profile 、 .bashrc 等）來選擇不同的預設 umask。"
    rationale: "為 umask 設定一個非常安全的預設值可確保使用者對其檔案權限做出有意識的選擇。預設 umask 設定 077 會導致系統上的任何其他使用者無法讀取使用者建立的檔案和目錄。 umask 為 027 將使檔案和目錄可供同一 Unix 群組中的使用者讀取，而 umask 為 022 將使檔案可供系統上的每個使用者讀取。"
    remediation: "編輯 /etc/bash.bashrc 、 /etc/profile 和 /etc/profile.d/*.sh 檔案（以及系統上支援的任何其他 shell 的相應檔案），並新增或編輯任何 umask 參數，如下所示：umask 027"
    compliance:
      - cis: ["5.4.4"]
      - cis_csc: ["13"]
      - pci_dss: ["3.6.1"]
    condition: none
    rules:
      - 'f:/etc/bash.bashrc -> !r:^\s*\t*# && r:umask \d0\d|umask \d1\d|umask \d4\d|umask \d5\d'
      - 'f:/etc/bash.bashrc -> !r:^\s*\t*# && n:umask \d\d(\d) compare != 7'
      - 'f:/etc/profile -> !r:^\s*\t*# && r:umask \d0\d|umask \d1\d|umask \d4\d|umask \d5\d'
      - 'f:/etc/profile -> !r:^\s*\t*# && n:umask \d\d(\d) compare != 7'
      - 'd:/etc/profile.d -> .sh -> !r:^\s*\t*# && r:umask \d0\d|umask \d1\d|umask \d4\d|umask \d5\d'
      - 'd:/etc/profile.d -> .sh -> !r:^\s*t*# && n:umask \d\d(\d) compare != 7'

  # 5.4.5 Ensure default user shell timeout is 900 seconds or less (Scored)
  - id: 19665
    title: "確保預設使用者 shell 逾時為 900 秒或更短"
    description: "預設的 TMOUT 決定使用者的 shell 逾時。 TMOUT 值以秒為單位測量。"
    rationale: "沒有與 shell 關聯的逾時值可能會允許未經授權的使用者存取另一個使用者的 shell 會話（例如，使用者離開電腦並且不鎖定螢幕）。設定超時值至少可以降低發生這種情況的風險。"
    remediation: "編輯 /etc/bashrc、/etc/profile 和 /etc/profile.d/*.sh 檔案（以及系統上支持的任何其他 Shell 的相應檔案），添加或編輯任何 umask 參數如下：TMOUT=600"
    compliance:
      - cis: ["5.4.5"]
      - cis_csc: ["16.11"]
      - pci_dss: ["12.3.8"]
    condition: all
    rules:
      - 'f:/etc/bashrc -> n:^\s*\t*TMOUT\s*\t*=\s*\t*(\d+) compare <= 900'
      - 'f:/etc/profile -> n:^\s*\t*TMOUT\s*\t*=\s*\t*(\d+) compare <= 900'

  - id: 19666
    title: "確保對 su 指令的存取受到限制"
    description: "su 指令允許使用者以另一個使用者的身分執行指令或 shell。該程式已被 sudo 取代，它允許對特權存取進行更精細的控制。通常，su 指令可以由任何使用者執行。透過取消註解/etc/pam.d/su中的pam_wheel.so語句，su指令將只允許wheel群組中的使用者執行su。"
    rationale: "限制 su 的使用並使用 sudo 代替它，可以使系統管理員更好地控制使用者權限的升級以執行特權指令。 sudo 實用程式還提供了更好的日誌記錄和審核機制，因為它可以記錄透過 sudo 執行的每個指令，而 su 只能記錄使用者執行了 su 程式。"
    remediation: "1) 將以下行新增到 /etc/pam.d/su 檔案中: auth required pam_wheel.so 2) 在 /etc/group 檔案的 wheel 聲明中創建一個以逗號分隔的用戶列表: wheel:x:10:root,<用戶列表> 注意: pam_wheel.so 的 use_uid 選項在基於 debian 的系統上無效。這是可以接受的，但不是必需的，因為這些系統預設使用其行為。"
    compliance:
      - cis: ["5.6"]
      - cis_csc: ["5.1"]
      - pci_dss: ["10.2.5"]
      - hipaa: ["164.312.b"]
      - nist_800_53: ["AU.14", "AC.7"]
      - tsc: ["CC7.2", "CC6.1", "CC6.8", "CC7.3", "CC7.4"]
      - gpg_13: ["7.8"]
      - gdpr_IV: ["35.7", "32.2"]
    condition: all
    rules:
      - 'f:/etc/pam.d/su -> !r:^# && r:auth\s*\t*required\s*\t*pam_wheel.so'
      - 'f:/etc/group -> !r:^# && r:wheel:\w+:\d+:\.'

  ###############################
  # 6 System Maintenance
  ###############################

  - id: 19667
    title: "確保配置了 /etc/passwd 的權限"
    description: "/etc/passwd 檔案包含許多系統實用程式使用的使用者帳戶訊息，因此必須可讀，這些實用程式才能運作。"
    rationale: "確保 /etc/passwd 檔案免受未經授權的寫入存取至關重要。儘管預設情況下它受到保護，但檔案權限可能會被無意或透過惡意操作更改。"
    remediation: "請執行以下指令來設定 /etc/passwd 的權限: # chown root:root /etc/passwd # chmod 644 /etc/passwd"
    compliance:
      - cis: ["6.1.2"]
      - cis_csc: ["16.4"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:stat /etc/passwd -> r:Access:\s*\(0644/-rw-r--r--\)\s*Uid:\s*\(\s*\t*0/\s*\t*root\)\s*\t*Gid:\s*\(\s*\t*0/\s*\t*root\)'

  - id: 19668
    title: "確保配置了 /etc/shadow 的權限"
    description: "/etc/shadow 檔案用於儲存對這些帳戶的安全性至關重要的有關使用者帳戶的資訊，例如雜湊密碼和其他安全資訊。"
    rationale: "如果攻擊者可以獲得 /etc/shadow 檔案的讀取權限，他們就可以輕鬆地針對雜湊密碼執行密碼破解程式來破解它。儲存在 /etc/shadow 檔案中的其他安全資訊（例如到期時間）也可能有助於破壞使用者帳戶。"
    remediation: "運行以下指令以設置 /etc/shadow 的權限： # chown root:shadow /etc/shadow # chmod o-rwx,g-wx /etc/shadow"
    compliance:
      - cis: ["6.1.3"]
      - cis_csc: ["16.4"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:stat /etc/shadow -> r:Access:\s*\(0\d\d0/-\w\w-\w-----\)\s*Uid:\s*\(\s*\t*0/\s*\t*root\)\s*\t*Gid:\s*\(\s*\t*\d+/\s*\t*shadow\)'

  - id: 19669
    title: "確保配置了 /etc/group 的權限"
    description: "/etc/group 檔案包含系統中定義的所有有效群組的清單。下面的指令允許 root 進行讀取/寫入存取，並允許其他人進行讀取存取。"
    rationale: "/etc/group 檔案需要受到保護，防止非特權使用者進行未經授權的更改，但需要可讀，因為此資訊與許多非特權程式一起使用。"
    remediation: "執行以下指令來設置 /etc/group 的權限: # chown root:root /etc/group # chmod 644 /etc/group"
    compliance:
      - cis: ["6.1.4"]
      - cis_csc: ["16.4"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:stat /etc/group -> r:Access:\s*\(0644/-rw-r--r--\)\s*Uid:\s*\(\s*\t*0/\s*\t*root\)\s*\t*Gid:\s*\(\s*\t*0/\s*\t*root\)'

  - id: 19670
    title: "確保配置了 /etc/gshadow 的權限"
    description: "/etc/gshadow 檔案用於儲存對這些帳戶的安全性至關重要的群組訊息，例如雜湊密碼和其他安全資訊。"
    rationale: "如果攻擊者可以獲得 /etc/gshadow 檔案的讀取權限，他們就可以輕鬆地針對雜湊密碼執行密碼破解程式來破解它。儲存在 /etc/gshadow 檔案中的其他安全資訊（例如群組管理員）也可能有助於破壞群組"
    remediation: "執行以下指令來設定 /etc/gshadow 的權限 : # chown root:shadow /etc/gshadow # chmod o-rwx,g-rw /etc/gshadow"
    compliance:
      - cis: ["6.1.5"]
      - cis_csc: ["16.4"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:stat /etc/gshadow -> r:Access:\s*\(0\d\d0/-\w\w-\w-----\)\s*Uid:\s*\(\s*\t*0/\s*\t*root\)\s*\t*Gid:\s*\(\s*\t*\d+/\s*\t*shadow\)'

  - id: 19671
    title: "確保 /etc/passwd- 上的權限已配置"
    description: "/etc/passwd- 檔案包含備份使用者帳號資訊。"
    rationale: "確保 /etc/passwd- 檔案免受未經授權的存取至關重要。儘管預設情況下它受到保護，但檔案權限可能會被無意或透過惡意操作更改。"
    remediation: "執行以下指令以設定 /etc/passwd- 的權限: # chown root:root /etc/passwd- # chmod 644 /etc/passwd-"
    compliance:
      - cis: ["6.1.6"]
      - cis_csc: ["16.4"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:stat /etc/passwd- -> r:Access:\s*\(0\d\d\d/-\w\w-\w--\w--\)\s*Uid:\s*\(\s*\t*0/\s*\t*root\)\s*\t*Gid:\s*\(\s*\t*0/\s*\t*root\)'

  - id: 19672
    title: "確保 /etc/shadow- 上的權限已配置"
    description: "/etc/shadow- 檔案用於儲存對使用者帳戶的安全性至關重要的備份訊息，例如雜湊密碼和其他安全資訊。"
    rationale: "確保 /etc/shadow- 檔案免受未經授權的存取至關重要。儘管預設情況下它受到保護，但檔案權限可能會被無意或透過惡意操作更改。"
    remediation: "執行以下適當的 chown 指令以及 chmod 指令來設置 /etc/shadow- 的權限： # chown root:root /etc/shadow- # chown root:shadow /etc/shadow- # chmod o-rwx,g-rw /etc/shadow-"
    compliance:
      - cis: ["6.1.7"]
      - cis_csc: ["16.4"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:stat /etc/shadow- -> r:Access:\s*\(0\d\d0/-\w\w-\w-----\)\s*Uid:\s*\(\s*\t*0/\s*\t*root\)\s*\t*Gid:\s*\(\s*\t*\d+/\s*\t*shadow\)'

  - id: 19673
    title: "確保 /etc/group- 上的權限已配置"
    description: "/etc/group- 檔案包含系統中定義的所有有效群組的備份清單。"
    rationale: "確保 /etc/group- 檔案免受未經授權的存取至關重要。儘管預設情況下它受到保護，但檔案權限可能會被無意或透過惡意操作更改。"
    remediation: "執行以下指令以設定 /etc/group- 的權限：# chown root:root /etc/group- # chmod 644 /etc/group-"
    compliance:
      - cis: ["6.1.8"]
      - cis_csc: ["16.4"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:stat /etc/group- -> r:Access:\s*\(0\d\d\d/-\w\w-\w--\w--\)\s*Uid:\s*\(\s*\t*0/\s*\t*root\)\s*\t*Gid:\s*\(\s*\t*0/\s*\t*root\)'

  - id: 19674
    title: "確保 /etc/gshadow- 上的權限已配置"
    description: "/etc/gshadow- 檔案用於儲存對這些帳戶的安全性至關重要的群組的備份訊息，例如散列密碼和其他安全資訊。"
    rationale: "確保 /etc/gshadow- 檔案免受未經授權的存取至關重要。儘管預設情況下它受到保護，但檔案權限可能會被無意或透過惡意操作更改。"
    remediation: "# chown root:root /etc/gshadow- # chown root:shadow /etc/gshadow- # chmod o-rwx,g-rw /etc/gshadow-"
    compliance:
      - cis: ["6.1.9"]
      - cis_csc: ["16.4"]
      - pci_dss: ["2.2.4"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:stat /etc/gshadow- -> r:Access:\s*\(0\d\d0/-\w\w-\w-----\)\s*Uid:\s*\(\s*\t*0/\s*\t*root\)\s*\t*Gid:\s*\(\s*\t*\d+/\s*\t*shadow\)'

  # 6.2 User and Group Settings

  - id: 19675
    title: "確保密碼欄位不為空"
    description: "密碼欄位為空的帳戶意味著任何人都可以登入該使用者而無需提供密碼。"
    rationale: "所有帳戶必須有密碼或被鎖定，以防止未經授權的使用者使用該帳戶。"
    remediation: "如果 /etc/shadow 檔案中的任何帳戶沒有密碼，執行以下指令以鎖定該帳戶，直到可以確定為何它沒有密碼為止: # passwd -l <em><username></em>。另外，檢查該帳戶是否已登入並調查其用途，以確定是否需要強制解除。"
    compliance:
      - cis: ["6.2.1"]
      - cis_csc: ["4.4"]
      - pci_dss: ["8.2"]
    condition: none
    rules:
      - 'f:/etc/shadow -> r:^\w+::'

  - id: 19676
    title: '確保 /etc/passwd 中不存在舊的“+”條目'
    description: "各種檔案中的字元 + 曾經是系統在系統設定檔中的某個點插入來自 NIS 映射的資料的標記。大多數系統不再需要這些條目，但可能存在於從其他平台匯入的檔案中。"
    rationale: "這些條目可能為攻擊者提供獲得系統特權存取的途徑。"
    remediation: "如果存在，請移除 /etc/passwd 中的任何舊有 + 入口。"
    compliance:
      - cis: ["6.2.2"]
      - cis_csc: ["16.2"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
    condition: none
    rules:
      - "f:/etc/passwd -> !r:^# && r:^+:"

  - id: 19677
    title: '確保 /etc/shadow 中不存在舊的“+”條目'
    description: "各種檔案中的字元 + 曾經是系統在系統設定檔中的某個點插入來自 NIS 映射的資料的標記。大多數系統不再需要這些條目，但可能存在於從其他平台匯入的檔案中。"
    rationale: "這些條目可能為攻擊者提供獲得系統特權存取的途徑。"
    remediation: "若存在的話，從 /etc/shadow 中移除所有遺留的 + 項目。"
    compliance:
      - cis: ["6.2.3"]
      - cis_csc: ["16.2"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
    condition: none
    rules:
      - "f:/etc/shadow -> !r:^# && r:^+:"

  - id: 19678
    title: '確保 /etc/group 中不存在舊的“+”條目'
    description: "各種檔案中的字元 + 曾經是系統在系統設定檔中的某個點插入來自 NIS 映射的資料的標記。大多數系統不再需要這些條目，但可能存在於從其他平台匯入的檔案中。"
    rationale: "這些條目可能為攻擊者提供獲得系統特權存取的途徑。"
    remediation: "如果存在，請從 /etc/group 中刪除此類任何遺留的 + 項目。"
    compliance:
      - cis: ["6.2.4"]
      - cis_csc: ["16.2"]
      - pci_dss: ["2.2.3"]
      - nist_800_53: ["CM.1"]
      - tsc: ["CC5.2"]
      - gpg_13: ["4.3"]
      - gdpr_IV: ["35.7.d"]
      - hipaa: ["164.312.b"]
    condition: none
    rules:
      - "f:/etc/group -> !r:^# && r:^+:"

  - id: 19679
    title: "確保 root 是唯一的 UID 0 帳戶"
    description: "任何 UID 為 0 的帳戶都具有系統的超級使用者權限。"
    rationale: "此存取必須僅限於預設 root 帳戶並且只能透過系統控制台進行。管理存取必須透過非特權帳戶使用經批准的機制進行，如第 5.6 項所述，確保對 su 指令的存取受到限制。"
    remediation: "移除除 root 之外任何 UID 為 0 的使用者，或者在合適情況下給予他們新 UID。"
    compliance:
      - cis: ["6.2.5"]
      - cis_csc: ["5.1"]
      - pci_dss: ["10.2.5"]
      - hipaa: ["164.312.b"]
      - nist_800_53: ["AU.14", "AC.7"]
      - tsc: ["CC7.2", "CC6.1", "CC6.8", "CC7.3", "CC7.4"]
      - gpg_13: ["7.8"]
      - gdpr_IV: ["35.7", "32.2"]
    condition: none
    rules:
      - 'f:/etc/passwd -> !r:^# && !r:^root: && r:^\w+:\w+:0:'

  - id: 19680
    title: "確保影子組為空"
    description: "影子群組允許需要存取權限的系統程式讀取 /etc/shadow 檔案。不應將任何使用者指派到影子群組。"
    rationale: "分配給影子群組的任何使用者都將被授予對 /etc/shadow 檔案的讀取權限。如果攻擊者可以獲得 /etc/shadow 檔案的讀取權限，他們就可以輕鬆地針對雜湊密碼執行密碼破解程式來破解它們。儲存在 /etc/shadow 檔案中的其他安全資訊（例如到期時間）也可能有助於破壞其他使用者帳戶。"
    remediation: "將所有用戶從 shadow 群組中移除，並將任何以 shadow 為主要群組的用戶的主要群組更改。"
    compliance:
      - cis: ["6.2.20"]
      - cis_csc: ["16"]
      - pci_dss: ["10.2.5"]
      - hipaa: ["164.312.b"]
      - nist_800_53: ["AU.14", "AC.7"]
      - tsc: ["CC7.2", "CC6.1", "CC6.8", "CC7.3", "CC7.4"]
      - gpg_13: ["7.8"]
      - gdpr_IV: ["35.7", "32.2"]
    condition: none
    rules:
      - 'f:/etc/group -> !r:^# && r:shadow:\w*:\w*:\S+'
